/**
   Zwibbler

   Copyright 2019 Hanov Solutions Inc. All Rights Reserved. This software is
   NOT open source. For licensing information, contact the author.

   steve.hanov@gmail.com

   @license
 */
(function(){var __extends = (function () {
  var extendStatics = Object.setPrototypeOf ||
      ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
      function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
  return function (d, b) {
      extendStatics(d, b);
      function __() { this.constructor = d; }
      d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
  function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
  return new (P || (P = Promise))(function (resolve, reject) {
      function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
      function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
      function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
      step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
  var _ = { label: 0, sent: function () { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
  return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function () { return this; }), g;
  function verb(n) { return function (v) { return step([n, v]); }; }
  function step(op) {
      if (f) throw new TypeError("Generator is already executing.");
      while (_) try {
          if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
          if (y = 0, t) op = [op[0] & 2, t.value];
          switch (op[0]) {
              case 0: case 1: t = op; break;
              case 4: _.label++; return { value: op[1], done: false };
              case 5: _.label++; y = op[1]; op = [0]; continue;
              case 7: op = _.ops.pop(); _.trys.pop(); continue;
              default:
                  if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                  if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                  if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                  if (t[2]) _.ops.pop();
                  _.trys.pop(); continue;
          }
          op = body.call(thisArg, _);
      } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
      if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var __values = (this && this.__values) || function (o) {
  var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
  if (m) return m.call(o);
  if (o && typeof o.length === "number") return {
      next: function () {
          if (o && i >= o.length) o = void 0;
          return { value: o && o[i++], done: !o };
      }
  };
  throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(){ca=function(){};ba.Symbol||(ba.Symbol=da)}var da=function(){var c=0;return function(a){return"jscomp_symbol_"+(a||"")+c++}}();
function ea(){ca();var c=ba.Symbol.iterator;c||(c=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&aa(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return fa(this)}});ea=function(){}}function fa(c){var a=0;return ha(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})}function ha(c){ea();c={next:c};c[ba.Symbol.iterator]=function(){return this};return c}
function ia(c,a){ea();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}function ja(c,a){if(a){for(var b=ba,d=c.split("."),e=0;e<d.length-1;e++){var f=d[e];f in b||(b[f]={});b=b[f]}d=d[d.length-1];e=b[d];f=a(e);f!=e&&null!=f&&aa(b,d,{configurable:!0,writable:!0,value:f})}}
ja("Array.prototype.values",function(c){return c?c:function(){return ia(this,function(a,b){return b})}});function ka(c){ea();var a=c[Symbol.iterator];return a?a.call(c):fa(c)}
ja("Promise",function(c){function a(a){this.Mi=0;this.Fn=void 0;this.Mg=[];var b=this.Wl();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}}function b(){this.He=null}function d(b){return b instanceof a?b:new a(function(a){a(b)})}if(c)return c;b.prototype.rp=function(a){null==this.He&&(this.He=[],this.xt());this.He.push(a)};b.prototype.xt=function(){var a=this;this.sp(function(){a.Du()})};var e=ba.setTimeout;b.prototype.sp=function(a){e(a,0)};b.prototype.Du=function(){for(;this.He&&this.He.length;){var a=
this.He;this.He=[];for(var b=0;b<a.length;++b){var d=a[b];a[b]=null;try{d()}catch(n){this.yt(n)}}}this.He=null};b.prototype.yt=function(a){this.sp(function(){throw a;})};a.prototype.Wl=function(){function a(a){return function(e){d||(d=!0,a.call(b,e))}}var b=this,d=!1;return{resolve:a(this.wx),reject:a(this.yn)}};a.prototype.wx=function(b){if(b===this)this.yn(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof a)this.fy(b);else{a:switch(typeof b){case "object":var d=null!=b;break a;
case "function":d=!0;break a;default:d=!1}d?this.vx(b):this.iq(b)}};a.prototype.vx=function(a){var b=void 0;try{b=a.then}catch(l){this.yn(l);return}"function"==typeof b?this.gy(b,a):this.iq(a)};a.prototype.yn=function(a){this.hs(2,a)};a.prototype.iq=function(a){this.hs(1,a)};a.prototype.hs=function(a,b){if(0!=this.Mi)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.Mi);this.Mi=a;this.Fn=b;this.Eu()};a.prototype.Eu=function(){if(null!=this.Mg){for(var a=0;a<this.Mg.length;++a)f.rp(this.Mg[a]);
this.Mg=null}};var f=new b;a.prototype.fy=function(a){var b=this.Wl();a.pj(b.resolve,b.reject)};a.prototype.gy=function(a,b){var d=this.Wl();try{a.call(b,d.resolve,d.reject)}catch(n){d.reject(n)}};a.prototype.then=function(b,d){function e(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(z){f(z)}}:b}var c,f,h=new a(function(a,b){c=a;f=b});this.pj(e(b,c),e(d,f));return h};a.prototype["catch"]=function(a){return this.then(void 0,a)};a.prototype.pj=function(a,b){function d(){switch(e.Mi){case 1:a(e.Fn);
break;case 2:b(e.Fn);break;default:throw Error("Unexpected state: "+e.Mi);}}var e=this;null==this.Mg?f.rp(d):this.Mg.push(d)};a.resolve=d;a.reject=function(b){return new a(function(a,d){d(b)})};a.race=function(b){return new a(function(a,e){for(var c=ka(b),f=c.next();!f.done;f=c.next())d(f.value).pj(a,e)})};a.all=function(b){var e=ka(b),c=e.next();return c.done?d([]):new a(function(a,b){function f(b){return function(d){h[b]=d;k--;0==k&&a(h)}}var h=[],k=0;do h.push(void 0),k++,d(c.value).pj(f(h.length-
1),b),c=e.next();while(!c.done)})};return a});ja("Array.prototype.keys",function(c){return c?c:function(){return ia(this,function(a){return a})}});
ja("String.prototype.startsWith",function(c){return c?c:function(a,b){if(null==this)throw new TypeError("The 'this' value for String.prototype.startsWith must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype.startsWith must not be a regular expression");var d=this+"";a+="";for(var e=d.length,c=a.length,h=Math.max(0,Math.min(b|0,d.length)),k=0;k<c&&h<e;)if(d[h++]!=a[k++])return!1;return k>=c}});
ja("Array.prototype.fill",function(c){return c?c:function(a,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}});ja("Math.sign",function(c){return c?c:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}});
var r=function(){function c(a,b){this.type=a;this.values=b}c.Mh=function(a){a.toLowerCase()in c.Go&&(a=c.Go[a.toLowerCase()]);var b=/#([0-9a-f])([0-9a-f])([0-9a-f])/i,d=/rgb\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *\)/,e=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/;var f=/#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i.exec(a);if(null!==f)a=parseInt(f[1],16)/255,b=parseInt(f[2],16)/255,d=parseInt(f[3],16)/255,f=1;else if(f=e.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/
255,d=parseFloat(f[3])/255,f=parseFloat(f[4]);else if(f=d.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/255,d=parseFloat(f[3])/255,f=1;else if(f=b.exec(a),null!==f)a=parseInt(f[1],16),a=(16*a+a)/255,b=parseInt(f[2],16),b=(16*b+b)/255,d=parseInt(f[2],16),d=(16*d+d)/255,f=1;else return null;return new c(c.RGBA,[a,b,d,f])};c.de=function(a){return c.Mh(a)||new c(c.RGBA,[1,0,1,1])};c.Gz=function(a){var b=/#[0-9a-f]+|rgba?\([^\)]+\)|[a-z]+/gi,d=[],e;do(e=b.exec(a))&&d.push(e[0]);while(e);return d};
c.prototype.toString=function(){function a(a){a=Math.round(255*a);return 16>a?"0"+a.toString(16):a.toString(16)}var b=this.yj(c.RGBA);return 1===b.values[3]?"#"+a(b.values[0])+a(b.values[1])+a(b.values[2]):"rgba("+Math.round(255*b.values[0])+","+Math.round(255*b.values[1])+","+Math.round(255*b.values[2])+","+b.values[3]+")"};c.prototype.yj=function(a){return c.eu[this.type][a](this)};c.prototype.Lb=function(a){a.type!==this.type&&(a=a.yj(this.type));if(this.type===c.kf){var b=this.values[0],d=a.values[0];
b=b>d?Math.min(b-d,d-b+360):Math.min(d-b,b-d+360);b/=360;return Math.pow(b*b+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)}return Math.pow((this.values[0]-a.values[0])*(this.values[0]-a.values[0])+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)};c.RGBA=0;c.Po=1;c.kf=2;c.Ms=3;c.pz=3;c.eu=[[la,ma,na,oa],[pa,la,qa,ra],[sa,ta,la,ua],[va,wa,xa,la]];c.Go={aliceblue:"#f0f8ff",
antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",
darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",
honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",
limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",
orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",
steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0.0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return c}(),ya=.9505,za=1,Aa=1.089;
function sa(c){var a=c.values[0],b=c.values[1],d=c.values[2];0>a&&(a+=360);var e=a/60-Math.floor(a/60),f=d*(1-b),h=d*(1-e*b);b=d*(1-(1-e)*b);var k=e=0,l=0;switch(Math.floor(a/60)%6){case 0:e=d;k=b;l=f;break;case 1:e=h;k=d;l=f;break;case 2:e=f;k=d;l=b;break;case 3:e=f;k=h;l=d;break;case 4:e=b;k=f;l=d;break;case 5:e=d,k=f,l=h}return new r(r.RGBA,[e,k,l,c.values[3]])}
function na(c){var a=c.values[0],b=c.values[1],d=c.values[2],e=Math.max(a,b,d),f=Math.min(a,b,d);return new r(r.kf,[e===f?0:e===a?(60*(b-d)/(e-f)+360)%360:e===b?60*(d-a)/(e-f)+120:60*(a-b)/(e-f)+240,0===e?0:1-f/e,e,c.values[3]])}function ra(c){function a(a){return a>6/29*(6/29)*(6/29)?Math.pow(a,1/3):1/3*(29/6)*(29/6)*a+4/29}var b=a(c.values[1]/za);return new r(r.Ms,[116*b-16,500*(a(c.values[0]/ya)-b),200*(b-a(c.values[2]/Aa)),c.values[3]])}
function wa(c){var a=(c.values[0]+16)/116,b=a+c.values[1]/500,d=a-c.values[2]/200,e=6/29;return new r(r.Po,[b>e?ya*b*b*b:3*(b-16/116)*e*e*ya,a>e?za*a*a*a:3*(a-16/116)*e*e*za,d>e?Aa*d*d*d:3*(d-16/116)*e*e*Aa,c.values[3]])}function ma(c){for(var a=[],b=0;3>b;b++)a[b]=.04045>=c.values[b]?c.values[b]/12.92:Math.pow((c.values[b]+.055)/1.055,2.4);return new r(r.Po,[.4124*a[0]+.3576*a[1]+.1805*a[2],.2126*a[0]+.7152*a[1]+.0722*a[2],.0193*a[0]+.1192*a[1]+.9505*a[2],c.values[3]])}
function pa(c){var a=[],b=[0,0,0,0];a[0]=3.241*c.values[0]-1.5374*c.values[1]-.4986*c.values[2];a[1]=-.9692*c.values[0]+1.876*c.values[1]+.0416*c.values[2];a[2]=.0556*c.values[0]-.204*c.values[1]+1.057*c.values[2];for(var d=0;3>d;d++)b[d]=.0031308>=a[d]?12.92*a[d]:1.055*Math.pow(a[d],1/2.4)-.055;b[3]=c.values[3];return new r(r.RGBA,b)}function la(c){return new r(c.type,c.values.concat())}function oa(c){return ra(ma(c))}function va(c){return pa(wa(c))}function qa(c){return na(pa(c))}
function ta(c){return ma(sa(c))}function ua(c){return oa(sa(c))}function xa(c){return qa(wa(c))};function Ba(c){for(var a="",b,d,e,f,h,k,l=0;l<c.length;)b=c[l++],d=c[l++],e=c[l++],f=b>>2,b=(b&3)<<4|d>>4,h=(d&15)<<2|e>>6,k=e&63,isNaN(d)?h=k=64:isNaN(e)&&(k=64),a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return a}
function Ca(c){for(var a=c.length,b=0,d,e,f=0;f!==a;){d=c.charCodeAt(f);f+=1;if(55296<=d&&56319>=d)if(f===a&&(b+=3),e=c.charCodeAt(f),56320<=e&&57343>=e){if(d=1024*(d-55296)+e-56320+65536,f+=1,65535<d){b+=4;continue}}else b+=3;b=127>=d?b+1:2047>=d?b+2:b+3}b=new Uint8Array(b);var h=-1;for(f=0;f!==a;){d=c.charCodeAt(f);f+=1;if(55296<=d&&56319>=d){if(f===a){b[h+=1]=239;b[h+=1]=191;b[h+=1]=189;break}e=c.charCodeAt(f);if(56320<=e&&57343>=e){if(d=1024*(d-55296)+e-56320+65536,f+=1,65535<d){b[h+=1]=240|d>>>
18;b[h+=1]=128|d>>>12&63;b[h+=1]=128|d>>>6&63;b[h+=1]=128|d&63;continue}}else{b[h+=1]=239;b[h+=1]=191;b[h+=1]=189;continue}}127>=d?b[h+=1]=0|d:(2047>=d?b[h+=1]=192|d>>>6:(b[h+=1]=224|d>>>12,b[h+=1]=128|d>>>6&63),b[h+=1]=128|d&63)}return b};var Da=function(){function c(a,b,d){void 0===d&&(d="");this.name=a;this.attributes=b;this.text=d;this.children=[]}c.prototype.toString=function(){var a=[];this.ip(a,"");return a.join("")};c.prototype.ip=function(a,b){var d;if(this.hasAttributes()||0!==this.children.length){a.push(b);a.push("<");a.push(this.name);for(d in this.attributes)this.attributes.hasOwnProperty(d)&&(a.push(" "),a.push(d),void 0!==this.attributes[d]&&null!==this.attributes[d]&&(a.push('="'),a.push(this.Wo(""+this.attributes[d])),
a.push('"')));if(this.children.length||""!==this.text){a.push(">\n");for(d=0;d<this.children.length;d++)this.children[d].ip(a,b+"  ");""!==this.text&&a.push(b+"  "+this.Wo(this.text));a.push(b+"</"+this.name+">")}else a.push("/>");a.push("\n")}};c.prototype.hasAttributes=function(){for(var a in this.attributes)if(this.attributes.hasOwnProperty(a))return!0;return!1};c.prototype.Hi=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.attributes[b]=a[b])};c.prototype.$d=function(a){this.children.push(a)};
c.prototype.Wo=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};return c}();var y=new (function(){function c(){this.disabled={};this.Od=[];this.Gp=!1}c.prototype.enable=function(a,b){void 0===b&&(b=!0);this.disabled[a]=!b};c.prototype.create=function(a,b){void 0===b&&(b=!0);!1===b&&(this.disabled[a]=!0);var d=this;return function(){for(var b=0;b<arguments.length;b++);d.pw(a,arguments)}};c.prototype.addListener=function(a){this.Od.push(a);return a};c.prototype.removeListener=function(a){for(var b=0;b<this.Od.length;b++)if(this.Od[b]===a){this.Od.splice(b,1);break}};c.prototype.zu=
function(){this.Gp||(this.Gp=!0,this.addListener(function(a,b){console.log(a+": "+b)}))};c.prototype.pw=function(a,b){var d=[],e;if(0!==this.Od.length){var c=b[0].split("%s");d.push(c[0]);for(e=1;e<c.length;e++)e-1>=b.length-1?d.push("<too few args>"):"string"===typeof b[e]||"number"===typeof b[e]?d.push(b[e]):void 0===b[e]?d.push("(undefined)"):null===b[e]?d.push("(null)"):b[e]instanceof Object&&b[e].toString instanceof Function?d.push(b[e].toString()):d.push(JSON.stringify(b[e])),d.push(c[e]);d=
d.join("");e=0;for(c=this.Od;e<c.length;e++)(0,c[e])(a,d)}};return c}());y.create("HTML");function Ea(c){return parseFloat(c||"")||0}
var Ga=function(){function c(a){this.ba=a}c.prototype.$a=function(a){for(var b in a){if(0<=b.indexOf("-"))throw Error("setStyle: styles must be camelcase; not "+b);this.ba.style[b]=""+a[b]}return this};c.prototype.Hi=function(a){for(var b in a)this.ba.setAttribute(b,a[b]);return this};c.prototype.$c=function(a){a.appendChild(this.ba);return this};c.prototype.Qm=function(a){a.parentNode&&a.parentNode.insertBefore(this.ba,a.nextSibling)};c.prototype.insertBefore=function(a){a.parentNode&&a.parentNode.insertBefore(this.ba,
a);return this};c.prototype.remove=function(){this.ba.parentNode&&this.ba.parentNode.removeChild(this.ba);return this};c.prototype.Ld=function(a){return window.getComputedStyle(this.ba)[a]||""};c.prototype.Wb=function(){var a=this.ba.getBoundingClientRect();return{top:a.top+window.pageYOffset,left:a.left+window.pageXOffset,width:a.width,height:a.height}};c.prototype.$k=function(a){var b=(b=this.Nv())?b.Wb():{left:0,top:0};this.ba.style.left=a.left-b.left+"px";this.ba.style.top=a.top-b.top+"px"};c.prototype.Nv=
function(){if(!(this.ba instanceof HTMLElement)||"fixed"===this.Ld("position"))return Fa(document.body);for(var a=this.ba.parentElement;a&&"static"===Fa(a).Ld("position");)a=a.parentElement;return a?Fa(a):null};c.prototype.Em=function(){var a=window.getComputedStyle(this.ba),b={left:Ea(a.marginLeft),top:Ea(a.marginTop),right:Ea(a.marginRight),bottom:Ea(a.marginBottom),Ym:0,Hn:0,po:0,Ol:0};"content-box"===a.boxSizing&&(b.Ym+=Ea(a.borderLeftWidth)+Ea(a.paddingLeft),b.po+=Ea(a.borderTopWidth)+Ea(a.paddingTop),
b.Hn+=Ea(a.borderRightWidth)+Ea(a.paddingRight),b.Ol+=Ea(a.borderBottomWidth)+Ea(a.paddingBottom));return b};c.prototype.jd=function(a){this.ba.classList.add(a);return this};c.prototype.lo=function(a,b){b?this.ba.classList.add(a):this.ba.classList.remove(a)};c.prototype.addEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<a.length;e++)this.ba.addEventListener(a[e],b,d);return this};c.prototype.removeEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<
a.length;e++)this.ba.removeEventListener(a[e],b,d);return this};c.prototype.matches=function(a){if(this.ba.matches)return this.ba.matches(a);var b=0;for(a=a.split(",");b<a.length;b++){var d=a[b];d=d.trim();if(0!=d.length)return"["==d[0]?this.ba.hasAttribute(d.substr(1,d.length-2)):this.ba.tagName===d.toUpperCase()}return!1};c.prototype.query=function(a,b){this.matches(a)&&b(this.ba);Array.prototype.forEach.call(this.ba.querySelectorAll(a),b)};c.prototype.clear=function(){for(;null!==this.ba.firstChild;)this.ba.removeChild(this.ba.firstChild);
return this};c.prototype.ah=function(a){this.ba.innerText=a;return this};return c}();function Fa(c,a){if("string"===typeof c){if("<"==c[0]){var b=Fa.Tp(c);return new Ga(b[0])}b=new Ga(document.createElement(c));a&&b.Hi(a);return b}return new Ga(c)}var Ha=null;
(function(c){c.jc=function(a){return"jQuery"in window&&a instanceof window.jQuery?a[0]:a instanceof HTMLElement?a:"string"===typeof a?document.querySelector(a):null};c.hk=function(){var a=document.documentElement,b=a.scrollWidth>a.clientWidth;a=a.scrollHeight>a.clientHeight?c.Cg():0;b=b?c.Cg():0;return{width:window.innerWidth-a,height:window.innerHeight-b,x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}};c.Cg=function(){if(null===
Ha){var a=document.createElement("div");a.style.visibility="hidden";a.style.width="100px";document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var d=document.createElement("div");d.style.width="100%";a.appendChild(d);d=d.offsetWidth;a.parentNode.removeChild(a);Ha=b-d}return Ha};c.tq=function(){for(var a=document.getElementsByTagName("*"),b=0,d=0;d<a.length;d++){var e=parseInt(c(a[d]).Ld("z-index"),10)||0;e>b&&(b=e)}return b};c.Tp=function(a){var b=document.createElement("div");
b.innerHTML=a;a=[];for(var d=b.firstChild;d;)d instanceof HTMLElement&&a.push(d),d=d.nextSibling;for(d=0;d<a.length;d++)b.removeChild(a[d]);return a}})(Fa||(Fa={}));
function Ia(c){return new Promise(function(a,b){var d=new XMLHttpRequest;c.mimeType&&d.overrideMimeType(c.mimeType);c.withCredentials&&(d.withCredentials=!0);c.responseType&&(d.responseType=c.responseType);var e=c.method||"GET",f=c.wr||{},h=c.url,k="",l=!0,n;for(n in f)l||(k+="&"),l=!1,k+=n+"="+encodeURIComponent(f[n]);"GET"===e&&0<k.length&&(h+="?"+k,k="");d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status)a(d);else{var e=d.statusText;0===d.status?e="Could not contact server.":
d.getResponseHeader("status")&&(e=d.getResponseHeader("status"));b(Error(d.status+" "+e))}};d.open(e,h,!0);"string"===typeof c.data&&(k=c.data);c.contentType?d.setRequestHeader("Content-type","application/json"):"POST"===e&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.cancel&&c.cancel.then(function(){d.abort()});c.Lp?setTimeout(function(){d.send(k)},c.Lp):d.send(k)})}
var Ja=function(){function c(){this.Oq=[];this.Ad=null}c.prototype.Om=function(a){for(var b=0,d=this.Oq;b<d.length;b++)if(d[b]===a)return;this.Oq.push(a);this.Ad||(this.Ad=document.createElement("style"),document.head&&document.head.insertBefore(this.Ad,document.head.firstChild));this.Ad.appendChild(document.createTextNode(a))};c.prototype.Ua=function(){this.Ad&&Fa(this.Ad).remove()};return c}(),Ka=function(){function c(){this.input=null}c.prototype.Ua=function(){this.input&&this.input.parentNode&&
this.input.parentNode.removeChild(this.input)};c.prototype.open=function(a){var b=this;return new Promise(function(d){b.input&&b.input.parentNode&&b.input.parentNode.removeChild(b.input);b.input=document.createElement("input");b.input.style.display="none";b.input.setAttribute("id","ZwibblerFileInput");b.input.setAttribute("type","file");document.body.appendChild(b.input);a.accept&&b.input.setAttribute("accept",a.accept);var e=new FileReader,c="";b.input.addEventListener("change",function(){var b=
this.files;b&&0<b.length&&(c=b[0].type,"data-uri"===a.format?e.readAsDataURL(b[0]):"text"===a.format?e.readAsText(b[0]):"ArrayBuffer"===a.format&&e.readAsArrayBuffer(b[0]))});e.addEventListener("load",function(){d({contentType:c,data:e.result})});b.input.value="";b.input.click()})};return c}(),La=function(){function c(){this.ui="";this.anchor=null}c.prototype.Ua=function(){this.anchor&&this.anchor.parentNode&&this.anchor.parentNode.removeChild(this.anchor);""!==this.ui&&window.URL.revokeObjectURL(this.ui)};
c.prototype.Bx=function(a,b){for(var d=atob(a.split(",")[1]),e=a.split(",")[0].split(":")[1].split(";")[0],c=new ArrayBuffer(d.length),h=new Uint8Array(c),k=0;k<d.length;k++)h[k]=d.charCodeAt(k);this.Ax(new Blob([c],{type:e}),b)};c.prototype.Ax=function(a,b){var d=this;this.Ua();window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(a,b):(this.ui=window.URL.createObjectURL(a),navigator.userAgent.toLowerCase().match(/(iphone|ipad)/)?window.open(this.ui,"_blank"):(this.anchor=document.createElement("a"),
this.anchor.innerHTML="download",this.anchor.setAttribute("href",this.ui),this.anchor.setAttribute("download",b),this.anchor.style.display="none",document.body.appendChild(this.anchor),this.anchor.click(),setTimeout(function(){d.anchor&&document.body.removeChild(d.anchor)},1E3)))};return c}(),A=Fa;var Ma=function(){function c(a,b,d,e,c){void 0===a&&(a="transparent");void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===c&&(c=0);this.rf=a;this.left=b;this.top=d;this.right=e;this.bottom=c;this.zIndex=1;this.insertBefore=null;this.qa=document.createElement("div")}c.prototype.ie=function(){this.qa&&A(this.qa).remove()};c.prototype.show=function(a){A(this.qa).$a({position:"fixed",background:this.rf,opacity:.25,left:this.left+"px",top:this.top+"px",right:this.right+"px",bottom:this.bottom+
"px",display:"block"}).jd("zwibbler-popup-overlay");this.qa.addEventListener("click",a);this.qa.style.zIndex=this.zIndex.toString();this.insertBefore?this.insertBefore.parentNode&&this.insertBefore.parentNode.insertBefore(this.qa,this.insertBefore):document.body.appendChild(this.qa)};return c}();function Oa(c,a){function b(){var a=f.offsetWidth,b=f.offsetHeight,d=A.hk();A(f).$k({left:d.x+d.width/2-a/2,top:d.y+d.height/2-b/2})}function d(a){if(a.target instanceof HTMLElement)switch(a.target.tagName){case "SELECT":case "INPUT":case "TEXTAREA":return;default:if(a.target.isContentEditable)return}var b=(new Date).getTime();v&&x&&200>b-x&&(a.preventDefault(),setTimeout(function(){w.hide()},0))}function e(){x=(new Date).getTime()}void 0===a&&(a={});var f=A.jc(c);if(!f)throw Error("Zwibbler.Dialog: Bad element passed in: "+
c);var h=a.overlayColour||"transparent",k=null===f.parentNode;k&&document.body.appendChild(f);"static"===A(f).Ld("position")&&(f.style.position="absolute");var l=A(f).Ld("display");"none"===l&&(l="block");f.style.display="none";var n=new Ma(h);n.insertBefore=f;var q=a.showNear,u=a.showHow,v=!1,w={hide:function(){n.ie();f.style.display="none";if(w.onhide)w.onhide();window.removeEventListener("resize",b)},isShown:function(){return"none"!==A(f).Ld("display")},show:function(a,d,e,c){void 0===e&&(e=!1);
void 0===c&&(c=!0);var h=0,k=0,z="",D="";x=0;"number"===typeof a&&"number"===typeof d?(h=a,k=d,a=!0):(z=a||q,D=d||u,a=!1);d=A.tq()+1;f.style.zIndex=d.toString();n.zIndex=d;f.style.display=l;f.style.visibility="hidden";if(a)setTimeout(function(){var a=f.offsetWidth,b=f.offsetHeight,d=A.hk(),e={left:h,top:k};e.left=Math.min(e.left,d.x+d.width-a-2);e.top=Math.min(e.top,d.y+d.height-b-3);A(f).$k(e);f.style.visibility="visible";if(w.onshow)w.onshow()},0);else if(z&&D){var G=A.jc(z);if(G)setTimeout(function(){f.style.visibility=
"visible";var a=f,b=D,d=A(G).Wb();b=b.toLowerCase().split(" ");2!==b.length&&(b=["tl","tl"]);0<=b[0].indexOf("b")&&(d.top+=G.offsetHeight);0<=b[0].indexOf("r")&&(d.left+=G.offsetWidth);0<=b[1].indexOf("b")&&(d.top-=a.offsetHeight);0<=b[1].indexOf("r")&&(d.left-=a.offsetWidth);a.style.position="absolute";b=A.hk();var e=a.clientHeight;d.left=Math.min(d.left,b.x+b.width-a.clientWidth);d.top=Math.min(d.top,b.y+b.height-e);A(a).$k(d)},0);else if(w.onshow)w.onshow()}else window.addEventListener("resize",
b),setTimeout(function(){f.style.visibility="visible";b();if(w.onshow)w.onshow()},0);(z=f.querySelector("[z-focus]"))&&z.focus();c&&n.show(w.hide);v=e},destroy:function(){n.ie();window.removeEventListener("resize",b);f.removeEventListener("click",d);f.removeEventListener("pointerup",d);f.removeEventListener("touchend",d);f.removeEventListener("touchstart",e);f.removeEventListener("pointerdown",e);k&&A(f).remove()},onshow:a.onshow,onhide:a.onhide},x=0;f.addEventListener("click",d);"ontouchstart"in
window?(f.addEventListener("touchend",d),f.addEventListener("touchstart",e)):(f.addEventListener("pointerup",d),f.addEventListener("pointerdown",e));return w};var Pa=y.create("DRAGSORT");
function Qa(c){function a(a){"dragover"!==a.type&&Pa(a.type);for(var b=a.target;b.parentNode!==c.parent&&b.parentNode;)b=b.parentNode;if(1===b.nodeType&&b.getAttribute("draggable")&&"false"!==b.getAttribute("draggable").toLowerCase()&&b.parentNode===c.parent)if("dragstart"===a.type){for(var d=c.parent.children,e=0;e<d.length;e++)console.log(c.kj,d[e].getAttribute(c.kj),d[e]),null!==d[e].getAttribute(c.kj)&&d[e].setAttribute("sort-index",e.toString());a.dataTransfer.setData("text",b.id);a.dataTransfer.dropEffect=
"move";h=f=b;a.stopPropagation()}else"dragover"===a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.pn),h=b,h.classList.add(c.pn),a.preventDefault()):"dragend"===a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.pn),b=parseInt(h.getAttribute("sort-index")||"0"),d=parseInt(f.getAttribute("sort-index")||"0"),c.Rw(d,b),a.preventDefault(),a.stopPropagation()):"drop"===a.type&&(a.preventDefault(),a.stopPropagation())}var b=c.parent.Vs;c.parent.Vs=!0;for(var d=c.parent.children,e=
0;e<d.length;e++)null!==d[e].getAttribute(c.kj)&&d[e].setAttribute("draggable","true");if(b)return function(){};A(c.parent).addEventListener("dragstart dragover dragend drop",a);var f,h;return function(){A(c.parent).removeEventListener("dragstart dragover dragend drop",a)}};var Ra=function(){function c(a,b){this.name=b;this.qa=A("div").$a({borderTop:"1px solid #888",padding:"5px",cursor:"default"}).$c(a);this.update(0)}c.prototype.update=function(a){this.qa.ba.innerText=this.name+"... "+Math.round(100*a)+"%"};c.prototype.error=function(a){var b=this,d=document.createElement("input");d.setAttribute("type","button");d.value="OK";d.addEventListener("click",function(){b.done()});this.qa.ba.innerText=this.name+"... "+a+" ";this.qa.ba.appendChild(d)};c.prototype.done=function(){this.qa.remove()};
c.all=[];return c}();var Ta=function(){function c(a,b,d){this.parentElement=a;this.stack=[];this.Wf=!1;this.xe=[];this.ny=!1;this.first=A("CANVAS",{width:b,height:d}).$c(a).ba;this.stack.push({canvas:this.first,za:this.first.getContext("2d"),vh:{}});this.ld=this.Ph();this.width=this.first.width;this.height=this.first.height;this.ej(this.first)}c.prototype.ft=function(){if(void 0===a)var a=this.stack.length;var b=A("CANVAS").$a({position:"absolute",left:this.first.offsetLeft+"px",top:this.first.offsetTop+"px",pointerEvents:"none",
outline:"4px solid red"}).jd("zwibbler-overlay").ba;this.ej(b);this.stack.splice(a,0,{canvas:b,za:b.getContext("2d"),vh:{}});a===this.stack.length-1?this.parentElement.insertBefore(b,null):this.parentElement.insertBefore(b,this.stack[a+1].canvas);b.getContext("2d")};c.prototype.Vc=function(a,b,d){var e=this;this.stack[a].vh[b]=d;if(!this.Wf){var c=(new Date).getTime();this.Wf=!0;requestAnimationFrame(function(){var a=(new Date).getTime(),b=e.pq();e.Wf=!1;for(var d=0,f=e.stack;d<f.length;d++){var q=
f[d],u=!0,v;for(v in q.vh){var w=q.za;u&&(w.setTransform(b,0,0,b,0,0),w.clearRect(0,0,e.width,e.height),u=!1);q.vh[v](w,b)}q.vh={}}if(e.ny){e.xe.push({dc:a,latency:a-c,xu:(new Date).getTime()-a});25<e.xe.length&&e.xe.shift();w=f=d=0;for(q=e.xe;w<q.length;w++)u=q[w],d+=u.latency,f+=u.xu;d=Math.round(d/e.xe.length*10)/10;f=Math.round(f/e.xe.length*10)/10;a=1<e.xe.length?Math.round(e.xe.length/((a-e.xe[0].dc)/1E3)*100)/100:0;w=e.get(0);w.setTransform(b,0,0,b,0,0);w.fillStyle="white";b="latency="+d+"ms drawTime="+
f+"ms fps="+a;w.fillRect(0,0,w.measureText("latency=MM.MMms drawTime=MM.MMms fps=MM").width,13);w.textBaseline="top";w.font="10px arial";w.fillStyle="red";w.fillText(b,2,2)}})}};c.prototype.get=function(a){return this.stack[a].za};c.prototype.pq=function(){var a=this.Ph();if(a!==this.ld){this.ld=a;a=0;for(var b=this.stack;a<b.length;a++)this.ej(b[a].canvas)}return this.ld};c.prototype.cf=function(a,b){this.width=a;this.height=b;for(var d=0,e=this.stack;d<e.length;d++)this.ej(e[d].canvas)};c.prototype.Ph=
function(){var a=this.stack[0].za;return(window.devicePixelRatio||1)/(a.az||a.zw||a.Cw||a.Hw||a.Ct||1)};c.prototype.ej=function(a){a.width=this.width*this.ld;a.height=this.height*this.ld;a.style.width=this.width+"px";a.style.height=this.height+"px";a.getContext("2d").setTransform(this.ld,0,0,this.ld,0,0)};return c}();var Ua=y.create("EVALJS"),Va=function(){function c(a,b){this.Dd=a;this.key=b}c.prototype.toString=function(){return"LValue("+this.key+")"};return c}(),Wa=function(){function c(a,b,d){this.id=a;this.zk=b;d&&(this.oe=d)}c.prototype.oe=function(){return this};c.prototype.Vq=function(a){return a};c.prototype.toString=function(){return"Token(id='"+this.id+"', lbp="+this.zk+")"};return c}(),Ya=function(){function c(a,b){return a[b]}function a(a,b,d){a[b]=d}function b(a){if(a instanceof Va){if(a.Dd===z)return D(z,
a.key);if(a.Dd)return a.Dd[a.key]}else return a}function d(a,b){void 0===b&&(b=0);var d=H[a];d?d.zk=Math.max(d.zk,b):d=H[a]=new Wa(a,b);return d}function e(a,b){var e=d(a);e.oe=function(){return b};return e}function f(a){return new Wa("(literal)",0,function(){return a})}function h(a){var b=new Wa("(name)",0,function(){return new Va(z,a)});b.toString=function(){return"Token(name: "+a+")"};return b}function k(a,d,e){l(a,d,function(a){return e(b(a),b(x(d-1)))})}function l(a,b,e){d(a,b).Vq=e}function n(a,
e,c){d(a,e).oe=function(){return c(b(x(e)))}}function q(a,b,e){d(a,b).oe=e}function u(a){return" "===a||"\t"===a||"\n"===a||"\r"===a}function v(){return Xa<gb.length?gb[Xa++]:H["(end)"]}function w(a){if(a&&Y.id!==a)throw Error("Error: expected "+a+" but got "+Y.id);return Y=v()}function x(a){var b=Y;Y=v();for(var d=b.oe();a<Y.zk;)b=Y,Y=v(),d=b.Vq(d);return d}var z={},D=c,G=a,H={},C=0,K,T;e("true",!0);e("false",!1);e("null",null);e("undefined",void 0);d("(end)");(function(a,d,e){l(a,d,function(a){return e(b(a),
b(x(d)))})})(",",K=++C,function(a,b){return b});l("=",T=++C,function(a){var d=x(T);if(!(a instanceof Va))throw Error("Error: lhs of = must be assignable");d=b(d);if(a.Dd===z)G(z,a.key,d);else if(a.Dd instanceof Object)a.Dd[a.key]=d;else throw Error(a.Dd+"["+a.key+"] cannot be assigned to.");return d});k("&&",++C,function(a,b){return a&&b});k("||",++C,function(a,b){return a||b});k("|",++C,function(a,b){return a|b});k("^",++C,function(a,b){return a^b});k("&",++C,function(a,b){return a&b});k("===",++C,
function(a,b){return a===b});k("!==",C,function(a,b){return a!==b});k("==",C,function(a,b){return a==b});k("!=",C,function(a,b){return a!=b});k(">",++C,function(a,b){return a>b});k(">=",C,function(a,b){return a>=b});k("<",C,function(a,b){return a<b});k("<=",C,function(a,b){return a<=b});k("in",C,function(a,b){return a in b});k("<<",++C,function(a,b){return a<<b});k(">>",C,function(a,b){return a>>b});k(">>>",C,function(a,b){return a>>>b});k("+",++C,function(a,b){return a+b});k("-",C,function(a,b){return a-
b});k("*",++C,function(a,b){return a*b});k("/",C,function(a,b){return a/b});k("%",C,function(a,b){return a%b});n("!",++C,function(a){return!a});n("~",C,function(a){return~a});n("+",C,function(a){return+a});n("-",C,function(a){return-a});n("typeof",C,function(a){return typeof a});l(".",++C,function(a){var d=Y;if("(name)"!==d.id)throw Error("Error: '.' expects a name, not "+Y.id);if(a instanceof Va)a.Dd=b(a),a.key=d.oe().key;else if(a instanceof Object)a=new Va(b(a),d.oe().key);else throw Error("Error: '.' must be preceded by object");
w();return a});q("(",++C,function(){var a=x(0);w(")");return a});d(")");l("(",++C,function(a){var d=[];if(")"!==Y.id)for(;;){d.push(b(x(K+1)));if(","!==Y.id)break;w(",")}w(")");var e=null;a instanceof Va&&(e=a.Dd);a=b(a);if("function"!==typeof a)throw Error("Tried to call a non-function; type was "+typeof a);return a.apply(e,d)});d(",");l("[",C,function(a){var d=x(0);if(!(a instanceof Va))throw Error("Error: '[]' must be preceded by lvalue");w("]");a.Dd=b(a);a.key=b(d);return a});d("]");q("{",++C,
function(){for(var a={};"}"!==Y.id;){if("(literal)"===Y.id)var d=Y.oe();else if("(name)"===Y.id)d=Y.oe().key;else throw Error("Bad {}; expecting name or string constant");w();w(":");a[d]=b(x(K+1));if(","!==Y.id)break;Y=w(",")}w("}");return a});q("[",C,function(){for(var a=[];"]"!==Y.id;){a.push(b(x(K+1)));if(","!==Y.id)break;Y=w(",")}w("]");return a});d(",");d(":");d("}");var X=/(\d+(\.\d+)?)|(===|!==|==|!=|\+=|-=|&&|\|\||<=|>=|<<|>>>|>>|&&|\|\||[{}\(\)\[\]\+\-\.\*\/=!,\?&\|:%~<>])|([a-zA-Z\$_][\$_a-zA-Z0-9]*)|("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g,
gb=[],Xa=0,Y;return{parse:function(a){for(var b=[],d=0;d<a.length;){for(;u(a.charAt(d));)d++;X.lastIndex=d;var e=X.exec(a);if(e&&e.index===d)if(d+=e[0].length,e[1])b.push(f(parseFloat(e[1])));else if(e[3]&&e[3]in H)b.push(H[e[3]]);else if(e[4])switch(e[4]){case "true":case "false":case "null":case "in":case "typeof":case "undefined":b.push(H[e[4]]);break;default:b.push(h(e[4]))}else{if(e[5]){e=e[5].substr(1,e[5].length-2);for(var c="",k=!1,l=0;l<e.length;l++){var n=e[l];if(k){switch(n){case "n":n=
"\n";break;case "r":n="\r";break;case "t":n="\t"}c+=n;k=!1}else"\\"===n?k=!0:c+=n}b.push(f(c))}}else throw Error("Parse error: Expected stuff in "+a+" near: "+a.substr(d));}b.push(H["(end)"]);return b},evaluate:function(d,e,f,h){Xa=0;gb=e;z=d;D=f||function(a,b){return a[b]};G=h||function(a,b,d){a[b]=d};Y=v();d=b(x(0));z={};D=c;G=a;return d}}}(),Za=Ya.parse,$a=Ya.evaluate;function ab(c,a,b){try{return $a(c,Za(a),b)}catch(d){console.log("When evaluating: %s on scope ",a,c),console.log(d)}}
function bb(c,a){if(c===a)return!0;if(!(c instanceof Object&&a instanceof Object)||c.constructor!==a.constructor)return!1;for(var b in c)if(c.hasOwnProperty(b)&&(!a.hasOwnProperty(b)||c[b]!==a[b]&&("object"!==typeof c[b]||!bb(c[b],a[b]))))return!1;for(b in a)if(a.hasOwnProperty(b)&&!c.hasOwnProperty(b))return!1;return!0}
var cb=function(){function c(){this.Ce={};this.Bi=!1;this.length=0;this.Kl=[];this.timeout=0}c.prototype.Cc=function(a,b,d){a={scope:a,parsed:Za(b),gr:void 0,dr:d};b in this.Ce?this.Ce[b].push(a):this.Ce[b]=[a];this.length+=1;this.Bi=!0;this.check()};c.prototype.Iy=function(a,b){if(a in this.Ce){for(var d=this.Ce[a],e=0;e<d.length;e++)if(d[e].dr===b){d.splice(e,1);break}0===d.length&&delete this.Ce[a];--this.length}};c.prototype.check=function(a){var b=this;this.Bi=!0;a&&this.Kl.push(a);0===this.timeout&&
(this.timeout=setTimeout(function(){for(var a=(new Date).getTime(),e=0,c=0;10>c&&b.Bi;c++){b.Bi=!1;for(var h in b.Ce)for(var k=null,l=void 0,n=0;n<b.Ce[h].length;n++){var q=b.Ce[h][n];try{q.scope!==k&&(l=$a(q.scope,q.parsed),k=q.scope,e+=1),bb(q.gr,l)||(q.gr=l,q.dr(l),b.Bi=!0)}catch(u){console.log("Error when evaluating %s: ",h,u),console.log("Context was: %o",q.scope)}}l=b.Kl;b.Kl=[];for(k=0;k<l.length;k++)(0,l[k])()}Ua("Evaluated %s/%s watchers in %sms",e,b.length,(new Date).getTime()-a);b.timeout=
0},0))};return c}();var db=y.create("Zeact"),fb=function(){function c(a,b,d,e,c){this.ml=a;this.scope=b;this.element=d;this.name=e;this.value=c}c.prototype.emit=function(a,b){this.ml.na(this.element,a,b)};c.prototype.listen=function(a,b){this.ml.Za(this.element,a,b)};c.prototype.watch=function(a,b){this.ml.Cc(this.scope,this.element,a,b)};c.prototype.eval=function(a){return eb.mm(this.scope,a,this.element)};c.prototype.destructor=function(a){this.ml.xa(this.element,a)};return c}(),hb=function(){function c(){this.Do=
new cb;this.Gj={};this.Le={};this.Ad=new Ja;this.Os=1}c.prototype.Ua=function(){this.Ad.Ua()};c.prototype.Ab=function(a,b,d){void 0===d&&(d=2);this.Gj[a]={name:a,link:b,ms:d}};c.prototype.vj=function(a,b){this.Le[a.toUpperCase()]=b;"string"===typeof b.template&&(b.template=b.template.trim())};c.prototype.Ud=function(a,b){var d=this;this.Ab(a,function(a,c,h,k){d.hy(a,function(){d.Cc(a,c,k,function(d){b(c,d,a)})})})};c.prototype.Cc=function(a,b,d,e){var c=this;this.Do.Cc(a,d,e);this.xa(b,function(){c.Do.Iy(d,
e)})};c.prototype.hy=function(a,b){a.hasOwnProperty("$settled")?(b(),this.digest()):a.hasOwnProperty("$settledWaiters")?a.$settledWaiters.push(b):a.$settledWaiters=[b]};c.prototype.tw=function(a){if(!a.hasOwnProperty("$settled")&&(a.$settled=!0,a.$settledWaiters)){for(var b=0,d=a.$settledWaiters;b<d.length;b++)(0,d[b])();delete a.$settledWaiters;this.digest()}};c.prototype.Za=function(a,b,d){a.addEventListener(b,d);this.xa(a,function(){a.removeEventListener(b,d)});a.zwibblerListeners||(a.zwibblerListeners=
{});a.zwibblerListeners[b]||(a.zwibblerListeners[b]=[]);a.zwibblerListeners[b].push(d)};c.prototype.na=function(a,b,d){var e=this;setTimeout(function(){e.Kc(a,b,d)},0)};c.prototype.Kc=function(a,b,d){if(a.zwibblerListeners&&b in a.zwibblerListeners)for(var e=0,c=a.zwibblerListeners[b];e<c.length;e++){var h=c[e];try{h.call(a,d)}catch(k){console.log("Error while handling event "+b+": ",k)}}};c.prototype.xa=function(a,b){a.pl?a.pl.push(b):a.pl=[b]};c.prototype.detach=function(a){for(var b=a.firstChild;b;)this.detach(b),
b=b.nextSibling;if(a.pl){b=0;for(var d=a.pl;b<d.length;b++)(0,d[b])();delete a.zwibblerWatchers}a.zwibblerListeners&&delete a.zwibblerListeners;a.Us&&delete a.Us;a.nh&&delete a.nh;delete a.oh};c.prototype.digest=function(a){this.Do.check(a)};c.prototype.Ku=function(a,b){var d=/^z-([a-z0-9@\-]+)/.exec(a.toLowerCase());if(d&&(d=d[1],d in this.Gj&&this.Gj[d].ms===b))return this.Gj[d]};c.prototype.pp=function(a,b,d,e){void 0===e&&(e=b);for(var c=b.parentNode,h=[],k=0;k<e.attributes.length;k++)h.push({name:e.attributes[k].name,
value:e.attributes[k].value});for(k=0;k<h.length&&b.parentNode===c;k++){e=h[k].name;var l=h[k].value,n=this.Ku(e,d);if(n&&n.ms===d&&(e=n.link(a,b,e,l))&&e!==b)return{ba:e,Cn:!0}}return{ba:b,Cn:b.parentNode!==c}};c.prototype.zj=function(a,b,d,e){b=document.createElement(b);for(var c in d)b.setAttribute(c,d[c]);e&&(b.ql=e);a=this.qc(a,b);delete b.ql;return a};c.prototype.st=function(a,b){var d=this,e=this.Le[b.tagName];if(!e)return null;db("Attaching component %s",b.tagName);var c=e.template;if(c instanceof
HTMLElement)var h=c.cloneNode(!0);else if("string"===typeof c)if("<"===c[0]){db("Using elementsFromString to instantiate component");var k=A.Tp(c);if(0===k.length)throw Error("Component "+b.tagName+": Could not interpret as HTML: "+c);if(1<k.length)throw Error("Component "+b.tagName+": Should render as a single element, but got "+k.length);h=k[0]}else{db("Using querySelector to instantiate component");h=document.querySelector(c);if(null===h)throw Error("Component "+b.tagName+': querySelector("'+c+
'") returned null');h=h.cloneNode(!0)}else throw Error("Component "+b.tagName+": Could not interpret template "+c);c=null!==b.parentNode;null!==b.parentNode&&b.parentNode.replaceChild(h,b);var l=this,n={$emit:function(a,b){l.na(h,a,b)},$emitNow:function(a,b){l.Kc(h,a,b)},$element:h,$parent:a};if(b.ql){k=b.ql;for(var q in n)k[q]=n[q];n=k}q=e.properties;var u={};q&&q.forEach(function(e){u[e]=1;var c=b.getAttribute(e);c&&(db("Bind prop %s to %s",e,c),n[e]=ab(a,c),d.Cc(a,h,c,function(a){n[e]=a}))});h.Ns=
1;for(q=b.firstChild;q;)k=q.nextSibling,h.appendChild(q),q=k;e.style&&this.Ad.Om(e.style);for(q=0;q<b.attributes.length;q++){k=b.attributes[q].name;var v=b.attributes[q].value;u[k]||0===k.indexOf("z-")||h.setAttribute(k,v)}db("apply directives from parent");for(q=1;2>=q;q++)if(k=this.pp(a,h,q,b),c&&k.Cn)return{scope:n,node:k.ba};db("apply directives from child");db("done applying");if(e.controller)try{e.controller(n,new fb(this,n,h,"","")),this.digest()}catch(w){console.log(w),console.log("When running controller for %s",
b.tagName)}this.qc(n,h);return{scope:n,node:h}};c.prototype.qc=function(a,b){var d=this,e=this.So(a,b);this.digest(function(){d.tw(a)});return e};c.prototype.So=function(a,b){if(1===b.nodeType){if(b.nh)return{node:b,scope:a};b.nh=this.Os++;b.oh=a;for(var d=0;2>=d;d++){var e=this.pp(a,b,d);if(e.Cn)return{node:e.ba,scope:a};if(0===d&&(e=this.st(a,b)))return e}for(d=b.firstChild;d;)e=d.nextSibling,d.Ns||this.So(a,d),d=e}return{node:b,scope:a}};return c}(),eb;
(function(c){function a(a,b,d){var e=b.type?b.type.toLowerCase():"",c=d;if("zwibblerValue"in b)var f="zwibblerValue";else f="value",c=""+c;if("radio"===e)b.checked=b[f]===c;else if("checkbox"===e)b.checked=!!d;else{if("SELECT"===b.tagName){e=0;for(var h=b.querySelectorAll("option");e<h.length;e++){var u=h[e],v=u.getAttribute("z-value");if(v&&ab(u.oh?u.oh:a,v)===d){u.selected=!0;return}}}else"DIV"===b.tagName&&"value"in a&&(a.value=c);b[f]=c}}function b(a,b){var d=b.type?b.type.toLowerCase():"";if("checkbox"===
d)return"zwibblerValue"in b?b.zwibblerValue:b.checked;if("radio"===d)(d=b.getAttribute("name"))&&(d=document.querySelector('input[name="'+d+'"]:checked'))&&(b=d);else if("SELECT"===b.tagName){d=0;for(var e=b.querySelectorAll("option");d<e.length;d++){var c=e[d];if(c.selected){var f=c.getAttribute("z-value");if(f)return ab(c.oh?c.oh:a,f)}}}else if("value"in a)return a.value;return"zwibblerValue"in b?b.zwibblerValue:b.value}function d(a,b,d,c,l){d&&(a["this"]=d);c&&(a.$event=c);return ab(a,b,l)}c.Iz=
a;c.ov=b;c.mm=d;c.hf=function(){function e(a,b){var d=a.indexOf(b);return-1===d?"":a.substr(d+b.length+1)}var c=new hb;c.Ab("init",function(a,b,e,c){d(a,c,b)});c.Ud("text",function(a,b){a.textContent=b});c.Ud("json",function(a,b){a.textContent=JSON.stringify(b)});c.Ud("html",function(a,b){a.innerHTML=b});c.Ab("model",function(d,e,f,n){function h(){k=b(d,e);db("input -> model: New value for %s: %s",n,k);d.anjnwjewaq=k;ab(d,n+"=anjnwjewaq");delete d.anjnwjewaq;c.digest()}var k=null;"checkbox"===e.type||
"radio"===e.type?c.Za(e,"change",h):c.Za(e,"input",h);setTimeout(function(){var b=e.getAttribute("z-value");b&&(c.Cc(d,e,b,function(c){db("z-value for %s[%s] is %s",e.tagName,b,c);e.zwibblerValue=c;a(d,e,k)}),c.xa(e,function(){delete e.zwibblerValue}));c.Cc(d,e,n,function(b){db("model(%s) -> %s[%s] : new value is %s",n,e.tagName,e.type,b);k=b;a(d,e,b)})},0)});c.Ab("on",function(a,b,f,n){var h=e(f,"on");db("Bind %s for %s",f,b.nh);""!==h&&c.Za(b,h,function(e){db("Got %s, execute %s",h,n);var f=d(a,
n,b,e);c.digest();e&&e.preventDefault&&!1===f&&e.preventDefault()})});c.Ab("bind",function(a,b,d,f){var h=e(d,"bind");""!==h&&c.Cc(a,b,f,function(a){b.setAttribute(h,a);"value"===h&&"SELECT"===b.tagName&&(console.log("SSet bound value %s=%s",h,a),console.log("Num children=",b.children.length),b.value=a)})},1);c.Ab("for",function(a,b,d,e){d=e.indexOf(" in ");if(-1!==d){var f=e.substr(0,d),h=e.substr(d+4),k=[];db("z-for '%s' in '%s'",f,h);var l=b.parentNode,n=b.nextSibling;b.parentNode.removeChild(b);
c.Cc(a,l,h,function(d){if("number"===typeof d){for(var e=[],q=0;q<d;q++)e.push(q);d=e}for(q=0;q<k.length;q++)e=k[q],e.parentNode&&e.parentNode.removeChild(e),c.detach(e);k.length=0;if("object"===typeof d&&"length"in d)for(q=0;q<d.length;q++){e=document.createComment("z-for "+h+"["+q+"] = "+d[q]);l.insertBefore(e,n);k.push(e);e=Object.create(a);e.$parent=a;e[f]=d[q];var u=b.cloneNode(!0);u.removeAttribute("z-for");l.insertBefore(u,n);e=c.qc(e,u).node;k.push(e)}})}},0);c.Ab("if",function(a,b,d,e){var f=
document.createComment(d+" "+e),h=b.parentElement,k=null;h.replaceChild(f,b);c.Cc(a,h,e,function(e){e&&!k?(k=b.cloneNode(!0),k.removeAttribute(d),h.replaceChild(k,f),c.qc(a,k)):!e&&k&&(c.detach(k),h.replaceChild(f,k),k=null)})},0);c.Ud("class",function(a,b){for(var d in b)A(a).lo(d,b[d])});c.Ud("style",function(a,b){for(var d in b)a.style[d]=b[d]});c.Ud("selected",function(a,b){A(a).lo("selected",b)});c.Ud("disabled",function(a,b){b?a.setAttribute("disabled","true"):a.removeAttribute("disabled")});
c.Ud("enabled",function(a,b){b?a.removeAttribute("disabled"):a.setAttribute("disabled","true")});c.Ud("checked",function(a,b){a.checked=b?!0:!1});return c}})(eb||(eb={}));var ib=eb;var kb=function(){function c(){this.items=[];this.next=0;this.Ne=!1;this.log=y.create("UNDOSTACK")}c.prototype.ua=function(a,b,d){void 0===b&&(b=!1);a=a instanceof jb?[a]:a;if(0!==a.length){this.next<this.items.length&&(this.items.length=this.next);if(!b)for(b=0;b<a.length;b++)a[b].md(d);for(d=this.top();d;)if(d[d.length-1].Hf(a[0])){if(a.shift(),0===a.length)break}else break;a.length&&this.items.push(a);this.Ne=!0;this.next=this.items.length}};c.prototype.Ac=function(a){this.log("Undo index %s of %s",
this.next,this.items.length);if(this.Zd()){for(var b=this.items[--this.next],d=b.length-1;0<=d;d--)b[d].Ac(a);return this.Ne=!0}return!1};c.prototype.Qd=function(a){this.log("Redo index %s of %s",this.next,this.items.length);if(this.Yd()){for(var b=this.items[this.next++],d=0;d<b.length;d++)b[d].md(a);return this.Ne=!0}return!1};c.prototype.Zd=function(){return 0<this.next};c.prototype.Yd=function(){return this.next<this.items.length};c.prototype.clear=function(){this.next=this.items.length=0;this.Ne=
!1};c.prototype.top=function(){return this.items.length?this.items[this.items.length-1]:null};return c}(),jb=function(){function c(){}c.prototype.md=function(){};c.prototype.Ac=function(){};c.prototype.Hf=function(){return!1};return c}();var lb=function(){function c(a){this.next=a}c.prototype.Cs=function(a){for(var b=0;b<a.length;b++)this.lb(a.charCodeAt(b))};c.prototype.lb=function(a){this.next.lb(a)};c.prototype.flush=function(){this.next.flush()};c.prototype.zg=function(){return this.next.zg()};return c}(),nb=function(){function c(){this.data="";this.log=y.create("BYTESTREAM")}c.prototype.Cs=function(a){for(var b=0;b<a.length;b++)this.lb(a.charCodeAt(b))};c.prototype.zg=function(){return this};c.prototype.lb=function(a){if(255<
a||0>a)throw"Bad data written to byte buffer";this.data+=String.fromCharCode(a)};c.prototype.flush=function(){};c.prototype.toString=function(){return this.data};c.prototype.Ob=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data.charCodeAt(b));return a};c.No=function(a,b){c.Jo[a]=b};c.hf=function(a){var b=new c;a=a.split(",");a.reverse();for(var d=0;d<a.length;d++){var e=a[d];e.length&&(b=c.Jo[e](b))}return b};c.Jo={};return c}();var ob=function(c){function a(a){a=c.call(this,a)||this;a.wh=0;a.total=0;a.size=0;a.keys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return a}__extends(a,c);a.prototype.lb=function(a){this.wh=this.wh<<8|a;this.size+=8;for(this.total+=1;6<=this.size;)this.next.lb(this.keys.charCodeAt(this.wh>>this.size-6&63)),this.size-=6};a.prototype.flush=function(){var a=(3-this.total%3)%3;this.size&&(this.next.lb(this.keys.charCodeAt(this.wh>>this.size-6&63)),this.wh=this.size=0);for(;a--;)this.next.lb(61);
this.next.flush()};return a}(lb);nb.No("Base64Encoder",function(c){return new ob(c)});var pb=function(c){function a(a){a=c.call(this,a)||this;a.Mf=0;a.Pd=0;a.Zq=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8193];a.log=y.create("BITWRITER");return a}__extends(a,c);a.prototype.lb=function(a){this.Bs(a,8)};a.prototype.Bs=function(a,d){this.Mf=this.Mf<<d|a&this.Zq[d];for(this.Pd+=d;8<=this.Pd;)this.next.lb(this.Mf>>>this.Pd-8&255),this.Pd-=8,this.Mf&=this.Zq[this.Pd]};a.prototype.flush=function(){this.Pd&&(this.next.lb(this.Mf<<8-this.Pd),this.Mf=this.Pd=0);this.next.flush()};return a}(lb);var qb=function(c){function a(a){var b=c.call(this,a)||this;b.Jg=258;b.wz=0;b.cg=0;b.first=!0;b.zh=[];b.tn=[];b.Ml=[];b.Ez=0;b.Ul=9;b.log=y.create("LZWEncoder");b.Gt=new pb(a);b.To();return b}__extends(a,c);a.prototype.lb=function(a){if(this.first)this.cg=a,this.first=!1;else{var b=this.Xs(this.cg,a);void 0!==this.zh[b]?this.cg=this.zh[b]:(this.dj(this.cg),this.zh[b]=this.Jg,this.tn[b]=this.cg,this.cg=this.Ml[b]=a,4095>this.Jg?(this.Jg+=1,this.Ul=Math.ceil(Math.log(this.Jg)/Math.log(2))):this.To())}};
a.prototype.Xs=function(a,d){var b;var c=d<<4^a;for(b=0===c?1:18041-c;;){if(void 0===this.zh[c]||this.tn[c]===a&&this.Ml[c]===d)return c;c-=b;0>c&&(c+=18041)}};a.prototype.To=function(){this.dj(a.Gs);this.Jg=258;this.Ul=9;this.zh.length=0;this.tn.length=0;this.Ml.length=0};a.prototype.flush=function(){this.first||(this.dj(this.cg),this.dj(a.Ks))};a.prototype.dj=function(a){this.Gt.Bs(a,this.Ul)};a.Gs=256;a.Ks=257;return a}(lb);nb.No("LZWEncoder",function(c){return new qb(c)});y.create("ANIM");var rb=function(){function c(){this.ve=0;this.fn=null}c.prototype.request=function(a,b){var d=this;this.ut=a;this.fn=b;0===this.ve&&(this.ve=window.requestAnimationFrame(function(a){d.ve=0;d.fn&&d.fn(d.ut,a)}))};c.prototype.cancel=function(){0!==this.ve&&(window.cancelAnimationFrame(this.ve),this.ve=0)};return c}();function sb(c,a,b){this.Pa=c;this.bl=a;this.fn=b;this.el=0}
var tb=new (function(){function c(){this.Cb=[];this.io=!1;this.log=y.create("ImageLoader")}c.prototype.timeout=function(){var a=[];this.log("Timeout running... %s images remaining",this.Cb.length);for(var b=0;b<this.Cb.length;b++)this.Cb[b].Pa.complete?this.Cb[b].fn(this.Cb[b].Pa,this.Cb[b].bl):5E3>this.Cb[b].el?(this.Cb[b].el+=250,a.push(this.Cb[b])):this.Cb[b].fn(this.Cb[b].Pa,this.Cb[b].bl);this.Cb=a;this.Cb.length?setTimeout(this.timeout,250):(this.log("Timeout Stopped"),this.io=!1)};c.prototype.load=
function(a,b,d){function e(a){for(var b=0;b<c.Cb.length;b++){var d=c.Cb[b];if(d.Pa===a)return c.Cb.splice(b,1),d}return null}var c=this;void 0===d&&(d=!1);var h=document.createElement("img"),k=new sb(h,a,b);this.Cb.push(k);var l=0<=a.indexOf("://"),n="://"+window.location.host,q=0!==a.indexOf("data:")&&l&&-1===a.indexOf(n);q&&!d&&(this.log("Using cross origin request for img"),h.crossOrigin="");h.addEventListener("load",function(){c.log("LoadFn called. complete=%s",h.complete);if(h.complete){var a=
e(h);a&&b(h,a.bl)}else c.io||(c.io=!0,setTimeout(c.timeout,250),k.el=250)},!1);h.addEventListener("error",function(){c.log("Error loading %s; useCors=%s disableCors=%s",a,q,d);e(h);!q||d?b(null,k.bl):c.load(a,b,!0)},!1);h.src=a;return h};return c}());var ub=function(){function c(){this.images={}}c.prototype.add=function(a,b){var d=this.images[a];d||(d={Pa:null,Rk:0},tb.load(b,function(a){d.Pa=a}),this.images[a]=d);d.Rk+=1};c.prototype.release=function(a){var b=this.images[a];b&&(--b.Rk,0>=b.Rk&&delete this.images[a])};c.prototype.get=function(a){return(a=this.images[a])&&a.Pa?a.Pa:null};return c}();var vb=function(){function c(a){this.code="en";this.data={};this.log=y.create("LANGUAGE");this.data=this.xr(a,{})}c.prototype.ds=function(a){a=a.split(",");this.log("Choice of languages: %s",a);for(var b=0;b<a.length;b++){var d=a[b].split("-")[0];if(d in this.data){this.log("Using language code %s",d);this.code=d;break}else this.log("No language for code %s",d)}};c.prototype.Il=function(a){this.xr(a,this.data)};c.prototype.xr=function(a,b){for(var d=a.split("\n"),e=/^([ \t]*)([^:]+):([^:]+):(.*)/,
c=0;c<d.length;c++){var h=e.exec(d[c]);if(h){var k=h[2],l=h[3];h=h[4];k in b||(b[k]={});l in b[k]&&this.log("Warning: Replacing %s:%s",k,l);b[k][l]=h}}return b};c.prototype.fn=function(){var a=this;return function(b){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.Yo(b,d)}};c.prototype.get=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return this.Yo(a,b)};c.prototype.Yo=function(a,b){var d="<not translated:"+a+">";this.code in this.data&&a in this.data[this.code]&&
(d=this.data[this.code][a]);for(var e=0;e<b.length;e++)d=d.replace("^"+e,b[e]);return d};return c}();y.create("ColourPanel");
var wb={style:"\n.zwibbler-colour-panel {\n    overflow:hidden;\n    border-top: 1px solid black;\n    white-space: nowrap;\n    font-size: 0;\n}\n\n.zwibbler-colour-panel div { \n    display: inline-block;\n}",pk:'<div class="zwibbler-colour-panel" z-style="{height:ColourPanelWidth()+\'px\'}">\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'clear\'}"\n        z-on:click="setColour(\'rgba(0,0,0,0.0)\', true)"\n        z-on:contextmenu="setColour(\'rgba(0,0,0,0.0)\', false)">\n    </canvas>\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'transparent\'}"\n        z-on:click="setOpacity(0.5, true)"\n        z-on:contextmenu="setOpacity(0.5, false)">\n    </canvas>\n    <div z-for="colour in ColourPanelColours"\n        z-style="{width: ColourPanelWidth()+\'px\', height: ColourPanelWidth()+\'px\', background: colour}"\n        z-on:click="setColour(colour, true)"\n        z-on:contextmenu="setColour(colour, false)">\n    </div>\n</div>\n',controller:function(c){var a=
c.Hp();a.shift();a.shift();c.ColourPanelColours=a;c.ColourPanelWidth=function(){return c.ee("useTouch")?40:20}}};var xb=function(){function c(){this.Eh=[];this.log=y.create("DESTRUCTOR")}c.prototype.add=function(a){this.Eh.push(a)};c.prototype.addEventListener=function(a,b,d,e){function c(b){a.addEventListener(b,d,e);h.add(function(){a.removeEventListener(b,d,e)})}var h=this;void 0===e&&(e=!1);var k=0;for(b=b.split(" ");k<b.length;k++)c(b[k])};c.prototype.oa=function(a,b,d){a.oa(b,d);this.add(function(){a.removeListener(b,d)})};c.prototype.Ua=function(){this.log("Running %s destructors",this.Eh.length);for(var a=
this.Eh.length-1;0<=a;a--)this.Eh[a]();this.Eh.length=0};return c}();var yb=function(){function c(a,b,d){var e=this;void 0===d&&(d=!1);this.qa=a;this.Pz=d;this.en=0;this.Xm={};this.ub=!1;this.timeout=null;this.lines=[];this.filter=null;this.Vt="#5da700 #ed81ff #02ab34 #f92798 #59ff91 #ff6b80 #3cffe4 #ffd32b #5e8caa #ffdb7f #e5cdff #00c17e #f6f6f5 #9a861e #daff9d #808d40".split(" ");this.Wt="#2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #805221 #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.tg=[];var c=new Ja;c.Om('\n\n.z-inner-debug.black {\n    background: #000;\n    white-space: pre-wrap;\n}\n\n.z-inner-debug.white {\n    background: #fff;\n}\n\n.z-debug-panel {\n    font-family: "monospace";\n    font-size: 12px;\n    display: flex;\n    flex-flow: column nowrap;\n    text-align: left;\n}\n\n.z-inner-debug {\n    flex: 1 1 auto;\n    overflow: scroll;\n}\n\n.z-inner-debug.black div {\n    border-bottom: 1px solid #222;\n    margin-bottom: 3px;\n}\n\n.z-inner-debug.white div {\n    border-bottom: 1px solid #eee;\n    margin-bottom: 3px;\n}\n');
a.classList.add("z-debug-panel");var h=0;A("input").Hi({type:"text",placeholder:"regexp...",onclick:"this.select()"}).$c(a).addEventListener("input",function(a){h&&window.clearTimeout(h);h=setTimeout(function(){e.Rx(a.target.value);h=0},200)});this.ed=A("div").jd("z-inner-debug").$c(a).ba;A("button").$c(this.qa).$a({flex:"0 0 auto"}).ah("Scroll to bottom/top").addEventListener("click",function(){e.ed.scrollTop=e.tp()?0:e.ed.scrollHeight});this.mw=y.addListener(function(a,b){return e.kp(a,b)});b.add(function(){y.removeListener(e.mw);
c.Ua()});this.kp("DEBUG","Debug window starting");A(this.ed).jd(d?"white":"black");this.tg=d?this.Wt:this.Vt}c.prototype.show=function(){this.qa.style.display="flex";this.ub=!0;this.Qo();this.ed.scrollTop=this.ed.scrollHeight};c.prototype.ie=function(){this.qa.style.display="none";this.ub=!1};c.prototype.dv=function(a){a in this.Xm||(this.Xm[a]=this.tg[this.en],this.en=(this.en+1)%this.tg.length);return this.Xm[a]};c.prototype.kp=function(a,b){for(var d=this,e=0,c=b.split("\n");e<c.length;e++)this.lines.push({key:a,
line:c[e]});this.ub&&null===this.timeout&&(this.timeout=setTimeout(function(){d.timeout=null;d.Qo()},100))};c.prototype.Rx=function(a){this.filter=2>a.length?null:new RegExp(a,"i");for(a=this.ed.firstChild;a;){var b=a;1===b.nodeType&&"DIV"===b.tagName&&(!this.filter||this.filter.exec(b.textContent)?b.style.display="block":b.style.display="none");a=a.nextSibling}};c.prototype.tp=function(){return this.ed.scrollTop>=this.ed.scrollHeight-this.ed.clientHeight};c.prototype.Qo=function(){for(var a=this.tp(),
b=0,d=this.lines;b<d.length;b++){var e=d[b],c=this.dv(e.key),h=document.createElement("div");h.style.color=c;e=e.key+": "+e.line;this.filter&&!this.filter.exec(e)&&(h.style.display="none");h.appendChild(document.createTextNode(e));this.ed.appendChild(h)}a&&(this.ed.scrollTop=this.ed.scrollHeight);this.lines.length=0};return c}();var zb=y.create("EventEmitter"),Ab=function(){function c(){this.pi=!1;this.ab={};this.Hd=[];this.Lj={}}c.prototype.na=function(a){for(var b=this,d=1;d<arguments.length;d++);this.Hd.push(Array.prototype.slice.apply(arguments));1===this.Hd.length&&setTimeout(function(){for(var a=0;a<b.Hd.length;a++)b.am.apply(b,b.Hd[a]);b.Hd.length=0},0)};c.prototype.Kc=function(a){for(var b=1;b<arguments.length;b++);this.Hd.push(Array.prototype.slice.apply(arguments));if(1===this.Hd.length){for(b=0;b<this.Hd.length;b++)this.am.apply(this,
this.Hd[b]);this.Hd.length=0}};c.prototype.xg=function(a){for(var b=this,d=1;d<arguments.length;d++);d=Array.prototype.slice.apply(arguments);var e=d[0];e in this.Lj||setTimeout(function(){var a=b.Lj[e];delete b.Lj[e];b.am.apply(b,a)},0);this.Lj[e]=d};c.prototype.am=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];if(a in this.ab){d=this.ab[a];this.pi||zb("Emit %s",a);for(var e=0;e<d.length;e++)d[e].apply(null,b)}};c.prototype.oa=function(a,b){this.ab||(this.ab={});for(var d=
0,e=a.split(" ");d<e.length;d++)this.bind(e[d],b)};c.prototype.once=function(a,b){function d(){e.vs(a,d);b.apply(null,arguments)}var e=this;e.bind(a,d)};c.prototype.bind=function(a,b){a in this.ab?this.ab[a].push(b):this.ab[a]=[b];return b};c.prototype.removeListener=function(a,b){return this.vs(a,b)};c.prototype.vs=function(a,b){var d,e;if(a in this.ab){var c=this.ab[a];var h=d=0;for(e=c.length-1;d<=e;h=d+=1)if(c[h]===b){c.splice(h,1);break}0===c.length&&delete this.ab[a]}};c.prototype.xh=function(){this.ab=
{}};return c}();var Bb=function(c){function a(){var a=c.call(this)||this;a.keys={};a.pi=!0;a.sy=new RegExp("alt backspace cmd command control ctrl del delete down end enter esc escape f4 home ins insert left meta pagedown pageup right shift up \u2318".split(" ").sort(function(a,b){return b.length-a.length}).join("|"),"g");a.log=y.create("KEYMAP");a.Dq=function(b){a.Xv(b)};return a}__extends(a,c);a.prototype.map=function(a,d,e){void 0===e&&(e=!0);a=a.toLowerCase().split(",");var b;if("string"===typeof d)for(d=d.split(","),
b=0;b<a.length;b++)for(var c=0;c<d.length;c++)this.Ro(a[b],d[c],!e);else for(b=0;b<a.length;b++)this.Ro(a[b],d,!e)};a.prototype.Ro=function(a,d,e){if(0!==a.length){var b=a.match(this.sy)||[],c=!1,k=!1,l=!1,n=!1,q=[],u;for(u=0;u<b.length;u++)switch(b[u]){case "alt":l=!0;break;case "control":case "ctrl":k=!0;break;case "shift":c=!0;break;case "home":q.push(36);break;case "end":q.push(35);break;case "pageup":q.push(33);break;case "pagedown":q.push(34);break;case "delete":case "del":q.push(46);break;
case "backspace":q.push(8);break;case "up":q.push(38);break;case "right":q.push(39);break;case "down":q.push(40);break;case "left":q.push(37);break;case "escape":case "esc":q.push(27);break;case "enter":q.push(13);break;case "ins":case "insert":q.push(45);break;case "f4":q.push(115);break;case "meta":case "command":case "cmd":case "\u2318":n=!0;break;default:alert("key entry not found: "+b[u])}var v=this;b=function(a){c&&-1===a.indexOf("-shift")&&(a+="-shift");k&&-1===a.indexOf("-control")&&(a+="-control");
l&&-1===a.indexOf("-alt")&&(a+="-alt");n&&-1===a.indexOf("-meta")&&(a+="-meta");"string"===typeof d?v.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,d):v.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,"function()");if(e){if(a in v.keys){for(var b=[],f=0,h=v.keys[a];f<h.length;f++){var q=h[f];q!==d&&b.push(q)}v.keys[a]=b}}else if(a in v.keys){f=v.keys[a];for(b=0;b<f.length&&f[b]!==d;b++);b===f.length&&v.keys[a].push(d)}else v.keys[a]=[d]};if(0===q.length)switch(a=a.toUpperCase().charAt(a.length-
1),a){case "=":b("107-shift");b("187");b("61");break;case "+":b("107");b("61-shift");break;case "-":b("109");b("189");b("173");break;default:q.push(a.charCodeAt(0))}for(u=0;u<q.length;u++)b(""+q[u])}};a.prototype.zv=function(a){var b="";a.keyCode&&(b+=a.keyCode);a.shiftKey&&(b+="-shift");a.ctrlKey&&(b+="-control");a.altKey&&(b+="-alt");a.metaKey&&(b+="-meta");return b};a.prototype.translate=function(a){var b=[],e=this.zv(a);e in this.keys&&(b=this.keys[e]);(32>a.keyCode||126<=a.keyCode)&&this.log("%s",
e);return b};a.prototype.Xv=function(a){for(var b=0,e=this.translate(a);b<e.length;b++){var c=e[b];"string"===typeof c?(this.log("action: %s",c),this.Kc("*",c,a)):c(a)}};a.prototype.up=function(a){a.addEventListener("keydown",this.Dq)};a.prototype.detach=function(a){a.removeEventListener("keydown",this.Dq)};return a}(Ab);var Cb={1:"INITIAL CONNECTION",2:"APPEND",3:"SET-KEY",4:"BROADCAST",128:"ERROR",129:"ACK/NACK",130:"KEY-INFORMATION",131:"SET-KEY-ACK",255:"CONTINUATION"},Gb={0:"No",1:"Yes"},Hb={0:"NACK",1:"ACK"};function B(c,a,b,d){return{length:c,type:a,name:b,yz:d}}
var Ib={1:[B(1,0,"messageType",Cb),B(1,0,"more",Gb),B(2,0,"protocolVersion"),B(4,0,"maxSize"),B(1,0,"creationMode",{0:"POSSIBLY_CREATE",1:"NEVER_CREATE",2:"ALWAYS_CREATE"}),B(8,0,"offset"),B(1,0,"docIDLength"),B(-1,1,"docID"),B(-2,1,"data")],2:[B(1,0,"messageType",Cb),B(1,0,"more",Gb),B(8,0,"offset"),B(-2,1,"data")],3:[B(1,0,"messageType",Cb),B(1,0,"more",Gb),B(2,0,"requestID"),B(1,0,"lifetime",{0:"CLIENT-LIFETIME",1:"SESSION-LIFETIME"}),B(4,0,"oldVersion"),B(4,0,"newVersion"),B(4,0,"nameLength"),
B(-1,1,"name"),B(4,0,"valueLength"),B(-1,1,"value")],4:[B(1,0,"messageType",Cb),B(1,0,"more",Gb),B(4,0,"dataLength"),B(-1,1,"data")],128:[B(1,0,"messageType",Cb),B(1,0,"more",Gb),B(2,0,"errorCode",{0:"UNSPECIFIED",1:"DOES_NOT_EXIST",2:"ALREADY_EXISTS",3:"INVALID_OFFSET"}),B(-2,1,"description")],129:[B(1,0,"messageType",Cb),B(1,0,"more",Gb),B(2,0,"ack",Hb),B(8,0,"offset")],130:[B(1,0,"messageType",Cb),B(1,0,"more",Gb),B(0,2,"keys"),B(4,0,"version"),B(4,0,"nameLength"),B(-1,1,"name"),B(4,0,"valueLength"),
B(-1,1,"value")],131:[B(1,0,"messageType",Cb),B(1,0,"more",Gb),B(2,0,"ack",Hb),B(2,0,"requestID")],255:[B(1,0,"messageType",Cb),B(1,0,"more",Gb),B(-2,1,"data")]};
function Jb(c){var a=Ib[c.messageType];if(!a)throw Error("no encoder for message type "+c.messageType);for(var b=[],d=0;d<a.length;d++){var e=a[d];if(!(e.name in c))throw Error("missing field "+e.name);var f=c[e.name];if(0===e.type){var h=b;e=e.length;do--e,h.push(Math.floor(f/Math.pow(2,8*e)%256));while(0<e)}else if(f instanceof Uint8Array)for(h=0;h<f.length;h++)b.push(f[h]);else for(h=b,f=Ca(f),e=0;e<f.length;e++)h.push(f[e])}return new Uint8Array(b)}
function Kb(c){var a=Ib[c[0]];if(!a)return null;for(var b={},d=b,e=0,f=0,h="",k=0,l=0;l<a.length;l++){var n=a[l],q;if(2===n.type)h=n.name,b={},d[h]=[b],k=l;else{if(0===n.type){e=f;var u=n.length;for(q=0;u;)q=256*q+c[e],--u,e+=1;q=e=q;f+=n.length}else{u=e;-2===n.length&&(u=c.length-f,b[n.name+"_length"]=u);q=u;void 0===q&&(q=c.length-f);q=c.slice(f,f+q);for(var v="",w=0;w<q.length;w++){var x=q[w];if(0===(x&128))v+=String.fromCharCode(x);else if(192===(x&224)){var z=q[w++]&63;v+=String.fromCharCode((x&
31)<<6|z)}else if(224===(x&240)){z=q[w++]&63;var D=q[w++]&63;v+=String.fromCharCode((x&31)<<12|z<<6|D)}else if(240===(x&248)){z=q[w++]&63;D=q[w++]&63;var G=q[w++]&63;x=(x&7)<<18|z<<12|D<<6|G;65535<x&&(x-=65536,v+=String.fromCharCode(x>>>10&1023|55296),x=56320|x&1023);v+=String.fromCharCode(x)}}q=v;f+=u}b[n.name]=q;f<c.length&&l+1==a.length&&h.length&&(b={},d[h].push(b),l=k)}}return d}
var Lb=function(c){function a(a,d){var b=c.call(this)||this;b.Pb=a;b.Bk=d;a.binaryType="arraybuffer";a.onopen=function(){b.na({type:"open"})};a.onerror=function(){b.na({type:"error"});a.onerror=a.onclose=null};a.onclose=function(){b.na({type:"close"});a.onerror=a.onclose=null};a.onmessage=function(a){b.na({type:"message",message:new Uint8Array(a.data)})};return b}__extends(a,c);a.prototype.close=function(){this.Pb.close()};a.prototype.read=function(){return __awaiter(this,void 0,void 0,function(){var a,
d,e,c,h;return __generator(this,function(b){switch(b.label){case 0:a=[],b.label=1;case 1:return[4,this.cr()];case 2:d=b.sent();if("message"!==d.type||0===a.length&&!d.message[1])return[2,d];e=0;c=d.message;a.length&&(e=2);for(h=e;h<c.length;h++)a.push(c[h]);return d.message[1]?[3,1]:[2,{type:"message",message:new Uint8Array(a)}];case 3:return[2]}})})};a.prototype.send=function(a){var b=this.Pb,e=0,c=a.length;c>this.Bk&&(c=this.Bk,a[1]=1);b.send(a.slice(e,e+c));for(e+=c;e<a.length;)c=a.length-e,c>
this.Bk-2&&(c=this.Bk-2),b.send(Jb({messageType:255,more:e+c<a.length?1:0,data:a.slice(e,e+c)})),e+=c};return a}(function(){function c(){this.Co=[];this.ab=[]}c.prototype.cr=function(){var a=this;return(new Promise(function(b){a.ab.length?b(a.ab.shift()):a.Co.push(b)})).then(null,function(a){throw a;})};c.prototype.na=function(a){this.Co.length?this.Co.shift()(a):this.ab.push(a)};return c}());
function Mb(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2,new Promise(function(a){setTimeout(a,c)})]})})}
var Nb=function(c){function a(a,d,e){var b=c.call(this)||this;b.za=a;b.Hx=d;b.latency=e;b.log=y.create("Sharing");b.keys={};b.Mq="";b.tr=function(){b.sg()};b.Kk=function(){};b.bg=!1;b.connected=!1;b.Pb=null;b.gc=0;b.Ic="";b.vn=[];b.Ai=[];b.Wk=[];b.Fw=1;b.di=0;return b}__extends(a,c);a.prototype.Wx=function(a){this.latency=a};a.prototype.start=function(a,d){var b=this;return new Promise(function(e,c){b.log("Start shared session: createMode=%s",d);b.Kk=e;b.za.oa("local-changes",b.tr);if(1===d)b.Fp(a,
d,"").then(null,c);else{var f=b.za.Cm();if(""===f)throw Error("getLocalChanges() returned null on first batch");b.Mq=f;b.Fp(a,d,f).then(null,c)}})};a.prototype.stop=function(){this.log("stop() -- shut down session");this.bg=!1;this.Pb&&this.Pb.close();this.za.removeListener("local-changes",this.tr);this.di&&clearTimeout(this.di)};a.prototype.Kn=function(a){this.vn.push(a);this.sg()};a.prototype.Vx=function(a,d,e){d=JSON.stringify(d);for(var b=null,c=0,k=this.Ai;c<k.length;c++){var l=k[c];l.name===
a&&(b=l)}c=0;k=1;a in this.keys&&(c=this.keys[a].version,k=c+1);e||(k=c=0);b?b.value=d:(b={name:a,value:d,oldVersion:c,newVersion:k,gx:e,ve:this.Fw++},this.Ai.push(b));this.sg()};a.prototype.Fp=function(a,d,e){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(f){switch(f.label){case 0:this.bg=!0,b=0,f.label=1;case 1:if(!this.bg)return[3,10];this.connected=!1;if(!b)return[3,3];this.log("Waiting %sms before reconnecting",b);return[4,Mb(b)];case 2:f.sent(),f.label=
3;case 3:return b=Math.max(Math.min(2*b,3E5),1E3),[4,this.connect()];case 4:return f.sent()?[4,this.bw(a,d,e)]:[3,1];case 5:if(!f.sent())return[3,1];this.Kk&&(this.Kk(),this.Kk=function(){});this.na("connected");d=1;this.Ic=this.Mq=e="";this.connected=!0;this.sg();f.label=6;case 6:return f.trys.push([6,8,,9]),[4,this.rt()];case 7:return f.sent(),[3,9];case 8:return c=f.sent(),this.log("While trying to connect: "+c.message),console.log("While trying to connect: ",c),[3,9];case 9:return this.connected=
!1,b=0,this.na("connect-error"),[3,1];case 10:return[2]}})})};a.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var a,d,e;return __generator(this,function(b){switch(b.label){case 0:return a=this.Hx,this.Pb&&this.Pb.close(),this.Pb=d=new Lb(new WebSocket(a),102400),this.log("Connect to %s; wait for event",a),[4,d.cr()];case 1:e=b.sent();if("open"!==e.type)return this.log("Received unexpected event: %s",e.type),[2,!1];this.log("Connected to %s",a);return[2,!0]}})})};a.prototype.bw=
function(a,d,e){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(f){switch(f.label){case 0:this.log("Send INIT message docLen=%s changes=%s",this.gc,e.toString().length);if(!this.Pb)throw Error("ws is null");try{this.Pb.send(Jb({messageType:1,more:0,maxSize:102400,protocolVersion:2,creationMode:d,offset:this.gc,docIDLength:a.length,docID:a,data:e}))}catch(l){throw console.log("Got error ",l),l;}return[4,this.Pb.read()];case 1:b=f.sent();if("message"!=b.type)return this.log("Expected message; got "+
b.type),[2,!1];c=Kb(b.message);if(128===c.messageType)throw this.log("Got error response: %s",c.description),Error(c.description);2===c.messageType&&(0<c.offset&&e.length&&this.za.ii(e),this.log("Got initial changes at offset %s=>%s",c.offset,c.offset+c.data_length),(c.data.length||0===c.offset)&&this.za.qh(c.data,0===c.offset),0===c.offset&&(this.Ic=""),this.gc=c.offset+c.data_length);this.log("Connected and initialized.");return[2,!0]}})})};a.prototype.sg=function(){var a=this;this.log("Check changes; changesSent=%s",
this.Ic);this.di||(this.di=setTimeout(function(){var b;a.di=0;a.log("inner checkChanges: connected=%s ws=%s",!!a.connected,!!a.Pb);if(a.connected&&a.Pb){""===a.Ic&&(a.Ic=a.za.Cm(),a.log("getLocalChanges: %s",a.Ic),a.Ic&&(a.log("Sent changes %s->%s",a.gc,a.gc+a.Ic.length),a.Pb.send(Jb({messageType:2,offset:a.gc,more:0,data:a.Ic}))));for(var e=0,c=a.vn;e<c.length;e++){var h=c[e];a.Pb.send(Jb({messageType:4,more:0,dataLength:h.length,data:h}))}e=a.vn.length=0;for(c=a.Ai;e<c.length;e++)h=c[e],a.Pb.send(Jb({messageType:3,
more:0,requestID:h.ve,lifetime:h.gx?1:0,oldVersion:h.oldVersion,newVersion:h.newVersion,nameLength:h.name.length,name:h.name,valueLength:h.value.length,value:h.value}));(b=a.Wk).push.apply(b,a.Ai);a.Ai.length=0}},this.latency))};a.prototype.rt=function(){return __awaiter(this,void 0,void 0,function(){var a,d,e,c,h,k,l,n;return __generator(this,function(b){switch(b.label){case 0:return[4,this.Pb.read()];case 1:a=b.sent();if("message"!==a.type)return this.log("Expected message; got "+a.type),[2];d=
Kb(a.message);if(2===d.messageType){if(this.gc!==d.offset)throw Error("Error: docLength ="+this.gc+" but got offset "+d.offset);this.za.qh(d.data,!1);this.log("From server: APPEND "+this.gc+"->"+(this.gc+d.data_length));this.gc+=d.data_length;this.sg()}else if(129===d.messageType)d.ack?(this.log("Received ACK "+this.gc+"=>"+d.offset),this.za.ii(this.Ic),this.Ic="",this.gc=d.offset):(this.log("Received NACK "+this.gc+"!="+d.offset+" "+this.Ic.substr(0,22)),this.Ic="",this.sg());else if(4===d.messageType)this.na("broadcast",
d.data);else if(130===d.messageType){e=[];c=0;for(h=d.keys;c<h.length;c++)k=h[c],k.value=""===k.value?null:JSON.parse(k.value),l={name:k.name,value:k.value,version:k.version},e.push(k),null===l.value?delete this.keys[l.name]:this.keys[l.name]=l;this.na("set-keys",e)}else if(131===d.messageType)for(n=0;n<this.Wk.length;n++){if(k=this.Wk[n],k.ve===d.requestID){this.log("key %s ACKED:%s",k.name,d.ack);d.ack&&(this.keys[k.name]={name:k.name,value:k.value,version:k.newVersion});this.Wk.splice(n,1);break}}else throw Error("Unexpected message type "+
d.messageType);b.label=2;case 2:return[3,0];case 3:return[2]}})})};return a}(Ab);y.create("OTDocument");
var Ob=function(){function c(a,b,d,e,c){void 0===e&&(e=[]);void 0===c&&(c=!1);this.Sa=a;this.uc=b;this.dc=d;this.ops=e;this.local=c}c.prototype.clone=function(a,b){void 0===b&&(b=this.dc);for(var d=[],e=0,f=this.ops;e<f.length;e++)d.push(f[e].clone());return new c(a,this.uc,b,d,this.local)};c.prototype.inverse=function(a,b){void 0===a&&(a=this.Sa);void 0===b&&(b=this.dc);for(var d=[],e=this.ops.length-1;0<=e;e--)d.push(this.ops[e].inverse());return new c(a,this.uc,b,d,this.local)};return c}(),Pb=
function(){function c(a,b,d){this.zp=a;this.Et=b;this.Uq=d}c.prototype.getData=function(){return this.zp};c.prototype.Bg=function(){return this.Uq};c.prototype.empty=function(){return this.Et===this.Uq};c.prototype.toString=function(){return this.zp};return c}(),Qb=function(){function c(a,b){void 0===a&&(a=!1);this.At=a;this.Ke=b;this.log=y.create("OTDocument");this.Bc=[];this.next=0;this.local=[];this.all=[];this.vb=0;this.Bd={};this.Bb=!1;this.ei=null;this.ap=-1;this.xl=""}c.prototype.Zd=function(){return 0<
this.next&&!this.locked()};c.prototype.Yd=function(){return this.next<this.Bc.length&&!this.locked()};c.prototype.Ac=function(){this.Zd()&&(this.Bb=!0,this.Hr(this.Bc[--this.next],!0),this.ua(!1,!0),this.Bb=!1)};c.prototype.Qd=function(){this.Yd()&&(this.Bb=!0,this.Hr(this.Bc[this.next++],!1),this.ua(!1,!0),this.Bb=!1)};c.prototype.Tl=function(){this.next=this.Bc.length=0};c.prototype.sk=function(a){if(null===a)return this.all.length-1;for(var b=0;b<this.all.length;b++)if(this.all[b].Sa===a)return b;
return-1};c.prototype.locked=function(){return null!==this.ei};c.prototype.Lm=function(a){var b=this.sk(a);if(0>b)return this.log("CID "+a+" does not exist"),!1;var d=this.sk(this.ei);b===this.all.length-1&&(a=null);this.Bb=!0;this.ei=a;if(b!==d){if(d<b)for(a=d+1;a<=b;a++)this.zf(this.all[a]);else for(a=d;a>b;a--)this.zf(this.all[a].inverse());this.ua(!1)}this.Bb=!1};c.prototype.Jm=function(){for(var a=[],b=0,d=this.all;b<d.length;b++){var e=d[b];a.push({Sa:e.Sa,dc:e.dc,local:e.local})}return a};
c.prototype.bv=function(){return this.local.length?0===this.Ke?new Pb(this.encode(this.local),this.vb.toString(),(this.vb+this.local.length).toString()):new Pb(this.encode(this.local),this.local[0].uc,this.local[this.local.length-1].Sa):new Pb("","0","0")};c.prototype.ux=function(){this.vb=0;this.local=this.all.concat();for(var a=0,b=this.all;a<b.length;a++)b[a].local=!0};c.prototype.ii=function(a){if(0===this.Ke){a=parseInt(a,10)-this.vb;for(var b=0;b<a;b++)this.all[this.vb+b].Sa=(this.vb+b+1).toString(),
this.vb+b+1<this.all.length&&(this.all[this.vb+b+1].uc=this.all[this.vb+b].Sa);this.vb+=a;this.local.splice(0,a)}else for(b=this.local.length-1;0<=b;b--)if(a===this.local[b].Sa){this.local.splice(0,b+1);break}};c.prototype.Bg=function(){return this.all.length?this.all[this.all.length-1].Sa:this.Nj()};c.prototype.Hl=function(a,b){void 0===b&&(b=!1);this.Bb||(a.local=!0,b||(this.Bc.length=this.next,this.Bc.push(a),this.next+=1),this.local.push(a),this.all.push(a),this.At?(this.log("Executing LOCAL %s",
a.Sa),this.zf(a)):this.log("adding LOCAL %s",a.Sa),1===this.Ke&&(this.Bd[a.Sa]=a))};c.prototype.zf=function(a){var b=0;for(a=a.ops;b<a.length;b++)this.md(a[b])};c.prototype.Nu=function(a){for(var b=this.all.length-1;0<=b&&this.all[b].Sa!==a;b--);return b};c.prototype.Hr=function(a,b){var d=this.Nu(a.Sa);if(-1===d)this.log("ERROR");else{var e=this.mi();b?(e=a.inverse(e,this.now()),e.uc=this.all[d].Sa):e=a.clone(e,this.now());for(d=b?d+1:d;d<this.all.length;d++)this.all[d].local?e.uc=this.all[d].Sa:
this.gl(this.all[d],[e]);this.local.push(e);this.all.push(e);this.zf(e);1===this.Ke&&(this.Bd[e.Sa]=e)}};c.prototype.gl=function(a,b){if(0!==b.length){if(a.uc!==b[0].uc)throw Error("Error: Expected same parentage.");for(var d=0,e=a.ops;d<e.length;d++)for(var c=e[d],h=0,k=b;h<k.length;h++){var l=k[h];c=this.Ey(c,l.ops,a.Sa,l.Sa)}b[0].uc=a.Sa}};c.prototype.Ey=function(a,b,d,e){this.log("Transform "+d+" agaisnt list "+e);for(var c=0;c<b.length;c++){var h=b[c];b[c]=this.ro(a,h,d,e);a=this.ro(h,a,e,d)}return a};
c.prototype.qh=function(a,b){var d=this,e=this.decode(a);if(null===e||0===e.length)return null!==e;this.log("Entering addRemoteChanges");var c=null;b&&(c=new Ob(this.mi(!0),this.Bg(),(new Date).getTime()/1E3,b,!0));var h=this.sk(this.ei),k=this.all.length;if(0===this.Ke){if(this.locked())throw Error("Not implemented");if(this.vb===this.all.length)for(var l=0;l<e.length;l++){var n=e[l];this.all.push(n);c&&this.gl(n,[c])}else{for(this.Bb=!0;k!==this.vb;)--k,this.zf(this.all[k].inverse());this.Bb=!1;
n=this.all.slice(this.vb);c&&n.push(c);for(this.all.length=this.vb;0<e.length&&0<n.length;)if(this.tt(e[0],n[0]))this.log("Removing DUPE oplist"),n.shift(),this.local.shift(),this.all.push(e.shift()),this.vb+=1;else break;for(var q=0;q<e.length;q++)l=e[q],this.gl(l,n);c&&n.pop();this.all=this.all.concat(e,n)}this.vb+=e.length}else{for(k=0;k<e.length;k++)l=e[k],l.Sa in this.Bd||(this.Bd[l.Sa]=l);k={};k[this.Nj()]=[];for(n in this.Bd)k[n]=[];for(n in this.Bd)l=this.Bd[n],l.uc in k&&k[l.uc].push(l.Sa);
for(n in k)k[n].sort(function(a,b){var e=d.Sq(a),c=d.Sq(b);return e&&!c?1:!e&&c?-1:a<b?-1:a>b?1:0});l=k[this.Nj()];e=this.Nj();c=void 0;for(c=0;c<this.all.length&&1===l.length&&l[0]===this.all[c].Sa;c++)e=l[0],l=k[l[0]];for(this.Bb=!0;h>=c;h--){this.log("[%s] Executing INVERSE %s",h,this.all[h].Sa);try{this.zf(this.all[h].inverse())}catch(u){throw this.log("Error occurred HEREEEEEE %s",this.all[h].Sa),u;}}this.Bb=!1;this.all.length=c;c=[];this.Hm(k,e,c);k=this.all.length;for(h=1;h<c.length;h++)this.all.push(c[h]);
h=this.sk(this.ei);this.log("revertedTo=%s lockedTo=%s ordered=%s all=%s",k,h,c.length,this.all.length)}this.Bb=!0;for(c=k;c<=h;c++)this.log("[%s] Executing REMOTE %s",c,this.all[c].Sa),this.zf(this.all[c]);0<this.all.length-k?this.ua(!0):this.log("no remote changes to commit");this.Bb=!1;this.log("Done addremotechanges");return!0};c.prototype.Sq=function(a){return a in this.Bd&&this.Bd[a].local};c.prototype.Hm=function(a,b,d){d.push(this.Bd[b]);for(b=a[b];1===b.length;)d.push(this.Bd[b[0]]),b=a[b[0]];
if(0!==b.length){var e=d.length;this.Hm(a,b[0],d);for(var c=1;c<b.length;c++){var h=[];this.Hm(a,b[c],h);for(var k=e;k<d.length;k++)this.gl(d[k],h);d.push.apply(d,h)}}};c.prototype.Nj=function(){return(0).toString()};c.prototype.mi=function(a){void 0===a&&(a=!1);if(0===this.Ke){var b=this.ap.toString();a||--this.ap;return b}return this.xl+Math.floor(1E6*Math.random()).toString(36)};c.prototype.show=function(){this.log("%s",JSON.stringify(this.all,null,2))};c.prototype.now=function(){return Math.floor((new Date).getTime()/
1E3)};c.prototype.Jx=function(a){this.xl=a};c.prototype.Ap=function(a,b){if(0===this.Ke){var d=parseInt(a,10),e=parseInt(b,10);return 0>d&&0>e?d>e:0<d&&0<e?d<e:0<e?!1:!0}return a<b};c.prototype.tt=function(a,b){var d=this.encode([a]),e=this.encode([b]);return d==e};c.prototype.ua=function(){};return c}(),Rb=function(){function c(a,b,d){this.type=a;this.Zb=b;this.newValue=d}c.prototype.clone=function(){return new c(this.type,this.Zb,this.newValue)};c.prototype.inverse=function(){return"a"===this.type?
new c("a",-this.Zb,this.newValue-this.Zb):new c("m",1/this.Zb,this.newValue/this.Zb)};return c}();
(function(c){function a(a,d){var b=c.call(this,!0,a)||this;b.prefix=d;b.value=0;b.Jx(d);return b}__extends(a,c);a.prototype.md=function(a){"a"===a.type?(this.log("Add to  %s  %s",this.value,a.Zb),this.value+=a.Zb):"m"===a.type&&(this.log("Multiply %s by %s",this.value,a.Zb),this.value*=a.Zb);if(this.value!==a.newValue)throw Error("Document value should be "+a.newValue+", but got "+this.value);};a.prototype.decode=function(a){a=JSON.parse(a,function(a,b){if(b instanceof Object){if(b.Zb)return new Rb(b.type,
b.Zb,b.newValue);if(b.ops)return new Ob(b.Sa,b.uc,b.dc,b.ops)}return b});if(0===this.Ke)for(var b=this.vb,e=b+1,c=0;c<a.length;c++){var h=a[c];h.uc=b.toString();h.Sa=e.toString();b=e;e+=1}return a};a.prototype.encode=function(a){return JSON.stringify(a)};a.prototype.ro=function(a,d,e,c){this.log("transform %s/,%s",e,c);if(this.Ap(e,c))return e=a.newValue,e="a"===d.type?e+d.Zb:e*d.Zb,new Rb(d.type,d.Zb,e);e=d.newValue;e="a"===a.type?e+a.Zb:e*a.Zb;this.log("   Modified op2 with value "+e);return new Rb("a",
e-a.newValue,e)};a.prototype.add=function(a){var b=this.mi();this.Hl(new Ob(b,this.Bg(),Math.round((new Date).getTime()/1E3),[new Rb("a",a,this.value+a)]))};a.prototype.multiply=function(a){var b=this.mi();this.Hl(new Ob(b,this.Bg(),Math.round((new Date).getTime()/1E3),[new Rb("m",a,this.value*a)]))};return a})(Qb);var Sb=function(){function c(a,b){this.ac=a;this.index=b}c.prototype.encode=function(){return this.ac+";"+this.index};return c}(),Ub=function(){function c(a,b,d,e){this.gb=a;this.da=e;this.type="c";this.Ka=new Sb(b,d)}c.prototype.encode=function(){var a=JSON.stringify(this.da);return"C"+this.gb+";"+this.Ka.encode()+";"+a.length+";"+a+";"};c.prototype.clone=function(){return new c(this.gb,this.Ka.ac,this.Ka.index,this.da)};c.prototype.inverse=function(){return new Tb(this.gb,this.Ka.ac,this.Ka.index)};
c.jf=function(a,b){var d=/C([^;]+);([^;]+);(-?\d+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){var f=parseInt(e[4],10),h=JSON.parse(a.substr(d.lastIndex,f));return{pf:new c(e[1],e[2],parseInt(e[3],10),h),position:d.lastIndex+f+1}}return null};return c}(),Tb=function(){function c(a,b,d){this.gb=a;this.ac=b;this.index=d;this.da=null;this.type="d";this.Ka=new Sb(b,d)}c.prototype.clone=function(){return new c(this.gb,this.Ka.ac,this.Ka.index)};c.prototype.inverse=function(){if(null===this.da)throw Error("DeleteOp should have been executed before inverse");
return new Ub(this.gb,this.Ka.ac,this.Ka.index,this.da)};c.prototype.encode=function(){return"D"+this.gb+";"+this.Ka.encode()+";"};c.jf=function(a,b){var d=/D([^;]+);([^;]+);(-?\d+);/g;d.lastIndex=b;var e=d.exec(a);return e&&e.index===b?{pf:new c(e[1],e[2],parseInt(e[3],10)),position:d.lastIndex}:null};return c}(),Vb=function(){function c(a,b,d){this.gb=a;this.da=b;this.Jf=d;this.type="s"}c.prototype.clone=function(){return new c(this.gb,this.da,this.Jf)};c.prototype.inverse=function(){if(null===
this.Jf)throw Error("SetPropertiesOp was not executed before inversion");return new c(this.gb,this.Jf,this.da)};c.prototype.encode=function(){var a=JSON.stringify(this.da);return"S"+this.gb+";"+a.length+";"+a+";"};c.jf=function(a,b){var d=/S([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){var f=parseInt(e[2],10),h=JSON.parse(a.substr(d.lastIndex,f));return{pf:new c(e[1],h,null),position:d.lastIndex+f+1}}return null};return c}(),Wb=function(){function c(a,b,d,e,c){this.gb=a;this.type=
"m";this.src=new Sb(b,d);this.Ka=new Sb(e,c)}c.prototype.clone=function(){return new c(this.gb,this.src.ac,this.src.index,this.Ka.ac,this.Ka.index)};c.prototype.inverse=function(){return new c(this.gb,this.Ka.ac,this.Ka.index,this.src.ac,this.src.index)};c.prototype.encode=function(){return"M"+this.gb+";"+this.src.encode()+";"+this.Ka.encode()+";"};c.jf=function(a,b){var d=/M([^;]+);([^;]+);(-?\d+);([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);return e&&e.index===b?{pf:new c(e[1],e[2],parseInt(e[3],
10),e[4],parseInt(e[5],10)),position:d.lastIndex}:null};return c}(),Xb=function(c){function a(a,d,e){void 0===e&&(e=!1);var b=c.call(this,!1,1)||this;b.zb=a;b.rk=e;b.eg=[];b.xn=!1;b.Kx(d);return b}__extends(a,c);a.prototype.Kx=function(a){this.xl=a};a.prototype.createNode=function(a,d,e,c){this.Bb||(d=new Ub(a,d,e,c),this.eg.push(d),this.rk&&!this.locked()&&this.md(d));return a};a.prototype.be=function(a,d,e){this.Bb||(d=new Tb(a,d,e),d.da=this.zb.Pc(a),this.eg.push(d),this.rk&&!this.locked()&&this.md(d))};
a.prototype.Sc=function(a,d,e,c,h){this.Bb||(a=new Wb(a,c,h,d,e),this.eg.push(a),this.rk&&!this.locked()&&this.md(a))};a.prototype.yd=function(a,d,e){this.Bb||(a=new Vb(a,d,e),this.eg.push(a),this.rk&&!this.locked()&&this.md(a))};a.prototype.Pc=function(a){return this.zb.Pc(a)};a.prototype.ua=function(a,d){if(!this.xn){if(!this.Bb&&this.eg.length){for(var b=new Ob(this.mi(),this.Bg(),this.now()),c=0,h=this.eg;c<h.length;c++)b.ops.push(h[c]);this.Hl(b,d)}else this.Bb&&(this.xn=!0,this.zb.ua(a,d),this.xn=
!1);this.eg.length=0}};a.prototype.md=function(a){this.log("Execute "+a.type);switch(a.type){case "c":this.zb.createNode(a.gb,a.Ka.ac,a.Ka.index,a.da);break;case "d":-1===a.Ka.index?this.log("op was nullified."):(a.da=this.zb.Pc(a.gb),this.zb.be(a.gb,a.Ka.ac,a.Ka.index));break;case "s":if(null===a.Jf){a.Jf={};var b=this.zb.Pc(a.gb),e;for(e in a.da)a.Jf[e]=b[e]}this.zb.yd(a.gb,a.da,a.Jf);break;case "m":-1!==a.src.index&&this.zb.Sc(a.gb,a.Ka.ac,a.Ka.index,a.src.ac,a.src.index)}};a.prototype.decode=
function(a){for(var b=[],e=0,c=/B([^;]+);([^;]+);([^;]+);\d+;/g;e<a.length;){var h;switch(a[e]){case "B":c.lastIndex=e;if((h=c.exec(a))&&h.index===e){e=parseInt(h[1],36);var k=h[2];h=h[3];if(isNaN(e))return this.log("Error: TS is not a number."),null;h=new Ob(h,k,e);b.push(h);e=c.lastIndex}else return null;continue;case "C":h=Ub.jf(a,e);break;case "D":h=Tb.jf(a,e);break;case "S":h=Vb.jf(a,e);break;case "M":h=Wb.jf(a,e);break;case "\r":case "\t":case "\n":case " ":e+=1;continue;default:return null}if(0===
b.length)return this.log("Got change outside of batch"),null;if(null===h)throw Error("change is null while decoding: "+a.substr(e,500));e=h.position;b[b.length-1].ops.push(h.pf)}return b};a.prototype.encode=function(a){for(var b="",e=0;e<a.length;e++){var c=a[e];b+="B"+c.dc.toString(36)+";"+c.uc+";"+c.Sa+";"+c.ops.length+";";var h=0;for(c=c.ops;h<c.length;h++)b+=c[h].encode()}return b};a.prototype.ro=function(a,d,e,c){function b(b,d,e){b="c"===a.type?1:-1;switch(e.type){case "c":if(0>e.Ka.index)break;
e=e.clone();f(d,e.Ka,b,"c");l.log("Result is "+c+":"+e.type+"."+e.Ka.index);break;case "d":if(0>e.Ka.index)break;e=e.clone();f(d,e.Ka,b,"d");l.log("Result is "+c+":"+e.type+"."+e.Ka.index);break;case "m":0>e.Ka.index||0>e.src.index||(e=e.clone(),f(d,e.src,b,"d"),f(d,e.Ka,b,"c"))}return e}function f(b,f,h,k){b.ac===f.ac&&0<=f.index&&(b.index<f.index||b.index==f.index&&0<h?(f.index+=h,l.log("Shift "+c+":"+d.type+" by "+h)):b.index===f.index&&0>h&&"d"===k?(f.index=-1,l.log("NULLIFY")):l.log("No conflict; "+
e+":"+a.type+" "+b.index+" "+c+":"+d.type+" "+f.index))}var l=this;this.log("xform "+e+":"+a.type+"/"+c+":"+d.type);if(this.Ap(c,e))return this.log("Not doing anything; "+c+"<"+e),d;"c"===a.type&&0<=a.Ka.index?d=b(a.type,a.Ka,d):"d"===a.type&&0<=a.Ka.index?d=b(a.type,a.Ka,d):"m"===a.type&&0<=a.Ka.index&&0<=a.src.index&&(d=b("d",a.src,d),d=b("c",a.Ka,d));return d};return a}(Qb);
(function(){function c(){this.Ia={};this.log=y.create("DebugTree");this.root={gb:"0",parent:null,children:[],da:{name:"root"}};this.Ia["0"]=this.root}c.prototype.createNode=function(a,b,d,e){this.log("create node "+a+" child of "+b);b=this.Ia[b];e={gb:a,parent:b,children:[],da:e};b.children.splice(d,0,e);this.Ia[a]=e};c.prototype.be=function(a){this.log("delete node "+a);if(a in this.Ia){var b=this.Ia[a].parent;if(b)for(var d=0;d<b.children.length;d++)if(b.children[d].gb===a){b.children.splice(d,
1);break}delete this.Ia[a]}};c.prototype.Sc=function(a,b,d){this.log("move "+a+" to "+b+":"+d);if(a in this.Ia){var e=this.Ia[a];this.be(a);this.createNode(a,b,d,e.da)}};c.prototype.yd=function(a,b){if(a in this.Ia)for(var d in b)b.hasOwnProperty(d)&&(this.Ia[a].da[d]=b[d])};c.prototype.Pc=function(a){return a in this.Ia?this.Ia[a].da:{}};c.prototype.ua=function(){};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a){for(var b="("+a.da.name,d=0;d<a.children.length;d++)b+=
" "+this.encode(a.children[d]);return b+")"};return c})();var Yb=y.create("DOCTREE"),Zb=function(){function c(a,b){this.le=a;this.Ia={};this.Ia["0"]=b}c.prototype.nt=function(a,b){if(a in this.Ia)throw Error("Node "+a+" already exists");this.Ia[a]=b};c.prototype.createNode=function(a,b,d,e){Yb("createNode("+a+", "+b+", "+d+")");if(a in this.Ia)throw Error("createNode "+a+" already exists");b=this.Ma(b);if(b.Na()+1<d)throw Error("Asked to insert at index "+d+" but parent only has "+b.Na()+" children");e=this.le.sw(a,e);b.uk(e,d);e.parent=b;this.Ia[a]=e;this.le.jr&&
this.le.jr(e)};c.prototype.Ma=function(a){if(a in this.Ia)return this.Ia[a];throw Error("nid "+a+" does not exist");};c.prototype.Se=function(a){return a in this.Ia};c.prototype.be=function(a,b,d){Yb("deleteNode("+a+", "+b+", "+d+")");var e=this.Ma(a),c=this.Ma(b);if(e.parent!==c)throw Error("Asked to remove "+a+" from parent "+b+" but it has a different parent");if(c.rb(d)!==e)throw Error("Asked to remove "+a+":"+d+" but it is in a different index");if(0!==e.Na())throw Error("Asked to delete "+a+
" but it still has children.");for(a=e.Na()-1;0<=a;a--)b=e.rb(a),this.be(b.id,e.id,a);this.le.kr&&this.le.kr(e);c.removeChild(d);delete this.Ia[e.id]};c.prototype.Sc=function(a,b,d,e,c){Yb("moveNode("+a+", dest="+b+":"+d+", src="+e+":"+c+")");var f=this.Ma(a),k=this.Ma(b),l=this.Ma(e);if(f.parent!==l)throw Error("node "+a+" does not have parent "+e);if(l.Na()<c)throw Error("parent of "+a+" does not have a node at index "+c);if(l.rb(c)!==f)throw Error("node "+a+" not the "+c+"th child");if(f.parent===
k){if(k.Na()<=d)throw Error("asked to shift node at "+b+":"+d+" but it only has "+k.Na()+" children");f.parent.co(d,c)}else{if(k.Na()<d)throw Error("asked to put a node at "+b+":"+d+" but it only has "+k.Na()+" children");l.removeChild(c);k.uk(f,d);f.parent=k}};c.prototype.yd=function(a,b){var d=this.Ma(a),e;for(e in b)d.setProperty(e,b[e]);this.le.sr&&this.le.sr(d,b)};c.prototype.Pc=function(a){return this.Ma(a).Pc()};c.prototype.ua=function(a){this.le.Hk&&this.le.Hk(a)};c.prototype.Jc=function(a){for(var b in this.Ia)a(this.Ia[b])};
return c}();function $b(c){c=c.replace(/\+/g," ");return decodeURIComponent(c)}function ac(c,a){var b;var d={};var e=c.indexOf(a||"?");0<=e&&(c=c.substr(e+1));e=c.indexOf("#");0<=e&&(c=c.substr(0,e));e=c.split("&");var f=0;for(b=e.length;f<b;f++){var h=e[f];var k=h.split("=");h=$b(k[0]);"/"==h[0]&&-1===h.indexOf(".")&&(h=h.substr(1));k=1<k.length?$b(k[1]):"";h.length&&(d[h]=k)}return d}function bc(){if(void 0===c)var c=window.location.hash;return ac(c,"#")};var cc=y.create("CONFIG"),dc=function(c){function a(a,d,e){var b=c.call(this)||this;b.Lh={};for(var h in d)b.Lh[h.toLowerCase()]=h;b.options=JSON.parse(JSON.stringify(d));for(var k in e)k.toLowerCase()in b.Lh||alert("Zwibbler: Unknown option '"+k+"'"),b.set(k,e[k],!0);a.addEventListener(window,"hashchange",function(){cc("Reload parameters from url hash");b.Zm()});a.add(function(){b.ab={}});b.Zm();for(var l in b.options)cc("%s=%s",l,b.options[l]);return b}__extends(a,c);a.prototype.Zm=function(){var a=
bc(),d;for(d in a)this.set(d,a[d])};a.prototype.has=function(a){return a.toLowerCase()in this.Lh};a.prototype.set=function(a,d,e){void 0===e&&(e=!1);a.toLowerCase()in this.Lh&&(a=this.Lh[a.toLowerCase()]);if(a=this.aq(a,d))cc("Set config %s=%s",a.name,a.value),a.name in this.options?(this.options[a.name]=a.value,e||(this.Kc("update",a.name,a.value),this.Kc(a.name,a.value,!1))):cc("Error: %s is not a configuration option.",a.name)};a.prototype.aq=function(a,d){if("string"===typeof d&&"number"===typeof this.options[a]&&
(d=parseFloat(d),isNaN(d))){console.log(Error("Config option "+a+" expects a number"));return}return{name:a,value:d}};a.prototype.oa=function(a,d){if("update"!==a&&!(a in this.options))throw Error(a+" is not a valid config setting.");d(this.options[a],!0);return c.prototype.oa.call(this,a,d)};a.prototype.get=function(a){if(!(a in this.options))throw Error(a+" is not a valid config setting.");return this.options[a]};return a}(Ab);var ec=function(){function c(a){var b=this;this.za=a;this.me=[];this.Wf=!1;this.oc="";this.enabled=!1;this.tg="#ff0000 #00ff00 #0000ff #ff00ff #805221 #2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.listener=function(a){b.za.ke(a.pageX,a.pageY)?b.move(b.oc,1,a.pageX,a.pageY):b.move(b.oc,0,a.pageX,a.pageY)};this.kw=function(a){for(var d=0;d<a.length;d++){var c=a[d];if(c.name.startsWith("pointer."))if(null===c.value||
"delete"===c.value)b.Mp(c.name.substr(8));else if(1===c.value.rel){var h=b.za.Aq(c.value.x,c.value.y);b.za.ke(h.x,h.y)?b.move(c.value.id,1,h.x,h.y):b.move(c.value.id,-1,h.x,h.y)}else b.move(c.value.id,0,c.value.x,c.value.y)}};a.oa("set-keys",this.kw);this.Vp="onpointerdown"in window?"pointermove":"mousemove";a.oa("destroy",function(){b.bs(!1,b.oc);for(var a=0,e=b.me;a<e.length;a++){var c=e[a];c.ba.parentNode&&c.ba.parentNode.removeChild(c.ba)}})}c.prototype.bs=function(a,b){this.oc=b;a&&!this.enabled?
document.addEventListener(this.Vp,this.listener,!0):!a&&this.enabled&&(document.removeEventListener(this.Vp,this.listener,!0),this.za.Sn("pointer."+this.oc,"delete",!1),this.Mp(this.oc));this.enabled=a};c.prototype.Mp=function(a){for(var b=0;b<this.me.length;b++)if(this.me[b].oc===a){a=this.me[b];a.ba.parentNode&&a.ba.parentNode.removeChild(a.ba);this.me.splice(b,1);break}};c.prototype.cv=function(){return this.tg[this.me.length%this.tg.length]};c.prototype.move=function(a,b,d,e){for(var c=this,h=
null,k=0,l=this.me;k<l.length;k++){var n=l[k];if(n.oc==a){h=n;break}}h?(h.bn=!0,h.rel=b,h.x=d,h.y=e):(h=this.cv(),k=document.createElement("div"),k.style.width="40px",k.style.height="40px",k.style.background="radial-gradient("+h+", transparent 50%)",k.style.position="absolute",k.style.pointerEvents="none",document.body.appendChild(k),h={oc:a,rel:b,x:d,y:e,bn:!0,ba:k},this.me.push(h));this.Wf||(this.Wf=!0,requestAnimationFrame(function(){c.Wf=!1;for(var a=0,b=c.me;a<b.length;a++){var d=b[a];if(d.bn){var e=
d.x-d.ba.offsetWidth/2,f=d.y-d.ba.offsetHeight/2;d.ba.style.display=-1===d.rel||e>document.documentElement.scrollWidth||f>document.documentElement.scrollHeight?"none":"block";d.ba.style.left=e+"px";d.ba.style.top=f+"px";d.bn=!1;d.oc===c.oc&&(e=0,c.za.ke(d.x,d.y)&&(d=c.za.wm(d.x,d.y),e=1),c.za.Sn("pointer."+c.oc,{rel:e,x:d.x,y:d.y,id:c.oc},!1))}}}))};return c}();function fc(c){return"string"===typeof c}function E(c){return"number"===typeof c}function gc(c){return"object"===typeof c};var hc=y.create("CONFIG"),ic=function(){var c;if(document.currentScript&&(c=document.currentScript.getAttribute("src")))return c;if(!document.getElementsByTagName)return"";c=document.getElementsByTagName("script");if(0===c.length)return"";c=c[c.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src")||""}(),jc={autoGroup:!1,adaptiveBrushWidth:!1,adaptiveLineWidth:!1,angleArcs:0,allowSelectBox:"auto",allowResize:!0,allowTextInShape:!0,allowPointerEvents:!0,allowSystemClipboard:!0,
allowZoom:!0,autoPickTool:!0,autoPickToolText:!0,autoSnap:0,background:"clear",backgroundImage:null,broadcastMouse:!1,collaborationServer:"wss://zwibbler.com/socket2",clickToDrawShapes:!1,debug:!1,defaultArrowStyle:"simple",defaultArrowSize:15,defaultArrowXOffset:null,defaultItalic:!1,defaultBold:!1,defaultBrushColour:"#000000",defaultBrushWidth:10,defaultFillStyle:"#e0e0e0",defaultFont:"Arial",defaultFontSize:20,defaultLineWidth:2,defaultPaperSize:"none",defaultRoundRectRadius:10,defaultSmoothness:"smooth",
defaultStrokeStyle:"#000000",defaultText:"Lorum ipsum dolor",defaultTextBackground:"rgba(0,0,0,0.0)",defaultTextAlign:"left",defaultTextDecoration:"none",defaultTextFillStyle:"#000000",defaultTextStrokeStyle:"#000000",defaultTextLineWidth:0,defaultZoom:1,drawShapeStyle:"box",fonts:["Arial","Times New Roman"],gridBlocks:10,gridColour:"#cccccc",gridSpacing:20,imageFolder:"$SCRIPT",iPadNoScrollText:!1,keyBringToFront:"Home",keyCancel:"ESC",keyCopy:"Ctrl+C,\u2318+C",keyCurveTool:"C",keyCut:"Ctrl+X,\u2318+X,Shift+Delete",
keyDelete:"Delete,Backspace",keyDown:"Down,Ctrl+Down",keyDuplicate:"Ctrl+D",keyEnter:"Enter",keyGroup:"Ctrl+G",keyLeft:"Left,Ctrl+Left",keyLineTool:"L",keyMoveDown:"PageDown",keyMoveUp:"PageUp",keyNext:"Down,Right",keyNextPage:"Shift+PageDown",keyPaste:"Ctrl+V,\u2318+V,Shift+Insert",keyPrevious:"Left,Up",keyPreviousPage:"Shift+Pageup",keyRedo:"Ctrl+Shift+Z",keyRight:"Right,Ctrl+Right",keySelectNone:"ESC",keySelectAll:"Ctrl+A",keySendToBack:"End",keyUndo:"Ctrl+Z",keyUngroup:"Ctrl+Shift+G",keyUp:"Up,Ctrl+Up",
keyZoomIn:"+,Shift+=",keyZoomNormal:"=",keyZoomOut:"-",keyZoomToPage:"F4",keyZoomToWidth:"Shift+F4",language:"en",latency:0,leaveTextToolOnBlur:!1,maximumZoom:0,magnet:!0,minimumZoom:0,multilineText:!1,nudge:10,outsidePageColour:"#808080",pageBorderColour:"rbga(0,0,0,0.0)",pageInflation:20,pagePlacement:"centre",pageSelectorDiv:"",pageShadow:!0,pageView:!1,pasteOffset:10,pasteOffsetX:0,pasteOffsetY:0,persistent:!1,pixelsPerUnit:1,preciseNudge:1,readOnly:!1,scrollbars:!0,setFocus:!0,showArrowTool:!0,
showBackgroundSelector:!1,showBrushTool:!0,showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFontNameProperty:!0,showFontSizeProperty:!0,showHints:!0,showImageSelector:!1,showImageTool:!1,showKeyboardHelp:!0,showLineTool:!0,showMathTool:!1,showMoveToFrontBack:!1,showPageSelector:!1,showPageSelectorControls:!0,showPickTool:!0,showPropertyPanel:!1,showRoundRectTool:!1,showRuler:!1,showShapeBrushTool:!1,showSloppinessProperty:!0,showSmoothnessProperty:!0,showSquareTool:!0,
showTextTool:!0,showToolbar:!0,showUndoRedo:!0,simulateGestures:!1,singleStrokeBrush:!1,sloppy:!1,snap:0,spotHighlightColour:"rgba(0,0,0,0.2)",spotHighlightZIndex:1,symmetry:0,textMode:"interactive",toolbarButtonSize:50,useTouch:"auto",units:"",colourPalette:"auto",colourPicker:"wheel",drawCircleStyle:"box",enableArrowKeysNudge:!1,showMenu:!1},kc={},lc;for(lc in jc)kc[lc.toLowerCase()]=lc;
var mc=function(c){function a(a,d){var b=c.call(this,a,jc,d)||this;b.dd="";""===b.dd&&b.set("imageFolder",b.options.imageFolder);"auto"===b.options.useTouch&&hc("Detected touch support: %s","ontouchstart"in window||"onmsgesturechange"in window);hc("Detect clipboard support: %s",b.Sm());return b}__extends(a,c);a.prototype.Zm=function(){var a=bc(),d;for(d in a)this.set(d,a[d])};a.Ls=function(a){return a.toLowerCase()in kc};a.prototype.aq=function(a,d){"debug"===a&&(a="showDebug");if("defaultZoom"===
a){if("page"!==d&&"width"!==d&&!E(d)&&(d=parseFloat(d),isNaN(d))){hc("Error: Config option %s must be a number or 'page' or 'width'",a);return}}else if("allowSelectBox"!==a)if("imageFolder"===a){var b=this.Qv();""===b?(this.dd=d.replace("$SCRIPT/",""),this.dd=this.dd.replace("$SCRIPT","")):this.dd=d.replace("$SCRIPT/","$SCRIPT").replace("$SCRIPT",b);""!==this.dd&&"/"!==this.dd[this.dd.length-1]&&(this.dd+="/");hc("scriptPath=%s imageFolder=%s, result:%s",b,this.options.imageFolder,this.dd)}else if("string"===
typeof d)if("number"===typeof this.options[a]){if(d=parseFloat(d),isNaN(d)){console.log(Error("Config option "+a+" expects a number"));return}}else if("boolean"===typeof this.options[a]||"useTouch"===a&&"auto"!==d)d="1"===d||"true"===d||""===d;return{name:a,value:d}};a.prototype.Qv=function(){var a=ic;var d=a.lastIndexOf("/");return a=0<=d?a.substr(0,d+1):""};a.prototype.Jz=function(){return this.options.showBrushTool};a.prototype.Mz=function(){return this.options.showPropertyPanel};a.prototype.Kz=
function(){return this.options.showColourPanel};a.prototype.Lz=function(){return this.options.showDebug};a.prototype.Nz=function(){return this.options.showToolbar};a.prototype.Xa=function(a){return this.get(a)};a.prototype.get=function(a){switch(a){case "useTouch":return this.gh();default:return c.prototype.get.call(this,a)}};a.prototype.gh=function(){return"auto"===this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in window:this.options.useTouch};a.prototype.Xu=function(){if("auto"===
this.options.allowSelectBox){var a=this.gh(),d=document.documentElement.offsetHeight,e=window.innerHeight,c=!a||a&&0<e-d+50;hc("Allowing select box: %s (useTouch=%s, documentHeight=%s, windowHeight=%s)",c,a,d,e);return c}return this.options.allowSelectBox};a.prototype.jv=function(){var a=(""+this.options.defaultSmoothness).toLowerCase();return"sharpest"===a?0:"sharper"===a?.1:"sharp"===a?.2:"smoothest"===a?.5:.3};a.prototype.Am=function(a){return 0===a.indexOf("http:")||0===a.indexOf("https:")||0===
a.indexOf("/")?a:this.dd+a};a.prototype.jc=function(a){return A.jc(this.get(a))};a.prototype.wt=function(a){function b(a){for(var b="",d=0;d<a.length;d++){var e=a.charAt(d);b=e===e.toUpperCase()?b+("-"+e.toLowerCase()):b+e}return b}var e=this,c={keyCut:1,keyCopy:1,keyPaste:1},h;for(h in this.options)this.options.hasOwnProperty(h)&&(0!==h.indexOf("key")||c[h]||a.map(this.options[h],b(h).substr(4)));this.oa("allowSystemClipboard",function(){var b=!e.Sm();b?hc("Not using system clipboard. Mapping cut/copy/paste keys"):
hc("Using system clipboard. Ignore keyCut/keyCopy/keyPaste.");a.map(e.options.keyCut,"cut",b);a.map(e.options.keyCopy,"copy",b);a.map(e.options.keyPaste,"paste",b)})};a.prototype.qq=function(){return"radial"===this.get("drawCircleStyle")||"radial"===this.get("drawShapeStyle")?"circle":"rectangle"};a.prototype.Di=function(a){var b=a;0<this.options.maximumZoom&&(a=Math.min(a,this.options.maximumZoom));0<this.options.minimumZoom&&(a=Math.max(a,this.options.minimumZoom));a!==b&&hc("Zoom restricted to %s",
a);return a};a.prototype.Sm=function(){var a=document;return this.get("allowSystemClipboard")&&void 0!==a.oncopy&&void 0!==a.oncut&&void 0!==a.onpaste};return a}(dc);var nc=function(){function c(){this.keys={}}c.prototype.contains=function(a){return a in this.keys};c.prototype.add=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.keys[a[b]]=!0;else this.keys[a]=!0};c.prototype.remove=function(a){delete this.keys[a]};c.prototype.Fj=function(a){var b,d;void 0===d&&(d="");if(!(a instanceof c))throw d||"Assertion failed";d=new c;for(b in this.keys)a.contains(b)||d.add(b);return d};c.prototype.Ob=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&
b.push(a);return b};c.prototype.yy=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(parseFloat(a));return b};c.prototype.clear=function(){this.keys={}};c.prototype.Jc=function(a){for(var b in this.keys)if(this.keys.hasOwnProperty(b)&&a(b))break};c.prototype.empty=function(){for(var a in this.keys)if(this.keys.hasOwnProperty(a))return!1;return!0};return c}();function oc(c){for(var a=[],b=0;b<c;b++)a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[Math.floor(63*Math.random())]);return a.join("")};var pc=y.create("MISC");function qc(c){var a=document.createElement("canvas");c&&c.appendChild(a);a.style.background="transparent";return a}function rc(c,a){var b=r.de(c);b.values[3]=a;return b.toString()}function sc(c){var a=A.hk(),b=A(c).Wb();b.left=Math.min(b.left,a.x+a.width-c.offsetWidth);b.top=Math.min(b.top,a.y+a.height-c.offsetHeight);A(c).$k(b)}
function tc(c){var a=c.getContext("2d");if(null===a)return"error";var b=a.getImageData(0,0,c.width,c.height);c=b.width;var d=b.height;a=c*d*3;var e=a+54,f=[66,77,e&255,e>>8&255,e>>16&255,e>>24&255,0,0,0,0,54,0,0,0],h=[40,0,0,0,c&255,c>>8&255,c>>16&255,c>>24&255,d&255,d>>8&255,d>>16&255,d>>24&255,1,0,24,0,0,0,0,0,a&255,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];a=(4-3*c%4)%4;b=b.data;e=c<<2;for(var k=nb.hf("Base64Encoder"),l=0;l<f.length;l++)k.lb(f[l]);for(l=0;l<h.length;l++)k.lb(h[l]);
do{f=e*(d-1);for(h=0;h<c;h++)l=h<<2,k.lb(b[f+l+2]),k.lb(b[f+l+1]),k.lb(b[f+l]);for(f=0;f<a;f++)k.lb(0)}while(--d);k.flush();return"data:image/bmp;base64,"+k.zg().toString()}
function uc(c,a){"erase"===a?c.hd?(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",--c.lineWidth,c.stroke(),c.globalCompositeOperation="source-over",c.strokeStyle=c.hd,c.lineWidth+=2,c.stroke(),--c.lineWidth):(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",c.stroke(),c.globalCompositeOperation="source-over"):(c.strokeStyle=a,c.stroke())}
function vc(){for(var c=0;c<arguments.length;c++);c=arguments[0];for(var a=1;a<arguments.length;a++){var b=arguments[a],d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d])}return c}function wc(c){return c instanceof HTMLElement?"INPUT"===c.tagName||"TEXTAREA"===c.tagName||c.isContentEditable?!0:!1:!1}function xc(c,a){"string"===typeof a&&"number"===typeof c&&(a=parseFloat(a));return a};y.create("Graphics",!0);
var F=function(){function c(a,b){this.x=a;this.y=b}c.prototype.Lb=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};c.prototype.toString=function(){return"("+this.x+", "+this.y+")"};c.prototype.Nc=function(a){return this.x===a.x&&this.y===a.y};c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.xy=function(a){return new c(this.x-a.x,this.y-a.y)};c.prototype.Op=function(a,b){var d=a.x,e=a.y,c=this.x,h=this.y,k=b.x-d,l=b.y-e,n=k*k+l*l;if(0===n)return this.Lb(a);
n=((c-d)*k+(h-e)*l)/n;1<n?n=1:0>n&&(n=0);d=d+n*k-c;e=e+n*l-h;return Math.sqrt(d*d+e*e)};return c}(),yc=function(){function c(a,b){this.width=a;this.height=b}c.prototype.ss=function(){return new I(0,0,this.width,this.height)};return c}();function zc(c,a,b,d){return Math.sqrt((c-b)*(c-b)+(a-d)*(a-d))}function Ac(c,a,b,d){var e=zc(c,a,b,d);return 0===e?{x:1,y:0}:{x:(b-c)/e,y:(d-a)/e}}function Bc(c){c.x*=-1;c.y*=-1;return c}
var I=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.Lr()}c.load=function(a){return new c(a.x,a.y,a.width,a.height)};c.kh=function(a){if(0===a.length)return new c(0,0,0,0);for(var b=a[0].x,d=a[0].x,e=a[0].y,f=a[0].y,h=1;h<a.length;h++)a[h].x<b&&(b=a[h].x),a[h].x>d&&(d=a[h].x),a[h].y<e&&(e=a[h].y),a[h].y>f&&(f=a[h].y);return new c(b,e,d-b,f-e)};c.prototype.save=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};c.prototype.clone=function(){return new c(this.x,
this.y,this.width,this.height)};c.prototype.Nc=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height};c.prototype.Ri=function(a){a.x<this.x&&(this.width+=this.x-a.x,this.x=a.x);a.y<this.y&&(this.height+=this.y-a.y,this.y=a.y);a.x+a.width>this.x+this.width&&(this.width+=a.x+a.width-this.x-this.width);a.y+a.height>this.y+this.height&&(this.height+=a.y+a.height-this.y-this.height)};c.prototype.uo=function(a,b){a<this.x?(this.width+=this.x-a,this.x=a):a>this.x+this.width&&
(this.width=a-this.x);b<this.y?(this.height+=this.y-b,this.y=b):b>this.y+this.height&&(this.height=b-this.y)};c.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>a.x+a.width&&this.y<=a.y&&this.y+this.height>a.y+a.height};c.prototype.Xw=function(a){return this.x>a.x+a.width||a.x>this.x+this.width||this.y>a.y+a.height||a.y>this.y+this.height?!1:!0};c.prototype.th=function(){return this.width*this.height};c.prototype.vr=function(a){return this.Xw(a)?(Math.min(this.right(),a.right())-
Math.max(this.x,a.x))*(Math.min(this.bottom(),a.bottom())-Math.max(this.y,a.y)):0};c.prototype.bd=function(a,b,d){void 0===d&&(d=0);return this.x-d<=a&&this.x+this.width+d>a&&this.y-d<=b&&this.y+this.height+d>b};c.prototype.Lr=function(){0>this.width&&(this.x+=this.width,this.width=-this.width);0>this.height&&(this.y+=this.height,this.height=-this.height)};c.prototype.Nd=function(a,b){void 0===b&&(b=a);this.x-=a/2;this.y-=b/2;this.width+=a;this.height+=b};c.prototype.transform=function(a){var b=a.apply(this.x,
this.y);var d=a.apply(this.x+this.width,this.y);var e=a.apply(this.x+this.width,this.y+this.height);a=a.apply(this.x,this.y+this.height);this.x=Math.min(b.x,d.x,e.x,a.x);this.y=Math.min(b.y,d.y,e.y,a.y);this.width=Math.max(b.x,d.x,e.x,a.x)-this.x;this.height=Math.max(b.y,d.y,e.y,a.y)-this.y};c.prototype.right=function(){return this.x+this.width};c.prototype.bottom=function(){return this.y+this.height};c.prototype.Ed=function(){return new F(this.x+this.width/2,this.y+this.height/2)};c.prototype.toString=
function(){return"Rectangle("+this.x+", "+this.y+", "+this.width+", "+this.height+")"};return c}(),J=function(){function c(){this.log=y.create("MATRIX");if(0===arguments.length)this.m11=1,this.m21=this.m12=0,this.m22=1,this.Ea=this.Da=0;else if(1===arguments.length)if("string"===typeof arguments[0]){var a=arguments[0].match(/-?\d+\.?[\de\-]*/g);if(!a||6!=a.length)throw Error("Bad initializer for matrix: "+arguments[0]);this.m11=parseFloat(a[0]);this.m21=parseFloat(a[1]);this.m12=parseFloat(a[2]);
this.m22=parseFloat(a[3]);this.Da=parseFloat(a[4]);this.Ea=parseFloat(a[5])}else{if(6!==arguments[0].length)throw"Bad array initializer for Matrix.";this.m11=arguments[0][0];this.m12=arguments[0][1];this.m21=arguments[0][2];this.m22=arguments[0][3];this.Da=arguments[0][4];this.Ea=arguments[0][5]}else this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.Da=arguments[4],this.Ea=arguments[5]}c.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+
this.Da+"    "+this.m21+" "+this.m22+" "+this.Ea+"    0 0 1 ]"};c.prototype.Ob=function(){return[this.m11,this.m12,this.m21,this.m22,this.Da,this.Ea]};c.prototype.Rq=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.Da&&0===this.Ea};c.prototype.Nc=function(a){return this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.Da===a.Da&&this.Ea===a.Ea};c.prototype.multiply=function(a){var b=new c;b.m11=this.m11*a.m11+this.m12*a.m21;b.m21=this.m21*a.m11+
this.m22*a.m21;b.m12=this.m11*a.m12+this.m12*a.m22;b.m22=this.m21*a.m12+this.m22*a.m22;b.Da=this.m11*a.Da+this.m12*a.Ea+this.Da;b.Ea=this.m21*a.Da+this.m22*a.Ea+this.Ea;return b};c.prototype.apply=function(a,b){return new F(this.m11*a+this.m12*b+this.Da,this.m21*a+this.m22*b+this.Ea)};c.prototype.dg=function(a){var b;void 0===b&&(b=!1);b?a.setTransform(this.m11,this.m21,this.m12,this.m22,this.Da,this.Ea):a.transform(this.m11,this.m21,this.m12,this.m22,this.Da,this.Ea)};c.prototype.clone=function(){return new c(this.m11,
this.m12,this.m21,this.m22,this.Da,this.Ea)};c.prototype.inverse=function(){var a=this.m11*this.m22-this.m12*this.m21;return new c(this.m22/a,-this.m12/a,-this.m21/a,this.m11/a,(this.m12*this.Ea-this.Da*this.m22)/a,(this.Da*this.m21-this.m11*this.Ea)/a)};c.prototype.xs=function(){var a=this.m11,b=this.m21,d=this.m12,e=this.m22,f=Math.sqrt(a*a+b*b),h=Math.sqrt(d*d+e*e);return new c(a/f,d/h,b/f,e/h,this.Da,this.Ea)};c.prototype.Yb=function(){return new F(Math.sqrt(this.m11*this.m11+this.m21*this.m21),
Math.sqrt(this.m12*this.m12+this.m22*this.m22))};c.prototype.iw=function(){return 1===this.m11&&1===this.m22&&0===this.m12&&0===this.m21};c.prototype.translate=function(a,b){return this.multiply(new Cc(a,b))};c.prototype.rotate=function(a,b,d){return this.multiply(new Dc(a,b,d))};c.prototype.eh=function(){return"matrix("+this.m11+", "+this.m21+", "+this.m12+", "+this.m22+", "+this.Da+", "+this.Ea+")"};c.prototype.toJSON=function(){return this.eh()};return c}(),Dc=function(c){function a(a,d,e){var b=
Math.cos(a);a=Math.sin(a);return c.call(this,b,a,-a,b,-d*b-e*a+d,d*a-e*b+e)||this}__extends(a,c);return a}(J),Cc=function(c){function a(a,d){return c.call(this,1,0,0,1,a,d)||this}__extends(a,c);return a}(J),Ec=function(c){function a(a,d,e,f){return void 0===e||void 0===f?c.call(this,a,0,0,d,0,0)||this:c.call(this,a,0,0,d,e-a*e,f-d*f)||this}__extends(a,c);return a}(J),Fc=function(c){function a(a,d,e){var b=Math.cos(2*a);a=Math.sin(2*a);return c.call(this,b,a,a,-b,-d*b-e*a+d,-d*a+e*b+e)||this}__extends(a,
c);return a}(J);function Gc(c,a,b,d,e,f,h,k,l,n){if(!(8<++Gc.depth)){var q=(a+d)/2,u=(b+e)/2,v=(d+f)/2,w=(e+h)/2,x=(f+k)/2,z=(h+l)/2,D=(q+v)/2,G=(u+w)/2;v=(v+x)/2;w=(w+z)/2;var H=(D+v)/2,C=(G+w)/2,K=k-a,T=l-b;d=Math.abs((d-k)*T-(e-l)*K);f=Math.abs((f-k)*T-(h-l)*K);(d+f)*(d+f)<n*(K*K+T*T)?c.push(new F(H,C)):(Gc(c,a,b,q,u,D,G,H,C,n),Gc(c,H,C,v,w,x,z,k,l,n))}--Gc.depth}(Gc||(Gc={})).depth=0;
function Hc(c,a,b,d,e,f,h,k){if(!(8<++Gc.depth)){var l=(a+d)/2,n=(b+e)/2,q=(d+f)/2,u=(e+h)/2,v=(l+q)/2,w=(n+u)/2,x=f-a,z=h-b;d=Math.abs((d-f)*z-(e-h)*x);d*d<=k*(x*x+z*z)?c.push(new F(v,w)):(Hc(c,a,b,l,n,v,w,k),Hc(c,v,w,q,u,f,h,k))}--Gc.depth}
function Ic(c,a,b){var d,e=!1,f=c.length;1<f&&c[f-1].x===c[0].x&&c[f-1].y===c[0].y&&--f;if(3>f)return!1;var h=c[f-1].x;var k=c[f-1].y;for(d=0;d<f;d++){var l=c[d].x;var n=c[d].y;if(l>h){var q=h;var u=l;var v=k;k=n}else q=l,u=h,v=n;l<a===a<=h&&(b-v)*(u-q)<(k-v)*(a-q)&&(e=!e);h=l;k=n}return e}function Jc(c,a,b,d){d*=d;for(var e=1;e<c.length;e++){var f=c[e-1].x,h=c[e-1].y,k=c[e].x-f,l=c[e].y-h,n=((a-f)*k+(b-h)*l)/(k*k+l*l);1<n?n=1:0>n&&(n=0);f=f+n*k-a;h=h+n*l-b;if(f*f+h*h<=d)return!0}return!1}
(function(){function c(a){this.image=a}c.prototype.clear=function(){for(var a=0;a<this.image.width*this.image.height*4;a++)this.image.data[a]=0};c.prototype.getImageData=function(){return this.image};c.prototype.width=function(){return this.image.width};c.prototype.height=function(){return this.image.height};c.prototype.get=function(a,b){var d=this.image.width*b*4+4*a;return this.image.data[d]|this.image.data[d+1]<<8|this.image.data[d+2]<<16|this.image.data[d+3]<<24};c.prototype.set=function(a,b,
d){a=this.image.width*b*4+4*a;this.image.data[a]=d&255;this.image.data[a+1]=d>>8&255;this.image.data[a+2]=d>>16&255;this.image.data[a+3]=d>>24&255};return c})();
(function(){function c(a,b){this.data=[];this.mg=a;this.$i=b;this.data=[]}c.prototype.width=function(){return this.mg};c.prototype.height=function(){return this.$i};c.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.mg;a.height=this.$i;a=a.getContext("2d").getImageData(0,0,this.mg,this.$i);for(var b=this.mg*this.$i,d=0;d<b;d++){var e=!0===this.data[d]?255:0;a.data[4*d]=e;a.data[4*d+1]=e;a.data[4*d+2]=e;a.data[4*d+3]=255}return a};c.prototype.get=function(a,b){return!0===
this.data[this.mg*b+a]};c.prototype.set=function(a,b,d){this.data[this.mg*b+a]=d};return c})();
var L=function(){function c(a){this.closed=!1;this.fa=[];a instanceof I&&(this.moveTo(a.x,a.y),this.lineTo(a.x+a.width,a.y),this.lineTo(a.x+a.width,a.y+a.height),this.lineTo(a.x,a.y+a.height),this.lineTo(a.x,a.y),this.closePath())}c.prototype.clear=function(){this.closed=!1;this.fa=[]};c.prototype.beginPath=function(){};c.prototype.rect=function(){};c.prototype.moveTo=function(a,b){this.fa.push(c.Fc,a,b)};c.prototype.lineTo=function(a,b){this.fa.push(c.Ec,a,b)};c.prototype.bezierCurveTo=function(a,
b,d,e,f,h){this.fa.push(c.De,a,b,d,e,f,h)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.fa.push(c.Fe,a,b,d,e)};c.prototype.arc=function(){};c.prototype.arcTo=function(){};c.prototype.closePath=function(){this.fa.push(c.Dc)};c.prototype.ia=function(a){for(var b=0;b<this.fa.length;){switch(this.fa[b]){case c.Fc:a.moveTo&&a.moveTo(this.fa[b+1],this.fa[b+2]);break;case c.Ec:a.lineTo&&a.lineTo(this.fa[b+1],this.fa[b+2]);break;case c.De:a.bezierCurveTo&&a.bezierCurveTo(this.fa[b+1],this.fa[b+2],
this.fa[b+3],this.fa[b+4],this.fa[b+5],this.fa[b+6]);break;case c.Fe:a.quadraticCurveTo&&a.quadraticCurveTo(this.fa[b+1],this.fa[b+2],this.fa[b+3],this.fa[b+4]);break;case c.Dc:a.closePath&&a.closePath();break;default:alert("Error!")}b+=c.Gc[this.fa[b]]}};c.prototype.xx=function(){for(var a=0,b=0,d=0,e=[];a<this.fa.length;){switch(this.fa[a]){case c.Dc:e.push([c.Dc]);break;case c.Fc:b=this.fa[a+1];d=this.fa[a+2];break;case c.Ec:e.push([c.Ec,b,d]);b=this.fa[a+1];d=this.fa[a+2];break;case c.De:e.push([c.De,
this.fa[a+3],this.fa[a+4],this.fa[a+1],this.fa[a+2],b,d]);b=this.fa[a+5];d=this.fa[a+6];break;case c.Fe:e.push([c.Fe,this.fa[a+1],this.fa[a+2],b,d]),b=this.fa[a+3],d=this.fa[a+4]}a+=c.Gc[this.fa[a]]}this.fa.length&&e.push([c.Fc,b,d]);a=new c;for(b=e.length-1;0<=b;b--)Array.prototype.push.apply(a.fa,e[b]);a.closed=this.closed;return a};c.prototype.ff=function(){for(var a=0,b,d=[];a<this.fa.length;){var e=c.Mo[this.fa[a]];for(b=0;b<e;b++)d.push(new F(this.fa[a+1+2*b],this.fa[a+1+2*b+1]));a+=c.Gc[this.fa[a]]}return d};
c.prototype.transform=function(a){for(var b=0,d,e;b<this.fa.length;){e=c.Mo[this.fa[b]];for(d=0;d<e;d++){var f=a.apply(this.fa[b+1+2*d],this.fa[b+1+2*d+1]);this.fa[b+1+2*d]=f.x;this.fa[b+1+2*d+1]=f.y}b+=c.Gc[this.fa[b]]}};c.prototype.clone=function(){var a=new c;a.fa=this.fa.concat();return a};c.prototype.yp=function(a){for(var b=0,d,e=d=0,f=new I(this.fa[1],this.fa[2],0,0),h;b<this.fa.length;){switch(this.fa[b]){case c.Fc:case c.Ec:d=this.fa[b+1];e=this.fa[b+2];f.uo(d,e);break;case c.De:var k=h=
[],l=this.fa[b+5],n=this.fa[b+6];Gc(k,d,e,this.fa[b+1],this.fa[b+2],this.fa[b+3],this.fa[b+4],l,n,a*a);k.push(new F(l,n));for(d=0;d<h.length;d++)f.uo(h[d].x,h[d].y);d=this.fa[b+5];e=this.fa[b+6];break;case c.Fe:k=h=[];l=this.fa[b+3];n=this.fa[b+4];Hc(k,d,e,this.fa[b+1],this.fa[b+2],l,n,a*a);k.push(new F(l,n));for(d=0;d<h.length;d++)f.uo(h[d].x,h[d].y);d=this.fa[b+3];e=this.fa[b+4]}b+=c.Gc[this.fa[b]]}return f};c.prototype.append=function(a){this.fa=this.fa.concat(a.fa)};c.prototype.ko=function(a){for(var b=
0,d=0,e=0,f=new c,h;b<this.fa.length;){switch(this.fa[b]){case c.Fc:d=this.fa[b+1];e=this.fa[b+2];f.moveTo(d,e);break;case c.Ec:d=this.fa[b+1];e=this.fa[b+2];f.lineTo(d,e);break;case c.De:var k=h=[],l=this.fa[b+5],n=this.fa[b+6];Gc(k,d,e,this.fa[b+1],this.fa[b+2],this.fa[b+3],this.fa[b+4],l,n,a*a);k.push(new F(l,n));2===h.length&&1E-4>d*(h[0].y-h[1].y)+h[0].x*(h[1].y-e)+h[1].x*(e-h[0].y)&&(h[0]=h[1],h.length=1);for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.fa[b+5];e=this.fa[b+6];break;case c.Fe:k=
h=[];l=this.fa[b+3];n=this.fa[b+4];Hc(k,d,e,this.fa[b+1],this.fa[b+2],l,n,a*a);k.push(new F(l,n));for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.fa[b+3];e=this.fa[b+4];break;case c.Dc:f.closePath()}b+=c.Gc[this.fa[b]]}return f};c.prototype.ix=function(a,b){var d;void 0===d&&(d=0);return Ic(this.ff(),a,b)||0<d&&this.Br(a,b,d)};c.prototype.Br=function(a,b,d){var e=0,f=0,h=0;for(d*=d;h<this.fa.length;){switch(this.fa[h]){case c.Fc:e=this.fa[h+1];f=this.fa[h+2];break;case c.Ec:var k=this.fa[h+
1];var l=this.fa[h+2];var n=k-e;var q=l-f;var u=n*n+q*q;u=((a-e)*n+(b-f)*q)/u;1<u?u=1:0>u&&(u=0);e+=u*n;q=f+u*q;f=e-a;q-=b;f=f*f+q*q;if(f<=d)return!0;e=k;f=l}h+=c.Gc[this.fa[h]]}return!1};c.prototype.Ij=function(a,b){for(var d=0,e=0,f=b[0],h,k=new F(0,0),l;d<this.fa.length;){switch(this.fa[d]){case c.Fc:l=this.fa[d+1];h=this.fa[d+2];a.moveTo(l,h);k=new F(l,h);break;case c.Ec:l=this.fa[d+1];var n=h=this.fa[d+2],q=new F(l,n);h=k.Lb(q);if(!(0>=h)){for(;h>f;)k.x+=(q.x-k.x)*f/h,k.y+=(q.y-k.y)*f/h,e&1?
a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),h-=f,e=(e+1)%b.length,f=b[e];h<=f&&(k=new F(l,n),e&1?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),f-=h)}}d+=c.Gc[this.fa[d]]}};c.prototype.th=function(){function a(a,b){f-=(a-d)*(b+e);d=a;e=b}for(var b=0,d,e,f=0;b<this.fa.length;){switch(this.fa[b]){case c.Fc:d=this.fa[b+1];e=this.fa[b+2];break;case c.Ec:a(this.fa[b+1],this.fa[b+2]);break;case c.De:a(this.fa[b+5],this.fa[b+6]);break;case c.Fe:a(this.fa[b+3],this.fa[b+4])}b+=c.Gc[this.fa[b]]}return f/2};c.prototype.Sp=function(a){for(var b=
0,d=0,e=0,f=!1;b<this.fa.length;){switch(this.fa[b]){case c.Fc:d=this.fa[b+1];e=this.fa[b+2];f=!0;break;case c.Ec:a(d,e,this.fa[b+1],this.fa[b+2],f),d=this.fa[b+1],e=this.fa[b+2],f=!1}b+=c.Gc[this.fa[b]]}};c.prototype.Kt=function(){var a=0;this.Sp(function(b,d,e,c){a+=zc(b,d,e,c)});return a};c.prototype.Mt=function(a){var b=new c,d=0;this.Sp(function(e,c,h,k,l){if(d<=a){l&&b.moveTo(e,c);l=zc(e,c,h,k);if(d+l>=a){var f=a-d;h=e+(h-e)*f/l;k=c+(k-c)*f/l}d+=l;b.lineTo(h,k)}});return b};c.Fc=0;c.Ec=1;c.De=
2;c.Fe=3;c.Dc=4;c.Gc=[3,3,7,5,1];c.Mo=[1,1,3,2,0];return c}();function Kc(c,a,b,d,e){var f;if(2>=d-b)e.push(c[b]);else{var h=c[b],k=c[d-1],l=0,n=0;for(f=b+1;f<d;f++){var q=c[f].Op(h,k);q>l&&(l=q,n=f)}0<n&&l>a?(Kc(c,a,b,n,e),Kc(c,a,n,d,e)):e.push(h)}}function Lc(c,a){var b=[];Kc(c,a,0,c.length,b);0<c.length&&0<b.length&&!c[c.length-1].Nc(b[b.length-1])&&b.push(c[c.length-1]);return b}
var Mc=function(){function c(){this.la=[];if(1===arguments.length){var a=arguments[0];if(a instanceof I)this.la.push(new F(a.x,a.y)),this.la.push(new F(a.right(),a.y)),this.la.push(new F(a.right(),a.bottom())),this.la.push(new F(a.x,a.bottom()));else if(a instanceof Array)this.la=a;else throw alert("Bad parameter passed to Polygon() constructor."),"Error";}}c.prototype.dw=function(a){var b=this.ff();a=a.ff();for(var d=0;d<b.length;d++){var e=b[d];if(!Ic(a,e.x,e.y))return!1}return!0};c.prototype.transform=
function(a){for(var b=0;b<this.la.length;b++)this.la[b]=a.apply(this.la[b].x,this.la[b].y)};c.prototype.add=function(a,b){this.la.push(new F(a,b))};c.prototype.bd=function(a,b,d){void 0===d&&(d=0);return Ic(this.la,a,b)||d&&Jc(this.la,a,b,d)};c.prototype.Ht=function(){return I.kh(this.la)};c.prototype.clone=function(){return new c(this.la.slice(0))};c.prototype.Nc=function(a){if(this.la.length!==a.la.length)return!1;for(var b=0;b<this.la.length;b++){var d=this.la[b],e=a.la[b];if(d.x!==e.x||d.y!==
e.y)return!1}return!0};c.prototype.Nd=function(a){for(var b=[],d=0;d<this.la.length;d++){var e=this.la[0===d?this.la.length-1:d-1],c=this.la[d],h=this.la[d===this.la.length-1?0:d+1],k=zc(e.x,e.y,c.x,c.y),l=zc(h.x,h.y,c.x,c.y);b.push({x:c.x+((c.x-e.x)/k+(c.x-h.x)/l)/Math.sqrt(2)*a,y:c.y+((c.y-e.y)/k+(c.y-h.y)/l)/Math.sqrt(2)*a})}this.la=b};c.prototype.ia=function(a){if(!(1>this.la.length)){a.moveTo(this.la[0].x,this.la[0].y);for(var b=1;b<this.la.length;b++)a.lineTo(this.la[b].x,this.la[b].y);a.closePath()}};
c.prototype.ff=function(){return this.la};c.nz=function(a,b){for(var d=0,e=0,c=!1,h=[],k=[],l=0;l<b.length;l++)k.push(0);for(;;){var n=0,q=-1;for(l=0;l<b.length;l++)if(k[l]<b[l].length){var u=b[l][k[l]];if(0===l||u<n){n=u;q=l;var v=1-k[l]%2}}if(-1===q)return h;k[q]+=1;"intersection"===a?v?(e+=1,e===b.length&&(d=n)):(e===b.length&&(h.push(d),h.push(n)),--e):v?(e+=1,0===q?(c=!0,1===e)&&(d=n):c&&2===e&&(h.push(d),h.push(n))):(c&&1===e&&(h.push(d),h.push(n)),--e,0===q&&(c=!1),c&&1===e&&(d=n))}};return c}();
function Nc(c,a,b,d,e,f,h,k){b-=c;d-=a;h-=e;k-=f;var l=-h*d+b*k;if(0===l)return null;e=(h*(a-f)-k*(c-e))/l;return new F(c+e*b,a+e*d)}
function Oc(c,a){function b(a){var b,e;var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];a[b+1]&&(c[b]=d(n,a[b+1]));b+=1}return c}function d(a,b){return new F(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2)}return a?Oc(b(b(function(a){var b,e;a=[a[0]].concat(a).concat(a[a.length-1]);var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];c[2*b]=n;a[b+1]&&(c[2*b+1]=d(n,a[b+1]));b+=1}return c}(c))),a-1):c}
function Pc(c,a){var b=0,d=0,e=0,f=0;Qc(a,function(a,k){switch(a){case "M":for(var h=0;h<k.length;h+=2)b=k[h],d=k[h+1],0==h?c.moveTo(b,d):c.lineTo(b,d);break;case "m":for(h=0;h<k.length;h+=2)b+=k[h],d+=k[h+1],0==h?c.moveTo(b,d):c.lineTo(b,d);break;case "L":for(h=0;h<k.length;h+=2)b=k[h],d=k[h+1],c.lineTo(k[h],k[h+1]);break;case "l":for(h=0;h<k.length;h+=2)b+=k[h],d+=k[h+1],c.lineTo(b,d);break;case "H":for(h=0;h<k.length;h++)b=k[h],c.lineTo(b,d);break;case "h":for(h=0;h<k.length;h++)b+=k[h],c.lineTo(b,
d);break;case "V":for(h=0;h<k.length;h++)d=k[h],c.lineTo(b,d);break;case "v":for(h=0;h<k.length;h++)d+=k[h],c.lineTo(b,d);break;case "Q":for(h=0;h<k.length;h+=4)e=k[h],f=k[h+1],b=k[h+2],d=k[h+3],c.quadraticCurveTo(e,f,b,d);break;case "C":for(h=0;h<k.length;h+=6)e=k[h+2],f=k[h+3],b=k[h+4],d=k[h+5],c.bezierCurveTo(k[h],k[h+1],e,f,b,d);break;case "c":for(h=0;h<k.length;h+=6){var n=k[h]+b,q=k[h+1]+d;e=k[h+2]+b;f=k[h+3]+d;b=k[h+4]+b;d=k[h+5]+d;c.bezierCurveTo(n,q,e,f,b,d)}break;case "S":for(h=0;h<k.length;h+=
4)n=b+b-e,q=d+d-f,c.bezierCurveTo(n,q,k[h],k[h+1],k[h+2],k[h+3]),e=k[h],f=k[h+1],b=k[h+2],d=k[h+3];break;case "s":for(h=0;h<k.length;h+=4)n=b+b-e,q=d+d-f,c.bezierCurveTo(n,q,k[h]+b,k[h+1]+d,k[h+2]+b,k[h+3]+d),e=k[h]+b,f=k[h+1]+d,b=k[h+2]+b,d=k[h+3]+d;break;case "A":case "a":for(h=0;h<k.length;h+=7){var u=k[h+1];n=k[h+2]/Math.PI;var v=1===k[h+3];var w=1===k[h+4];q=k[h+5];var x=k[h+6];"a"==a&&(q+=b,x+=d);var z=Math.abs(u);var D=(b-q)/2;var G=(d-x)/2;var H=Math.cos(n)*D+Math.sin(n)*G;D=-Math.sin(n)*
D+Math.cos(n)*G;G=z*z;var C=u*u,K=H*H,T=D*D,X=K/G+T/C;1<X&&(G=Math.sqrt(X),z*=G,u*=G,G=z*z,C=u*u);K=G*T+C*K;G=Math.sqrt(Math.max(0,(G*C-K)/K));v==w&&(G=-G);C=G*z*D/u;T=-G*u*H/z;K=Math.cos(n)*C-Math.sin(n)*T+(b+q)/2;G=Math.sin(n)*C+Math.cos(n)*T+(d+x)/2;v=Rc(1,0,(H-C)/z,(D-T)/u);D=Rc((H-C)/z,(D-T)/u,(-H-C)/z,(-D-T)/u);w||(D-=2*Math.PI);D%=2*Math.PI;w=K;H=G;c.translate(w,H);c.scale(z,u);c.rotate(n);c.arc(0,0,1,v,v+D,0>D);c.rotate(-n);c.scale(1/z,1/u);c.translate(-w,-H);b=q;d=x}break;case "Z":case "z":c.closePath();
break;default:throw Error("Unknown draw command: "+a);}switch(a){case "C":case "c":case "S":case "s":break;default:e=b,f=d}})}
function Qc(c,a){function b(){if(0<=h){var a=parseFloat(c.substr(h,h+f));if(isNaN(a))throw Error("Error parsing number: "+c.substr(h,h+f)+" in "+c);e.push(a);h=-1;k=!1}}for(var d="",e=[],f=0,h=-1,k=!1;f<c.length;f++){var l=c[f];"A"<=l&&"Z">=l||"a"<=l&&"z">=l?(b(),""!=d&&(a(d,e),e=[],d=""),d=l):0<h&&"-"==l||k&&"."==l?(b(),h=f):"0"<=l&&"9">=l||"-"==l||"+"==l||"E"==l||"e"==l||"."==l?(-1==h&&(h=f),"."==l&&(k=!0)):b()}b();""!=d&&a(d,e)}
function Rc(c,a,b,d){var e=(c*b+a*d)/(zc(0,0,c,a)*zc(0,0,b,d));e=Math.acos(-1>e?-1:1<e?1:e);0>c*d-a*b&&(e=-e);return e}
(function(){function c(){this.items=[];this.ta=new J}c.prototype.toString=function(){return this.items.join(" ")};c.prototype.arc=function(){throw Error("SvgPathContext.arc is not implemented.");};c.prototype.arcTo=function(){throw Error("SvgPathContext.arcTo is not implemented.");};c.prototype.moveTo=function(a,b){var d=this.ta.apply(a,b);this.items.push("M",d.x,d.y)};c.prototype.lineTo=function(a,b){var d=this.ta.apply(a,b);this.items.push("L",d.x,d.y)};c.prototype.transform=function(a,b,d,e,c,
h){a=new J(a,d,b,e,c,h);this.ta=this.ta.multiply(a)};c.prototype.rect=function(){};c.prototype.bezierCurveTo=function(a,b,d,e,c,h){a=this.ta.apply(a,b);d=this.ta.apply(d,e);c=this.ta.apply(c,h);this.items.push("C",a.x,a.y,d.x,d.y,c.x,c.y)};c.prototype.quadraticCurveTo=function(){throw Error("SvgPathContext.quadraticCurveTo is not implemented.");};c.prototype.beginPath=function(){};c.prototype.closePath=function(){this.items.push("Z")};return c})();
function Sc(c,a,b,d,e){if(!(2>a.length)){void 0===d&&(d=!0);void 0===e&&(e=!0);var f=a[0].x===a[a.length-1].x&&a[0].y===a[a.length-1].y,h=[],k=[],l=new F(0,0),n=l,q=l,u=l,v=l,w=[];b/=2;var x;for(x=1;x<a.length;x++){q=a[x-1];v=a[x];u=Ac(q.x,q.y,v.x,v.y);l=new F(u.y,-u.x);n=new F(q.x-u.x*b-l.x*b,q.y-u.y*b-l.y*b);q=new F(q.x-u.x*b+l.x*b,q.y-u.y*b+l.y*b);if(k.length){var z=k[k.length-1];var D=w[w.length-1];n=Nc(z.x,z.y,z.x+D.x,z.y+D.y,n.x,n.y,n.x+u.x,n.y+u.y)||n;z=h[h.length-1];q=Nc(z.x,z.y,z.x+D.x,z.y+
D.y,q.x,q.y,q.x+u.x,q.y+u.y)||q}k.push(n);h.push(q);w.push(u)}f?(z=k[0],D=w[0],n=Nc(z.x,z.y,z.x+D.x,z.y+D.y,n.x,n.y,n.x+u.x,n.y+u.y)||n,z=h[0],q=Nc(z.x,z.y,z.x+D.x,z.y+D.y,q.x,q.y,q.x+u.x,q.y+u.y)||q,k[0].x=n.x,k[0].y=n.y,h[0].x=q.x,h[0].y=q.y,k.push(n),h.push(q)):(k.push(new F(v.x+u.x*b-l.x*b,v.y+u.y*b-l.y*b)),h.push(new F(v.x+u.x*b+l.x*b,v.y+u.y*b+l.y*b)));if(e){c.moveTo(k[0].x,k[0].y);for(x=1;x<k.length;x++)c.lineTo(k[x].x,k[x].y);f&&(c.closePath(),c.moveTo(h[h.length-1].x,h[h.length-1].y))}else d&&
c.moveTo(h[h.length-1].x,h[h.length-1].y);if(d){for(x=h.length-1;0<=x;x--)c.lineTo(h[x].x,h[x].y);!f&&e&&c.lineTo(k[0].x,k[0].y)}}}
(function(){function c(a){this.la=a;this.n=0;this.sb=new F(0,0)}c.prototype.next=function(a){if(0===this.la.length)return null;if(0===this.n)return this.sb=this.la[0].clone(),this.n+=1,this.sb.clone();for(;this.n<this.la.length;){var b=this.sb.Lb(this.la[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.sb.x+=(this.la[this.n].x-this.sb.x)*a/b,this.sb.y+=(this.la[this.n].y-this.sb.y)*a/b,this.sb.clone()}return null};return c})();
var Tc=function(){function c(){this.path=[]}c.prototype.nf=function(a,b){0<this.path.length&&a===this.path[this.path.length-1].x&&b===this.path[this.path.length-1].y||this.path.push(new F(a,b))};c.prototype.Im=function(){return this.path};return c}();function Uc(c,a){c.length>a&&(c=c.slice(c.length-a));return c}
var Vc=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.Ki=[];a.order=3;a.eo=3;a.Vr=Math.pow(2,a.order);a.sampleSize=a.eo+1;return a}__extends(a,c);a.prototype.Im=function(){return this.Ki};a.prototype.nf=function(a,d){c.prototype.nf.call(this,a,d);if(this.path.length<this.sampleSize)this.Ki=Oc(this.path,this.order);else{var b=Uc(Oc(Uc(this.path,this.sampleSize),this.order),this.Vr*this.eo);this.Ki=this.Ki.slice(0,this.Ki.length-this.Vr*(this.eo-1)).concat(b)}};return a}(Tc);var Wc=function(c){function a(){var a=c.call(this)||this;a.Sg=[];a.pg=!1;a.canvas=null;a.ga=null;a.log=y.create("FORMAT",!0);return a}__extends(a,c);a.prototype.add=function(a,d,e,c,h){var b;var f=this.Sg;var n=0;for(b=f.length;n<b;n++){var q=f[n];q.type===d&&q.gn===a&&q.url===e&&(q.Vn=!0)}this.log("Request URL %s",e.substr(0,64));this.Sg.push({gn:a,type:d,url:e,wr:c||{},Lt:h,Vn:!1});this.check()};a.prototype.check=function(){for(var a=0;!this.pg&&a<this.Sg.length;)this.Sg[a].Vn?this.Sg.shift():(this.Zs(this.Sg[0]),
a+=1);this.pg||this.na("done")};a.prototype.Zs=function(a){var b=this;b.pg=!0;b.log("Processing request for item %s url=%s",a.gn,a.url.substr(0,64));0===a.type.indexOf("image")&&tb.load(a.url,function(d,c){null!==d?(b.log("Image request completed for item %s url %s",a.gn,c.substr(0,64)),a.Lt(d,c)):b.log("Image request failed for url %s",c);b.pg=!1;a.Vn=!0;b.check()})};a.prototype.bu=function(a,d){this.na("convert-dom-request",a,d)};a.prototype.Tg=function(a){this.na("reformat",a)};a.prototype.Te=
function(){if(null===this.canvas)return new I(0,0,0,0);var a=A(this.canvas).Wb();return new I(a.left,a.top,this.canvas.width,this.canvas.height)};a.prototype.ee=function(a){return this.ga?this.ga.get(a):null};return a}(Ab);function Xc(c){return 0!=(c.Db&1)}function Yc(c){return 0!=(c.Db&4)}function Zc(c){return 5===(c.Db&5)&&c.ba};var $c=y.create("WrappedNode");
function ad(c,a){var b={};b.ctx=c.ctx;b.id=a.id;var d=a.type();"CustomNode"===a.type()&&(d=a.ka("nodeType"));b.type=d;b.children=new Proxy({},{get:function(b,d){var e=a.rb(d);return e instanceof bd?e.bk(c):e}});b.props=cd(a.da,"",function(b,d){a.Qw(b,d)});Object.defineProperty(b,"parent",{configurable:!0,get:function(){return a.parent?a.parent.bk(c):null},set:function(b){$c("Warning; replacing parent property");a.parent=b}});Yc(a)&&Object.defineProperty(b,"element",{configurable:!0,get:function(){return a.ba}});
return b}
function cd(c,a,b){function d(d){if("string"===typeof d)for(var e in c)if(e.startsWith(""+a+d+"."))return cd(c,""+a+d+".",b);return null}void 0===a&&(a="");return new Proxy(c,{get:function(b,f){if("hasOwnProperty"===f)return function(b){return a+b in c};if("string"===typeof f){var e=d(f);return e?e:c[a+f]}return c[f]},has:function(b,f){if("string"===typeof f){var e=d(f);return e?e:a+f in c}return b.hasOwnProperty(f)},set:function(d,f,h){"string"===typeof f?(c[a+f]=h,b(a+f,h)):c[f]=h;return!0}})};var dd=y.create("BaseNode"),bd=function(){function c(a,b){this.id=a;this.aa=b;this.Db=0;this.parent=null;this.da={};this.scope=null}c.prototype.type=function(){return"BaseNode"};c.prototype.toString=function(){return this.type()+":"+this.id};c.prototype.Qw=function(a,b){this.aa.xc([this.id],a,b)};c.prototype.bk=function(a){this.scope||(this.scope=ad(a,this));return this.scope};c.kd=function(a,b){c.types[a]=b};c.create=function(a,b,d){return a in c.types?new c.types[a](b,d):null};c.prototype.Ua=function(){};
c.prototype.Oj=function(a,b){b=xc(this.da[a],b);b instanceof Array&&(b=b.slice(0));return b};c.prototype.Pc=function(){var a={},b;for(b in this.da)this.da.hasOwnProperty(b)&&(a[b]=this.ka(b));return a};c.prototype.yd=function(a){for(var b in a)a.hasOwnProperty(b)&&this.setProperty(b,a[b])};c.prototype.Wh=function(a){return a in this.da};c.prototype.ng=function(a){return this.Wh(a)};c.prototype.setProperty=function(a,b){b=this.Oj(a,b);this.ng(a)&&(dd("%s:%s set %s=%s",this.id,this.type(),a,b),this.da[a]=
b);return b};c.prototype.ka=function(a){a=this.da[a];a instanceof Array&&(a=a.slice(0));return a};c.prototype.Na=function(){return 0};c.prototype.removeChild=function(){throw Error("BaseNode removechild called.");};c.prototype.uk=function(){throw Error("BaseNode insertChild called.");};c.prototype.rb=function(){throw Error("BaseNode getChild called.");};c.prototype.co=function(){throw Error("BaseNode swapChildren called.");};c.prototype.Ue=function(a){for(var b=0;b<this.Na();b++)if(a===this.rb(b))return b;
return-1};c.types={};return c}();var ed=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.rect=new I(0,0,1,1);e.aj=!1;e.Ja=new I(0,0,1,1);e.bc=0;e.log=y.create("GraphicsNode");e.Db|=1;e.da.matrix=new J;e.da.layer="default";e.Nl(a.sa);return e}__extends(a,c);a.prototype.Nl=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.da[b]=a[b])};a.prototype.clip=function(){};a.prototype.Ua=function(){};a.prototype.We=function(){return!1};a.prototype.nk=function(){return null};a.prototype.Jj=function(){};a.prototype.Pq=function(){return!1};
a.prototype.Xh=function(){return"text"in this.da};a.prototype.Vb=function(){var a=this.ka("layer");return a?""+a:"default"};a.prototype.Tm=function(){return null!==this.parent&&null!==this.parent.parent&&"PageNode"!==this.parent.type()};a.prototype.type=function(){return"BaseNode"};a.prototype.La=function(){return this.ka("matrix")};a.prototype.fe=function(){return this.La().inverse()};a.prototype.Zg=function(a){this.setProperty("matrix",a)};a.prototype.Oj=function(a,d){d=c.prototype.Oj.call(this,
a,d);"matrix"===a&&"string"===typeof d?d=new J(d):"opacity"===a&&(d=parseFloat(d));return d};a.prototype.ng=function(a){switch(a){case "customData":case "tag":case "locked":case "lockSize":case "lockRotation":case "lockPosition":case "lockEditMode":case "rotationHandles":case "lockAspectRatio":case "zIndex":case "snap":case "opacity":case "type":case "$type":return!0}return"_"===a[0]||this.Wh(a)};a.prototype.Qj=function(){var a=new Mc(this.Ja);a.transform(this.La());return a};a.prototype.Md=function(){return this.ka("zIndex")||
0};a.prototype.transform=function(a){this.Zg(a.multiply(this.La()))};a.prototype.format=function(){};a.prototype.xb=function(a,d){var b=this.fe().apply(a,d);return this.hidden()||this.ka("locked")||!this.Ja.bd(b.x,b.y)?null:this};a.prototype.bf=function(a){this.aj=a};a.prototype.hidden=function(){return this.aj};a.prototype.$g=function(){};a.prototype.Gk=function(){};a.prototype.Jk=function(){};a.prototype.zi=function(a){if(a.zi){var b={"zwibbler:id":""+this.id};if("tag"in this.da){var e=this.da.tag;
"string"!==typeof e&&(e=JSON.stringify(e));b["zwibbler:tag"]=e}a.zi(b)}};a.prototype.yi=function(a){a.yi&&a.yi()};a.prototype.ia=function(b){b.save();this.zi(b);var d=this.da.matrix;b.transform(d.m11,d.m21,d.m12,d.m22,d.Da,d.Ea);"erase"===this.da.strokeStyle?b.hd?b.strokeStyle=b.hd:(b.strokeStyle="#000000",b.globalCompositeOperation="destination-out"):b.strokeStyle=this.da.strokeStyle;b.fillStyle=this.da.fillStyle;b.lineWidth=this.da.lineWidth;this.da.shadow&&(b.shadowOffsetX=3,b.shadowOffsetY=3,
b.shadowBlur=5,b.shadowColor="rgba(0,0,0,0.5)");"opacity"in this.da&&(b.globalAlpha=this.da.opacity);this.lf(b);this.yi(b);b.restore();a.Io&&(b.save(),b.beginPath(),b.lineWidth=1,b.strokeStyle="#ff8000",b.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),b.stroke(),b.restore())};a.prototype.Up=function(a,d){var b=d?function(b){a.fillStyle=b;a.fill()}:function(b){a.strokeStyle=b;a.stroke()};a.hd?(a.globalCompositeOperation="destination-out",--a.lineWidth,b("#000000"),a.globalCompositeOperation=
"source-over",a.fillStyle=a.hd,a.lineWidth+=2,b(a.hd),--a.lineWidth):(a.globalCompositeOperation="destination-out",b("#000000"),a.globalCompositeOperation="source-over")};a.prototype.lf=function(){};a.prototype.resolve=function(){return!1};a.prototype.hq=function(a,d,e,c){this.Jh||(this.Jh={});var b=this.Jh[a];if(!b||b.As!==c){b&&c===b.As||(b={As:c,value:c},this.Jh[a]=b);a=/url\(([^\)]+)\)/.exec(c);var f;a&&(f=a[1]);var l=this;f&&(b.value="rgba(0, 0, 0, 0.2)",e.add(this.id,"image",f,null,function(a){l.log("Got image response.");
b.value=d.createPattern(a,"repeat")||"magenta";e.Tg(l.id)}))}};a.prototype.sq=function(a){return this.Jh&&(a=this.Jh[a])?a.value:"magenta"};a.prototype.rq=function(){return""};a.prototype.ne=function(){};a.prototype.Tj=function(){};a.prototype.Uj=function(){return null};a.prototype.$r=function(){};a.sa={fillStyle:"#cccccc",strokeStyle:"#000000",lineWidth:2,shadow:!1};a.Io=!1;return a}(bd);y.create("GroupNode");
var fd=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.children=[];b.Db|=2;return b}__extends(a,c);a.prototype.type=function(){return"GroupNode"};a.prototype.Ue=function(a){for(var b=0;b<this.children.length;b++)if(a===this.children[b])return b;return-1};a.prototype.format=function(a,d){for(var b=0,c=this.children;b<c.length;b++){var h=c[b];Xc(h)&&h.format(a,d)}};a.prototype.Na=function(){return this.children.length};a.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,
1);return b};a.prototype.uk=function(a,d){this.children.splice(d,0,a)};a.prototype.rb=function(a){return this.children[a]};a.prototype.co=function(a,d){var b=this.children[a];this.children[a]=this.children[d];this.children[d]=b};return a}(ed);ed.kd("GroupNode",fd);var gd=y.create("BRUSH"),hd=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.la=[];b.sc=[];gd("New BrushNode created.");b.da.points=[];b.da.strokeStyle="#ff00ff";b.da.lineWidth=10;return b}__extends(a,c);a.prototype.type=function(){return"BrushNode"};a.prototype.setProperty=function(a,d){"fillStyle"===a&&(a="strokeStyle");"dashes"===a||"lineCap"===a?this.da[a]=d:c.prototype.setProperty.call(this,a,d)};a.prototype.ka=function(a){"fillStyle"===a&&(a="strokeStyle");return c.prototype.ka.call(this,
a)};a.prototype.format=function(){var a,d;this.la.length=0;var e=this.da.points;var c=a=0;for(d=e.length-1;a<=d;c=a+=2)this.la.push(new F(e[c],e[c+1]));c=I.kh(this.la);e=this.La().Yb();a=this.da.lineWidth;c.Nd(a/e.x,a/e.y);this.Ja=c.clone();c=new Mc(c);c.transform(this.da.matrix);this.rect=I.kh(c.la);this.sc=[];if("dashes"in this.da)for(e=this.da.dashes.split(","),c=0;c<e.length;c++)a=parseFloat(e[c]),isNaN(a)||this.sc.push(a)};a.prototype.xb=function(a,d){if(this.rect.bd(a,d)){var b=this.fe().apply(a,
d);if(Jc(this.la,b.x,b.y,12+this.da.lineWidth/2))return this}return null};a.prototype.lf=function(b){var d=this.da.points;if(0!==d.length){b.save();b.beginPath();var e=this.ka("lineCap")||"round";b.lineCap=e;b.lineJoin="round"===e?"round":"bevel";if(1<this.sc.length){e=this.la;var c=this.sc;if(0!==e.length){b.moveTo(e[0].x,e[0].y);var h=0;for(var k=1,l=c[0],n=e[0].clone(),q;k<e.length;)q=n.Lb(e[k]),0===q?k+=1:q<=l?(n=e[k].clone(),h&1?b.moveTo(n.x,n.y):b.lineTo(n.x,n.y),l-=q,k+=1):(n.x+=(e[k].x-n.x)*
l/q,n.y+=(e[k].y-n.y)*l/q,h&1?b.moveTo(n.x,n.y):b.lineTo(n.x,n.y),h=(h+1)%c.length,l=c[h])}}else for(b.moveTo(d[0],d[1]),e=c=2,h=d.length-1;c<=h;e=c+=2)b.lineTo(d[e],d[e+1]);this.fe().dg(b);uc(b,this.da.strokeStyle);if(a.Rs){this.La().dg(b);b.beginPath();e=c=0;for(h=d.length-1;c<=h;e=c+=2)b.rect(d[e]-2,d[e+1]-2,4,4);b.fillStyle="#ff0000";b.fill()}b.restore()}};a.Rs=!1;return a}(ed);ed.kd("BrushNode",hd);var id=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Yc=null;b.Id=null;b.width=100;b.height=20;b.vc=new Mc;b.wf=[];b.qd=new I(0,0,b.width,b.height);b.rc=new I(0,0,b.width,b.height);b.log=y.create("IMAGE",!0);delete b.da.fillStyle;delete b.da.strokeStyle;delete b.da.lineWidth;b.da.url="";return b}__extends(a,c);a.prototype.type=function(){return"ImageNode"};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "url":this.Id=this.Yc=null;break;case "brightness":case "contrast":case "gamma":this.Id=
null;this.da[a]=d;break;case "allowCrop":case "crop":case "blendMode":case "opacity":case "width":case "height":this.da[a]=d}};a.prototype.Mx=function(a){a.x=Math.max(a.x,0);a.y=Math.max(a.y,0);a.width=Math.min(a.width,this.qd.width);a.height=Math.min(a.height,this.qd.height);a.width=Math.max(1,a.width);a.height=Math.max(1,a.height);this.da.crop=[a.x,a.y,a.width,a.height].join()};a.prototype.oq=function(){var a=this.da.crop,d=new I(0,0,this.qd.width,this.qd.height);a&&(a=a.split(","),d.x=parseFloat(a[0])|
0,d.y=parseFloat(a[1])|0,d.width=parseFloat(a[2])|0,d.height=parseFloat(a[3])|0);return d};a.prototype.zx=function(){var a={brightness:this.ka("brightness"),contrast:this.ka("contrast"),gamma:this.ka("gamma")};this.Id=void 0!==a.brightness&&void 0!==a.contrast&&void 0!==a.gamma&&this.Yc?this.Iu(this.Yc,a)||this.Yc:this.Yc};a.prototype.format=function(a,d){function b(a,b,d){n.wf.push({x:n.rc.x+a*n.rc.width,y:n.rc.y+b*n.rc.height,je:d})}var c=this;null===this.Yc&&"ImageSurface"in window?(this.Yc=new window.ImageSurface(this.da.url),
this.qd=new I(0,0,this.Yc.width,this.Yc.height)):null===this.Yc?(this.qd=new I(0,0,this.width,this.height),d.add(this.id,"image",this.da.url,null,function(a){c.log("Got image response.");c.Yc=a;return d.Tg(c.id)})):this.qd=new I(0,0,this.Yc.width,this.Yc.height);if(null===this.Id&&(this.zx(),this.Id)){var h=this.ka("width"),k=this.ka("height");this.log("Override width/height as %s/%s",h,k);h&&(this.Id.style.width=h+"px");k&&(this.Id.style.height=k+"px")}this.rc=this.oq();this.rect=this.rc.clone();
if(h=this.ka("boundingPolygon")){k=[];for(var l=0;l<h.length;l+=2)k.push(new F(h[l],h[l+1]));this.vc=new Mc(k)}else this.vc=new Mc(this.rect);this.Ja=this.rect.clone();this.vc.transform(this.da.matrix);this.rect.transform(this.da.matrix);this.wf.length=0;var n=this;b(.5,0,!0);b(1,.5,!1);b(.5,1,!0);b(0,.5,!1)};a.prototype.Qj=function(){return this.vc};a.prototype.xb=function(a,d){return!this.da.locked&&this.vc.bd(a,d,3)?this:null};a.prototype.lf=function(b){var d,e,c=!1;if(this.Id)try{var h=b.globalCompositeOperation,
k=b.globalAlpha,l=this.ka("blendMode"),n=this.ka("opacity");l&&(b.globalCompositeOperation=""+l,this.log("Using globalCompsiteOperation=%s (requested %s)",b.globalCompositeOperation,l));void 0!==n&&(b.globalAlpha=n);var q=this.ka("lineWidth")||0;if(q){b.save();this.fe().dg(b);var u=this.vc.clone();u.Nd(q/2);b.beginPath();u.ia(b);b.lineWidth=q;b.strokeStyle=this.ka("strokeStyle")||"#000000";b.stroke();b.restore()}b.drawImage(this.Id,this.rc.x,this.rc.y,this.rc.width,this.rc.height,this.rc.x,this.rc.y,
this.rc.width,this.rc.height);b.globalAlpha=k;b.globalCompositeOperation=h;if(a.Ho){var v=this.vc.la;b.save();b.setTransform(1,0,0,1,0,0);b.beginPath();b.lineWidth=2;b.strokeStyle="#000000";b.moveTo(v[0].x,v[0].y);var w=d=1;for(e=v.length-1;d<=e;w=d+=1)b.lineTo(v[w].x,v[w].y);b.closePath();b.stroke();b.restore()}}catch(x){this.log("Error drawing image: %s",x.message),c=x}if(null===this.Id||c)b.save(),b.lineWidth=1,b.strokeStyle="#cccccc",b.strokeRect(0,0,this.width,this.height),b.restore()};a.prototype.We=
function(){return!0===this.ka("allowCrop")&&!0!==this.ka("lockEditMode")};a.prototype.Jj=function(a,d){a.save();a.beginPath();a.lineWidth=1*d;a.strokeStyle="#0050B7";for(var b=this.La(),c=0;c<this.wf.length;c++){var h=this.wf[c],k=b.apply(h.x,h.y),l;if(h.je){var n=20;var q=l=0;var u=3;h=k.x-10;k=k.y-6}else n=0,l=20,q=3,u=0,h=k.x-6,k=k.y-10;for(var v=0;5>v;v++)a.moveTo(h,k),a.lineTo(h+n*d,k+l*d),h+=q*d,k+=u*d}a.stroke();a.restore()};a.prototype.nk=function(a,d,e){var b=this.La();e*=10;for(var c=0;c<
this.wf.length;c++){var k=this.wf[c];k=b.apply(k.x,k.y);if(k.x-e<=a&&a<k.x+e&&k.y-e<=d&&d<k.y+e)return c}return null};a.prototype.Tj=function(a){a=this.wf[a];this.La().apply(a.x,a.y)};a.prototype.ne=function(a,d,e){var b=this.oq();d=this.fe().apply(d,e);d.x=Math.round(d.x);d.y=Math.round(d.y);0===a&&0<=d.y&&d.y<this.qd.height?(b.height-=d.y-b.y,b.y=d.y):1===a&&0<=d.x&&d.x<this.qd.width?b.width=d.x-b.x:2===a&&0<=d.y&&d.y<this.qd.height?b.height=d.y-b.y:3===a&&0<=d.x&&d.x<this.qd.width&&(b.width-=d.x-
b.x,b.x=d.x);this.Mx(b)};a.prototype.Iu=function(a,d){var b=a.width,c=a.height;if(!(a instanceof HTMLCanvasElement)){var h=document.createElement("canvas");h.width=b;h.height=c;h.getContext("2d").drawImage(a,0,0);a=h}h="number"===typeof d.brightness?d.brightness:-1;var k="number"===typeof d.contrast?d.contrast:-1,l="number"===typeof d.gamma?d.gamma:-1,n=document.createElement("canvas");this.log("filterSpec: %s",JSON.stringify(d));this.log("brightness=%s contrast=%s gamma=%s w=%s h=%s",h,k,l,b,c);
n.width=b+1;n.height=c;try{var q=a.getContext("2d").getImageData(0,0,b,c).data}catch(D){return this.log("Cannot filter external image."),null}b=n.getContext("2d").getImageData(0,0,b,c);c=b.data;for(var u=0;u<q.length;u+=4){var v=q[u]/255,w=q[u+1]/255,x=q[u+2]/255,z=q[u+3];0<=l&&(v=Math.pow(v,l),w=Math.pow(w,l),x=Math.pow(x,l));0<=h&&(v*=h,x*=h,w*=h);0<=k&&(v=v*k-.5*k+.5,w=w*k-.5*k+.5,x=x*k-.5*k+.5);c[u]=Math.min(255*v|0,255);c[u+1]=Math.min(255*w|0,255);c[u+2]=Math.min(255*x|0,255);c[u+3]=z}n.getContext("2d").putImageData(b,
0,0);return n};a.Ho=!1;return a}(ed);ed.kd("ImageNode",id);var jd=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a["class"]="DataNode";return a}__extends(a,c);a.prototype.type=function(){return"DataNode"};a.prototype.ng=function(){return!0};return a}(bd);bd.kd("DataNode",jd);var kd=function(){function c(a){this.Tc=a;this.rj=[];this.Dn=!0;this.log=y.create("cloudAddon");this.ue=a.ka("cloudRadius")}c.prototype.format=function(){var a=this.Tc.vd.ff();this.log("Format cloud; %s points",a.length);this.rj=this.Ut(a,this.ue)};c.prototype.Ut=function(a,b){var d=[],e=5/6*b*2,c,h=a[a.length-1];for(c=0;c<a.length;c++){var k=a[c];var l=k.x-h.x,n=k.y-h.y,q=Math.sqrt(l*l+n*n);l/=q;n/=q;var u=q/e+.5|0;1>u&&(u=1);u=q/u;for(var v=0;v+.1*u<q;v+=u)d.push({x:h.x+v*l,y:h.y+v*n,Wa:0,end:0});
h=k}k=d[d.length-1];for(c=0;c<d.length;c++)e=d[c],l=e.x-k.x,n=e.y-k.y,h=.5*Math.sqrt(l*l+n*n)/b,-1>h&&(h=-1),1<h&&(h=1),l=Math.atan2(n,l),h=Math.acos(h),h=[l-h,Math.PI+l+h],k.end=h[0],e.Wa=h[1],k=e;return d};c.prototype.ia=function(a){this.log("Drawing cloud with %s circles",this.rj.length);var b=15*Math.PI/180,d=this.ue;a.beginPath();for(var e=0;e<this.rj.length;e++){var c=this.rj[e];a.arc(c.x,c.y,d,c.Wa,c.end+b)}a.stroke()};return c}();var ld=function(){function c(){this.text="";this.font="10px Arial";this.fq="Arial";this.fontSize=10;this.lines=[];this.Ao="top";this.Vh="left";this.bi=this.bold=!1;this.textDecoration="";this.log=y.create("TextBox");this.rect=new I(0,0,0,this.fontSize)}c.prototype.cs=function(a,b,d,e,c){this.fq=a;this.fontSize=b;this.bold=d;this.bi=e;this.textDecoration=c};c.prototype.ah=function(a){this.text=a};c.prototype.Ln=function(a,b){switch(a){case "left":case "center":case "right":this.Vh=a;break;case null:break;
default:this.log("Unknown alignment: %s",a)}switch(b){case "top":case "middle":case "bottom":this.Ao=b;break;case null:break;default:this.log("Unknnown alignment: %s",b)}};c.prototype.format=function(a,b,d){this.font=""+this.fontSize+'px "'+this.fq+'"';this.bold&&(this.font="bold "+this.font);this.bi&&(this.font="italic "+this.font);this.lines.length=0;var e;a.font=this.font;var c=0;this.rect.width=0;if(0===b){var h=this.text.split("\n");for(e=0;e<h.length;e++){var k=h[e];var l=a.measureText(k).width;
c+=this.fontSize;this.lines.push({x:0,y:c,width:l,text:k});this.rect.width=Math.max(this.rect.width,l)}}else{k=h=0;var n=!1;for(e=0;e<this.text.length;e++){var q=this.text.charAt(e);l=a.measureText(this.text.substr(h,e-h+1)).width;"\n"===q?n=!0:l>b?k?(e=k,n=!0):e>h&&(--e,n=!0):" "===q&&(k=e);n&&(l=" "===this.text.charAt(e)?a.measureText(this.text.substr(h,e-h)).width:a.measureText(this.text.substr(h,e-h+1)).width,c+=this.fontSize,this.lines.push({x:0,y:c,width:l,text:this.text.substr(h,e-h+1)}),h=
e+1,k=0,n=!1,this.rect.width=Math.max(this.rect.width,l))}l&&(c+=this.fontSize,this.lines.push({x:0,y:c,width:l,text:this.text.substr(h,e-h)}),this.rect.width=Math.max(this.rect.width,l))}this.rect.x=0;this.rect.y=0;this.rect.height=c;if("center"===this.Vh)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width/2-a.width/2;else if("right"===this.Vh)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width-a.width;b&&"center"===this.Vh?this.rect.x=b/2-this.rect.width/2:b&&"right"===
this.Vh&&(this.rect.x=b-this.rect.width);d&&"middle"===this.Ao?this.rect.y=d/2-this.rect.height/2:d&&"bottom"===this.Ao&&(this.rect.y=d-this.rect.height)};c.prototype.ia=function(a,b,d){this.fillText(a,b,d);this.Rp(a,b,d)};c.prototype.Rp=function(a,b,d){var e;if(0<=this.textDecoration.indexOf("underline")){a.save();a.beginPath();var c=1;for(e=0;e<this.lines.length;e++){var h=this.lines[e];a.moveTo(h.x+b,h.y+d+c);a.lineTo(h.x+b+h.width,h.y+d+c)}a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.beginPath();
a.restore()}if(0<=this.textDecoration.indexOf("line-through")){a.save();a.beginPath();c=.25*-this.fontSize;for(e=0;e<this.lines.length;e++)h=this.lines[e],a.moveTo(h.x+b,h.y+d+c),a.lineTo(h.x+b+h.width,h.y+d+c);a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.restore()}};c.prototype.fillText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.fillText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};c.prototype.strokeText=function(a,
b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.strokeText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};return c}();var md=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.ib=new ld;e.Mm=0;e.border={lineWidth:0,rf:"#000000"};e.log=y.create("TEXT",!0);e.Nl(a.Ts);e.da.text="lorum ipsum dolor";return e}__extends(a,c);a.prototype.type=function(){return"TextNode"};a.prototype.setProperty=function(a,d){this.da[a]=this.Oj(a,d);"textFillStyle"===a?this.da.fillStyle=d:"fillStyle"===a&&(this.da.textFillStyle=d)};a.prototype.format=function(a){this.ib.cs(this.da.fontName,this.da.fontSize,this.da.bold,this.da.italic,
this.da.textDecoration);var b=this.da.text;b.length&&10===b.charCodeAt(b.length-1)&&(b=b.substr(0,b.length-1));this.ib.ah(b);var e=this.da.matrix;b=e.apply(0,0);e=e.apply(1,0);b=b.Lb(e);e=this.ka("wrap");var c=!1!==this.ka("scaleFont");this.ib.Ln(this.da.textAlign,"top");e?(e=this.da.baseWidth,void 0===e&&(this.ib.format(a,0,0),e=Math.max(this.ib.rect.width,10),500<e&&(e=500),this.da.baseWidth=e,this.log("Formatting text for first time; baseWidth=%s",e)),b=Math.ceil(b*e),this.ib.format(a,b,0),a=this.ib.rect.height,
this.Ja=new I(0,0,e,a)):c?(this.ib.format(a,0,0),b=this.ib.rect.width,a=this.ib.rect.height,this.Ja=new I(0,-(0+this.ka("fontSize")),b,a)):(this.ib.format(a,0,0),b=this.ib.rect.width,a=this.ib.rect.height,this.Ja=new I(0,0,b,a));a=new Mc(this.Ja);a.transform(this.La());this.rect=a.Ht();this.Mm=this.rect.height;this.rect.height+=.3*this.da.fontSize;a=this.ka("lineWidth")+0;this.rect.Nd(a,a);this.border=this.da.border?this.Zw(this.da.border):{lineWidth:0,rf:"#000000"}};a.prototype.Zw=function(a){var b=
{lineWidth:0,rf:"#000000"};a=a.split(" ");for(var e=0;e<a.length;e++){var c=parseFloat(a[e]);if(isNaN(c)){if(c=r.Mh(a[e]))b.rf=c.toString()}else b.lineWidth=c}return b};a.prototype.La=function(){return!1===this.ka("scaleFont")?c.prototype.La.call(this).xs():c.prototype.La.call(this)};a.prototype.ia=function(a){if(0!==this.da.text.length){var b=.3*this.da.fontSize;a.save();this.zi(a);"opacity"in this.da&&(a.globalAlpha=this.da.opacity);var e=this.da.background;if(e||this.border.lineWidth)a.save(),
this.La().dg(a),e&&(a.fillStyle=e,a.fillRect(this.Ja.x,this.Ja.y,this.Ja.width,this.Ja.height+b)),this.border.lineWidth&&(a.beginPath(),a.strokeStyle=this.border.rf,a.lineWidth=this.border.lineWidth,a.rect(this.Ja.x,this.Ja.y,this.Ja.width,this.Ja.height+b),a.stroke()),a.restore();this.ka("wrap")?this.La().xs().dg(a):this.La().dg(a);a.strokeStyle=this.da.strokeStyle;a.fillStyle=this.da.fillStyle;a.lineWidth=this.da.lineWidth;b=0;e=this.La().Yb();e=this.Ja.height*e.y;if(this.da.wrap||!1===this.ka("scaleFont"))switch(this.log("Available: %s rect: %s",
e,this.ib.rect),this.da.verticalAlign){case "bottom":b+=e-this.ib.rect.height;break;case "middle":b+=(e-this.ib.rect.height)/2}else b=-(0+this.ka("fontSize"));this.da.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");0<this.da.lineWidth&&this.ib.strokeText(a,0,b);this.ib.fillText(a,0,b);this.ib.Rp(a,0,b);this.yi(a);a.restore();ed.Io&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),
a.stroke(),a.restore())}};a.Ts={textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:0,fillStyle:"#000000",wrap:!1,textAlign:"left",bold:!1,italic:!1,background:"rgba(0,0,0,0.0)",textDecoration:""};return a}(ed);ed.kd("TextNode",md);var nd=function(){function c(a,b){this.ra=a;this.ha=b;this.py=!0;this.log=y.create("MoveSegment")}c.prototype.ia=function(a){a.moveTo(this.ha.x,this.ha.y)};c.prototype.Ae=function(){return this.Lc()};c.prototype.Lc=function(){return{x:1,y:0}};return c}(),od=function(){function c(a,b,d,e,c){this.ra=a;this.ha=b;this.Wn=e;this.we=c;this.log=y.create("LineSegment");this.Xf=0;this.Fa=new F(0,0);this.Oa=new F(0,0);this.length=0;this.from=new F(0,0);this.ha=b;this.ra=a;this.we=c;this.Wn=e;d.next();this.Pk=
d.next();this.Qk=d.next();this.moveTo=this.Yf=null;this.format()}c.prototype.format=function(){var a=zc(this.ra.ha.x,this.ra.ha.y,this.ha.x,this.ha.y);this.Xf=this.length=a;var b=this.ra.ha.clone();this.ra instanceof c&&this.we&&(this.we=Math.min(this.we,a/2,this.ra.length/2),a=Ac(this.ra.ha.x,this.ra.ha.y,this.ha.x,this.ha.y),b.x+=a.x*this.we,b.y+=a.y*this.we,this.ra.ky(this.we),this.Xf-=this.we);this.from=b;null===this.Yf&&(this.Yf=this.ha);a=this.Xf/10*this.Wn;10<a&&(a=10);var d=b.x,e=b.y,f=this.ha.x,
h=this.ha.y;d+=a;e+=a;this.Fa=new F(d+this.Pk*(f+a-d),e+this.Pk*(h+a-e));d=b.x-a;f=this.ha.x-a;e=b.y-a;h=this.ha.y-a;this.Oa=new F(d+this.Qk*(f-d),e+this.Qk*(h-e))};c.prototype.ky=function(a){var b=Ac(this.from.x,this.from.y,this.ha.x,this.ha.y),d=this.ha.clone();d.x-=b.x*a;d.y-=b.y*a;this.Yf=d;this.Xf-=a;a=this.Xf/10*this.Wn;10<a&&(a=10);b=this.from.x;var e=this.from.y,c=d.x,h=d.y;b+=a;e+=a;this.Fa=new F(b+this.Pk*(c+a-b),e+this.Pk*(h+a-e));this.log("RECALC ctrl1=%s",this.Fa);b=this.from.x-a;c=d.x-
a;e=this.from.y-a;h=d.y-a;this.Oa=new F(b+this.Qk*(c-b),e+this.Qk*(h-e))};c.prototype.Ii=function(a){this.ra=a;this.format();this.ra instanceof c&&(this.moveTo=this.ra.Yf)};c.prototype.ia=function(a){null!==this.Yf&&(this.we&&(this.moveTo&&a.moveTo(this.moveTo.x,this.moveTo.y),a.quadraticCurveTo(this.ra.ha.x,this.ra.ha.y,this.from.x,this.from.y)),a.bezierCurveTo(this.Fa.x,this.Fa.y,this.Oa.x,this.Oa.y,this.Yf.x,this.Yf.y))};c.prototype.Ae=function(){return this.ra?Ac(this.ra.ha.x,this.ra.ha.y,this.Fa.x,
this.Fa.y):this.Lc()};c.prototype.Lc=function(){return Ac(this.Oa.x,this.Oa.y,this.ha.x,this.ha.y)};return c}(),pd=function(){function c(a,b,d){this.ha=b;this.ra=a;this.ks=d;var e=zc(a.ha.x,a.ha.y,b.x,b.y);e||(e=1);var c=(b.x-a.ha.x)/e,h=(b.y-a.ha.y)/e;this.Oa=new F(b.x-e*d*c,b.y-e*d*h);if((b=a.Oa)&&a.ra){var k=Ac(a.ra.ha.x,a.ra.ha.y,a.ha.x,a.ha.y),l=zc(a.ra.ha.x,a.ra.ha.y,a.ha.x,a.ha.y);c=.5*(c+k.x);h=.5*(h+k.y);b.x=a.ha.x-l*d*c;b.y=a.ha.y-l*d*h}this.Fa=new F(a.ha.x+e*d*c,a.ha.y+e*d*h);this.length=
e}c.prototype.Ii=function(a){this.ra=a;var b=a.Oa,d=(this.ha.x-a.ha.x)/this.length,e=(this.ha.y-a.ha.y)/this.length,c=this.ks;if(b&&a.ra){var h=Ac(a.ra.ha.x,a.ra.ha.y,a.ha.x,a.ha.y),k=zc(a.ra.ha.x,a.ra.ha.y,a.ha.x,a.ha.y);d=.5*(d+h.x);e=.5*(e+h.y);b.x=a.ha.x-k*c*d;b.y=a.ha.y-k*c*e}this.Fa=new F(a.ha.x+this.length*c*d,a.ha.y+this.length*c*e)};c.prototype.ia=function(a){a.bezierCurveTo(this.Fa.x,this.Fa.y,this.Oa.x,this.Oa.y,this.ha.x,this.ha.y)};c.prototype.Ae=function(){return this.ra?Ac(this.ra.ha.x,
this.ra.ha.y,this.Fa.x,this.Fa.y):{x:1,y:0}};c.prototype.Lc=function(){return 0<this.ks?Ac(this.Oa.x,this.Oa.y,this.ha.x,this.ha.y):Ac(this.ra.ha.x,this.ra.ha.y,this.ha.x,this.ha.y)};return c}(),qd=function(){function c(a,b,d){this.ra=a;this.control=b;this.ha=d}c.prototype.ia=function(a){a.quadraticCurveTo(this.control.x,this.control.y,this.ha.x,this.ha.y)};c.prototype.Ae=function(){return this.ra?Ac(this.ra.ha.x,this.ra.ha.y,this.control.x,this.control.y):{x:1,y:0}};c.prototype.Lc=function(){return Ac(this.control.x,
this.control.y,this.ha.x,this.ha.y)};return c}(),rd=function(){function c(a,b,d,e){this.ra=a;this.control=b;this.ha=d;this.ue=e}c.prototype.ia=function(a){a.arcTo(this.control.x,this.control.y,this.ha.x,this.ha.y,this.ue)};c.prototype.Ae=function(){return{x:1,y:0}};c.prototype.Lc=function(){return Ac(0,0,1,0)};return c}(),sd=function(){function c(a,b,d,e,c,h,k){this.ra=a;this.Ed=b;this.ha=d;this.ue=e;this.Zn=c;this.Bu=h;this.fu=k}c.prototype.ia=function(a){a.arc(this.Ed.x,this.Ed.y,this.ue,this.Zn,
this.Bu,0!==this.fu)};c.prototype.Ae=function(){return{x:1,y:0}};c.prototype.Lc=function(){return Ac(0,0,1,0)};return c}(),td=function(){function c(a,b,d,e){this.Fa=b;this.Oa=d;this.Fa=b;this.Oa=d;this.ha=e;this.ra=a}c.prototype.ia=function(a){a.bezierCurveTo(this.Fa.x,this.Fa.y,this.Oa.x,this.Oa.y,this.ha.x,this.ha.y)};c.prototype.Ae=function(){return this.ra?Ac(this.ra.ha.x,this.ra.ha.y,this.Fa.x,this.Fa.y):{x:1,y:0}};c.prototype.Lc=function(){return Ac(this.Oa.x,this.Oa.y,this.ha.x,this.ha.y)};
return c}(),ud=function(){function c(a,b,d,e){this.ra=a;this.Fa=b;this.Oa=d;this.ha=e}c.prototype.ia=function(a){if(this.ra){var b=[];this.ra.Oa&&b.push(this.ra.Oa);this.Fa&&b.push(this.Fa);2===b.length?a.bezierCurveTo(b[0].x,b[0].y,b[1].x,b[1].y,this.ha.x,this.ha.y):1===b.length&&a.quadraticCurveTo(b[0].x,b[0].y,this.ha.x,this.ha.y)}};c.prototype.Ii=function(a){this.ra=a};c.prototype.Ae=function(){return this.ra&&this.ra.Oa?Ac(this.ra.ha.x,this.ra.ha.y,this.Fa.x,this.Fa.y):{x:1,y:0}};c.prototype.Lc=
function(){return this.Fa?Ac(this.Fa.x,this.Fa.y,this.ha.x,this.ha.y):{x:1,y:0}};return c}(),vd=function(){function c(a,b,d,e,c){this.ra=a;this.Ah=b;this.ha=d;this.log=y.create("SEGMENT");this.ra=a;this.Ah=b;c*=2;var f=2*e.next()-1;e.next();e=this.ra.Lc();if(!this.ra.py&&e){var k=zc(a.ha.x,a.ha.y,b.x,b.y);this.Fa=new F(a.ha.x+.5522847498*e.x*k,a.ha.y+.5522847498*e.y*k)}else this.Fa=new F(a.ha.x+.5522847498*(b.x-a.ha.x),a.ha.y+.5522847498*(b.y-a.ha.y));this.Oa=new F(d.x-.5522847498*(d.x-b.x)*(1-f*
c),d.y-.5522847498*(d.y-b.y)*(1-f*c));this.ha=d}c.prototype.Ii=function(a){this.ra=a;var b=this.ra.Lc();if(b){var d=zc(a.ha.x,a.ha.y,this.Ah.x,this.Ah.y);this.Fa=new F(a.ha.x+.5522847498*b.x*d,a.ha.y+.5522847498*b.y*d)}else this.Fa=new F(a.ha.x+.5522847498*(this.Ah.x-this.ra.ha.x),a.ha.y+.5522847498*(this.Ah.y-this.ra.ha.y))};c.prototype.ia=function(a){a.bezierCurveTo(this.Fa.x,this.Fa.y,this.Oa.x,this.Oa.y,this.ha.x,this.ha.y)};c.prototype.Ae=function(){return this.ra?Ac(this.ra.ha.x,this.ra.ha.y,
this.Fa.x,this.Fa.y):{x:1,y:0}};c.prototype.Lc=function(){return Ac(this.Oa.x,this.Oa.y,this.ha.x,this.ha.y)};return c}();var wd=function(){function c(a){this.hi=this.gi=0;if("string"===typeof a){for(;8>a.length;)a+=a;for(var b=16777619,d=0;d<a.length;d++)b=(16777619*b^a.charCodeAt(d))&4294967295;a=b}this.Ur=a;this.reset()}c.prototype.reset=function(){this.hi=this.gi=this.Ur};c.prototype.next=function(){this.hi=36969*(this.hi&65535)+(this.hi>>16);this.gi=18E3*(this.gi&65535)+(this.gi>>16);return((this.hi<<16)+this.gi)/4294967295/2+.5};return c}();var xd=function(){function c(a){this.la=a;this.n=0;this.sb=new F(0,0)}c.prototype.next=function(a){if(0===this.la.length)return null;if(0===this.n)return this.sb=this.la[0].clone(),this.n+=1,this.sb.clone();for(;this.n<this.la.length;){var b=this.sb.Lb(this.la[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.sb.x+=(this.la[this.n].x-this.sb.x)*a/b,this.sb.y+=(this.la[this.n].y-this.sb.y)*a/b,this.sb.clone()}return null};return c}(),yd=function(){function c(a){this.Tc=a;this.Dn=
!0;this.la=[];this.log=y.create("WaveAddon");this.ue=a.ka("waveRadius")}c.prototype.format=function(){var a=this.Tc.Pl(!1).ko(M.tl).ff();this.log("Format cloud; %s points",a.length);this.la=this.$y(a,this.ue)};c.prototype.$y=function(a,b){var d=new xd(a),e=1,c=[];if(2>a.length)return c;var h=0;for(var k=1;k<a.length;k++)h+=zc(a[k-1].x,a[k-1].y,a[k].x,a[k].y);b=h/Math.round(h/(2*b)+.5)/2;for(h=[];;){k=d.next(2*b);if(!k)break;h.push(k)}h.push(a[a.length-1]);var l=h[0];c.push(l);for(d=1;d<h.length;d++){k=
h[d];var n=Ac(l.x,l.y,k.x,k.y);var q=b,u=new F(n.y*e,-1*n.x*e);l=new F(l.x+(n.x+u.x)*q,l.y+(n.y+u.y)*q);c.push(l);c.push(k);e*=-1;l=k}for(d=2;d<c.length-1;d+=2)e=c[d-1],h=c[d+1],c[d].x=e.x+(h.x-e.x)/2,c[d].y=e.y+(h.y-e.y)/2;return c};c.prototype.ia=function(a){a.beginPath();a.moveTo(this.la[0].x,this.la[0].y);for(var b=1;b<this.la.length-1;b+=2)a.quadraticCurveTo(this.la[b].x,this.la[b].y,this.la[b+1].x,this.la[b+1].y)};return c}();var M=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.wa=[];e.og=0;e.Cd=[];e.Xn=[];e.us=!1;e.inverse=new J;e.origin=new F(0,0);e.sc=[];e.vd=new L;e.Eq=!1;e.backgroundImage=null;e.log=y.create("PATHNODE");e.log("New PathNode Created");e.Ib=new md("",d);e.Ib.setProperty("text",e.da.text);e.Nl(a.sa);e.da.closed=!1;e.da.commands=[];e.da.seed=0;return e}__extends(a,c);a.prototype.moveTo=function(b,d){var e=this.da.commands;e.push(a.fg);e.push(b);e.push(d)};a.prototype.Ft=function(b,d,e,c,h,
k){var f=this.da.commands;f.push(a.jh);f.push(h);f.push(k);f.push(b);f.push(d);f.push(e);f.push(c)};a.prototype.type=function(){return"PathNode"};a.prototype.Xh=function(){return!0};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "bold":case "fontName":case "fontSize":case "italic":case "text":case "textAlign":case "textDecoration":case "wrap":this.da[a]=d;this.Ib.setProperty(a,d);break;case "textFillStyle":this.Ib.setProperty("fillStyle",d);this.da[a]=
d;break;case "textBackground":this.Ib.setProperty("background",d);this.da[a]=d;break;case "cloudRadius":case "waveRadius":case "doubleLine":case "doubleLineDashSide":case "spotHighlight":case "verticalAlign":this.da[a]=d;break;case "backgroundImage":this.da[a]=d,this.backgroundImage=null}};a.prototype.Tj=function(b){for(var d=0,e=this.da.commands,c=b/3|0,h=0;h<c;h++)d+=a.bb[e[d]]+1;h=b%3*2+1;c=e[d+h];d=e[d+h+1];this.log("getEditHandle(%s) = (%s, %s)",b,c,d);this.La().apply(c,d)};a.prototype.ne=function(b,
d,e){for(var c=0,h=this.da.commands,k=b/3|0,l=0;l<k;l++)c+=a.bb[h[c]]+1;k=this.inverse.apply(d,e);l=b%3*2+1;h[c+l]=k.x;h[c+l+1]=k.y;if(0===b&&this.da.closed){for(b=null;c<h.length;)k=a.bb[h[c]],2<=k&&(b=c),c+=k+1;b&&(c=b,k=this.inverse.apply(d,e),h[c+1]=k.x,h[c+2]=k.y)}};a.prototype.rq=function(){return"commands"};a.prototype.sx=function(b){for(var d=this.da.commands,e=0,c=0;c<b/3;c++)e+=a.bb[d[e]]+1;d.splice(e,a.bb[d[e]]+1)};a.prototype.Yu=function(){return this.ka("arrowXOffset")||this.ka("arrowSize")};
a.prototype.format=function(b,d){var e=this,c=null;this.wa.length=0;this.inverse=this.da.matrix.inverse();var h=new F(0,0),k=this.da.commands,l=null,n=this.da.matrix,q=new wd(this.da.seed);this.Xn.length=0;for(var u=null,v=null,w=0;w<k.length;){switch(k[w++]){case a.fg:h=n.apply(k[w++],k[w++]);v=new nd(l,h);this.wa.push(v);null===c&&(c=h);this.Xn.push(h);u=null;break;case a.Ee:l&&(h=n.apply(k[w++],k[w++]),this.wa.push(new od(l,h,q,this.da.sloppiness,this.da.roundRadius)),this.Xn.push(h));break;case a.gg:if(l){h=
n.apply(k[w++],k[w++]);var x=n.apply(k[w++],k[w++]);this.wa.push(new qd(l,x,h))}break;case a.sl:if(l){h=n.apply(k[w++],k[w++]);x=n.apply(k[w++],k[w++]);var z=k[w++];this.wa.push(new rd(l,x,h,z))}break;case a.rl:if(l){h=n.apply(k[w++],k[w++]);x=n.apply(k[w++],k[w++]);z=k[w++];var D=k[w++],G=k[w++],H=k[w++];this.wa.push(new sd(l,x,h,z,D,G,H))}break;case a.jh:l&&(h=n.apply(k[w++],k[w++]),z=n.apply(k[w++],k[w++]),x=n.apply(k[w++],k[w++]),this.wa.push(new td(l,z,x,h)));break;case a.Oo:l&&(h=n.apply(k[w++],
k[w++]),z=n.apply(k[w++],k[w++]),x=n.apply(k[w++],k[w++]),this.wa.push(new ud(l,z,x,h)));break;case a.Wi:l&&(h=n.apply(k[w++],k[w++]),this.wa.push(new pd(l,h,this.da.smoothness)));break;case a.ul:l&&(h=n.apply(k[w++],k[w++]),z=n.apply(k[w++],k[w++]),this.wa.push(new vd(l,z,h,q,this.da.sloppiness)));break;case a.Dc:this.da.closed=!0;u&&l&&u!==l&&u.Ii&&v&&(u.Ii(l),l.ha=v.ha);break;default:w++}l=this.wa[this.wa.length-1];null!==u||l instanceof nd||(u=l)}this.origin=c||new F(0,0);this.og=this.wa.length;
this.Su(q);this.rect.x=this.origin.x;this.rect.y=this.origin.y;this.rect.width=0;this.rect.height=0;c=this.da.dashes.split(",");this.sc=[];for(w=0;w<c.length;w++)h=parseFloat(c[w]),isNaN(h)||this.sc.push(h);c=this.sc.length?a.tl:a.Fs;this.vd=this.Pl(!0).ko(c);w=0+this.ka("shapeWidth");0<w&&(this.vd=this.du(this.vd,w));this.rect=this.vd.yp(c);w=this.rect.width-2*(this.da.lineWidth/2+1);h=this.da.lineWidth;k=this.vd.clone();k.transform(this.fe());this.Ja=k.yp(c);c=this.La().Yb();this.Ja.Nd(Math.ceil(h/
c.x),Math.ceil(h/c.y));this.rect.Nd(h+1,h+1);8>this.rect.width&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8);8>this.rect.height&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8);if(""!==this.da.text){c=this.rect.Ed();this.Ib.setProperty("textAlign",this.da.textAlign||"center");this.Ib.setProperty("baseWidth",w);this.Ib.format(b,d);w=c.x-this.Ib.rect.x-this.Ib.rect.width/2;h=0;switch(this.da.verticalAlign){default:case "middle":h=c.y-this.Ib.rect.y-this.Ib.Mm/2;break;case "top":h=this.rect.y-
this.Ib.rect.y;break;case "bottom":h=this.rect.bottom()-this.Ib.Mm-this.Ib.rect.y}this.Ib.transform(new Cc(w,h));this.Ib.format(b,d)}this.us=0===r.de(this.da.fillStyle).values[3]&&!this.backgroundImage;this.hq("fill",b,d,this.da.fillStyle);this.Cd.length=0;0<this.da.cloudRadius?this.Cd.push(new kd(this)):0<this.da.waveRadius?this.Cd.push(new yd(this)):this.da.doubleLine&&this.Cd.push(new zd(this));for(w=0;w<this.Cd.length;w++)this.Cd[w].format(b);(w=this.ka("backgroundImage"))&&null===this.backgroundImage&&
d.add(this.id,"image",w,null,function(a){e.backgroundImage=a;d.Tg(e.id)})};a.prototype.$j=function(){return this.vd};a.prototype.Su=function(a){function b(b,d){b=b.clone();l&&(b.x+=d.x*h*.5,b.y+=d.y*h*.5);var f=b.x-d.x*h;var n=b.y-d.y*h;var q=f+d.y*c/2;var u=n-d.x*c/2;f+=-d.y*c/2;n+=d.x*c/2;e.wa.push(new nd(e.wa[e.wa.length-1],new F(f,n)));e.wa.push(new pd(e.wa[e.wa.length-1],b,k));e.wa.push(new pd(e.wa[e.wa.length-1],new F(q,u),k));"solid"===e.da.arrowStyle&&e.wa.push(new od(e.wa[e.wa.length-1],
new F(f,n),a,e.da.smoothness,0))}if(this.Eq=0<this.da.arrowSize&&!this.da.closed&&0<this.wa.length){var e=this,c=this.da.arrowSize,h=this.da.arrowXOffset,k=this.da.smoothness,l=this.da.doubleLine;null===h&&(h=c);var n=this.wa[this.wa.length-1];b(n.ha,n.Lc());this.da.doubleArrow&&b(this.wa[0].ha,Bc(this.wa[1].Ae()))}};a.prototype.close=function(){this.da.commands.push(a.Dc)};a.prototype.zt=function(){var a=this.wa[this.wa.length-1];8>=zc(a.ha.x,a.ha.y,this.origin.x,this.origin.y)&&this.close()};a.prototype.du=
function(a,d){this.log("ConvertToRects: width=%s",d);for(var b=0,c=a.fa,h=0,k=0,l,n,q=new L;b<c.length;){this.log("cmd %s %s %s",c[b],c[b+1],c[b+2]);switch(c[b]){case L.Fc:h=c[b+1];k=c[b+2];break;case L.Ec:l=c[b+1];n=c[b+2];this.log("(%s,%s-%s,%s)",h,k,l,n);if(0<zc(h,k,l,n)){var u=Ac(h,k,l,n),v=u.y*d/2;u=-u.x*d/2;q.moveTo(h+v,k+u);q.lineTo(l+v,n+u);q.lineTo(l-v,n-u);q.lineTo(h-v,k-u);q.closePath()}h=l;k=n}b+=L.Gc[c[b]]}return q};a.prototype.clip=function(a){if(this.da.closed){var b=new L;this.log("Clipping to a path");
for(var e=0;e<this.wa.length;e++)this.wa[e].ia(b);b.closePath();0>b.th()&&(b=b.xx());b.ia(a)}};a.prototype.ia=function(a){this.da.spotHighlight?this.log("Not drawing node %s due to spothighlight",this.id):c.prototype.ia.call(this,a)};a.prototype.lf=function(a){var b=this.inverse;a.save();a.lineJoin="round";a.transform(b.m11,b.m21,b.m12,b.m22,b.Da,b.Ea);a.beginPath();a.lineCap="round";b=!0;var e;for(e=0;e<this.Cd.length;e++)this.Cd[e].Dn&&(b=!1);if(b)for(e=0;e<this.wa.length;e++)this.wa[e].ia(a);for(e=
0;e<this.Cd.length;e++)this.Cd[e].ia(a);if(!b&&0<this.da.arrowSize)for(e=this.og;e<this.wa.length;e++)this.wa[e].ia(a);if(this.da.closed){a.closePath();if(this.backgroundImage){a.fillStyle=a.createPattern(this.backgroundImage,"no-repeat")||"magenta";e=Math.max(this.rect.width/this.backgroundImage.naturalWidth,this.rect.height/this.backgroundImage.naturalHeight);var c=this.rect.width-this.backgroundImage.naturalWidth*e,h=this.rect.height-this.backgroundImage.naturalHeight*e;a.translate(this.rect.x+
c/2,this.rect.y+h/2);a.scale(e,e);a.fill();a.scale(1/e,1/e);a.translate(-this.rect.x-c/2,-this.rect.y-h/2)}else a.fillStyle=this.sq("fill"),a.fill();a.shadowColor="rgba(0,0,0,0.0)"}b&&(this.sc.length&&0<this.da.lineWidth?(a.beginPath(),this.vd.Ij(a,this.sc),a.lineCap="butt"):0<0+this.ka("shapeWidth")&&(a.beginPath(),this.vd.ia(a)));0<this.da.lineWidth&&a.stroke();if(this.da.arrowSize&&"solid"===this.da.arrowStyle){a.beginPath();for(e=this.og;e<this.wa.length;e++)this.wa[e].ia(a);a.fillStyle=this.da.strokeStyle;
a.fill()}""!==this.da.text&&this.Ib.ia(a);a.restore()};a.prototype.xb=function(a,d){if(this.hidden()||this.ka("locked"))return null;var b=12+this.da.shapeWidth/2+this.da.lineWidth/2;if(a>=this.rect.x-b&&a<this.rect.x+b+this.rect.width&&d>=this.rect.y-b&&d<this.rect.y+b+this.rect.height)if(this.da.closed&&!this.us){if(this.vd.ix(a,d))return this}else if(this.vd.Br(a,d,b)||""!==this.da.text&&this.Ib.xb(a,d))return this;return null};a.prototype.Pl=function(a){var b=new L;if(0<this.da.arrowSize&&!a)for(a=
0;a<this.og;a++)this.wa[a].ia(b);else for(a=0;a<this.wa.length;a++)this.wa[a].ia(b);this.da.closed&&b.closePath();return b};a.prototype.lineTo=function(b,d){var e=this.da.commands;e.push(a.Ee);e.push(b);e.push(d)};a.prototype.Ch=function(b,d){var e=this.da.commands;e.push(a.Wi);e.push(b);e.push(d)};a.prototype.We=function(){return!1!==this.da.editable&&!0!==this.da.lockEditMode};a.prototype.nk=function(a,d,e){e*=8;if(a>=this.origin.x-e&&a<this.origin.x+e&&d>=this.origin.y-e&&d<this.origin.y+e)return 0;
for(var b=0;b<this.og;b++){var c=this.wa[b];if(a>=this.wa[b].ha.x-e&&a<this.wa[b].ha.x+e&&d>=this.wa[b].ha.y-e&&d<this.wa[b].ha.y+e)return 3*b;if(c.control){if(a>=c.control.x-e&&a<c.control.x+e&&d>=c.control.y-e&&d<c.control.y+e)return 3*b+1}else if(c.Fa){if(a>=c.Fa.x-e&&a<c.Fa.x+e&&d>=c.Fa.y-e&&d<c.Fa.y+e)return 3*b+1;if(c.Oa&&a>=c.Oa.x-e&&a<c.Oa.x+e&&d>=c.Oa.y-e&&d<c.Oa.y+e)return 3*b+2}}return null};a.prototype.Uj=function(b){var d=this.da.commands;b/=3;var e=0,c=!1,h=0,k;for(k=0;k<d.length;){var l=
d[k];if(l===a.Dc){c=!0;break}h+=1;k+=a.bb[d[k]]+1}0===b&&c&&(b=h-1);for(k=0;k<d.length;e++){c=null;switch(d[k]){case a.fg:c="move_to";break;case a.Ee:c="line_to";break;case a.gg:c="quadratic_to"}if(b===e)return c;k+=a.bb[d[k]]+1}return null};a.Ss=function(b,d,e){d/=3;var c=0,h=[],k=new F(0,0),l=!1,n=0,q;for(q=0;q<b.length;){var u=b[q];if(u===a.Dc){l=!0;break}n+=1;q+=a.bb[b[q]]+1}0===d&&l&&(d=n-1);for(q=0;q<b.length;c++){u=b[q];l=!1;d===c&&(u===a.gg&&"line_to"===e?(h.push(a.Ee,b[q+1],b[q+2]),l=!0):
u===a.Ee&&"quadratic_to"===e&&(h.push(a.gg,b[q+1],b[q+2],(k.x+b[q+1])/2,(k.y+b[q+2])/2),l=!0));k=new F(b[q+1],b[q+2]);if(!l)for(u=0;u<1+a.bb[b[q]];u++)h.push(b[q+u]);q+=a.bb[b[q]]+1}return h};a.prototype.Pq=function(){return!0};a.prototype.Jj=function(a,d,e){a.save();a.lineWidth=1*d;a.strokeStyle="#0050B7";a.fillStyle="#0050B7";d*=8;0===e?a.fillRect(this.origin.x-d,this.origin.y-d,2*d,2*d):a.strokeRect(this.origin.x-d,this.origin.y-d,2*d,2*d);for(var b=1;b<this.og;b++){var c=this.wa[b];a.beginPath();
if(c.control)a.arc(c.control.x,c.control.y,d,0,2*Math.PI),a.arc(c.control.x,c.control.y,2*d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke();else if(c instanceof td||c instanceof ud){var k=c.Fa;var l=c.Oa;var n=c.ra.ha;k&&(a.moveTo(n.x,n.y),a.lineTo(k.x,k.y),a.moveTo(k.x+d,k.y),a.arc(k.x,k.y,d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke());a.beginPath();a.moveTo(c.ha.x,c.ha.y);a.lineTo(l.x,l.y);a.moveTo(l.x+d,l.y);a.arc(l.x,l.y,d,0,2*Math.PI);e===3*b+2?a.fill():a.stroke()}e===3*b?a.fillRect(this.wa[b].ha.x-
d,this.wa[b].ha.y-d,2*d,2*d):a.strokeRect(this.wa[b].ha.x-d,this.wa[b].ha.y-d,2*d,2*d)}a.restore()};a.Hs=function(a){var b=new N,e=0;for(a=a.fa;e<a.length;){switch(a[e]){case L.Fc:b.moveTo(a[e+1],a[e+2]);break;case L.Ec:b.lineTo(a[e+1],a[e+2]);break;case L.De:b.bezierCurveTo(a[e+1],a[e+2],a[e+3],a[e+4],a[e+5],a[e+6]);break;case L.Fe:b.quadraticCurveTo(a[e+1],a[e+2],a[e+3],a[e+4]);break;case L.Dc:b.close()}e+=L.Gc[a[e]]}return b.Ob()};a.sa={strokeStyle:"#000000",fillStyle:"#ffffff",fontName:"Arial",
fontSize:20,lineWidth:2,dashes:"",shapeWidth:0,smoothness:.3,sloppiness:0,shadow:!1,closed:!1,arrowSize:0,arrowXOffset:null,arrowStyle:"simple",doubleArrow:!1,text:"",roundRadius:0,wrap:!1};a.Fs=8;a.tl=2;a.fg=0;a.Ee=1;a.gg=2;a.sl=3;a.jh=4;a.Wi=5;a.ul=6;a.Dc=7;a.Oo=8;a.rl=9;a.oz=.5522847498;a.bb=[];return a}(ed);M.bb[M.fg]=2;M.bb[M.Ee]=2;M.bb[M.gg]=4;M.bb[M.sl]=5;M.bb[M.jh]=6;M.bb[M.Wi]=2;M.bb[M.ul]=4;M.bb[M.Dc]=0;M.bb[M.Oo]=6;M.bb[M.rl]=8;
var N=function(){function c(a){void 0===a&&(a=[]);this.fa=a}c.prototype.beginPath=function(){};c.prototype.pf=function(a,b,d){for(var e=0,c=0;c<a;c++)e+=M.bb[this.fa[e]]+1;this.fa[e+1]=b;this.fa[e+2]=d};c.prototype.moveTo=function(a,b){this.fa.push(M.fg);this.fa.push(a);this.fa.push(b)};c.prototype.lineTo=function(a,b){this.fa.push(M.Ee);this.fa.push(a);this.fa.push(b)};c.prototype.Ch=function(a,b){this.fa.push(M.Wi);this.fa.push(a);this.fa.push(b)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.fa.push(M.gg);
this.fa.push(d);this.fa.push(e);this.fa.push(a);this.fa.push(b)};c.prototype.tf=function(a,b,d,e){this.fa.push(M.ul);this.fa.push(d);this.fa.push(e);this.fa.push(a);this.fa.push(b)};c.prototype.bezierCurveTo=function(a,b,d,e,c,h){this.fa.push(M.jh);this.fa.push(c);this.fa.push(h);this.fa.push(a);this.fa.push(b);this.fa.push(d);this.fa.push(e)};c.prototype.arc=function(a,b,d,e,c,h){void 0===h&&(h=!0);var f=(new Dc(-c,a,b)).apply(a+d,b);this.fa.push(M.rl);this.fa.push(f.x);this.fa.push(f.y);this.fa.push(a);
this.fa.push(b);this.fa.push(d);this.fa.push(e);this.fa.push(c);this.fa.push(h?1:0)};c.prototype.arcTo=function(a,b,d,e,c){this.fa.push(M.sl);this.fa.push(d);this.fa.push(e);this.fa.push(a);this.fa.push(b);this.fa.push(c)};c.prototype.kq=function(){for(var a=[],b=0;b<this.fa.length;){for(var d=this.fa[b],e=0;e<M.bb[d];e+=2)a.push(new F(this.fa[b+1+e],this.fa[b+1+e+1]));b+=M.bb[d]+1}a=I.kh(a);return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.Gy=function(a,b){for(var d=0;d<this.fa.length;){for(var e=
this.fa[d],c=0;c<M.bb[e];c+=2)this.fa[d+1+c]+=a,this.fa[d+2+c]+=b;d+=M.bb[e]+1}};c.prototype.translate=function(){throw Error("Not implemented: translate");};c.prototype.scale=function(){throw Error("Not implemented: scale");};c.prototype.rotate=function(){throw Error("Not implemented: rotate");};c.prototype.closePath=function(){this.fa.push(M.Dc)};c.prototype.close=function(){this.closePath()};c.prototype.Ob=function(){return this.fa};return c}();N.prototype.change=N.prototype.pf;
N.prototype.moveTo=N.prototype.moveTo;N.prototype.lineTo=N.prototype.lineTo;N.prototype.curveTo=N.prototype.Ch;N.prototype.quadraticCurveTo=N.prototype.quadraticCurveTo;N.prototype.cornerTo=N.prototype.tf;N.prototype.bezierCurveTo=N.prototype.bezierCurveTo;N.prototype.arc=N.prototype.arc;N.prototype.arcTo=N.prototype.arcTo;N.prototype.getBoundingBox=N.prototype.kq;N.prototype.translateAll=N.prototype.Gy;N.prototype.closePath=N.prototype.closePath;N.prototype.close=N.prototype.close;
N.prototype.toArray=N.prototype.Ob;ed.kd("PathNode",M);N.prototype.beginPath=N.prototype.beginPath;N.prototype.change=N.prototype.pf;N.prototype.moveTo=N.prototype.moveTo;N.prototype.lineTo=N.prototype.lineTo;N.prototype.curveTo=N.prototype.Ch;N.prototype.quadraticTo=N.prototype.Hz;N.prototype.cornerTo=N.prototype.tf;N.prototype.bezierTo=N.prototype.Ft;N.prototype.arc=N.prototype.arc;N.prototype.arcTo=N.prototype.arcTo;N.prototype.getBoundingBox=N.prototype.kq;N.prototype.translate=N.prototype.translate;
N.prototype.closePath=N.prototype.closePath;N.prototype.close=N.prototype.close;N.prototype.toArray=N.prototype.Ob;var zd=function(){function c(a){this.Tc=a;this.ue=0;this.Dn=!0;this.kk=!1;this.path=new L;this.Nk=new L;this.log=y.create("DoubleLineAddon")}c.prototype.format=function(){this.log("Formatting doubleline; thickness=%s",this.Tc.ka("doubleLine"));var a=this.Tc.Pl(!1).ko(M.tl),b=this.Tc.Yu();if(0<b){var d=a.Kt();d>b&&(a=a.Mt(d-b))}a=a.ff();b=this.Tc.ka("doubleLine");this.path=new L;this.Nk=new L;d=this.Tc.ka("doubleLineDashSide");this.kk=!1;"outer"===d?(Sc(this.path,a,b,!0,!1),Sc(this.Nk,a,b,!1,!0),this.kk=
!0):"inner"===d?(Sc(this.path,a,b,!1,!0),Sc(this.Nk,a,b,!0,!1),this.kk=!0):Sc(this.path,a,b,!0,!0)};c.prototype.ia=function(a){a.beginPath();this.Tc.sc.length&&this.kk?(this.Nk.Ij(a,this.Tc.sc),this.path.ia(a)):this.Tc.sc.length?this.path.Ij(a,this.Tc.sc):this.path.ia(a)};return c}();var Ad=y.create("FitCurve");
function Bd(c){function a(a,b){H.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y);Ad("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",b[0].x,b[0].y,b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y)}function b(a,b){return a.x*b.x+a.y*b.y}function d(a){var b=1-a;return 3*a*b*b}function e(a){return 3*a*a*(1-a)}function f(a,b){var d=a.x-b.x,e=a.y-b.y;return Math.sqrt(d*d+e*e)}function h(a){return a.x*a.x+a.y*a.y}function k(a,b){var d=Math.sqrt(h(a));0!==d&&(a.x*=b/d,a.y*=b/d);return a}function l(a,b,d){void 0===
d&&Ad("Undef!");d.x=a.x+b.x;d.y=a.y+b.y;return d}function n(a,b){return{x:a.x+b.x,y:a.y+b.y}}function q(a,b){return{x:a.x*b,y:a.y*b}}function u(a,b){return{x:a.x-b.x,y:a.y-b.y}}function v(a,c,h,v,w,x){var z,C=[],D=[[],[]],G=[];var K=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var H=h-c+1;for(z=0;z<H;z++){var T={x:w.x,y:w.y};var X={x:x.x,y:x.y};k(T,d(v[z]));k(X,e(v[z]));C[z]=[T,X]}D[0][0]=0;D[0][1]=0;D[1][0]=0;D[1][1]=0;G[0]=0;for(z=G[1]=0;z<H;z++)D[0][0]+=b(C[z][0],C[z][0]),D[0][1]+=b(C[z][0],C[z][1]),
D[1][0]=D[0][1],D[1][1]+=b(C[z][1],C[z][1]),T=1-v[z],X=v[z],T=u(a[c+z],n(q(a[c],T*T*T),n(q(a[c],d(v[z])),n(q(a[h],e(v[z])),q(a[h],X*X*X))))),G[0]+=b(C[z][0],T),G[1]+=b(C[z][1],T);v=D[0][0]*D[1][1]-D[1][0]*D[0][1];z=D[0][0]*G[1]-D[0][1]*G[0];G=G[0]*D[1][1]-G[1]*D[0][1];0===v&&(v=D[0][0]*D[1][1]*1E-11);D=G/v;G=z/v;if(0>D||0>G)return D=f(a[h],a[c])/3,K[0]=a[c],K[3]=a[h],l(K[0],k(w,D),K[1]),l(K[3],k(x,D),K[2]),K;K[0]=a[c];K[3]=a[h];l(K[0],k(w,D),K[1]);l(K[3],k(x,G),K[2]);return K}function w(a,b,d){var e;
var c=[];for(e=0;e<=a;e++)c[e]={x:b[e].x,y:b[e].y};for(e=1;e<=a;e++)for(b=0;b<=a-e;b++)c[b].x=(1-d)*c[b].x+d*c[b+1].x,c[b].y=(1-d)*c[b].y+d*c[b+1].y;return c[0]}function x(a){var b=Math.sqrt(Math.sqrt(h(a)));0!==b&&(a.x/=b,a.y/=b);return a}function z(a,b,d,e,c){var f,k=(d-b+1)/2;var l=0;for(f=b+1;f<d;f++){var n=w(3,e,c[f-b]);n=u(n,a[f]);n=h(n);n>=l&&(l=n,k=f)}return{$q:l,ls:k}}function D(b,d,e,c,h,n){var q;var C=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var H=n*n;if(2===e-d+1)n=f(b[e],b[d])/3,C[0]=
b[d],C[3]=b[e],l(C[0],k(c,n),C[1]),l(C[3],k(h,n),C[2]),a(3,C);else{var K=[0];for(q=d+1;q<=e;q++)K[q-d]=K[q-d-1]+f(b[q],b[q-1]);for(q=d+1;q<=e;q++)K[q-d]/=K[e-d];var T=K;C=v(b,d,e,T,c,h);q=z(b,d,e,C,T);K=q.$q;q=q.ls;if(K<n)a(3,C);else{if(K<H||G)for(H=0;4>H;H++){q=b;K=d;var X=e;var gb=C;var Xa=[];for(C=K;C<=X;C++){var Ve=Xa,Mf=C-K,V,mb=gb,Db=q[C],Eb=T[C-K],Na=[];var Sa=[];var Fb=w(3,mb,Eb);for(V=0;2>=V;V++)Na[V]={x:0,y:0},Na[V].x=3*(mb[V+1].x-mb[V].x),Na[V].y=3*(mb[V+1].y-mb[V].y);for(V=0;1>=V;V++)Sa[V]=
{x:0,y:0},Sa[V].x=2*(Na[V+1].x-Na[V].x),Sa[V].y=2*(Na[V+1].y-Na[V].y);V=w(2,Na,Eb);Sa=w(1,Sa,Eb);Ve[Mf]=Eb-((Fb.x-Db.x)*V.x+(Fb.y-Db.y)*V.y)/(V.x*V.x+V.y*V.y+(Fb.x-Db.x)*Sa.x+(Fb.y-Db.y)*Sa.y)}X=Xa;C=v(b,d,e,X,c,h);q=z(b,d,e,C,X);K=q.$q;q=q.ls;if(K<n||G){a(3,C);return}T=X}X={x:0,y:0};H=u(b[q-1],b[q]);K=u(b[q],b[q+1]);X.x=(H.x+K.x)/2;X.y=(H.y+K.y)/2;H=X=x(X);D(b,d,q,c,H,n);H.x=-H.x;H.y=-H.y;D(b,q,e,H,h,n)}}}var G=!0;void 0===G&&(G=!1);var H=new L;H.moveTo(c[0].x,c[0].y);(function(a,b,d){var e=u(a[1],
a[0]);e=x(e);var c=b-1;c=u(a[c-1],a[c]);c=x(c);D(a,0,b-1,e,c,d)})(c,c.length,25);return H};var Cd=function(){function c(a,b){void 0===b&&(b="repeat");this.Pa=a;this.repeat=b}c.prototype.loaded=function(){return this.Pa instanceof HTMLImageElement?this.Pa.complete:!0};c.prototype.setTransform=function(){};return c}(),Dd=function(){function c(a,b,d,e){this.ty=[];this.from=new F(a,b);this.ha=new F(d,e)}c.prototype.addColorStop=function(a,b){this.ty.push({offset:a,rf:b})};return c}(),Fd=function(){function c(){this.stack=[];this.ta=new J;this.lineCap="butt";this.lineJoin="miter";this.lineWidth=
1;this.strokeStyle=this.fillStyle="#000000";this.textBaseline="top";this.font="10px arial";this.globalCompositeOperation="source-over";this.globalAlpha=1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor="rgba(0,0,0,0)"}c.prototype.save=function(){this.stack.push({ta:this.ta.clone(),fillStyle:this.fillStyle,font:this.font,lineJoin:this.lineJoin,lineCap:this.lineCap,lineWidth:this.lineWidth,strokeStyle:this.strokeStyle,textBaseline:this.textBaseline,globalCompositeOperation:this.globalCompositeOperation,
globalAlpha:this.globalAlpha,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,qf:this.Zo()})};c.prototype.restore=function(){var a=this.stack.pop();a&&(this.ta=a.ta,this.fillStyle=a.fillStyle,this.font=a.font,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.lineWidth=a.lineWidth,this.ta=a.ta,this.strokeStyle=a.strokeStyle,this.textBaseline=a.textBaseline,this.globalCompositeOperation=a.globalCompositeOperation,this.globalAlpha=
a.globalAlpha,this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor,this.cp(a.qf))};c.prototype.drawImage=function(a,b,d,e,c,h,k,l,n){var f=a.width,u=a.height,v=0,w=f,x=u;void 0!==e&&void 0!==c&&void 0!==h&&void 0!==k&&void 0!==l&&void 0!==n?(v=b,0-d,w=e,x=c,b=h,d=k,f=l,u=n):void 0!==e&&void 0!==c&&(f=e,u=c);this.Vo(a,v,0,w,x,b,d,f,u)};c.prototype.beginPath=function(){};c.prototype.closePath=function(){};c.prototype.arc=function(a,
b,d,e,c,h){h&&(h=e,e=c,c=h);for(;0>e;)e+=2*Math.PI;for(;0>c;)c+=2*Math.PI;e>c&&(e-=2*Math.PI);var f=2*Math.PI;var l=e%f;var n=c%f;n===l&&(n+=2*Math.PI);c=[];e=Math.PI/2;h=l<n?1:-1;var q=l;for(f=Math.min(f,Math.abs(n-l));1E-5<f;){l=q+h*Math.min(f,e);var u=(l-q)/2,v=d*Math.cos(u),w=d*Math.sin(u),x=.5522847498*Math.tan(u);n=v+x*w;v=-w+x*v;w=-v;x=u+q;u=Math.cos(x);x=Math.sin(x);c.push({bz:d*Math.cos(q),ec:d*Math.sin(q),cz:n*u-v*x,fc:n*x+v*u,dz:n*u-w*x,hz:n*x+w*u,ez:d*Math.cos(l),iz:d*Math.sin(l)});f-=
Math.abs(l-q);q=l}for(d=0;d<c.length;d++)e=c[d],0===d&&this.moveTo(e.bz+a,e.ec+b),this.bezierCurveTo(e.cz+a,e.fc+b,e.dz+a,e.hz+b,e.ez+a,e.iz+b)};c.prototype.arcTo=function(){};c.prototype.strokeRect=function(a,b,d,e){this.beginPath();this.rect(a,b,d,e);this.stroke()};c.prototype.setTransform=function(a,b,d,e,c,h){this.ta=new J(a,d,b,e,c,h)};c.prototype.transform=function(a,b,d,e,c,h){a=new J(a,d,b,e,c,h);this.ta=this.ta.multiply(a)};c.prototype.translate=function(a,b){this.transform(1,0,0,1,a,b)};
c.prototype.scale=function(a,b){this.transform(a,0,0,b,0,0)};c.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)};c.prototype.rect=function(a,b,d,e){this.beginPath();this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+e);this.lineTo(a,b+e);this.lineTo(a,b);this.closePath()};c.prototype.fillRect=function(a,b,d,e){this.rect(a,b,d,e);this.fill()};c.prototype.kg=function(a){return Ed(a)};c.prototype.createPattern=function(a,b){return new Cd(a,b)};c.prototype.createLinearGradient=
function(a,b,d,e){return new Dd(a,b,d,e)};return c}(),Gd=function(){function c(a){this.fontFamily="";this.fontSize=10;this.lineHeight=this.fontVariant=this.fontWeight=this.fontStyle="normal";a=Ed(a);this.fontFamily=a.fontFamily||"Arial";this.fontSize=parseFloat(a.fontSize);this.fontStyle=a.fontStyle;this.fontWeight=a.fontWeight;this.fontVariant=a.fontVariant;this.lineHeight=a.lineHeight}c.prototype.toString=function(){var a=this.fontSize+'px "'+this.fontFamily+'"';"bold"===this.fontWeight&&(a="bold "+
a);"italic"===this.fontStyle&&(a="italic"+a);return a};return c}();
function Ed(c){var a=null,b="10",d="normal",e="normal",f="normal",h="normal",k=!1;c=c.split(/\s+/);a:for(;;){var l=c.shift();if(!l)break;switch(l){case "normal":break;case "italic":case "oblique":d=l;break;case "small-caps":f=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":e=l;break;default:if(k){a=l;c.length&&(a+=" "+c.join(" "));2<a.length&&('"'===a.charAt(0)||"'"===a.charAt(0))&&(a=a.substr(1,a.length-
2));break a}else l=l.split("/"),b=l[0],k=!0,1<l.length&&(h=l[1])}}return{fontStyle:d,fontVariant:f,fontWeight:e,fontSize:b,lineHeight:h,fontFamily:a}};var Hd=function(){function c(){this.fa=[]}c.prototype.lineTo=function(a,b,d){a.apply(b,d);this.fa.push({yh:"L",Og:a.apply(b,d)})};c.prototype.moveTo=function(a,b,d){a.apply(b,d);this.fa.push({yh:"M",Og:a.apply(b,d)})};c.prototype.quadraticCurveTo=function(a,b,d,e,c){this.fa.push({yh:"Q",Og:a.apply(b,d),Mk:a.apply(e,c)})};c.prototype.bezierCurveTo=function(a,b,d,e,c,h,k){this.fa.push({yh:"C",Og:a.apply(b,d),Mk:a.apply(e,c),qn:a.apply(h,k)})};c.prototype.closePath=function(){this.fa.push({yh:"Z"})};
c.prototype.jo=function(a){a=a.inverse();for(var b="",d=0;d<this.fa.length;d++){var e=this.fa[d];0<d&&(b+=" ");b+=e.yh;if(e.Og){var c=a.apply(e.Og.x,e.Og.y);b+=c.x+","+c.y;e.Mk&&(c=a.apply(e.Mk.x,e.Mk.y),b+=","+c.x+","+c.y,e.qn&&(e=a.apply(e.qn.x,e.qn.y),b+=","+e.x+","+e.y))}}return b};return c}(),Id=function(c){function a(a){var b=c.call(this)||this;b.ta=new J;b.fa=[];b.path=new Hd;b.qf="";b.mc=[];b.Nb=0;b.log=y.create("SvgContext");b.lh=1;b.hg=2;b.wl=4;b.log("SVG context rect: %s",a);b.root=new Da("svg",
{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:zwibbler":"http://zwibbler.com/xml",version:1.2,baseProfile:"tiny",width:a.width,height:a.height,viewBox:a.x+" "+a.y+" "+a.width+" "+a.height});b.Ej=new Da("defs",{});b.root.$d(b.Ej);b.groups=[b.root];return b}__extends(a,c);a.prototype.rw=function(){return"clip"+this.Nb++};a.prototype.zi=function(a){a=new Da("g",a||{});this.Yl().$d(a);this.groups.push(a)};a.prototype.yi=function(){var a=this.groups.pop();if(a&&
1===a.children.length){var d=a.children[0];d.Hi(a.attributes);a.name=d.name;a.attributes=d.attributes;a.children=d.children;a.text=d.text}};a.prototype.Yl=function(){return this.groups[this.groups.length-1]};a.prototype.node=function(a,d,e,c){function b(a,b){if(b instanceof Cd)e[a]="url(#"+f.ll(b)+")";else if("string"===typeof b){var d=r.de(b),c=d.values[3];1>c&&(d.values[3]=1,e[a+"-opacity"]=""+c);e[a]=d.toString()}}void 0===e&&(e={});var f=this;this.ta.Rq()||(e.transform="matrix("+this.ta.m11+" "+
this.ta.m21+" "+this.ta.m12+" "+this.ta.m22+" "+this.ta.Da+" "+this.ta.Ea+")");d&this.lh?b("fill",this.fillStyle):e.fill="none";d&this.hg&&(b("stroke",this.strokeStyle),e["stroke-width"]=this.lineWidth,"miter"!==this.lineJoin&&(e["stroke-linejoin"]=this.lineJoin),"butt"!==this.lineCap&&(e["stroke-linecap"]=this.lineCap));d&this.wl&&(d=this.kg(this.font),e["font-weight"]=d.fontWeight,e["font-size"]=parseFloat(d.fontSize),e["font-style"]=d.fontStyle,e["font-family"]=d.fontFamily);""!==this.qf&&(e["clip-path"]=
"url(#"+this.qf+")");this.kt(new Da(a,e,c))};a.prototype.kt=function(a){var b=!0,e=null,c={},h,k=this.Yl();0===k.children.length?b=!1:e=k.children[k.children.length-1];!e||a.name===e.name&&a.text===e.text||(b=!1);if(b&&e)for(h in e.attributes)if(e.attributes.hasOwnProperty(h))if(h in a.attributes){var l=e.attributes[h],n=a.attributes[h];if(l!==n)if(0===h.indexOf("fill")||0===h.indexOf("stroke"))if("none"===l)c[h]=n;else if("none"===n)c[h]=l;else{b=!1;break}else{b=!1;break}}else c[h]=e.attributes[h];
if(b&&e)for(h in a.attributes)a.attributes.hasOwnProperty(h)&&(h in e.attributes||(c[h]=a.attributes[h]));b&&e?e.Hi(c):k.$d(a)};a.prototype.wk=function(a){if(a===this.hg){if(0===this.lineWidth)return!1;a=this.strokeStyle}else a=this.fillStyle;return a instanceof Cd?!0:"string"===typeof a?0<r.de(a).values[3]:!1};a.prototype.Xo=function(a){for(var b=0;b<this.mc.length;b++)if(this.mc[b].Zh===a)return this.mc[b].ti;return null};a.prototype.kl=function(a){var b=this.Xo(a);if(b)return b;b="image"+this.mc.length;
this.mc.push({Zh:a,ti:b});var e=document.createElement("canvas"),c=e.getContext("2d");e.width=a.width;e.height=a.height;c.drawImage(a,0,0);e=e.toDataURL();a=new Da("image",{id:b,x:0,y:0,width:a.width,height:a.height,"xlink:href":e});this.Ej.$d(a);return b};a.prototype.ll=function(a){var b=this.Xo(a);if(b)return b;var e=this.kl(a.Pa);b="pattern"+this.mc.length;this.mc.push({Zh:a,ti:b});var c=new Da("pattern",{id:b});"no-repeat"===a.repeat?(c.attributes.width="1",c.attributes.height="1"):"repeat-x"===
a.repeat?(c.attributes.patternUnits="userSpaceOnUse",c.attributes.width=a.Pa.width,c.attributes.height=1E4):("repeat-y"===a.repeat?(c.attributes.patternUnits="userSpaceOnUse",c.attributes.width=1E4):(c.attributes.patternUnits="userSpaceOnUse",c.attributes.width=a.Pa.width),c.attributes.height=a.Pa.height);c.$d(new Da("use",{"xlink:href":"#"+e}));this.Ej.$d(c);return b};a.prototype.toString=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n'+this.root.toString()};a.prototype.rs=function(){return Ca(this.toString())};
a.prototype.toBlob=function(){return new Blob([Ca(this.toString())],{type:"image/svg+xml"})};a.prototype.beginPath=function(){this.path=new Hd};a.prototype.transform=function(a,d,e,c,h,k){a=new J(a,e,d,c,h,k);this.ta=this.ta.multiply(a)};a.prototype.closePath=function(){this.path.closePath()};a.prototype.fill=function(){this.wk(this.lh)&&this.node("path",this.lh,{d:this.path.jo(this.ta)})};a.prototype.stroke=function(){this.wk(this.hg)&&this.node("path",this.hg,{d:this.path.jo(this.ta)})};a.prototype.moveTo=
function(a,d){this.path.moveTo(this.ta,a,d)};a.prototype.lineTo=function(a,d){this.path.lineTo(this.ta,a,d)};a.prototype.quadraticCurveTo=function(a,d,e,c){this.path.quadraticCurveTo(this.ta,a,d,e,c)};a.prototype.bezierCurveTo=function(a,d,e,c,h,k){this.path.bezierCurveTo(this.ta,a,d,e,c,h,k)};a.prototype.fillText=function(a,d,e){this.wk(this.lh)&&(this.kg(this.font),this.node("text",this.lh|this.wl,{x:d,y:e},a))};a.prototype.strokeText=function(a,d,e){this.wk(this.hg)&&(this.kg(this.font),this.node("text",
this.hg|this.wl,{x:d,y:e},a))};a.prototype.Vo=function(a,d,e,c,h,k,l,n,q){var b=document.createElement("canvas"),f=b.getContext("2d");b.width=c;b.height=h;f.drawImage(a,-d,-e);a=b.toDataURL();this.Yl().$d(new Da("image",{transform:"matrix("+this.ta.m11+" "+this.ta.m21+" "+this.ta.m12+" "+this.ta.m22+" "+this.ta.Da+" "+this.ta.Ea+")",x:k,y:l,width:n,height:q,"xlink:href":a}))};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};
a.prototype.dh=function(){};a.prototype.Zo=function(){return{name:this.qf}};a.prototype.cp=function(a){this.qf=a?a.name:""};a.prototype.clip=function(){var a=this.rw(),d=new Da("clipPath",{id:a});d.$d(new Da("path",{d:this.path.jo(this.ta)}));this.Ej.$d(d);this.qf=a;this.path=new Hd};return a}(Fd);function Jd(c,a,b,d,e,f){var h=!1;c.save();switch(b){case 0:case 3:var k=a.height;var l=a.width;break;default:k=a.width,l=a.height}switch(b){case 2:h=!0}c.translate(a.x,a.y);c.fillStyle="rgba(0, 0, 0, 0.2)";c.fillStyle="#ccc";c.fillRect(0,0,a.width,a.height);c.lineWidth=1;c.fillStyle="black";c.strokeStyle="black";c.font="10px sans-serif";a=Math.ceil(50/e);b=f/e;var n=Math.ceil(b/a)*a;f=n;c.beginPath();if(h)for(b=(n-b)*e;b<l;)c.moveTo(0,b),c.lineTo(k,b),h=f.toString()+d,c.fillText(h,0,b+1+10),f+=a,
b+=e*a;else for(b=(n-b)*e;b<l;)c.moveTo(b,k),c.lineTo(b,0),h=f.toString()+d,c.fillText(h,b+1,10),f+=a,b+=e*a;c.stroke();c.restore()};var Kd=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.je=d;b.pi=!0;b.width=32;b.height=500;b.Oz=0;b.Jb=new I(0,0,0,0);b.Fb=!1;b.Bt="#c0c0c0";b.xp="#808080";b.borderWidth=1;b.Pe=0;b.Oe=100;b.Bo=10;b.position=5;b.offset=0;b.log=y.create("SCROLLBAR",!0);b.pi=!0;b.canvas=qc(document.body);b.canvas.style.position="absolute";b.canvas.style.border="none";b.canvas.classList.add("zwibbler-scrollbar");b.canvas.classList.add("zwibbler-passthrough");b.za=b.canvas.getContext("2d");e.addEventListener(b.canvas,
"mousedown",function(a){b.yb(a)});e.addEventListener(document.body,"mousemove",function(a){b.tb(a)});e.addEventListener(document.body,"mouseup",function(a){b.Gb(a)});e.addEventListener(b.canvas,"touchstart",function(a){b.nn(a)});e.addEventListener(document.body,"touchmove",function(a){b.nn(a)});e.addEventListener(document.body,"touchend",function(a){b.nn(a)});b.format();return b}__extends(a,c);a.prototype.$c=function(a){a.appendChild(this.canvas)};a.prototype.moveTo=function(a,d){this.canvas.style.left=
""+a+"px";this.canvas.style.top=""+d+"px"};a.prototype.cf=function(a,d){this.width=a;this.height=d;this.canvas.width=this.width;this.canvas.height=d;this.format();this.ia()};a.prototype.ie=function(){this.canvas.style.display="none"};a.prototype.show=function(){this.canvas.style.display="block"};a.prototype.hw=function(){return"block"===this.canvas.style.display};a.prototype.gs=function(a,d,e,c){this.Pe=a;this.Oe=d-a;this.Bo=e;this.position=c;this.format();this.ia()};a.prototype.format=function(){var a=
this.je?this.width:this.height;var d=this.Bo/this.Oe*a;a*=(this.position-this.Pe)/this.Oe;this.Jb=this.je?new I(a,0,d-1,this.height-1):new I(0,a,this.width-1,d-1);this.Jb.x=Math.round(this.Jb.x)+.5;this.Jb.y=Math.round(this.Jb.y)+.5;this.Jb.width=Math.round(this.Jb.width);this.Jb.height=Math.round(this.Jb.height)};a.prototype.ia=function(){this.za.beginPath();this.za.fillStyle=this.Bt;this.za.strokeStyle=this.xp;this.za.lineWidth=this.borderWidth;this.za.rect(this.borderWidth/2,this.borderWidth/2,
this.width-this.borderWidth,this.height-this.borderWidth);this.za.fill();this.za.stroke();this.za.beginPath();this.za.fillStyle=this.xp;this.za.strokeStyle="#000000";this.za.rect(this.Jb.x,this.Jb.y,this.Jb.width,this.Jb.height);this.za.fill();this.za.stroke()};a.prototype.Yp=function(a){var b=A(this.canvas).Wb(),e=0,c=0;if("touchstart"===a.type||"touchend"===a.type||"touchmove"===a.type)e=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY;else if("mousedown"===a.type||"mouseup"===a.type||"mousemove"===
a.type)e=a.pageX,c=a.pageY;return new F(e-b.left,c-b.top)};a.prototype.nn=function(a){switch(a.type){case "touchstart":this.yb(a);break;case "touchend":this.Gb(a);break;case "touchmove":this.tb(a)}};a.prototype.Cr=function(a){a=this.je?a.x/this.width*this.Oe+this.Pe:a.y/this.height*this.Oe+this.Pe;a=Math.min(a,this.Oe-this.Bo+this.Pe);return a=Math.max(a,this.Pe)};a.prototype.yb=function(a){a.preventDefault();a=this.Yp(a);this.Jb.bd(a.x,a.y)?this.je?(this.offset=a.x-this.Jb.x,a.x-=this.offset):(this.offset=
a.y-this.Jb.y,a.y-=this.offset):(this.position=this.Cr(a),this.offset=0,this.je?this.Jb.x=(this.position-this.Pe)/this.Oe*this.width:this.Jb.y=(this.position-this.Pe)/this.Oe*this.height,this.na("scroll",this.position),this.ia());this.Fb=!0};a.prototype.tb=function(a){this.Fb&&(this.Fb&&"mousemove"===a.type&&0===a.buttons?this.Fb=!1:(a.preventDefault(),a=this.Yp(a),this.je?a.x-=this.offset:a.y-=this.offset,this.position=this.Cr(a),this.na("scroll",this.position),this.format(),this.ia()))};a.prototype.Gb=
function(){this.Fb&&(this.Fb=!1)};a.prototype.Cg=function(){return this.je?this.height:this.width};a.sz=0;a.qz=1;a.mz=2;a.rz=3;return a}(Ab);var Ld={type:"translate",position:new F(0,0),offset:new F(0,0),Gf:""},Md={type:"translate",position:new F(0,0),offset:new F(0,0),Gf:""},Nd={type:"translate",position:new F(0,0),offset:new F(0,0),Gf:""},Od=function(){function c(a,b,d){this.ef=a;this.ta=b;this.Ja=d}c.prototype.fk=function(a,b){void 0===a&&(a=this.ta);void 0===b&&(b=1);var d=a.Yb();return new F(this.Ja.x+this.Ja.width*this.ef.position.x+this.ef.offset.x/d.x/b,this.Ja.y+this.Ja.height*this.ef.position.y+this.ef.offset.y/d.y/b)};c.prototype.ak=
function(){var a=this.fk();return this.ta.apply(a.x,a.y)};c.prototype.ia=function(a,b,d,e){a.save();e=e.multiply(this.ta);var c=e.Yb();c.x=1/c.x/d;c.y=1/c.y/d;d=this.fk(e,d);e=e.multiply(new Ec(c.x,c.y,d.x,d.y));e.dg(a);(b=b.get(this.ef.Gf))?(e=b.width,c=b.height,a.drawImage(b,d.x-e/2,d.y-c/2,e,c)):this.fm(a,d);a.restore()};c.prototype.fm=function(a,b){a.strokeStyle="red";a.lineWidth=1;a.strokeRect(b.x-10,b.y-10,20,20)};c.prototype.xb=function(a,b,d,e,c){var f=a.get(this.ef.Gf);a=this.fk(this.ta,
c);b=this.ta.inverse().apply(b,d);d=this.ta.Yb();d.x*=c;d.y*=c;f?(e=f.height,c=f.width/2/d.x,e=e/2/d.y):(c=e/d.x,e/=d.y);return(new I(a.x-c,a.y-e,2*c,2*e)).bd(b.x,b.y,0)};c.prototype.click=function(){return!1};return c}(),Pd=function(c){function a(a,d,e,f){a=c.call(this,a,d,e)||this;a.origin=f;return a}__extends(a,c);a.prototype.Fg=function(a){var b=1,e=1,c=this.ta.inverse(),h=this.ak(),k=this.fk();a=c.apply(h.x+a.x,h.y+a.y);k=new F(k.x-this.origin.x,k.y-this.origin.y);a=new F(a.x-this.origin.x,a.y-
this.origin.y);a=(a.x*k.x+a.y*k.y)/(k.x*k.x+k.y*k.y);0!==k.x&&0!==k.y?e=b=a:0!==k.x?b=a:e=a;return this.ta.multiply(new Ec(b,e,this.origin.x,this.origin.y)).multiply(c)};a.prototype.fm=function(a,d){a.beginPath();a.strokeStyle="#000";a.lineWidth=1;a.rect(d.x-4,d.y-4,8,8);a.stroke()};return a}(Od),Qd=function(c){function a(a,d,e,f,h){a=c.call(this,a,d,e)||this;a.wj=h;a.log=y.create("RotationSelHandle");d=a.ak();a.origin=a.ta.apply(f.x,f.y);a.Zn=Math.atan2(d.y-a.origin.y,d.x-a.origin.x);a.wj=h;return a}
__extends(a,c);a.prototype.Fg=function(a){var b=this.ak();a=Math.atan2(b.y+a.y-this.origin.y,b.x+a.x-this.origin.x)-this.Zn;this.wj&&(b=Math.PI/16,a=Math.floor(a/b)*b);return new Dc(-a,this.origin.x,this.origin.y)};a.prototype.fm=function(a,d){a.beginPath();a.strokeStyle="#008000";a.lineWidth=3;a.moveTo(d.x,d.y);a.arc(d.x,d.y,6,0,1.5*Math.PI,!1);a.stroke()};return a}(Od),Rd=function(c){function a(a,d){return c.call(this,a,d,new I(0,0,0,0))||this}__extends(a,c);a.prototype.Fg=function(a){return new Cc(a.x,
a.y)};return a}(Od),Sd=function(c){function a(){return c.call(this,Nd,new J,new I(0,0,0,0))||this}__extends(a,c);a.prototype.Fg=function(){return new J};return a}(Od),Td=function(c){function a(a,d,e){return c.call(this,a,d,e)||this}__extends(a,c);a.prototype.click=function(){this.ef.Bp&&this.ef.Bp();return!0};a.prototype.Fg=function(){return new J};return a}(Od);
function Ud(c,a,b,d){var e=void 0,f=new F(0,0),h=b.Yb();f.x=a.x+a.width*c.position.x+c.offset.x/h.x;f.y=a.y+a.height*c.position.y+c.offset.y/h.y;switch(c.type){case "translate":return new Rd(c,b);case "scale":return e||(e=new F(a.right()-c.position.x*a.width,a.bottom()-c.position.y*a.height)),new Pd(c,b,a,e);case "rotate":return e||(e=a.Ed()),new Qd(c,b,a,e,d||!1);case "click":return new Td(c,b,a)}};var Vd=y.create("SNAPPER");function Wd(c){switch(c){case 33:return"n-resize";case 34:return"e-resize";case 36:return"s-resize";case 40:return"w-resize";case 25:return"nw-resize";case 19:return"ne-resize";case 28:return"sw-resize";case 22:return"se-resize";case 1:case 4:case 8:case 2:return"move"}return"default"}function Xd(c,a){return{id:c,hc:2,x:a.x+a.width,ec:a.y,fc:a.y+a.height}}function Yd(c,a){return{id:c,hc:4,x:a.y+a.height,ec:a.x,fc:a.x+a.width}}
var Zd=function(){function c(){this.Ff=[];this.hh=[]}c.prototype.clear=function(){this.Ff.length=0;this.hh.length=0};c.prototype.lp=function(a,b){this.Ff.push({id:b,hc:1,x:a.y,ec:a.x,fc:a.x+a.width});this.Ff.push(Yd(b,a));this.hh.push({id:b,hc:8,x:a.x,ec:a.y,fc:a.y+a.height});this.hh.push(Xd(b,a))};c.prototype.qy=function(a,b){var d=8;void 0===d&&(d=10);var e=this.oj(this.hh,{id:b,hc:8,x:a.x,ec:a.y,fc:a.y+a.height},Number.MAX_VALUE);e=this.oj(this.hh,Xd(b,a),e);var c=this.oj(this.Ff,{id:b,hc:1,x:a.y,
ec:a.x,fc:a.x+a.width},Number.MAX_VALUE);c=this.oj(this.Ff,Yd(b,a),c);return{x:Math.abs(e)<d?e:0,y:Math.abs(c)<d?c:0}};c.prototype.Fm=function(a,b){var d=10;void 0===d&&(d=10);var e=[];this.qs(e,this.hh,a,b,d);this.qs(e,this.Ff,b,a,d);e.reverse();return e};c.prototype.qs=function(a,b,d,e,c){for(var f=c*c,k=0;k<b.length;k++){var l=b[k],n=Math.abs(d-l.x),q=Number.MAX_VALUE,u=0;if(!(n>c||e<l.ec-c||e>l.fc+c)){if(e>l.ec+c&&e<l.fc-c){var v=n*n;v<q&&(q=v,u=l.hc)}v=.5*(l.ec+l.fc);v=n*n+(e-v)*(e-v);v<f&&(q=
v,u=l.hc|32);b===this.Ff&&(v=n*n+(e-l.ec)*(e-l.ec),v<q&&(q=v,u=l.hc|24),v=n*n+(e-l.fc)*(e-l.fc),v<q&&(q=v,u=l.hc|18));q<f&&a.push({id:l.id,hc:u})}}};c.prototype.oj=function(a,b,d){for(var e=0;e<a.length;e++){var c=a[e],h=c.x-b.x;Math.abs(h)>Math.abs(d)||b.id===c.id||50>(b.fc<c.ec?c.ec-b.fc:b.ec>c.fc?b.ec-c.fc:0)&&(d=h)}return d};return c}();var $d={fontStyle:null,fontWeight:"normal",fontSize:12,fontFamily:"Times New Roman",colour:"black",align:"left",background:"none",underline:!1},ae={fontStyle:"fs",fontWeight:"fw",fontSize:"fh",fontFamily:"ff",colour:"fc",align:"ta",background:"fb",underline:"fu"},be=function(){function c(a){this.sa=a;this.options={}}c.prototype.Hy=function(){var a=new c(this.sa),b;for(b in $d)$d.hasOwnProperty(b)&&(a.options[b]=this.get(b));return a};c.prototype.zy=function(){var a={},b;for(b in this.options)this.options.hasOwnProperty(b)&&
(a[b]=this.options[b]);return a};c.prototype.apply=function(a){a.fillStyle=this.get("colour");a.font=this.ev()};c.prototype.empty=function(){var a=0,b;for(b in this.options)this.options.hasOwnProperty(b)&&(a+=1);return 0===a};c.prototype.Pj=function(a,b){var d=c.Pj(a,b);return d.empty()?this:d};c.prototype.eh=function(a){c.eh(this.options,a)};c.prototype.set=function(a,b){this.options[a]=b};c.prototype.get=function(a){return a in this.options?this.options[a]:this.sa[a]};c.prototype.has=function(a){return a in
this.options};c.prototype.Hf=function(a){for(var b in a.options){var d=this.get(b),c=a.get(b);d!==c&&this.set(b,c)}};c.prototype.clone=function(){var a=new c(this.sa);a.Hf(this);return a};c.prototype.ev=function(){var a=this.get("fontStyle"),b=this.get("fontWeight"),d=this.get("fontSize"),c=this.get("fontFamily");this.get("colour");var f=[];a&&f.push(a);b&&f.push(b);f.push(d+"px");f.push(c);return f.join(" ")};c.prototype.Nc=function(a){if(this===a)return!0;for(var b in this.options)if(!(b in a.options)||
a.options[b]!==this.options[b])return!1;for(b in a.options)if(!(b in this.options))return!1;return!0};c.prototype.Fj=function(a){var b=new c(this.sa),d;for(d in $d)$d.hasOwnProperty(d)&&a.get(d)!==this.get(d)&&(b.options[d]=this.get(d));return b};c.prototype.toString=function(){var a=[],b;for(b in this.options)a.push(b+"="+this.options[b]);return a.join(",")};return c}();
(function(c){c.Pj=function(a,b){void 0===b&&(b="");var d=new c($d);switch(b){case "B":d.set("fontWeight","bold");break;case "I":d.set("fontStyle","italic");break;case "U":d.set("underline",!0)}for(var e in a){var f=a[e];if("textDecoration"===e)d.set("underline",0<=f.indexOf("underline"));else if(""!==f)switch(e){case "fontStyle":case "fontFamily":case "fontWeight":case "background":d.set(e,f);break;case "fontSize":d.set(e,parseFloat(f)||2);break;case "textAlign":d.set("align",f);break;case "color":d.set("colour",
f)}}return d};c.eh=function(a,b){for(var d in a){var c=a[d];switch(d){case "fontStyle":case "fontFamily":case "fontWeight":case "background":b[d]=c;break;case "fontSize":b[d]=c+"px";break;case "align":b.textAlign=c;break;case "colour":b.color=c;break;case "underline":b.textDecoration=c?"underline":""}}return b}})(be||(be={}));var ce=be;y.create("TEXTWRITER");var de=function(){function c(){this.un=null;this.Lk=[]}c.prototype.bo=function(){};c.prototype.jm=function(){this.Lk.push("\n")};c.prototype.Ds=function(a){this.un=a=this.un?a.Fj(this.un):a.Hy();a=a.zy();for(var b in a)a.hasOwnProperty(b)&&this.Lk.push("/"+ae[b]+a[b]+";")};c.prototype.Es=function(a){a=a.replace(/\//g,"//");this.Lk.push(a)};c.prototype.toString=function(){return this.Lk.join("")};return c}();
function ee(c,a){for(var b=0,d="",e="",f="",h=0;h<c.length;h++){var k=c.charAt(h);switch(b){case 0:"/"===k?b=1:d+=k;break;case 1:"/"===k?(d+=k,b=0):(--h,d.length&&(a("text",d.replace(/\/\//g,"/")),d=""),e="",b=2);break;case 2:e+=k;2===e.length&&(b=3,f="");break;case 3:";"===k?(a(e,f),b=0):f+=k}}d.length&&a("text",d.replace(/\/\//g,"/"))};var fe=y.create("InlineItem"),ge=function(){function c(a){this.style=a;this.index=0}c.prototype.count=function(){return 1};c.prototype.$a=function(a){fe("Asked to set %s",a);this.style=this.style.clone();this.style.Hf(a);fe("After merge: %s",this.style)};c.prototype.tk=function(){};c.prototype.split=function(){return null};c.prototype.Nh=function(){return{width:0,height:0,ci:0,It:!0,br:!1}};c.prototype.Eg=function(){return""};return c}();y.create("TextItem");
var he=function(c){function a(a,d){var b=c.call(this,a)||this;b.text=d;return b}__extends(a,c);a.prototype.count=function(){return this.text.length};a.prototype.split=function(b){if(0<b&&b<this.text.length){var d=this.text.substr(b);this.text=this.text.substr(0,b);return new a(this.style.clone(),d)}return null};a.prototype.Nh=function(a,d){var b=this.text.charAt(d);return{width:a?a.measureText(b).width:0,height:this.style.get("fontSize"),ci:0,It:" "===b||"-"===b,br:"\n"===b}};a.prototype.Eg=function(a,
d){return this.text.substr(a,d)};return a}(ge);var ie=y.create("TEXTSEQ"),je=function(){function c(a){this.style=a;this.children=[];this.length=this.ig=0;this.te=null}c.mh=function(a){var b=new ce($d),d=new c(b),e={},f;for(f in ae)ae.hasOwnProperty(f)&&(e[ae[f]]=f);ee(a,function(a,c){var f=c;a in e?("fh"===a&&(f=parseFloat(f)),"null"===f&&(f=null),b.set(e[a],f)):"text"===a?d.append([new he(b.clone(),f)]):ie("Bad key: %s",a)});return d};c.prototype.save=function(a,b,d){var c=!1;this.Tq(a,b,function(a,b,e){d.Ds(a.style);a=a.Eg(b,e);b=0;for(e=a.split("\n");b<
e.length;b++){var f=e[b];if(""===f){if(c||d.bo(),d.jm(),c=!1,"\n"===a)break}else c||(d.bo(),c=!0),d.Es(f)}});c&&d.jm();return d};c.prototype.append=function(a){this.tk(this.ig,a)};c.prototype.tk=function(a,b){ie("Insert %s item at index %s",b.length,a);var d,c=0;for(d=0;d<this.children.length;d++){var f=this.children[d];var h=f.count();if(c===a){ie("Found proper position");break}else if(c+h>a){ie("Splitting item from %s..(%s)..%s",f.index,a,f.index+h);this.fj(d,a-c);c=a;d+=1;break}c+=h}for(this.children.splice.apply(this.children,
[d,0].concat(b));d<this.children.length;d++)f=this.children[d],h=f.count(),ie("Bump item %s index %s->%s length=%s",d,f.index,c,h),f.index=c,c+=h,ie("   item %s: %s/%s",d,f.index,f.count());this.ig=c;this.length=this.children.length;this.te=null};c.prototype.remove=function(a,b){var d=[];if(0===this.children.length)return d;this.fp(a);this.fp(a+b);for(var c=this.Rh(a),f,h=c.item.index,k=c.index;k<this.children.length;k++){var l=this.children[k];f=l.count();h+f<=a+b?d.push(l):l.index=h-b;h+=f}this.children.splice(c.index,
d.length);this.length-=d.length;this.ig-=b;this.te=null;return d};c.prototype.count=function(){return this.ig};c.prototype.Rh=function(a){for(var b=0,d=0;d<this.children.length;d++)if(b+=this.children[d].count(),b>a)return{index:d,item:this.children[d]};if(this.children.length)return{index:this.children.length-1,item:this.children[this.children.length-1]};throw Error("getItemAt() on empty sequence.");};c.prototype.fj=function(a,b){var d=this.children[a],c=d.split(b);c&&(c.index=d.index+d.count(),
this.children.splice(a+1,0,c),this.length+=1,ie("Split %s..%s..%s",d.index,c.index,c.index+c.count()));return c};c.prototype.fp=function(a){var b=this.Rh(a);b&&b.item.index<a&&this.fj(b.index,a-b.item.index)};c.prototype.dk=function(a){return 0===this.length?this.style:this.Rh(a).item.style};c.prototype.Bq=function(a,b){var d=[],c=0,f=0,h=null,k=0;if(0===b)return d.push({start:a,length:0,style:this.dk(a)}),d;for(var l=0;l<this.children.length;l++){var n=this.children[l];var q=n.count();k+=q;if(k>
a){null===h&&(h=n.style,c=n.index);var u=n.style.Nc(h);u&&(f+=q);if(!u||k>=b)d.push({start:c,length:f,style:h}),c=n.index,f=0;if(k>=a+b)break}}return d};c.prototype.by=function(a){for(var b=0;b<a.length;b++){var d=a[b];this.$a(d.style,d.start,d.length)}};c.prototype.$a=function(a,b,d){var c=0,f=b+d;ie("setStyle: %s:%s %s",b,d,a);for(d=0;d<this.children.length;d++){var h=this.children[d],k=h.count();c<b&&b<c+k?this.fj(d,b-c)?k=b-c:(h.$a(a),ie("Case 1")):b<=c&&f<c+k&&f>c?(this.fj(d,f-c),k=f-c,h.$a(a),
ie("Case 2")):b<=c&&c+k<=f&&(h.$a(a),ie("Case 3: fromChar=%s..%s count=%s..%s",b,f,c,c+k));c+=k}};c.prototype.Dx=function(a,b,d){for(var c=b;;){b=this.Nh(null,a);if(d(b)){a+=1;break}else if(0===a)break;--a}for(;;){b=this.Nh(null,c);if(d(b))break;else if(c>=this.ig-1)break;c+=1}return{start:a,length:c-a}};c.prototype.Ov=function(a,b){return this.Dx(a,b,function(a){return a.br})};c.prototype.Nh=function(a,b){if(0===this.length)throw Error("error: expected to have child items");if(null===this.te||b<
this.te.index||b>=this.te.index+this.te.count())this.te=this.Rh(b).item;return this.te.Nh(a,b-this.te.index)};c.prototype.Eg=function(a,b){var d="";this.Tq(a,b,function(a,b,c){console.log("Iterate: ",a,b,c);d+=a.Eg(b,c)});return d};c.prototype.Tq=function(a,b,d){var c=a+b;if(0!==b){var f=this.Rh(a);if(f)for(b=f.item,f=f.index;a<c;){var h=Math.min(b.count(),c-a);d(b,a-b.index,h);a+=h;f+=1;if(f===this.children.length)break;b=this.children[f]}}};return c}();var ke=y.create("SpliceText"),le=function(c){function a(a,d,e,f,h){var b=c.call(this)||this;b.Mb=a;b.text=d;b.start=e;b.length=f;b.style=h;b.pe=[];return b}__extends(a,c);a.prototype.Hf=function(b){if(!(b instanceof a))return!1;ke("?merge(%s,%s,%s) and (%s,%s,%s)",this.start,this.length,this.text.substr(0,5),b.start,b.length,b.text.substr(0,5));return 0===this.length&&0===b.length&&this.start+this.text.length===b.start&&(null===this.style&&null===b.style||null!=this.style&&null!==b.style&&this.style.Nc(b.style))?
(this.text+=b.text,ke("Merging SpliceTextAction"),!0):0!==this.text.length||0!==b.text.length||this.start!==b.start&&b.start+b.length!==this.start?!1:(this.length+=b.length,this.start<b.start?this.pe=this.pe.concat(b.pe):(this.pe=b.pe.concat(this.pe),this.start=b.start),ke("Merging Deletes"),!0)};a.prototype.md=function(){ke("Execute SpliceTextAction(del=%s/%s insert %s...)",this.start,this.length,this.text.substr(0,5));this.Mb.ji(this.start);0<this.length&&(ke("Removing text"),this.pe=this.Mb.text.remove(this.start,
this.length));if(0<this.text.length){if(null===this.style)throw Error("style is null");var a=new he(this.style,this.text);this.Mb.text.tk(this.start,[a])}};a.prototype.Ac=function(){ke("Undo SpliceTextAction(del=%s/%s insert %s)",this.start,this.length,this.text);0<this.text.length&&this.Mb.text.remove(this.start,this.text.length);this.pe.length&&this.Mb.text.tk(this.start,this.pe);this.Mb.ji(this.start)};return a}(jb);var me=y.create("UNDO"),ne=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.Mb=a;b.from=d;b.length=e;b.style=f;b.kn=[];return b}__extends(a,c);a.prototype.md=function(){me("Do apply style");this.Mb.ji(this.from);this.kn=this.Mb.text.Bq(this.from,this.length);this.Mb.text.$a(this.style,this.from,this.length)};a.prototype.Ac=function(){me("Undo apply style");console.log(this.kn);this.Mb.ji(this.from);this.Mb.text.by(this.kn)};a.prototype.Hf=function(){return!1};return a}(jb);var oe=y.create("TextEditor"),pe=function(c){function a(a,d){var b=c.call(this)||this;b.Bc=a;b.sa=d;b.sh=0;b.qg=0;b.Je=null;b.qj=0;b.active=!1;b.text=new je(d);return b}__extends(a,c);a.prototype.setActive=function(a){this.active=a;oe("setActive: %s",this.active)};a.prototype.Uh=function(){return Math.min(this.sh,this.qg)};a.prototype.Th=function(){return Math.max(this.sh,this.qg)};a.prototype.save=function(a,d){void 0===a&&(a=0);void 0===d&&(d=this.text.length);return this.text.save(a,d,new de).toString()};
a.prototype.Wc=function(a,d){void 0===d&&(d=a);this.qg=a;this.sh=d;this.xg("selchange")};a.prototype.fb=function(){this.Wc(0,0)};a.prototype.exec=function(a,d){var b=this.qg;switch(a){case "bold":this.fl("fontWeight","bold","normal");return;case "italic":this.fl("fontStyle","italic","normal");return;case "underline":this.fl("underline",!0,!1);return;case "orange":this.fl("background","orange","transparent");return;case "undo":oe("Processing undo");this.Bc.Ac(this);this.Wc(b);return;case "redo":oe("Processing redo");
this.Bc.Qd(this);this.Wc(b);return;case "font":this.jj("fontFamily",d);return;case "fontSize":"string"===typeof d&&(d=parseFloat(d)||2);this.jj("fontSize",d);return;case "align":this.jj("align",d);break;case "delete":oe("Delete text");this.An(!1);return;case "backspace":oe("Delete text backspace");this.An(!0);return;case "select-none":this.Wc(b,b);return}this.af()};a.prototype.fl=function(a,d,c){var b=this.Uh();b=this.text.Bq(b,this.Th()-b);for(var e,k=0;k<b.length&&(e=b[k].style,e.get(a)===d);k++);
this.jj(a,k<b.length?d:c)};a.prototype.Nq=function(a){var b=this.Uh(),c=this.Th()-b;a=a.replace("\r","\n");oe("Delete %s/%s Insert char %s...",b,c,a.substr(0,5));if(this.Je&&this.qj===b&&0===c){var f=this.Je;oe("Using recording caret style: %s",f)}else f=0===c&&0<b?this.text.dk(b-1):this.text.dk(b);this.Bc.ua(new le(this,a,b,c,f),!1,this);this.Wc(b+a.length,b+a.length);this.Je=null};a.prototype.jj=function(a,d){if("string"===typeof a){var b=new ce($d);b.set(a,d||"")}else b=a;if(b.empty())oe("apply empty style; ignore");
else{var c=this.Uh(),h=this.Th(),k=[];if(b.has("align")){var l=new ce($d);l.set("align",b.get("align"));var n=this.text.Ov(c,h);0<n.length&&(oe("Apply paragraph style to %s:%s %s",n.start,n.start+n.length,b),k.push(new ne(this,n.start,n.length,l)))}oe("applystyle called set %s:%s %s",c,h,b);c!==h?k.push(new ne(this,c,h-c,b)):(this.Je=null===this.Je||this.qj!==c?this.text.dk(c).clone():this.Je.clone(),this.Je.Hf(b),this.qj=c,oe("Recording new caret style: %s",this.Je));this.Bc.ua(k,!1,this)}};a.prototype.An=
function(a){var b=this.Uh(),c=this.Th()-b;oe("Delete %s characters (totalCount=%s)",c,this.text.count());c?(this.Bc.ua(new le(this,"",b,c,null),!1,this),this.Wc(b)):a&&0<b?(this.Bc.ua(new le(this,"",b-1,1,null),!1,this),this.Wc(b-1)):b<this.text.count()&&this.Bc.ua(new le(this,"",b,1,null),!1,this);this.qj=-1};a.prototype.Sv=function(){var a=this.Uh(),d=this.Th()-a;oe("getSelectedText()=%s",this.text.Eg(a,d));return this.text.Eg(a,d)};a.prototype.Kf=function(a){var b=this;oe("Received clipboard event: %s",
a.type);switch(a.type){case "copy":case "cut":oe("Cut/Copy to system clipboard.");var c=this.Sv();oe("text=%s",c);c.length&&(a.clipboardData.setData("text/plain",c),a.preventDefault(),"cut"===a.type&&this.An(!1));break;case "paste":for(oe("There are %s items on the clipboard",a.clipboardData.items.length),c=0;c<a.clipboardData.items.length;c++){var f=a.clipboardData.items[c];oe("Item [%s] type is %s",c,f.type);"text/plain"===f.type&&f.getAsString(function(a){b.Nq(a)})}}};a.prototype.ji=function(){};
a.prototype.af=function(){};return a}(Ab);var qe=y.create("HTMLTextEditor"),ve=function(c){function a(a,d,e){void 0===e&&(e={});var b=c.call(this,new kb,(new ce($d)).Pj(window.getComputedStyle(d),d.tagName))||this;b.ba=d;b.options=e;b.tc=new Bb;b.iy(a);a.addEventListener(document,"selectionchange",function(){b.Tw()});a.addEventListener(document,"cut",function(a){b.Kf(a)});a.addEventListener(document,"copy",function(a){b.Kf(a)});a.addEventListener(document,"paste",function(a){b.Kf(a)});re(b.text,d,b.sa);b.af();b.oa("reformat",function(){b.af()});
return b}__extends(a,c);a.prototype.Sx=function(a){this.ba.innerHTML=a;this.text=new je(this.sa);re(this.text,this.ba,this.sa);A(this.ba).clear();a=this.text;var b=this.ba,c=this.sa;a.save(0,a.count(),new se(b,c));this.Wc(0,0)};a.prototype.iy=function(a){var b=this;this.tc.map("ctrl+b,cmd+b","bold");this.tc.map("ctrl+i,cmd+i","italic");this.tc.map("ctrl+u,cmd+u","underline");this.tc.map("ctrl+z,cmd+z","undo");this.tc.map("ctrl+shift+z,cmd+shift+z","redo");this.tc.map("delete","delete");this.tc.map("backspace",
"backspace");this.tc.oa("*",function(a,d){qe("Keyboard event: ",a);d.preventDefault();d.stopPropagation();b.exec(a)});this.tc.up(this.ba);a.add(function(){b.tc.detach(b.ba)});a.addEventListener(this.ba,"keypress",function(a){var d=a.charCode;13===d&&b.options.Un&&!a.shiftKey?b.na("enter"):(b.Nq(String.fromCharCode(d)),a.preventDefault(),b.af())})};a.prototype.setActive=function(a){c.prototype.setActive.call(this,a);a?(this.ba.setAttribute("contenteditable","TRUE"),this.ba.focus()):(this.ba.setAttribute("contenteditable",
"FALSE"),this.ba.blur())};a.prototype.Tw=function(){if(this.active){var a=document.getSelection();if(null===a)this.fb();else if(null===a.focusNode||null===a.anchorNode)this.fb();else if(a.anchorNode===this.ba)qe("Select-all %s..%s",0,this.text.length),c.prototype.Wc.call(this,0,this.text.count());else{var d=te(this.ba,a.anchorNode,a.anchorOffset);a=te(this.ba,a.focusNode,a.focusOffset);-1!==d&&-1!==a&&(0===this.text.count()&&(a=d=0),a!==this.qg||d!==this.sh)&&(c.prototype.Wc.call(this,a,d),qe("Selected %s..%s",
d,a))}}};a.prototype.Wc=function(a,d){void 0===d&&(d=a);qe("self-set caret position: %s..%s",d,a);c.prototype.Wc.call(this,a,d);var b=ue(this.ba,a),f=ue(this.ba,d),h=document.createRange();d<=a?(h.setStart(f.node,f.offset),h.setEnd(b.node,b.offset)):(h.setStart(b.node,b.offset),h.setEnd(f.node,f.offset));if(b=window.getSelection())b.removeAllRanges(),b.addRange(h)};a.prototype.ji=function(a){qe("Mark for reformat: %s",a);this.xg("reformat")};a.prototype.af=function(){A(this.ba).clear();var a=this.text,
d=this.ba,c=this.sa;a.save(0,a.count(),new se(d,c));this.options.placeholder&&0===this.text.count()&&(a=A("div").$a({opacity:"0.5"}).ah(this.options.placeholder).$c(this.ba).ba,this.sa.eh(a.style));this.Wc(this.qg,this.sh)};a.prototype.exec=function(a,d){c.prototype.exec.call(this,a,d);this.af()};return a}(pe);
function te(c,a,b){function d(c){if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));if(c===a)return c instanceof Element&&c.children[0]&&"BR"===c.children[0].tagName&&1===b&&--e,h=!0;"DIV"===c.tagName&&(f=!0);for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){if(c===a)return h=!0;c=we(c.nodeValue,f);e+=c.length;c.length&&(f=!1)}}var e=0,f=!0,h=!1;for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return h?e+b:-1}
function ue(c,a){function b(c){d=c;f=0;if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));"DIV"===c.tagName&&(h=!0);for(c=c.firstChild;c&&!b(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){c=we(c.nodeValue,h);if(e+c.length>=a)return f=a-e,!0;e+=c.length;c.length&&(h=!1)}}for(var d=c,e=0,f=0,h=!0,k=c.firstChild;k&&!b(k);)k=k.nextSibling;return{node:d,offset:f}}
function we(c,a){for(var b="",d=a,e=0;e<c.length;e++){var f=c[e];switch(f){case " ":case "\n":case "\r":case "\t":d||(b+=" ",d=!0);break;default:b+=f,d=!1}}return b}
function re(c,a,b){function d(a,b){if(a.nodeType===Node.ELEMENT_NODE){switch(a.tagName){case "DIV":case "P":l||(f+="\n"),l=!1}"DIV"===a.tagName&&(n=!0);a instanceof HTMLElement&&(b=b.Pj(a.style,a.tagName));for(var c=a.firstChild;c;)d(c,b),c=c.nextSibling}else a.nodeType===Node.TEXT_NODE&&(h.Nc(b)||(e(h),h=b),c=we(a.nodeValue,n),f+=c,c.length&&(n=!1))}function e(a){f.length&&(k.push(new he(a,f)),f="")}var f="",h=b,k=[],l=!0,n=!0;for(a=a.firstChild;a;)d(a,b),a=a.nextSibling;e(h);k.length&&c.append(k)}
var se=function(){function c(a,b){this.root=a;this.oi=this.Kp=b;this.span=this.qa=null;this.offset=0;this.style=b}c.prototype.Ds=function(a){qe("writeStyle("+a.toString());this.oi=a};c.prototype.bo=function(){qe("startLine");this.qa=document.createElement("DIV");this.root.appendChild(this.qa);this.qa.setAttribute("t-off",this.offset.toString());this.qa.style.whiteSpace="pre-wrap";this.style=this.Kp;this.qa.style.fontSize=this.oi.get("fontSize")+"px"};c.prototype.jm=function(){qe("endLine");if(!this.qa)throw Error("Expected div to exist");
null===this.qa.firstChild&&this.qa.appendChild(document.createElement("BR"));this.span=this.qa=null;this.offset+=1};c.prototype.Es=function(a){qe("writeText("+a+")");if(!this.qa)throw Error("Expected div to exist");null!==this.span&&this.style.Nc(this.oi)||(this.span=document.createElement("SPAN"),this.qa.appendChild(this.span),this.oi.eh(this.span.style),this.style=this.oi);this.span.appendChild(document.createTextNode(a));this.offset+=a.length};return c}();var xe=function(){function c(){var a=this;this.kx=new Promise(function(b,d){a.resolve=b;a.reject=d})}c.prototype.then=function(a,b){return this.kx.then(a,b)};return c}();var ye="ontouchstart"in window,ze="onpointerdown"in window,Ae={touchstart:"down",touchmove:"move",touchend:"up",touchcancel:"up",pointerdown:"down",pointermove:"move",pointerup:"up",mousedown:"down",mousemove:"move",mouseup:"up",pointercancel:"up",wheel:"wheel"},Be=[],Ce=function(c){function a(a,d,e,f,h,k,l,n,q,u,v,w,x,z,D,G,H,C){void 0===H&&(H=Be);void 0===C&&(C=0);k=c.call(this,a,d,e,k,n,q)||this;k.type=a;k.pageX=d;k.pageY=e;k.nb=f;k.ob=h;k.startTime=l;k.pointerId=u;k.data=v;k.index=w;k.dt=x;k.buttons=
z;k.ctrlKey=D;k.shiftKey=G;k.la=H;k.angle=C;k.scale=0;k.rotation=0;return k}__extends(a,c);a.prototype.clone=function(){return new a(this.type,this.pageX,this.pageY,this.nb,this.ob,this.timestamp,this.startTime,this.target,this.nc,this.pointerId,this.data,this.index,this.dt,this.buttons,this.ctrlKey,this.shiftKey,this.la,this.angle)};a.prototype.ak=function(){return this.offset({x:this.pageX,y:this.pageY},void 0)};a.prototype.Sj=function(){return this.timestamp-this.startTime};a.prototype.Qh=function(){return zc(this.pageX,
this.pageY,this.nb,this.ob)};a.prototype.toString=function(){var a=c.prototype.toString.call(this)+(" "+this.Sj()+"ms "+Math.round(this.Qh())+"px");0!=this.scale&&(a+=" scale="+Math.round(100*(this.scale||0))/100,a+=" "+Math.round(this.rotation||0)+"deg");return a};a.prototype.setData=function(a,d){this.data[a]=d};a.prototype.getData=function(a){return this.data[a]};a.prototype.kv=function(){var a={x:0,y:0,z:0};if("wheel"===this.nc.type){var d=this.nc;a.x=d.deltaX;a.y=d.deltaY;a.x=d.deltaZ}return a};
return a}(function(){function c(a,b,d,c,f,h){this.type=a;this.pageX=b;this.pageY=d;this.timestamp=c;this.target=f;this.nc=h}c.prototype.toString=function(){return"["+this.type+" ("+this.nc.type+")] ("+this.pageX+","+this.pageY+")"};c.prototype.offset=function(a,b){var d=A(b).Wb();return{x:a.x-d.left,y:a.y-d.top}};c.prototype.stopPropagation=function(){this.nc.stopPropagation()};c.prototype.preventDefault=function(){this.nc.preventDefault()};return c}()),De=y.create("TouchListener"),Ke=function(c){function a(a,
d){function b(a){f.handleEvent(a)}void 0===d&&(d={});var f=c.call(this)||this;f.ba=a;f.options=d;f.Od=[];f.uf=[];f.active=[];f.Hq={};f.pi=!0;var h=d.Oy?document:a;ye?(f.Za(a,"touchstart",b),f.Za(h,"touchmove",b),f.Za(h,"touchend",b),f.Za(h,"touchcancel",b)):ze&&!1!==d.op&&(f.Za(a,"pointerdown",b),f.Za(h,"pointermove",b),f.Za(h,"pointerup",b),f.Za(h,"pointercancel",b));if(ye||!ze||!1===d.op)f.Za(a,"mousedown",b),f.Za(h,"mousemove",b),f.Za(h,"mouseup",b);f.Za(a,"wheel",b);return f}__extends(a,c);a.prototype.Za=
function(a,d,c){this.Od.push({element:a,event:d,fn:c});"touchmove"===d?a.addEventListener(d,c,{passive:!1,capture:!0===this.options.vo}):a.addEventListener(d,c,!0===this.options.vo)};a.prototype.oa=function(a,d){for(var b=0,f=a.split(" ");b<f.length;b++){var h=f[b],k="";switch(h){case "gesturestart":case "gesturechange":case "gestureend":k="gesture";break;case "tap":case "doubletap":k="tap";break;case "swipe":k="swipe";break;case "hold":k="hold";break;case "drag":k="drag"}if(""!==k&&!this.Hq[k]){switch(k){case "gesture":this.uf.push(new Ee(this));
break;case "tap":this.uf.push(new Fe(this));break;case "swipe":this.uf.push(new Ge(this));break;case "hold":this.uf.push(new He(this));break;case "drag":this.uf.push(new Ie(this))}this.Hq[k]=!0;De("Created new detector "+k+" to handle "+h)}}c.prototype.oa.call(this,a,d)};a.prototype.na=function(a,d){c.prototype.Kc.call(this,a,d)};a.prototype.Ua=function(){for(var a=0,d=this.Od;a<d.length;a++){var c=d[a];c.element.removeEventListener(c.event,c.fn,!0===this.options.vo)}a=0;for(d=this.uf;a<d.length;a++)c=
d[a],c.Ua&&c.Ua();this.Od.length=0;this.uf.length=0;this.active.length=0;this.ab={}};a.prototype.handleEvent=function(a){var b=Ae[a.type],c=(new Date).getTime();switch(a.type){case "touchstart":case "touchend":a.target===this.ba&&a.preventDefault();case "touchmove":case "touchcancel":for(var f=0;f<a.changedTouches.length;f++){var h=a.changedTouches[f];this.jk(a,b,h.identifier,h.pageX,h.pageY,c)}break;case "pointerdown":case "pointerup":case "pointermove":case "pointercancel":f=Je(a);this.jk(a,b,a.pointerId,
f.pageX,f.pageY,c);if("pointercancel"===a.type)for(f=this.active.length-1;0<=f;f--)this.jk(a,b,this.active[f].id,a.pageX,a.pageY,c);break;case "mousedown":case "mousemove":case "mouseup":case "wheel":f=Je(a),this.jk(a,b,0,f.pageX,f.pageY,c)}};a.prototype.jk=function(a,d,c,f,h,k){var b=null;switch(d){case "down":b=this.pt(c,f,h,k,a.buttons);d=new Ce("down",f,h,f,h,k,k,a.target,a,c,b.data,b.index,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;case "move":b=this.Ou(c);d=new Ce("move",f,h,b?
b.nb:f,b?b.ob:h,k,b?b.dc:k,a.target,a,c,b?b.data:{},b?b.index:-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;case "up":b=this.tx(c);d=new Ce("up",f,h,b?b.nb:f,b?b.ob:h,k,b?b.dc:k,a.target,a,c,b?b.data:{},b?b.index:-1,this.active.length,b?b.buttons:a.buttons,a.ctrlKey,a.shiftKey);break;case "wheel":d=new Ce(d,f,h,f,h,k,k,a.target,a,c,{},-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey);break;default:return}null!==b&&(b.xf=f,b.yf=h);(b||this.ba.contains(a.target))&&this.na(d.type,d)};
a.prototype.Ou=function(a){for(var b=0,c=this.active;b<c.length;b++){var f=c[b];if(f.id===a)return f}return null};a.prototype.pt=function(a,d,c,f,h){for(var b=0;b<this.active.length;b++){var e=this.active[b];if(e.id===a)return e.nb=e.xf=d,e.ob=e.yf=c,e.dc=f,e.la=[new F(d,c)],e}this.active.push({index:this.active.length,id:a,dc:f,nb:d,ob:c,xf:d,yf:c,la:[new F(d,c)],data:{},buttons:h});return this.active[this.active.length-1]};a.prototype.tx=function(a){for(var b=0;b<this.active.length;b++)if(this.active[b].id===
a)return a=this.active[b],this.active.splice(b,1),a;return null};return a}(Ab);function Je(c){if(c.pageX===c.clientX&&c.pageY===c.clientY){var a=document.documentElement.scrollLeft+document.body.scrollLeft,b=document.documentElement.scrollTop+document.body.scrollTop;if(a||b)return{pageX:c.clientX+a,pageY:c.clientY+b}}return c}
function Fe(c){var a=[];c.oa("up",function(b){De("Duration: %s distance: %s",b.Sj(),b.Qh());if(200>b.Sj()&&20>b.Qh()){var d=b.clone();d.type="tap";c.na("tap",d);a:{for(d=0;d<a.length;d++){var e=a[d];if(300>b.timestamp-e.dc&&20>zc(b.pageX,b.pageY,e.x,e.y)){e.x=b.pageX;e.y=b.pageY;e.dc=b.timestamp;d=!0;break a}}4===a.length&&a.splice(0,1);a.push({x:b.pageX,y:b.pageY,id:b.pointerId,dc:b.timestamp});d=!1}d&&(d=b.clone(),d.type="doubletap",c.na("doubletap",d))}})}
function Ie(c){var a=-1,b=-1;c.oa("move",function(d){a!==d.nb&&b!==d.ob&&8<d.Qh()&&(a=d.nb,b=d.ob,d=d.clone(),d.type="drag",c.na("drag",d))})}
function Ee(c){function a(){for(var a=0,b=0,d=0;d<e.length;d++)De("Active touch: id:%s %s,%s",e[d].id,e[d].xf,e[d].yf),a+=e[d].xf,b+=e[d].yf;return{x:a/e.length,y:b/e.length}}function b(a,b){for(var d=0,c=0;c<e.length;c++){var f=e[c];d+=Math.sqrt((f.xf-a)*(f.xf-a)+(f.yf-b)*(f.yf-b))}return d/e.length}function d(a,b,d,e,f){a=a.clone();a.type=b;a.pageX=d.x;a.pageY=d.y;a.scale=e;a.rotation=f;c.na(a.type,a)}var e=[],f=!1,h=0,k=1,l=1,n={x:0,y:0};c.oa("down move up",function(q){e=c.active;switch(q.type){case "down":2<=
e.length&&!f&&(f=!0,n=a(),l=b(n.x,n.y),k=1,h=0,d(q,"gesturestart",n,k,h));break;case "move":if(2<=e.length&&f){n=a();k=b(n.x,n.y)/l;for(var u=n.x,v=n.y,w=0,x=0;x<e.length;x++){var z=Math.atan2(e[x].yf-v,e[x].xf-u)-Math.atan2(e[x].ob-v,e[x].nb-u);z>Math.PI?z-=2*Math.PI:z<=-Math.PI&&(z+=2*Math.PI);w+=z}h=w/e.length/Math.PI*180;d(q,"gesturechange",n,k,h)}break;case "up":f&&2>e.length&&(f=!1,d(q,"gestureend",n,k,h))}})}
function Ge(c){c.oa("up",function(a){var b=a.la;if(!(200>a.Qh()||1E3<a.Sj()||2>b.length)){for(var d=b[0],e=b[b.length-1],f=1;f<b.length-1;f++)if(40<b[f].Op(d,e))return!1;b=Math.atan2(e.y-d.y,e.x-d.x);De("Swipe angle %s",Math.round(b/Math.PI*180));a=a.clone();a.type="swipe";a.angle=b;c.na("swipe",a)}})}function Le(c){this.hx=c;this.time=(new Date).getTime();this.timeout=0}
var He=function(){function c(a){function b(a){var b=d.$e[a];b&&(De("Remove pointer %s",a),clearTimeout(b.timeout),delete d.$e[a])}var d=this;this.$e={};a.oa("down",function(c){b(c.pointerId);d.$e[c.pointerId]=new Le(new F(c.pageX,c.pageY));d.$e[c.pointerId].timeout=setTimeout(function(){var b=c.clone();b.type="hold";b.timestamp=(new Date).getTime();a.na("hold",b)},1E3)});a.oa("move",function(a){var c=a.pointerId;if(c in d.$e){var e=d.$e[c];20<(new F(a.pageX,a.pageY)).Lb(e.hx)&&b(c)}});a.oa("up",function(a){b(a.pointerId)})}
c.prototype.Ua=function(){for(var a in this.$e)clearTimeout(this.$e[a].timeout)};return c}();function Me(c,a,b,d){c.fillStyle="#ffffff";c.fillRect(a,b,d,d);c.beginPath();c.strokeStyle="#000000";c.moveTo(a,b);c.lineTo(a+d,b+d);c.moveTo(a+d,b);c.lineTo(a,b+d);c.stroke()}function Ne(c,a,b,d){for(var e,f=0;f<d;f+=5){e=0===f/5%2;for(var h=0;h<d;h+=5)c.fillStyle=e?"#000000":"#ffffff",e=!e,c.fillRect(a+h,b+f,5,5)}e=c.createLinearGradient(a+d,b+d,a,b);e.addColorStop(0,"rgba(255, 255, 255, 1.0)");e.addColorStop(1,"rgba(255, 255, 255, 0.0)");c.fillStyle=e;c.fillRect(a,b,d,d)}
function Oe(c,a,b){function d(a,b,d){return A("div",{"zwibbler-color":d}).$a({width:b+"px",height:b+"px",display:"inline-block"}).$c(a)}function e(a,b,c){var e=document.createElement("canvas");e.width=a;e.height=a;e.setAttribute("zwibbler-color",c);b(e.getContext("2d"),0,0,a);a=d(f,a,c);a.ba.appendChild(e);return a}void 0===b&&(b={});var f=A.jc(c),h;if(f){c=new Ke(f,{Oy:!1});f.addEventListener("contextmenu",function(a){a.preventDefault()});c.oa("tap hold",function(a){var d="hold"===a.type||1<a.buttons,
c=a.target.getAttribute("zwibbler-color")||"";if("opacity-50"===c)b.onOpacity(.5,!d);else if(c)b.onColour(c,!d);a.preventDefault()});e(a,Me,"transparent");e(a,Ne,"opacity-50");for(h=0;1>=h;h+=1/13){var k=(new r(r.kf,[0,0,h,1])).toString();d(f,a,k).$a({backgroundColor:k})}for(h=.3;1>=h;h+=.7/14)for(c=0;360>c;c+=22.5)k=(new r(r.kf,[c,.7,h,1])).toString(),d(f,a,k).$a({backgroundColor:k});for(c=0;360>c;c+=22.5)k=(new r(r.kf,[c,1,1,1])).toString(),d(f,a,k).$a({backgroundColor:k})}}
(function(){function c(a,b){var d=this;this.Ok=null;var c=document.createElement("div");c.style.width="320px";c.style.lineHeight="0";c.style.position="absolute";b.appendChild(c);Oe(c,20,{onColour:function(a,b){d.Ok&&d.Ok.resolve({type:"colour",value:a,fill:b})}});this.bm=Oa(c);a.add(function(){d.bm&&d.bm.destroy()})}c.prototype.show=function(a,b){this.Ok=new xe;this.bm.show(a,b,!0);return this.Ok};return c})();var Pe=new (function(){function c(){this.om={}}c.prototype.lj=function(){if("localStorage"in window)try{var a=window.localStorage}catch(b){}return void 0!==a};c.prototype.setItem=function(a,b){this.lj()?window.localStorage.setItem(a,b):this.om[a]=""+b};c.prototype.getItem=function(a){return this.lj()?window.localStorage.getItem(a):this.om[a]};c.prototype.removeItem=function(a){this.lj()?window.localStorage.removeItem(a):delete this.om[a]};return c}());var Qe=function(){function c(a,b,d,c){this.x=a;this.y=b;this.width=d;this.height=c;this.mc=[];this.fonts={};this.images=[];this.hl={};this.Nb=1;this.Yt=!0;this.page={};this.log=y.create("PdfWriter");this.vi=this.object("Pages",{Kids:[],Count:0});this.Nt=this.object("Catalog",{Pages:this.vi._id+" 0 R"});this.dh()}c.prototype.fw=function(){if(null!==c.Cl)return c.Cl;var a=document.createElement("canvas"),b=!1;a.width=10;a.height=10;"toDataURL"in a&&(b=0<a.toDataURL("image/jpeg").indexOf("jpeg"));c.Cl=
b;this.log("JPEG supported: %s",b);return b};c.prototype.dh=function(a,b,d,c){void 0===a&&(a=this.x);void 0===b&&(b=this.x);void 0===d&&(d=this.width);void 0===c&&(c=this.height);this.log("StartPage MediaBox=[%s %s %s %s]",a,b,d,c);this.page=this.object("Page",{MediaBox:[a,b,a+d,b+c],Parent:this.vi._id+" 0 R"});this.vi.Kids.push(this.page._id+" 0 R");this.vi.Count+=1;this.hl={}};c.prototype.object=function(a,b){var d=this.mc.length+1;a&&(b.Type=a);b._id=d;this.mc.push(b);return b};c.prototype.ot=
function(a){this.page.Contents=a._id+" 0 R"};c.prototype.stream=function(a){if(this.Yt){var b=nb.hf("LZWEncoder");b.Cs(a);b.flush();a=b.zg().toString();a=this.object(null,{_stream:a,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]"})}else a=this.object(null,{_stream:a});return a};c.prototype.Py=function(a){if(!(a in this.fonts)){var b="F"+this.Nb;this.Nb+=1;var d="/"+a.replace(/ /g,"");b=this.object("Font",{_name:b,BaseFont:d,Encoding:"/StandardEncoding",Subtype:"/Type1"});this.fonts[a]=
b}this.Yi("Font",this.fonts[a]);return"/"+this.fonts[a]._name};c.prototype.zs=function(a,b){var d=""+a+"-"+b;if(!(d in this.hl)){var c="gs"+this.Nb;this.Nb+=1;var f=this.object("ExtGState",{_name:c});b?f.ca=this.fd(a):f.CA=this.fd(a);this.hl[d]=c;this.Yi("ExtGState",f)}return this.hl[d]};c.prototype.Yi=function(a,b){"Resources"in this.page||(this.page.Resources={});a in this.page.Resources||(this.page.Resources[a]={});this.page.Resources[a][b._name]=b._id+" 0 R"};c.prototype.Al=function(a,b){void 0===
b&&(b="");for(var d=0;d<this.images.length;d++)if(this.images[d].Zh===a&&b===this.images[d].Jq)return this.images[d].ti;return null};c.prototype.kl=function(a,b){var d,c=this.Al(a);if(!c){var f="I"+this.Nb;this.Nb+=1;b instanceof HTMLCanvasElement?c=b:(c=document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(b,0,0));var h=c.getContext("2d").getImageData(0,0,c.width,c.height),k=!1;if(this.fw()){this.log("Using JPEG encoding");var l="[/DCTDecode]";var n=nb.hf("");
for(d=0;d<h.data.length;d+=4)k=k||255>h.data[d+3];d=c.toDataURL("image/jpeg");var q=atob(d.split(",")[1]);for(d=0;d<q.length;d++)n.lb(q.charCodeAt(d))}else{this.log("Using LZW encoding");l="[/LZWDecode]";n=nb.hf("LZWEncoder");for(d=0;d<h.data.length;d+=4)n.lb(h.data[d]),n.lb(h.data[d+1]),n.lb(h.data[d+2]),k=k||255>h.data[d+3];var u="[ <</EarlyChange 0 >> ]"}n.flush();n=n.zg().toString();f=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceRGB",BitsPerComponent:8,
Length:n.length,Interpolate:"true",Filter:l,_name:f,_stream:n});u&&(f.DecodeParms=u);if(k){n=nb.hf("LZWEncoder");for(d=0;d<h.data.length;d+=4)n.lb(h.data[d+3]);n.flush();n=n.zg().toString();u=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceGray",BitsPerComponent:8,Length:n.length,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]",_stream:n});f.SMask=u._id+" 0 R"}this.images.push({Zh:a,Jq:"",ti:f});c=f}this.Yi("XObject",c);return"/"+c._name};c.prototype.ll=
function(a,b){var d=this.Al(a.Pa,b.toString());if(!d){d="P"+this.Nb;this.Nb+=1;this.kl(a.Pa,a.Pa);var c=this.Al(a.Pa),f=new J(a.Pa.width,0,0,-a.Pa.height,0,a.Pa.height);f=b.multiply(f);var h="1",k="1",l=b.Yb();l=Math.max(l.x,l.y);if("no-repeat"===a.repeat||"repeat-y"===a.repeat)h=""+Math.ceil(this.width/a.Pa.width/l);if("no-repeat"===a.repeat||"repeat-x"===a.repeat)k=""+Math.ceil(this.height/a.Pa.height/l);d=this.object("Pattern",{_name:d,PatternType:"1",PaintType:"1",TilingType:"2",BBox:"[0 0 1 1]",
XStep:h,YStep:k,Matrix:"[ "+this.fd(f.m11,f.m21,f.m12,f.m22,f.Da,f.Ea)+"]",Resources:"<< /XObject << /"+c._name+" "+c._id+" 0 R >> >>"});d._stream="/"+c._name+" Do";this.images.push({Zh:a.Pa,Jq:b.toString(),ti:d})}this.Yi("Pattern",d);return"/"+d._name};c.prototype.Vf=function(){var a=[],b=[],d;a.push("%PDF-1.4\n%\u0080\u0081\u0082\u0083\n");for(d=0;d<this.mc.length;d++)this.jp(a,b,this.mc[d],!1);var c=a.join("").length;a.push("xref\n0 "+(this.mc.length+1)+"\n");a.push("0000000000 65535 f\n");for(d=
0;d<this.mc.length;d++){for(var f=""+b[d];10>f.length;)f="0"+f;a.push(f+" 00000 n \n")}a.push("trailer\n");a.push("<< /Size "+(this.mc.length+1)+"\n");a.push("   /Root "+this.Nt._id+" 0 R\n");a.push(">>\n");a.push("startxref\n");a.push(c+"\n");a.push("%%EOF\n");return a.join("")};c.prototype.toBlob=function(){for(var a=this.Vf(),b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return new Blob([b],{type:"application/pdf"})};c.prototype.jp=function(a,b,d,c){c?a.push("<<\n"):(b.push(a.join("").length),
a.push(d._id+" 0 obj\n"),"Type"in d?a.push("<< /Type /"+d.Type+"\n"):a.push("<<\n"));"_stream"in d&&(d.Length=d._stream.toString().length);for(var e in d)if(d.hasOwnProperty(e)&&"Type"!==e&&"_"!==e.charAt(0)){c&&a.push("    ");a.push("   /"+e+" ");var h=d[e];"object"===typeof h&&"[object Array]"===Object.prototype.toString.apply(h)?a.push("[ "+h.join(" ")+" ]"):"object"===typeof h?this.jp(a,b,h,!0):a.push(h);a.push("\n")}c&&a.push("    ");a.push(">>\n");"_stream"in d&&(a.push("stream\n"),a.push(d._stream+
"\n"),a.push("endstream\n"));c||a.push("endobj\n")};c.prototype.Cu=function(a){return"("+a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")+")"};c.prototype.fd=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++){var c=""+a[d];0<c.indexOf("e")&&(c=a[d].toFixed(20));b.push(c)}return b.join(" ")};c.Cl=null;return c}(),Re=function(c){function a(a,d){var b=c.call(this)||this;b.Qu=d;b.path=[];b.x=0;b.y=0;b.yr=[];b.Of="";b.Uf="";b.Tf=-1;b.Sf=
"";b.Rf="";b.Qf="";b.Pf="";b.Nf=-1;b.log=y.create("PDFContext");b.se=a.clone();b.se.transform(new Ec(.75,.75,0,0));b.qb=new Qe(72*a.x/96,72*a.y/96,72*a.width/96,72*a.height/96);b.stream=[];b.x=0;b.y=0;b.fillStyle="#000000";b.strokeStyle="#000000";b.gp=b.at;b.ep();return b}__extends(a,c);a.prototype.save=function(){c.prototype.save.call(this);this.stream.push("q");this.yr.push({Of:this.Of,Uf:this.Uf,Tf:this.Tf,Sf:this.Sf,Rf:this.Rf,Qf:this.Qf,Pf:this.Pf,Nf:this.Nf})};a.prototype.restore=function(){c.prototype.restore.call(this);
var a=this.yr.pop();a&&(this.stream.push("Q"),this.Of=a.Of,this.Uf=a.Uf,this.Tf=a.Tf,this.Sf=a.Sf,this.Rf=a.Rf,this.Qf=a.Qf,this.Pf=a.Pf,this.Nf=a.Nf)};a.prototype.dh=function(a){var b=new Ec(.75,.75,0,0);a&&(this.se=a.clone(),this.se.transform(b));this.km();this.qb.dh(this.se.x,this.se.y,this.se.width,this.se.height);this.ep();this.beginPath()};a.prototype.beginPath=function(){this.path.length=0};a.prototype.ep=function(){this.log("Start page: %s",this.se);this.setTransform(1,0,0,1,0,0);this.Uf=
this.Of="";this.Tf=-1;this.Pf=this.Qf=this.Rf=this.Sf="";this.Nf=-1};a.prototype.km=function(){this.stream.length&&this.qb.ot(this.qb.stream(this.stream.join("\n")));this.stream.length=0};a.prototype.rs=function(){this.km();for(var a=this.qb.Vf(),d=new Uint8Array(a.length),c=0;c<a.length;c++)d[c]=a.charCodeAt(c);return d};a.prototype.toString=function(){throw Error("Do not call PdfContext.toString()");};a.prototype.toBlob=function(){this.km();return this.qb.toBlob()};a.prototype.setTransform=function(a,
d,c,f,h,k){var b=this.se.Ed();this.ta=(new J(a,c,d,f,h,k)).multiply(new Fc(0,b.x,b.y)).multiply(new Ec(.75,.75,0,0))};a.prototype.closePath=function(){this.path.push("h")};a.prototype.fill=function(){this.Dl();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("f")};a.prototype.stroke=function(){this.El();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("S")};a.prototype.moveTo=function(a,d){var b=this.ta.apply(a,d);this.path.push(this.qb.fd(b.x,
b.y)+" m");this.x=a;this.y=d};a.prototype.lineTo=function(a,d){var b=this.ta.apply(a,d);this.path.push(this.qb.fd(b.x,b.y)+" l");this.x=a;this.y=d};a.prototype.bezierCurveTo=function(a,d,c,f,h,k){a=this.ta.apply(a,d);c=this.ta.apply(c,f);f=this.ta.apply(h,k);this.path.push(this.qb.fd(a.x,a.y,c.x,c.y,f.x,f.y)+" c");this.x=h;this.y=k};a.prototype.quadraticCurveTo=function(a,d,c,f){this.bezierCurveTo(2/3*a+1/3*this.x,2/3*d+1/3*this.y,2/3*a+1/3*c,2/3*d+1/3*f,c,f)};a.prototype.fillText=function(a,d,c){this.gp(a,
d,c,0)};a.prototype.strokeText=function(a,d,c){this.gp(a,d,c,1)};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.Dl=function(){if(this.Of!==this.fillStyle){if(this.fillStyle instanceof Cd){var a=this.qb.ll(this.fillStyle,this.ta);this.stream.push("/Pattern cs");this.stream.push(a+" scn")}else"string"===typeof this.fillStyle&&(a=r.de(this.fillStyle).yj(r.RGBA),this.stream.push(this.qb.fd(a.values[0],a.values[1],
a.values[2])+" rg"),a=this.qb.zs(a.values[3],!0),this.stream.push("/"+a+" gs"));this.Of=this.fillStyle}};a.prototype.El=function(){function a(a){return"bevel"===a?2:"round"===a?1:0}function d(a){return"butt"===a?0:"round"===a?1:2}if(this.Uf!==this.strokeStyle){if(this.strokeStyle instanceof Cd){var c=this.qb.ll(this.strokeStyle,this.ta);this.stream.push("/Pattern CS");this.stream.push(c+" SCN")}else"string"===typeof this.strokeStyle&&(c=r.de(this.strokeStyle).yj(r.RGBA),this.stream.push(this.qb.fd(c.values[0],
c.values[1],c.values[2])+" RG"),c=this.qb.zs(c.values[3],!1),this.stream.push("/"+c+" gs"));this.Uf=this.strokeStyle}this.Tf!==this.lineWidth&&(this.Tf=this.lineWidth,this.stream.push(this.qb.fd(72*this.lineWidth/96)+" w"));this.Sf!==this.lineJoin&&(this.Sf=this.lineJoin,this.stream.push(a(this.lineJoin)+" j"));this.Rf!==this.lineCap&&(this.Rf=this.lineCap,this.stream.push(d(this.lineCap)+" J"))};a.prototype.bt=function(a,d,c,f){var b=this.kg(this.font);if(this.Qf!==b.fontSize||this.Pf!==b.fontFamily){var e=
this.qb.Py(b.fontFamily);this.stream.push(e+" "+this.qb.fd(parseFloat(b.fontSize))+" Tf");this.Qf=b.fontSize;this.Pf=b.fontFamily}this.Nf!==f&&(this.stream.push(f+" Tr"),this.Nf=f);0===f?this.Dl():this.El();this.stream.push("BT");d=this.ta.multiply(new J(1,0,0,-1,d,c));this.stream.push(this.qb.fd(d.m11,d.m21,d.m12,d.m22,d.Da,d.Ea)+" Tm");this.stream.push(this.qb.Cu(a)+" Tj");this.stream.push("ET")};a.prototype.at=function(a,d,c,f){var b=this.kg(this.font),e=this.Qu.get(b.fontFamily);e?(0===f?this.Dl():
this.El(),this.beginPath(),e.wu(this,a,d,c,parseFloat(b.fontSize)),0===f?this.fill():this.stroke()):this.bt(a,d,c,f)};a.prototype.kg=function(a){var b="",c="",f="normal",h="normal",k="normal",l="normal";a=a.split(/\s+/);a:for(;;){var n=a.shift();if(!n)break;switch(n){case "normal":break;case "italic":case "oblique":f=n;break;case "small-caps":k=n;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":h=n;break;
default:if(""===c)n=n.split("/"),c=n[0],1<n.length&&(l=n[1]);else{b=n;a.length&&(b+=" "+a.join(" "));break a}}}b&&(b=b.replace(/"/g,""));return{fontStyle:f,fontVariant:k,fontWeight:h,fontSize:c,lineHeight:l,fontFamily:b}};a.prototype.Vo=function(a,d,c,f,h,k,l,n,q){this.log("DrawImage(%s, %s, %s, %s, %s, %s, %s %s)",d,c,f,h,k,l,n,q);l+=q;var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=h;e.drawImage(a,-d,-c);a=this.qb.kl(a instanceof HTMLImageElement?[a.src,d,c,f,h].join():
a,b);this.stream.push("q");k=this.ta.multiply(new J(n,0,0,-q,k,l));this.stream.push(this.qb.fd(k.m11,k.m21,k.m12,k.m22,k.Da,k.Ea)+" cm");this.stream.push(a+" Do");this.stream.push("Q")};a.prototype.Vf=function(){return this.qb.Vf()};a.prototype.Zo=function(){return{}};a.prototype.cp=function(){};a.prototype.clip=function(){for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("W");this.stream.push("n");this.path.length=0};return a}(Fd);function Se(c){function a(a){b&&clearTimeout(b);b=setTimeout(function(){b=null;c()},arguments.length?a:1E3)}var b=null;a.cancel=function(){b&&(clearTimeout(b),b=null)};return a};var Ue=function(){function c(a,b,d,c,f,h,k){this.view=a;this.node=b;this.handle=d;this.Rg=h;this.ob=this.nb=0;this.log=y.create("MoveEditNode");b.Tj(d);this.Ta=b.ka("snap")||0;this.yb(c,f,k)}c.prototype.Mc=function(){this.log("Entering MoveEditNode")};c.prototype.lc=function(){this.log("Leaving MoveEditNode")};c.prototype.yb=function(a,b){var d=this.view.Ta(new F(a,b),this.Ta);a=d.x;b=d.y;this.log("onMouseDown(%s,%s)",a,b);this.nb=a;this.ob=b;return!0};c.prototype.tb=function(a,b){var d=this.view.Ta(new F(a,
b),this.Ta);a=d.x;b=d.y;this.node.ne(this.handle,a,b);this.node.format(this.view.za,this.view.request);this.view.ia();return!1};c.prototype.Gb=function(a,b){var d=this,c=this.view.Ta(new F(a,b),this.Ta);a=c.x;b=c.y;this.log("onMouseUp(%s,%s)",a,b,this.nb,this.ob);a!==this.nb||b!==this.ob?(this.node.ne(this.handle,this.nb,this.ob),this.view.aa.transaction(function(){d.view.aa.ne(d.node.id,d.handle,a,b)})):this.view.Fx(this.node.id,this.handle);this.view.ia();this.view.Ra(this.Rg||new Te(this.view));
return!0};return c}();var We=function(){function c(a,b,d,c){this.view=a;this.Rg=b;this.Ea=this.Da=0;this.Fb=!1;this.log=y.create("SELECT");this.lr(d,c)}c.prototype.hb=function(a){this.log("Gesture detected; aborting select box.");this.view.Ra(this.Rg);return this.Rg.hb?this.Rg.hb(a):!1};c.prototype.lc=function(){this.view.Sl("select")};c.prototype.yb=function(a,b){return this.lr(a,b)};c.prototype.lr=function(a,b){this.Da=a;this.Ea=b;return this.Fb=!0};c.prototype.tb=function(a,b){if(this.Fb){var d=this;this.view.Jr("select",
function(c){c.save();c.strokeStyle="#0050B7";c.lineWidth=2/d.view.scale;c.fillStyle="rgba(0, 80, 183, 0.2)";var e=new I(d.Da+.5,d.Ea+.5,a-d.Da,b-d.Ea);c.fillRect(e.x,e.y,e.width,e.height);c.strokeRect(e.x,e.y,e.width,e.height);c.restore()});return!0}return!1};c.prototype.Gb=function(a,b){this.Fb=!1;this.view.fb();this.view.Ex(new I(this.Da,this.Ea,a-this.Da,b-this.Ea));this.view.Tb();this.view.Ra(this.Rg);return!0};return c}();function Xe(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].id);return a}
var Ye=function(){function c(a,b,d,c,f){this.view=a;this.handle=b;this.Ay=d;new I(0,0,0,0);this.Ia=[];this.Hg=[];this.Hb=new F(0,0);this.log=y.create("TransformSelectionBehaviour");this.lk=!1;this.Ta=0;this.yb(c,f)}c.prototype.hb=function(a){var b=this;if("gesturestart"!==a.type&&"gesturechange"!==a.type&&"gestureend"!==a.type)return!1;this.log("%s scale=%s rotation=%s",a.type,a.scale,a.rotation);this.lk=!0;var d=this.view.xd(a.pageX,a.pageY,!0),c=d.x;d=d.y;"gesturestart"===a.type&&(this.Hb.x=c,this.Hb.y=
d);c-=this.Hb.x;d-=this.Hb.y;var f=a.scale,h=a.rotation;this.view.Vk||(f=1);this.view.Gi||(h=0);h=-h/180*Math.PI;if(0<this.view.ga.get("snap")){var k=Math.PI/16;h=Math.floor(h/k)*k}f=new Ec(f,f,this.Hb.x,this.Hb.y);h=new Dc(h,this.Hb.x,this.Hb.y);var l=(new Cc(c,d)).multiply(f).multiply(h);for(c=0;c<this.Ia.length;c++)this.Ia[c].Zg(l.multiply(this.Hg[c])),this.Ia[c].format(this.view.za,this.view.request);this.view.so(l);this.view.ia();if("gestureend"===a.type){for(c=0;c<this.Ia.length;c++)this.Ia[c].Zg(this.Hg[c]);
this.view.aa.transaction(function(){b.view.aa.Td(Xe(b.Ia),l)});this.Wp()}return!0};c.prototype.yb=function(a,b){if(this.lk)return!0;this.Ia=this.view.cd();this.Gu(this.Ia);this.Hb=this.view.Ta(new F(a,b),this.Ta);this.log("onMouseDown(%s,%s)",this.Hb.x,this.Hb.y);new I(this.view.gd.x,this.view.gd.y,this.view.gd.width,this.view.gd.height);return!0};c.prototype.Gu=function(a){this.Hg=[];for(var b=0;b<a.length;b++)this.Hg.push(a[b].La()),this.Ta=this.Ta||a[b].ka("snap")};c.prototype.tb=function(a,b){if(this.lk)return!0;
var d=this;var c=this.view.Ta(new F(a,b),this.Ta);var f=c.x;var h=c.y;for(var k=this.handle.Fg(new F(c.x-this.Hb.x,c.y-this.Hb.y)),l=0;l<this.Ia.length;l++)c=k.multiply(this.Hg[l]),this.Ia[l].Zg(c),this.Ia[l].format(this.view.za,this.view.request);this.view.so(k);this.view.ia(function(){if(d.handle instanceof Qd){var a=d.view.za;a.save();a.beginPath();a.strokeStyle="#0050B7";a.lineWidth=1/d.view.scale;a.moveTo(d.handle.origin.x,d.handle.origin.y);a.lineTo(f,h);a.stroke();a.restore()}});return!0};
c.prototype.Gb=function(a,b){var d=this;if(this.lk)return!0;var c=a,f=b,h=this.view.Ta(new F(a,b),this.Ta);a=h.x;b=h.y;this.log("onMouseUp(%s,%s)",a,b);if(h.Nc(this.Hb))this.Ay?(c=this.view.aa.xb(c,f,this.view.Va))&&c.We()?(this.log("Didn't move, and has edit mode. Selecting node %s",c.id),this.view.fb(),this.view.Yg(c)):this.log("Didn't move, but node has no edit mode or failed hittest"):this.log("Didn't move, but toggleEditNode=false");else{this.log("Moved by %s,%s",a-this.Hb.x,b-this.Hb.y);var k=
this.handle.Fg(new F(h.x-this.Hb.x,h.y-this.Hb.y));for(c=0;c<this.Ia.length;c++)this.Ia[c].Zg(this.Hg[c]);this.view.aa.transaction(function(){d.view.aa.Td(Xe(d.Ia),k)})}this.Wp();return!0};c.prototype.Wp=function(){this.view.so(new J);this.view.uh();this.view.update(!0);this.view.kb()};return c}();var Ze=function(){function c(a,b){this.view=a;this.da=b;this.Kj=!1;this.Ba=this.Re=this.ja=null;this.fillStyle="#000000";this.dl=!1;this.xa=new xb;this.fo="normal";this.log=y.create("Text");this.multiline=a.ga.get("multilineText");this.wb=document.createElement("div");a.ga.get("iPadNoScrollText")&&null!==navigator.userAgent.match(/iPad|iPhone|Android/i)&&(this.fo="top")}c.prototype.Mc=function(){this.log("Entering text mode");this.view.cc("text")};c.prototype.lc=function(){this.Kj&&this.Bj();this.view.cc("default");
this.log("Leaving text mode");this.ja&&this.ja.parentNode&&this.ja.parentNode.removeChild(this.ja);this.ja=null;this.wb.parentNode&&this.wb.parentNode.removeChild(this.wb);this.xa.Ua()};c.prototype.yb=function(a,b,d){this.log("onMouseDown(%s)",d.type);if(this.Kj){if(d.target===this.ja)return this.log("Ignore click -- its in our own edit box."),!1;this.log("Editing somewhere else on mousedown; submit that first.");this.Bj();this.view.ga.get("autoPickToolText")&&this.view.kb()}else d=this.view.aa.xb(a,
b,this.view.Va),this.ao(d,a,b);this.log("Eating click");return this.view.im=!0};c.prototype.Fu=function(){if(this.wb&&this.ja){this.wb.style.fontSize=this.ja.style.fontSize;this.wb.style.fontFamily=this.ja.style.fontFamily;this.wb.style.fontWeight=this.ja.style.fontWeight;this.wb.style.fontStyle=this.ja.style.fontStyle;this.wb.style.whiteSpace="pre-line";this.wb.style.position="absolute";this.wb.style.visibility="hidden";this.wb.style.backgroundColor="rgba(0,0,0,0.2)";document.body.appendChild(this.wb);
this.wb.style.left="0";for(this.wb.style.top="0";this.wb.firstChild;)this.wb.removeChild(this.wb.firstChild);this.wb.appendChild(document.createTextNode(this.ja.value));var a=this.wb.clientWidth,b=this.ja.clientWidth;b<a&&(b=a,this.view.ga.get("multilineText")&&b>500*this.view.scale&&(b=500*this.view.scale),this.ja.style.width=b+2+"px")}};c.prototype.ao=function(a,b,d){function c(){v.ja&&(v.log("Set editBox height to %s",""+v.ja.scrollHeight+"px"),v.ja.style.height=""+v.ja.scrollHeight+"px",v.ja.style.width=
""+v.ja.scrollWidth+"px");w=null}function f(){null===v.Ba&&v.Fu()}var h=0;this.dl=!1;if(a&&"TextNode"===a.type()||a&&"PathNode"===a.type()&&this.view.ga.get("allowTextInShape")||a&&a.Xh()){this.Ba=a;"top"!==this.fo&&"TextNode"===a.type()&&this.Ba.bf(!0);this.view.ia();this.Re=new F(a.rect.x,a.rect.y);if(h=a.ka("font")){h=Ed(h);var k=h.fontFamily||"arial";var l=parseFloat(h.fontSize)||10;var n="bold"===h.fontWeight;var q="italic"===h.fontStyle}else k=a.ka("fontName"),l=a.ka("fontSize"),n=a.ka("bold"),
q=a.ka("italic");"TextNode"===a.type()&&(l*=a.La().Yb().y);var u=a.ka("textDecoration");h=a.rect.width*this.view.scale;h=Math.max(h,200);this.fillStyle=a.ka("textFillStyle")||this.Qa("textFillStyle")}else this.Ba=null,this.Re=new F(b,d),k=this.Qa("fontName"),l=this.Qa("fontSize"),n=this.Qa("bold"),q=this.Qa("italic"),u=this.Qa("textDecoration"),this.fillStyle=this.da.fillStyle||this.Qa("textFillStyle")||this.Qa("fillStyle"),this.Qa("wrap")&&(d-=l);var v=this;this.ja=document.createElement("textarea");
a=this.ja.clientHeight;this.ja.style.width=h?""+h+"px":"auto";h=this.view.cm(this.Re.x,this.Re.y);this.ja.style.position="absolute";this.ja.style.fontFamily=k;this.ja.style.fontSize=""+l*this.view.scale+"px";this.ja.style.overflow="auto";this.ja.style.fontWeight=n?"bold":"normal";this.ja.style.fontStyle=q?"italic":"normal";this.ja.style.padding="0";this.ja.style.border="1px solid #888";this.ja.style.color=this.fillStyle;this.ja.style.backgroundColor=this.Qa("background");this.Ba&&"PathNode"===this.Ba.type()&&
(this.ja.style.backgroundColor="white");this.ja.style.textDecoration=u||"none";this.ja.style.textAlign=this.Qa("textAlign");this.ja.style.zIndex=""+(this.view.Md()+1);this.log("Using z-index %s",this.ja.style.zIndex);"#ffffff"===r.de(this.fillStyle).toString()&&(this.ja.style.backgroundColor="#808080");k=this.view.canvas.parentElement;l=A(k).Wb();q=n=0;"top"===this.fo?(q=A(this.view.canvas.first).Wb(),n=this.view.canvas.width,h=this.ja.clientWidth,n=q.left+n/2-h/2,q=q.top):(n=Math.round(h.x)-1,q=
Math.round(h.y)-1);this.ja.style.WebkitTransitionDuration="0";this.ja.style.MozTransitionDuration="0";this.ja.style.msTransitionDuration="0";this.ja.style.OTransitionDuration="0";this.ja.style.transitionDuration="0";this.ja.style.left=n-l.left+"px";this.ja.style.top=q-l.top+"px";k.appendChild(this.ja);sc(this.ja);this.Kj=!0;this.Re=new F(b,d+a);this.Ba&&(this.ja.value=this.Ba.ka("text"));var w=null;w=setTimeout(c,0);this.xa.addEventListener(this.ja,"keydown",function(a){"keydown"===a.type&&(27===
a.keyCode&&v.multiline||13===a.keyCode&&(a.shiftKey||!v.multiline)?(v.log("Enter pressed. create text."),v.Bj(),v.view.Ga.ub&&v.view.my(),v.view.ga.get("autoPickToolText")&&v.view.kb()):27===a.keyCode?(v.log("ESC pressed; cancel."),v.cancel(),v.view.kb(),v.view.ic.na("goto-toolbar")):13===a.keyCode&&(w||(w=setTimeout(c,0))))});this.xa.addEventListener(this.ja,"input",f);this.xa.addEventListener(this.ja,"propertychange",f);this.view.ga.get("leaveTextToolOnBlur")&&(this.xa.addEventListener(this.ja,
"focus",function(){v.log("Text focus received.")}),this.xa.addEventListener(this.ja,"blur",function(){v.ja&&!v.ja.Bn&&(v.log("Text blur received -- removing=%s",!0===v.ja.Bn),v.ja.Bn=!0,v.Bj())}));setTimeout(function(){v.ja&&v.ja.focus()},200);this.ja.focus();this.view.Aa.na("edit-text-shown",v.ja);this.view.Aa.digest()};c.prototype.cancel=function(){this.ja&&(this.ja.Bn=!0,this.ja.parentNode&&this.ja.parentNode.removeChild(this.ja),this.view.Aa.na("edit-text-hidden"),this.view.Ga.ub&&this.view.ic.na("goto-canvas"));
this.ja=null;this.Kj=!1;this.Ba&&(this.Ba.bf(!1),this.view.ia())};c.prototype.Qa=function(a){if(this.Ba){var b=this.Ba.ka(a);if(b)return b}return a in this.da?this.da[a]:"background"===a?this.view.ga.get("defaultTextBackground"):"wrap"===a?this.view.ga.get("multilineText"):this.view.sa[a]};c.prototype.ek=function(){return{textFillStyle:this.Qa("textFillStyle"),fillStyle:this.Qa("textFillStyle"),bold:this.Qa("bold"),italic:this.Qa("italic"),textDecoration:this.Qa("textDecoration"),strokeStyle:this.Qa("strokeStyle"),
lineWidth:this.Qa("lineWidth"),fontName:this.Qa("fontName"),fontSize:this.Qa("fontSize"),textAlign:this.Qa("textAlign")}};c.prototype.Bj=function(){var a=this;if(this.ja){var b=this.ja.value;this.cancel();if(this.Ba&&this.Ba.ka("text")===b&&!this.dl)this.log("Text was not changed.");else if(null===this.Ba&&""===b)this.log("No text entered.");else if(this.Ba){this.log("Update text in node %s",this.Ba.id);var d={text:b,textFillStyle:this.fillStyle,textAlign:this.Qa("textAlign"),textDecoration:this.Qa("textDecoration")};
"bold"in this.da&&(d.bold=this.da.bold);"italic"in this.da&&(d.italic=this.da.italic);this.view.aa.transaction(function(){a.view.aa.wc([a.Ba.id],d)})}else if(this.Re){this.log("Create new text node.");var c=0,f=this.Qa("fontSize");this.view.ga.get("multilineText")||(c=f);var h=new Cc(this.Re.x,this.Re.y+c);this.view.aa.transaction(function(){var d=a.view.aa.createNode("TextNode",vc({text:b,background:a.Qa("background"),fontSize:f,fontName:a.Qa("fontName"),bold:a.Qa("bold"),italic:a.Qa("italic"),textAlign:a.Qa("textAlign"),
textFillStyle:a.Qa("textFillStyle"),textDecoration:a.Qa("textDecoration"),strokeStyle:a.Qa("textStrokeStyle"),lineWidth:a.Qa("textLineWidth"),layer:a.da.layer||a.view.Va,wrap:a.view.ga.get("multilineText")},a.da));a.view.aa.Td([d],h)})}}};c.prototype.tb=function(){return!1};c.prototype.td=function(a){this.log("keyboard: %s",a);"cancel"===a&&null===this.ja&&(this.view.kb(),this.view.ic.na("goto-toolbar"))};c.prototype.sd=function(a){this.log("Set text colour to %s",a);this.dl=!0;this.fillStyle=a;this.da.textFillStyle=
a;this.ja&&(this.ja.style.color=a,"#ffffff"===r.de(a).toString()?this.ja.style.backgroundColor="#808080":this.ja.style.backgroundColor="#ffffff")};c.prototype.Ye=function(a,b){this.view.Rn(a,b)};c.prototype.qe=function(a,b){"defaultBold"===a?(a="bold",this.ja&&(this.ja.style.fontWeight=b?"bold":"normal")):"defaultItalic"===a?(a="italic",this.ja&&(this.ja.style.fontStyle=b?"italic":"normal")):"defaultTextBackground"===a?(a="background",this.ja&&(this.ja.style.backgroundColor=b)):"defaultFont"===a?
(a="fontName",this.ja&&(this.ja.style.fontFamily=b)):"defaultFontSize"===a?(a="fontSize",this.ja&&(this.ja.style.fontSize=b+"px")):"defaultTextFillStyle"===a?(a="textFillStyle",this.ja&&(this.ja.style.color=b)):"defaultTextDecoration"===a?(a="textDecoration",this.ja&&(this.ja.style.textDecoration=b)):"defaultTextAlign"===a&&(a="textAlign",this.ja&&(this.ja.style.textAlign=b));this.log("Update %s=%s",a,b);this.dl=!0;this.da[a]=b};c.prototype.nd=function(){return"text"};c.prototype.Rd=function(a,b){b=
xc(this.da[a],b);this.da[a]=b;"fillStyle"===a&&(this.da.textFillStyle=b);if(this.ja)switch(a){case "textFillStyle":case "fillStyle":this.ja.style.color=b;break;case "fontSize":this.ja.style.fontSize=b+"px";break;case "fontName":this.ja.style.fontFamily=b;break;case "bold":this.ja.style.fontWeight=b?"bold":"normal";break;case "italic":this.ja.style.fontStyle=b?"italic":"normal"}};return c}();var $e=function(){function c(a){this.view=a;this.start=new F(0,0);this.$n=new F(0,0);this.active=!1;this.rect=null;this.log=y.create("PanZoomMixin")}c.prototype.hb=function(a){this.log("onGesture(%s)",a.type);if(!this.view.ga.get("allowZoom"))return!1;if("gesturestart"===a.type)this.start=new F(a.pageX,a.pageY),this.$n=this.view.xd(a.pageX,a.pageY),this.rect=this.view.Ve(),this.active=!0;else if("gesturechange"===a.type&&this.rect){var b=a.pageX-this.start.x,d=a.pageY-this.start.y;a=this.view.Di(1/
a.scale);a=new Ec(a,a,this.$n.x,this.$n.y);a=(new Cc(-b/this.view.scale,-d/this.view.scale)).multiply(a);b=this.rect.clone();b.transform(a);this.view.bh(b)}else"gestureend"===a.type&&(this.active=!1);return!0};return c}();var af=y.create("MOVE"),ef=function(){function c(a,b,d,c){var e=this;this.Ha=a;this.node=d;this.Ck=c;this.zo=!0;this.placeholder=this.zr=null;this.xj="column";this.$m=function(){};this.df=new Zd;this.Ll=new rb;this.Fd=null;af("Moving node: %s istool=%s",d.id,c);this.Kw=d.ba.style.position||"";this.Iw=d.ba.style.left||"";this.Lw=d.ba.style.top||"";this.Ek=d.ba.parentElement;this.Mw=A(d.ba).Ld("zIndex");this.Jw=d.ba.nextElementSibling;this.$t=null!==d.ba.getAttribute("confine")||1===c;this.Fk=d.Dm();
var h=this.Ha.xd(b.nb,b.ob,!0);this.start=h;if(2===c){a=bf(this.node.ba);var k=this.Ha.xd(a.x,a.y,!0);af("Moving fixture from %s; tl=%s",a,k);a.x=k.x;a.y=k.y;this.node.rect=a;this.Fk=this.node.rect}"IFRAME"===d.ba.tagName&&(this.zo=!1);d.ba.style.position="absolute";this.zo&&this.Ha.Li.appendChild(d.ba);d.ba.style.zIndex="1";1===c&&(this.node.rect=new I(h.x-this.node.ba.offsetWidth/2,h.y-this.node.ba.offsetHeight/2,this.node.ba.offsetWidth,this.node.ba.offsetHeight),this.Fk=this.node.rect,this.$m=
function(){af("Got image load event from dragged tool");e.ox(h)},this.node.ba.addEventListener("load",this.$m,!0));this.rect=this.node.Dm();d.ba.classList.add("dragging");this.Ha.aa.Ub(function(a){var b=a.rect;Zc(a)&&(b=a.Dm());e.df.lp(b,a.id)});this.tb(h.x,h.y,b)}c.prototype.Mc=function(){af("Entering DragHTMLBehaviour")};c.prototype.hb=function(a){if(this.Ha.ga.get("allowZoom")&&"gesturestart"===a.type){af("Switch to default behaviour");var b=new Te(this.Ha);this.Ha.Ra(b);b.hb(a);return!0}return!1};
c.prototype.lc=function(){this.node.ba.style.left=this.Iw;this.node.ba.style.top=this.Lw;this.node.ba.style.position=this.Kw;this.node.ba.style.zIndex=this.Mw;this.node.ba.style.transform="";this.node.ba.classList.remove("dragging");this.Ek?this.zo&&this.Ek.insertBefore(this.node.ba,this.Jw):A(this.node.ba).remove();this.Fd&&this.Fd.classList.remove("drop");af("DragHTMLBehaviour.leave()");this.Kr();this.node.ba.removeEventListener("load",this.$m,!0);this.Ll.cancel()};c.prototype.au=function(a,b){var d=
bf(b);d.transform(this.Ha.gk());a.x<d.x&&(a.x=d.x);a.y<d.y&&(a.y=d.y)};c.prototype.tb=function(a,b,d){var c=this;this.Ll.request(d,function(a){var b=c.Ha.xd(a.pageX,a.pageY).xy(c.start),d=c.Fk;c.rect.x=d.x+b.x;c.rect.y=d.y+b.y;c.$t&&c.Ek&&c.au(c.rect,c.Ek);c.Ha.ga.get("magnet")&&(b=c.df.qy(c.rect,c.node.id),c.rect.x+=b.x,c.rect.y+=b.y);c.node.ba.style.left=c.rect.x+"px";c.node.ba.style.top=c.rect.y+"px";b=bf(c.node.ba);b=c.Ju(b);null!==b?c.mt(b,a.pageX,a.pageY):c.Kr();a=c.node.ka("$component");var e=
null,f=bf(c.node.ba);A(c.Ha.he()).query('[z-drop-accept="'+a+'"]',function(a){var b=bf(a),d=Math.min(f.th(),b.th());a!==c.node.ba&&b.vr(f)>.7*d&&(e=a)});a=e;a!==c.Fd&&(c.Fd&&c.Fd.classList.remove("drop"),c.Fd=a,c.Fd&&c.Fd.classList.add("drop"))});return!0};c.prototype.Ju=function(a){var b=this.node.ka("$component"),d=null;A(this.Ha.he()).query("[container-for]",function(c){cf(c,b)&&bf(c).vr(a)>.5*a.th()&&(d=c)});return d};c.prototype.mt=function(a,b,d){A(a).Ld("flex-direction").startsWith("row")?
this.xj="row":this.xj="column";var c=this.xj,f=0,h=null,k,l=new F(b,d),n=null;for(k=a.firstElementChild;k;){if(!k.classList.contains("placeholder")){n=bf(k);n=(new F(n.x,n.y)).Lb(l);if(!h||n<f)h=k,f=n;n=k}k=k.nextElementSibling}h&&h===n&&(n=bf(h),"column"===c&&d>n.y||"row"===c&&b>n.x)&&(h=null);b=h;if(this.placeholder&&this.placeholder.parentNode){if(a!==this.placeholder.parentElement||b!==this.zr)this.zr=b,a.insertBefore(this.placeholder,b)}else d={},"column"===this.xj?(d.flex="0 0 "+this.node.ba.offsetHeight+
"px",d.minWidth=this.node.ba.offsetWidth+"px"):(d.flex="0 0 "+this.node.ba.offsetWidth+"px",d.minHeight=this.node.ba.offsetHeight+"px"),this.placeholder=A("div",{"class":"placeholder"}).$a(d).ba,a.insertBefore(this.placeholder,b)};c.prototype.Kr=function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)};c.prototype.Gb=function(a,b,d){this.Ll.cancel();af("onMouseUp()");if(1===this.Ck&&!bf(this.Ha.canvas.first).bd(d.pageX,d.pageY))return af("Dropped nowhere!"),
this.Ha.Ra(new Te(this.Ha)),!0;d="static";var c=0,f=0,h=0,k=this.Ha.aa.Ef();if(this.placeholder&&this.placeholder.parentElement){"flex"!==A(this.placeholder.parentElement).Ld("display")&&(d="absolute");var l=this.Ha.aa.zm(this.placeholder);if(l){k=l;c=this.placeholder;f=this.placeholder.parentElement.firstElementChild;for(h=0;f&&f!==c;)f.getAttribute("nid")&&h++,f=f.nextElementSibling;h=Math.min(h,l.Na()-1);af("Use placeholder, place at %s:%s",k.id,h);c=this.rect.x-l.rect.x;f=this.rect.y-l.rect.y}else af("Placeholder is not in a NID node")}else af("No placeholder; add to root"),
d="absolute",h=-1,c=this.rect.x,f=this.rect.y;this.Ha.Ra(new Te(this.Ha));this.node.ba.dispatchEvent(new CustomEvent("zwibbler-drop",{cancelable:!0,detail:{node:df(this.node.id),Dz:df(k.id),Cz:h,zz:a,Az:b}}))?(this.Ha.aa.Wa(),0===this.Ck||2===this.Ck?this.Ha.aa.Sc(this.node.id,k.id,h):k&&1===this.Ck&&(a=this.node.Pc(),"absolute"===d&&(a["style.position"]="absolute",a["style.left"]=c+"px",a["style.top"]=f+"px"),this.Ha.aa.createNode("HTMLNode",a,k.id,h),this.Ha.fb(),this.Ha.Xd(this.node)),"absolute"===
d?this.Ha.aa.wc([this.node.id],{"style.left":c+"px","style.top":f+"px","style.position":d}):this.Ha.aa.wc([this.node.id],{"style.left":"","style.top":"","style.position":""}),this.Fd&&(a=this.Ha.Aa.wq(this.Fd))&&(a=this.Ha.Aa.Gm(a),this.Ha.Aa.Gm(this.node.id),a&&a.element&&O.Kc(a.element,"drop",this.node.bk(null))),this.Ha.aa.ua(!1)):af("DragHTML was cancelled by element");return!0};c.prototype.ox=function(a){this.node.rect=new I(a.x-this.node.ba.offsetWidth/2,a.y-this.node.ba.offsetHeight/2,this.node.ba.offsetWidth,
this.node.ba.offsetHeight);this.Fk=this.node.rect};return c}();function bf(c){c=A(c).Wb();return new I(c.left,c.top,c.width,c.height)};var ff=y.create("RESIZE"),gf=function(){function c(a,b,d){this.Ha=a;this.node=b;this.hc=d;ff("Enter resize behaviour")}c.prototype.Mc=function(){};c.prototype.lc=function(){ff("Exit RESIZE")};c.prototype.tb=function(a,b,d){this.Ha.xd(d.pageX,d.pageY);b=(d.pageX-d.nb)/this.Ha.scale;var c=(d.pageY-d.ob)/this.Ha.scale;d=this.node.rect.clone();a=this.hc;if(a&16){var f=Math.min(Math.abs(b),Math.abs(c));b=Math.sign(b)*f;c=Math.sign(c)*f}switch(a){case 25:case 22:c=b;break;case 19:case 28:c=-b}Vd("D: %s,%s",
b,c);a&1&&(d.y+=c,d.height-=c);a&4&&(d.height+=c);a&8&&(d.x+=b,d.width-=b);a&2&&(d.width+=b);if(this.node.ba){a=this.node.ba;f=a.offsetParent;b=d.x;for(c=d.y;f instanceof HTMLElement&&f!==this.Ha.aa.Rc;)b-=f.offsetLeft,c-=f.offsetTop,f=f.offsetParent;f=A(a).Em();a.style.left=b-f.left+"px";a.style.top=c-f.top+"px";a.style.width=d.width-f.Ym-f.Hn+"px";a.style.height=d.height-f.po-f.Ol+"px"}return!0};c.prototype.Gb=function(){if(!this.node.ba)throw Error("Expected element to be created");this.Ha.Ra(new Te(this.Ha));
A(this.node.ba).Em();this.Ha.aa.Wa();this.Ha.aa.wc([this.node.id],{"style.left":this.node.ba.style.left,"style.top":this.node.ba.style.top,"style.width":this.node.ba.style.width,"style.height":this.node.ba.style.height});this.Ha.aa.ua(!1);return!0};return c}();var hf=y.create("DefaultBehaviour"),Te=function(){function c(a){this.view=a;this.Rr=1;this.view.Yk("");if(this.gh=this.view.ga.gh())this.Rr=2;this.$b=new $e(a)}c.prototype.Mc=function(){hf("Entering pick tool.");this.view.cc("default")};c.prototype.lc=function(){hf("Leaving pick tool.")};c.prototype.hb=function(a){return this.$b.hb(a)};c.prototype.yb=function(a,b,d){var c,f;hf("onMouseDown");if(d.button)return hf("   -- not main button. ignore."),!1;if(this.view.ga.get("readOnly"))return(c=this.view.aa.xb(a,
b,this.view.Va))?(hf("layer=%s active=%s",c.Vb(),this.view.Va),this.view.Aa.na("node-clicked",df(c.id),a,b)):hf("readOnly mode: Ignoring click."),!1;if(f=this.view.vv(a,b)){if(f.click())return this.view.Aa.digest(),!0;this.view.Ra(new Ye(this.view,f,!1,a,b));return!0}this.view.selection.length&&this.view.gw(d)&&this.view.Dh();if(this.view.Ba&&(c=this.view.Ba,f=c.nk(a,b,1/this.view.scale*this.Rr),null!==f))return this.view.Ra(new Ue(this.view,c,f,a,b,this,d)),!0;(c=this.view.aa.xb(a,b,this.view.Va))||
(c=this.view.aa.zm(d.target));f=c&&Yc(c);var h=this.view.df.Fm(a,b);if(c&&c.Vb()===this.view.Va){h=c===this.view.Ba;var k=this.view.ai(c);hf("wasEditNode: %s, wasSelected: %s",h,k);k||(d.shiftKey||this.view.fb(),this.view.Xd(c),this.view.Tb());if(f)return!1;this.view.Ra(new Ye(this.view,this.view.Fi?new Rd(Ld,c.La()):new Sd,!h&&k,a,b))}else if(this.view.Ar(a,b)){if(f)return!1;this.view.Ra(new Ye(this.view,this.view.Fi?new Rd(Ld,this.view.selection[0].La()):new Sd,!0,a,b))}else{if(!this.view.ga.Xu())return hf("Disabled select box -- mobile touch active."),
this.view.Yg(null),this.view.fb(),this.view.Tb(),this.view.ia(),!1;0==h.length&&(this.view.Yg(null),this.view.Ra(new We(this.view,this,a,b)))}return!0};c.prototype.tb=function(a,b){var d=this.view.df.Fm(a,b);d.length?this.view.cc(Wd(d[0].hc)):this.view.cc("default");return!1};c.prototype.Gb=function(){hf("onMouseUp");return!1};c.prototype.Ik=function(a,b){var d=this.view.aa.xb(a,b,this.view.Va);d&&this.view.Aa.na("node-clicked",df(d.id),a,b);return!1};c.prototype.mr=function(a,b,d){hf("Mouse drag!");
if(this.$b.active)return!0;if(wc(d.nc.target)||this.view.ga.get("readOnly"))return!1;a=this.view.xd(d.nb,d.ob,!0);b=this.view.df.Fm(a.x,a.y);if((a=b.length?this.view.aa.jb(b[0].id):this.view.aa.xb(a.x,a.y,this.view.yg()))&&Zc(a)&&a.Vb()===this.view.Va){var c=a.ba.hasAttribute("z-fixture");if(!c){if(c=b.length)a:{switch(b[0].hc){case 25:case 33:case 19:case 34:case 22:case 36:case 28:case 40:c=!0;break a}c=!1}b=c&&a.ba.hasAttribute("z-sizeable")?new gf(this.view,a,b[0].hc,d.nb,d.ob):new ef(this.view,
d,a,0);this.view.Ra(b)}}if(!a){a:{for(a=d.nc.target;a;){if(a.hasAttribute("z-drag-to-create")){b={ba:a,type:a.getAttribute("z-drag-to-create")};break a}a=a.parentElement}b=null}if(b){a=P.iv(b.type);a.$component=b.type;b=b.ba;c={};for(var f=0;f<b.attributes.length;f++){var h=b.attributes[f].name,k=b.attributes[f].value;if(h.startsWith("z-prop:")){h=h.substr(7);for(var l=!1,n="",q=0;q<h.length;q++){var u=h[q];"-"===u?l=!0:l?(n+=u.toUpperCase(),l=!1):n+=u.toLowerCase()}h=n;k=ib.mm(c,k,b);a[h]=k}}b=new jf(this.view.aa.Wj(),
this.view.aa);b.yd(a);b.format(this.view.za,this.view.request);this.view.Ra(new ef(this.view,d,b,1))}else(a=this.view.aa.zm(d.target))&&Zc(a)&&((c=a.ba.hasAttribute("z-fixture"))||this.view.Ra(new ef(this.view,d,a,2)))}return!1};c.prototype.td=function(a,b){hf("keyboard: %s on target %s",a,b.target.tagName);if("INPUT"!==b.target.tagName){var d=!0,c=this.view.ga.get("nudge");b&&b.ctrlKey&&(c=this.view.ga.get("preciseNudge"));var f=this.view.Ga.ub;switch(a){case "bring-to-front":this.view.ad(0);break;
case "send-to-back":this.view.ad(1);break;case "left":f||this.view.Dk(-1,0,c)||(this.view.pb=Math.min(this.view.pb+16,0),this.view.Hc(),this.view.ia());break;case "right":f||this.view.Dk(1,0,c)||(c=this.view.um().width,this.view.pb=Math.max(-(c*this.view.scale-c),this.view.pb-16),this.view.Hc(),this.view.ia());break;case "up":f||this.view.Dk(0,-1,c)||(this.view.eb=Math.min(this.view.eb+16,0),this.view.Hc(),this.view.ia());break;case "down":f||this.view.Dk(0,1,c)||(c=this.view.um().height,this.view.eb=
Math.max(-(c*this.view.scale-c),this.view.eb-16),this.view.Hc(),this.view.ia());break;case "select-none":this.view.fb();this.view.Tb();this.view.ia();f&&this.view.ic.na("goto-toolbar");break;case "select-all":var h=[];this.view.aa.Ub(function(a){h.push(a)});this.view.selectNodes(h);this.view.ia();f&&this.view.ic.na("goto-toolbar");break;case "duplicate":this.view.duplicate();break;case "move-up":this.view.ad(2);break;case "move-down":this.view.ad(3);break;case "delete":this.view.Dh();break;case "curve-tool":this.view.Ip({});
break;case "line-tool":this.view.Wq({},!1,!1);break;case "group":this.view.group();break;case "ungroup":this.view.fh();break;case "undo":this.view.Ac();break;case "redo":this.view.Qd();break;case "cut":this.view.$l();break;case "copy":this.view.sf(!1,this.view.Qc(!1));break;case "paste":this.view.xi();break;case "zoom-normal":this.view.ga.get("allowZoom")?this.view.zd(1):hf("Zooming is disabled.");break;case "zoom-in":this.view.ga.get("allowZoom")?this.view.nl():hf("Zooming is disabled.");break;case "zoom-out":this.view.ga.get("allowZoom")?
this.view.ol():hf("Zooming is disabled.");break;default:d=!1}d&&(b.preventDefault(),b.stopPropagation())}};c.prototype.sd=function(a,b){if(b){this.view.Eb=a;this.view.Kb=a;var d="fillStyle"}else this.view.Rb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.Ye=function(a,b){b?(this.view.Eb=rc(this.view.Eb,a),this.view.Kb=rc(this.view.Kb,a)):this.view.Rb=rc(this.view.Rb,a);this.view.Rn(a,b)};c.prototype.ln=function(a,b){hf("onDoubleClick");var d=this.view.aa.xb(a,b,this.view.Va);hf("hittest: %s, hasText: %s",
null!==d,null!==d&&d.Xh());this.view.Aa.na("double-click",a,b,d?df(d.id):null);if(d&&"PathNode"===d.type()&&!this.view.ga.get("allowTextInShape"))hf("Editing text in shape is disabled.");else if(d&&d.Xh()&&!this.view.ga.get("readOnly"))hf("Text double-clicked."),this.view.ho({}),this.view.pa instanceof Ze&&this.view.pa.ao(d,a,b);else return!1;return!0};c.prototype.nd=function(){return"pick"};return c}();var kf=function(){function c(a,b,d){var c=this;this.view=a;this.options=b;this.mode=d;this.Ze={};this.log=y.create("Brush");this.view.fb(!0);this.Mr=function(){return c.re()};this.$b=new $e(this.view)}c.prototype.re=function(){this.cn(this.Kd()/2)};c.prototype.hb=function(a){a=this.$b.hb(a);this.$b.active&&this.reset();return a};c.prototype.Mc=function(){this.view.cc("crosshair");this.cn(this.Kd()/2);window.addEventListener("resize",this.Mr)};c.prototype.lc=function(){this.view.cc("default");this.view.Sl("brush");
window.removeEventListener("resize",this.Mr)};c.prototype.reset=function(){this.Ze={}};c.prototype.cn=function(a){var b=document.createElement("canvas");a*=this.view.scale*this.view.Ph();a=Math.ceil(a+1);b.width=2*a+2;b.height=2*a+2;var d=b.getContext("2d");d.beginPath();"round"===(this.options.lineCap||"round")?d.arc(a+1,a+1,a,0,2*Math.PI):d.rect(1,1,2*a-2,2*a-2);d.lineWidth=2;d.strokeStyle="#ffffff";d.stroke();d.lineWidth=1;d.strokeStyle="#000000";d.stroke();b=b.toDataURL();this.view.cc("url("+
b+") "+(a+1)+" "+(a+1)+", auto")};c.prototype.Wg=function(a){this.options.strokeStyle=a};c.prototype.Kd=function(){var a=this.options.lineWidth;this.view.ga.get("adaptiveBrushWidth")&&(a/=this.view.scale);return a};c.prototype.Zk=function(a){this.options.lineWidth=a;this.cn(this.Kd()/2)};c.prototype.yb=function(a,b,d){if(this.$b.active)return!0;var c="freehand"===this.mode||"brush"===this.mode?new Vc:new Tc;c.nf(a,b);this.Ze[d.pointerId]=c;return!0};c.prototype.rr=function(a){var b,d,c=this.view.Cp(a);
a.lineCap=this.options.lineCap||"round";a.lineJoin="round"===a.lineCap?"round":"bevel";a.lineWidth=this.Kd();var f=a.globalAlpha;"opacity"in this.options&&(a.globalAlpha=this.options.opacity);a.beginPath();for(var h in this.Ze){var k=this.Ze[h].Im();a.moveTo(k[0].x,k[0].y);var l=b=1;for(d=k.length-1;b<=d;l=b+=1)l=k[l],a.lineTo(l.x,l.y)}uc(a,this.options.strokeStyle);c&&a.restore();a.globalAlpha=f};c.prototype.tb=function(a,b,d){var c=this;d.pointerId in this.Ze&&(this.Ze[d.pointerId].nf(a,b),"erase"===
this.options.strokeStyle?this.view.ia(function(a){return c.rr(a)}):this.view.Jr("brush",function(a){return c.rr(a)}));return!0};c.prototype.Gb=function(a,b,d){this.tb(a,b,d);this.view.Sl("brush");this.ua();return!0};c.prototype.ua=function(){var a,b;this.view.aa.Wa();var d="";for(var c in this.Ze){var f=this.Ze[c].Im();if("brush"===this.mode||"freehand"===this.mode){var h=[];1===f.length&&f.push(new F(f[0].x+.1,f[0].y+.1));if(1<f.length){d=a=0;for(b=f.length-1;a<=b;d=a+=1)h.push(f[d].x),h.push(f[d].y);
d=this.view.aa.createNode("BrushNode",vc({points:h,layer:this.view.Va},this.options,{lineWidth:this.Kd()}))}}else{if("shapebrush"===this.mode){f=Lc(f,20);var k;var l=f;if(!(2>l.length)){a=l[0];f=l[l.length-1];h=40>a.Lb(f);for(b=0;b<l.length;b++){var n=l[b];for(k=b+1;k<l.length;k++){var q=l[k];20>Math.abs(n.x-q.x)&&(q.x=n.x);20>Math.abs(n.y-q.y)&&(q.y=n.y)}}n=I.kh(l).Ed();for(b=0;b<l.length;b++)k=l[b],20>Math.abs(k.x-n.x)&&(k.x=n.x),20>Math.abs(k.y-n.y)&&(k.y=n.y);h&&(a.x=f.x,a.y=f.y)}f=l}else if("quadratic"===
this.mode){f=Lc(f,10);a=Bd(f);d=a.fa[1];h=a.fa[2];l=a.fa[4];b=a.fa[5];f=a.fa[8];a=a.fa[9];l=((3*l-d)/2+(3*l-f)/2)/2;b=((3*b-h)/2+(3*b-a)/2)/2;k=new L;k.moveTo(d,h);k.quadraticCurveTo(l,b,f,a);d=k;h=M.Hs(d);d=this.view.aa.createNode("PathNode",vc({commands:h,fillStyle:this.view.Eb,sloppiness:0,layer:this.view.Va},this.options,{lineWidth:this.Kd()}));continue}1===f.length&&"freehand"===this.mode&&f.push(new F(f[0].x+.1,f[0].y+.1));if(1<f.length){h=new N;h.moveTo(f[0].x,f[0].y);a=f[0].Nc(f[f.length-
1]);d=b=1;for(l=f.length-1;b<=l;d=b+=1)h.lineTo(f[d].x,f[d].y);a&&h.close();d=this.view.aa.createNode("PathNode",vc({commands:h.Ob(),fillStyle:this.view.Eb,sloppiness:0,layer:this.view.Va},this.options,{lineWidth:this.Kd()}))}}}this.view.aa.ua();this.view.fb();c=this.view.aa.jb(d);this.view.ga.get("singleStrokeBrush")?(c&&this.view.Xd(c),this.view.kb()):this.reset();this.view.Tb()};c.prototype.sd=function(a,b){this.options.strokeStyle=a;if(b){this.view.Eb=a;this.view.Kb=a;var d="fillStyle"}else this.view.Rb=
a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.Ye=function(a){this.view.Kb=rc(this.view.Kb,a);this.options.strokeStyle=rc(this.options.strokeStyle,a);this.view.Eb=this.view.Kb};c.prototype.td=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort brush and go back to toolbar."),this.view.kb(),this.view.ic.na("goto-toolbar"))};c.prototype.qe=function(a,b){"defaultBrushWidth"===a?this.Zk(b):"defaultBrushColour"===a&&this.Wg(b)};c.prototype.Rd=function(a,b){switch(a){case "lineWidth":this.Zk(b);
break;case "strokeStyle":case "fillStyle":this.Wg(b)}};c.prototype.nd=function(){return"circle"===this.mode?"ellipse":this.mode};c.prototype.ek=function(){return this.options};return c}();var lf=function(){function c(a,b,d,c,f){void 0===d&&(d={});void 0===c&&(c=!1);void 0===f&&(f=!1);this.view=a;this.type=b;this.da=d;this.Un=c;this.wj=f;this.node=null;this.rm=new F(0,0);this.yk=new F(0,0);this.index=0;this.state="start";this.log=y.create("DRAWLINES");"wrap"in this.da||(this.da.wrap=this.view.ga.get("multilineText"));"fontSize"in this.da||(this.da.fontSize=this.view.ga.get("defaultFontSize"));this.$b=new $e(this.view);this.view.fb(!0)}c.prototype.Mc=function(){this.log("Entering DrawLinesBehaviour");
this.view.cc("crosshair");this.view.ga.gh()||this.view.Yk("click-to-place-first-point-of-line");this.view.ia()};c.prototype.reset=function(){this.Mc()};c.prototype.hb=function(a){a=this.$b.hb(a);this.$b.active&&this.node&&this.reset();return a};c.prototype.td=function(a){"cancel"===a&&(null!==this.node&&this.view.Ga.ub&&"curve"===this.type&&this.ua(),null!==this.node&&(this.view.aa.Wa(),this.view.aa.Sb([this.node.id]),this.view.aa.ua(!0)),this.view.Ga.ub?this.view.ic.na("goto-toolbar"):this.view.kb())};
c.prototype.done=function(){this.view.ga.get("autoPickTool")?this.view.kb():this.state="start"};c.prototype.nf=function(a,b){this.node instanceof M&&("curve"===this.type||"arrow"===this.type||"linear-bezier"===this.type?this.node.Ch(a,b):this.node.lineTo(a,b))};c.prototype.yb=function(a,b){var d=this.view.Ta(new F(a,b));this.log("onMouseDown(%s, %s) state=%s, index=%s",a,b,this.state,this.index);if("start"===this.state){this.rm=d;var c={seed:Math.round(65535*Math.random()),strokeStyle:this.view.Rb,
lineWidth:this.Kd(),sloppiness:this.view.sa.sloppiness,smoothness:this.view.sa.smoothness};"arrow"===this.type&&(c.arrowSize=this.view.ga.Xa("defaultArrowSize"),c.arrowStyle=this.view.ga.Xa("defaultArrowStyle"),c.arrowXOffset=this.view.ga.Xa("defaultArrowXOffset"));for(var f in this.da)this.da.hasOwnProperty(f)&&(c[f]=this.da[f]);this.view.aa.Wa();c=this.view.aa.createNode("PathNode",c);this.view.aa.ua(!0);this.node=this.view.aa.jb(c);this.node.moveTo(d.x,d.y);this.nf(d.x,d.y);this.index=3;this.view.update();
this.state="predrag"}else if("placing"===this.state)if(c=this.yk.Lb(d),this.log("Mouse moved by %s",c),"arrow"!==this.type&&8>this.rm.Lb(d)&&3<this.index)this.log("Clicked close to start; automatically closing path"),this.node instanceof M&&this.node.close(),this.ua(),this.done();else if(8>this.yk.Lb(d))this.log("Didn't move. Stop drawing."),this.Ep(),this.done();else{if(this.Un)return this.ua(),this.done(),!0;this.node&&(this.nf(d.x,d.y),this.index+=3,this.view.aa.ki(this.node.id),this.view.update())}else return this.log("Invalid state %s",
this.state),!0;this.yk=new F(d.x,d.y);return!0};c.prototype.Ep=function(){3<this.index?(this.node instanceof M&&this.node.sx(this.index),this.ua()):this.cancel()};c.prototype.Gb=function(a,b){var d=new F(a,b);d=this.rm.Lb(d);this.log("onMouseUp (%s,%s) %s",a,b,this.state);"predrag"===this.state&&(this.log("MovedBy: %s",d),10<d?(this.ua(),this.done()):(this.state="placing",this.view.Yk("click-to-place-another-point-or-double-click-to-end-the-line")));return!0};c.prototype.tb=function(a,b,d){b=this.view.Ta(new F(a,
b));a=b.x;b=b.y;if(d.ctrlKey||this.wj){d=this.yk;var c=Math.atan2(b-d.y,a-d.x),f=Math.PI/8;c>=-f&&c<f?b=d.y:c>=f&&c<3*f?(a=Math.max(b-d.y,a-d.x),b=d.y+a,a=d.x+a):c>=3*f&&c<5*f?a=d.x:c>=5*f&&c<7*f?(a=Math.max(b-d.y,d.x-a),b=d.y+a,a=d.x-a):c>=7*f||c<=7*-f?b=d.y:c<5*-f?(a=Math.max(d.y-b,d.x-a),b=d.y-a,a=d.x-a):c<3*-f?a=d.x:(a=Math.max(d.y-b,a-d.x),b=d.y-a,a=d.x+a)}this.node&&(this.node.ne(this.index,a,b),this.node.format(this.view.za,this.view.request),this.view.ia());return!1};c.prototype.cu=function(a){for(var b=
0,d=[],c,f,h,k,l,n;b<a.length;){var q=a[b];switch(q){case M.fg:h=a[b+1];k=a[b+2];d.push(q,h,k);break;case M.Ee:c=a[b+1],f=a[b+2],void 0!==h&&void 0!==k&&void 0!==l&&void 0!==n&&d.push(M.jh,c,f,(l+h)/2,(n+k)/2,(h+c)/2,(k+f)/2),l=h,n=k,h=c,k=f}b+=M.bb[q]+1}return d};c.prototype.ua=function(){var a=this;if(this.node){this.node instanceof M&&this.node.zt();this.view.aa.Wa();this.view.aa.Sb([this.node.id]);this.view.aa.ua(!0);var b=this.view.ga.Xa("defaultArrowSize"),d=this.node.ka("commands");"linear-bezier"===
this.type&&(d=this.cu(d));var c={arrowSize:"arrow"===this.type?b:0,arrowStyle:this.view.ga.Xa("defaultArrowStyle"),arrowXOffset:this.view.ga.Xa("defaultArrowXOffset"),commands:d,seed:this.node.ka("seed"),fillStyle:this.view.Eb,strokeStyle:this.view.Rb,lineWidth:this.Kd(),sloppiness:this.view.sa.sloppiness,smoothness:this.view.sa.smoothness,layer:this.view.Va},f;for(f in this.da)this.da.hasOwnProperty(f)&&(c[f]=this.da[f]);this.view.aa.transaction(function(){a.view.aa.createNode("PathNode",c)});this.node=
null}};c.prototype.cancel=function(){this.node&&(this.view.aa.Wa(),this.view.aa.Sb([this.node.id]),this.view.aa.ua(!0),this.node=null)};c.prototype.lc=function(){this.Ep();this.view.cc("default");this.view.Yk("");this.view.ia()};c.prototype.sd=function(a,b){if(b){this.view.Eb=a;this.view.Kb=a;var d="fillStyle";this.log("We are drawing lines. Set strokeStyle instead of fillStyle")}else d="strokeStyle";this.view.Rb=a;this.view.setProperty(d,a)};c.prototype.Ye=function(a,b){b?(this.view.Eb=rc(this.view.Eb,
a),this.view.Kb=rc(this.view.Kb,a)):this.view.Rb=rc(this.view.Rb,a);this.view.Rn(a,b)};c.prototype.nd=function(){return this.type};c.prototype.Rd=function(a,b){this.da[a]=b};c.prototype.Kd=function(){return this.view.rh(this.view.sa.lineWidth)};return c}();var mf=function(){function c(a,b,d,c,f,h,k,l){var e=this;this.view=a;this.nodeType=b;this.da=d;this.width=c;this.height=f;this.Sr=h;this.Cy=k;this.state="initial";this.start=new F(0,0);this.end=new F(0,0);this.node=null;this.log=y.create("DrawShape");"rectangle-tl"===h&&(this.Qp=function(a){a.lineWidth=1/e.view.scale;a.strokeStyle="#ccc";a.beginPath();a.rect(e.start.x,e.start.y,e.end.x-e.start.x,e.end.y-e.start.y);a.stroke()});this.vp=null===l?this.view.ga.get("autoPickTool"):l;this.$b=new $e(this.view);
this.view.fb(!0)}c.prototype.Qp=function(){};c.prototype.Mc=function(){this.log("Entering DrawShapeBehaviour");this.view.cc("crosshair")};c.prototype.lc=function(){this.log("Leaving DrawShapeBehaviour");this.cancel()};c.prototype.cancel=function(){this.node&&(this.view.aa.Wa(),this.view.aa.Sb([this.node.id]),this.view.aa.ua(!0),this.view.update(),this.node=null);this.state="initial"};c.prototype.hb=function(a){a=this.$b.hb(a);this.node&&this.$b.active&&(this.view.aa.Wa(),this.view.aa.Sb([this.node.id]),
this.view.aa.ua(!0),this.node=null,this.state="initial");return a};c.prototype.td=function(a){"cancel"===a&&this.view.kb()};c.prototype.yb=function(a,b){"initial"===this.state&&(this.start=this.view.Ta(new F(a,b)),this.state="predraw",this.log("initial -> predraw"));return!0};c.prototype.tb=function(a,b,d){a=this.view.Ta(new F(a,b));d=d.ctrlKey;"predraw"===this.state&&10<this.start.Lb(a)&&(this.create(),this.state="drawing",this.log("predraw -> drawing"));"drawing"===this.state&&(this.transform(this.start,
a,d),this.end=a,this.view.update(!1,this.Qp));return!0};c.prototype.Gb=function(a,b,d){"predraw"===this.state?this.view.ga.get("clickToDrawShapes")?(this.create(),this.transform(this.start,null,d.ctrlKey),this.ua(),this.vp&&this.view.kb(),this.state="initial"):this.cancel():"drawing"===this.state&&(this.transform(this.start,this.view.Ta(new F(a,b)),d.ctrlKey),this.ua(),this.vp&&this.view.kb(),this.state="initial");return!0};c.prototype.create=function(){this.view.aa.Wa();var a=this.view.aa.createNode(this.nodeType,
this.da);this.node=this.view.aa.jb(a);this.view.aa.ua(!0)};c.prototype.transform=function(a,b,d){if(b)if("circle"===this.Sr){var c=a;a=a.Lb(b);var f=2*a/this.width;a=2*a/this.height}else{if("rectangle-tl"===this.Sr)a=a.clone(),b=b.clone(),a.x>b.x&&(f=a.x,a.x=b.x,b.x=f),a.y>b.y&&(f=a.y,a.y=b.y,b.y=f),c=a;else if(f=[a,b],0===f.length)c=new F(0,0);else{c=f[0].x;for(var h=f[0].y,k=1;k<f.length;k++)c+=f[k].x,h+=f[k].y;c=new F(c/f.length,h/f.length)}f=(b.x-a.x)/this.width;a=(b.y-a.y)/this.height}else c=
a,a=f=1;d&&(a=f=Math.min(f,a));d=new Cc(c.x,c.y);d=d.multiply(new Ec(f,a));this.node&&(this.node.Zg(d),this.view.aa.ki(this.node.id))};c.prototype.ua=function(){var a=this;this.node&&(this.da.matrix=this.node.La(),this.view.aa.Wa(),this.view.aa.Sb([this.node.id]),this.view.aa.ua(!0),this.node=null,this.view.aa.transaction(function(){a.view.aa.createNode(a.nodeType,a.da)}))};c.prototype.Zk=function(a){this.da.lineWidth=this.view.rh(a)};c.prototype.sd=function(a,b){Te.prototype.sd.call(this,a,b);this.da[b?
"fillStyle":"strokeStyle"]=a};c.prototype.Ye=function(a,b){Te.prototype.Ye.call(this,a,b);var d=b?"fillStyle":"strokeStyle",c=rc(this.da[d],a);this.log("oldColour=%s+opacity %s = %s",this.da[d],a,c);this.da[d]=c};c.prototype.nd=function(){return this.Cy};c.prototype.Rd=function(a,b){this.da[a]=b};c.prototype.ek=function(){return this.da};c.prototype.qe=function(a,b){"defaultLineWidth"===a&&this.Zk(b)};return c}();var nf=function(){function c(a,b,d){this.view=a;this.da=b;this.Dw=d;this.state="none";this.scale=1;this.log=y.create("ImageStamp");this.Pa=document.createElement("img");this.url=this.Pa.src=b.url;"scale"in this.da&&(this.scale=this.da.scale,delete this.da.scale)}c.prototype.nd=function(){return"imagestamp"};c.prototype.Mc=function(){this.log("Entering ImageStampBehaviour");this.view.cc("move")};c.prototype.lc=function(){this.log("Leaving ImageStampBehaviour");this.view.ia()};c.prototype.Ta=function(a,
b){this.Pa.complete&&(a-=this.Pa.width/2,b-=this.Pa.height/2);return this.view.Ta(new F(a,b))};c.prototype.yb=function(a,b,d){var c=this;this.log("onMouseDown type %s",d.type);var f=this.Ta(a,b);this.view.aa.transaction(function(){c.view.aa.createNode("ImageNode",vc({},c.da,{url:c.url,layer:c.view.Va,matrix:(new Cc(f.x,f.y)).multiply(new Ec(c.scale,c.scale))}))});this.Dw||(this.log("MultiStamp not set; return to pick mode."),this.view.kb());return!0};c.prototype.tb=function(a,b){this.Pa.complete||
this.log("Don't draw; image not loaded.");var d=this.Ta(a,b),c=this;this.view.ia(function(a){var b=a.globalAlpha;a.globalAlpha=.5;a.drawImage(c.Pa,d.x,d.y,c.Pa.naturalWidth*c.scale,c.Pa.naturalHeight*c.scale);a.globalAlpha=b});return!0};c.prototype.Gb=function(){return!0};c.prototype.td=function(a){"cancel"===a&&(this.view.kb(),this.view.ic.na("goto-toolbar"))};return c}();var of=function(){function c(a){this.view=a;this.state="none";this.start=new F(0,0);this.ps=this.os=0;this.log=y.create("PanTool");this.$b=new $e(a)}c.prototype.Mc=function(){this.log("Entering PanToolBehaviour");this.view.cc("all-scroll")};c.prototype.lc=function(){this.log("Leaving PanToolBehaviour")};c.prototype.hb=function(a){return this.$b.hb(a)};c.prototype.zq=function(a){return new F(a.pageX,a.pageY)};c.prototype.yb=function(a,b,d){this.log("onMouseDown type %s",d.type);if(this.view.ew(d)){var c=
new Te(this.view);this.view.Ra(c);return c.yb(a,b,d)}this.state="dragging";this.start=this.zq(d);this.os=this.view.pb;this.ps=this.view.eb;return!0};c.prototype.tb=function(a,b,d){if("dragging"!==this.state)return!1;a=this.zq(d);b=this.ps+a.y-this.start.y;this.view.pb=this.os+a.x-this.start.x;this.view.eb=b;this.view.Hc();this.view.ia();return!0};c.prototype.Gb=function(){this.state="none";return!0};c.prototype.mn=function(a,b,d,c){if(!this.view.ga.get("allowZoom"))return this.log("Zooming is disabled."),
!1;this.log("onMouseWheel(%s, %s, %s)",a,b,d);d=0<d?1/1.1:1.1;a=new Ec(d,d,a,b);b=this.view.Ve();b.transform(a);this.view.bh(b);c.stopPropagation();c.preventDefault();return!0};c.prototype.td=function(a){"cancel"===a&&this.view.kb()};c.prototype.nd=function(){return"pan"};return c}();for(var pf,qf=[],rf=0;4>rf;rf++)qf.push(String.fromCharCode(">2$-".charCodeAt(rf)^"zwibbler3".charCodeAt(rf%9)));pf=qf.join("");for(var sf,tf=[115,116,114,111,107,101,84,101,120,116],uf=[],vf=0;vf<tf.length;vf++)uf.push(String.fromCharCode(tf[vf]));sf=uf.join("");
var xf=function(){function c(a,b,d,e,f,h,k,l,n,q){var u=this;this.Oc=a;this.canvas=b;this.aa=d;this.ic=e;this.ga=f;this.language=h;this.Aa=k;this.xa=l;this.Li=n;this.Ie=q;this.Vd="none";this.Pi=this.Oi=0;this.scale=1;this.eb=this.pb=0;this.gd=new I(0,0,0,0);this.Jn=new Mc;this.Fi=this.Gi=this.Vk=!0;this.In=new J;this.selection=[];this.Zf=[];this.Va="default";this.ze=this.im=!1;this.ld=1;this.background=this.Ge=null;this.mj={};this.wp=null;this.backgroundRepeat="no-repeat";this.Gd=this.Ba=null;this.Ko=
4;this.Lo=3*this.Ko;this.gf=this.Hh=null;this.jg=!1;this.Kb=this.Eb=this.Rb="#000000";this.ug=5;this.Gg="";this.bc=0;this.hn=new I(0,0,0,0);this.jn=new I(0,0,0,0);this.Ga={ub:!1,Fb:!1,Ql:!1,x:100,y:100};this.qk=new ub;this.ik=[];this.df=new Zd;this.log=y.create("VIEW");this.za=this.canvas.get(0);this.canvas.ft();this.ze=!0===f.get("pageView");this.qx();this.pa=new Te(this);this.xa.add(function(){u.pa&&u.pa.lc&&u.pa.lc();u.request.xh();u.pd.xh();u.pc.xh();u.pa={};u.aa.Ua()});this.pd=new Kd("horizontal",
!0,this.xa);this.pd.$c(this.canvas.get(0).canvas.parentNode);this.pc=new Kd("vertical",!1,this.xa);this.pc.$c(this.canvas.get(0).canvas.parentNode);var v=this;this.request=new Wc;this.request.canvas=this.canvas.get(0).canvas;this.request.ga=this.ga;this.request.oa("reformat",function(a){u.log("Node %s requests reformat",a);u.aa.Se(a)&&(u.log("   Reformatting... zoom=%s",u.Vd),u.aa.ki(a));u.update();(a=u.aa.jb(a))&&"background"===a.Vb()&&u.Bh();u.Ug();u.Aa.na("resource-loaded")});this.request.oa("convert-dom-request",
function(a,b){v.Aa.na("convert-dom-request",b,a)});this.request.oa("mouseevent",function(a){u.Dy.handleEvent(a)});f.oa("useTouch",function(){v.gf=null;v.Lo=3*v.Ko});this.pc.oa("scroll",function(a){v.eb=-a*v.scale;v.Aa.na("scroll");u.qo();v.ia()});this.pd.oa("scroll",function(a){v.pb=-a*v.scale;v.ia();u.qo();v.Aa.na("scroll")});this.Bh();this.aa=this.ag(d);this.ga.oa("update",function(a,b){v.qe(a,b)});this.xa.addEventListener(document,"webkitfullscreenchange",function(){0<=navigator.userAgent.search("Safari")&&
0>navigator.userAgent.search("Chrome")&&(u.log("SAFARI WORKAROUND: Disabling requestAnimationFrame."),u.requestAnimationFrame=c.prototype.requestAnimationFrame)});a=document;a.fonts&&this.xa.addEventListener(a.fonts,"loadingdone",function(){u.log("Font loading done, redraw now.");u.ia()});this.Zc(.5,0,0,-30,"","rotate");this.Zc(0,0,0,0,"","scale");this.Zc(1,0,0,0,"","scale");this.Zc(1,1,0,0,"","scale");this.Zc(0,1,0,0,"","scale");this.Zc(.5,0,0,0,"","scale");this.Zc(1,.5,0,0,"","scale");this.Zc(.5,
1,0,0,"","scale");this.Zc(0,.5,0,0,"","scale");this.pa=this.kb()}c.prototype.rh=function(a){this.ga.get("adaptiveBrushWidth")&&(a/=this.scale);return a};c.prototype.Vv=function(a){var b,d=!1;for(b=0;b<a.Sk.length;b++){var c=a.Sk[b];c in this.mj&&(this.log("Background node has been removed"),d=!0)}for(b=0;b<a.ij.length;b++){c=a.ij[b];var f=this.aa.Ma(c,!1);"background"===f.ka("layer")&&(this.log("Background node has been added"),d=!0)}for(b=0;b<a.il.length;b++)c=a.il[b],f=this.aa.Ma(c,!1),"background"===
f.ka("layer")?(this.log("Background node has been changed"),d=!0):c in this.mj&&(this.log("Node removed from background layer"),d=!0);d&&this.Bh();a.ij.length&&this.Aa.na("nodes-added",wf(a.ij));a.il.length&&this.Aa.na("nodes-changed",wf(a.il));a.Sk.length&&this.Aa.na("nodes-removed",wf(a.Sk))};c.prototype.requestAnimationFrame=function(a){a()};c.prototype.yg=function(){this.log("getActiveLayer() -> %s",this.Va);return this.Va};c.prototype.Xk=function(a){this.log("setActiveLayer(%s)",a);this.Va=a;
this.fb();this.Tb();this.ia()};c.prototype.Ji=function(a,b){this.aa.Ji(a,b);this.Kg(!1);b||a!==this.Va||(this.fb(),this.Tb());this.ia()};c.prototype.ag=function(a){var b=this;this.log("setDocument()");this.kb();this.aa.Ua();this.aa=a;this.aa.ur=function(a,d,c,k){b.Hk(a,d,c,k)};this.scale=1;this.eb=this.pb=0;this.selection=[];this.Gd=this.Ba=null;this.bc+=1;this.gd=new I(0,0,0,0);this.Jn=new Mc(this.gd);this.In=new J;this.Gg="";this.Va="default";this.Eb="#ffffff";this.Kb=this.ga.Xa("defaultBrushColour");
this.Rb=this.ga.Xa("defaultStrokeStyle");this.sa={};this.sa.lineWidth=this.ga.Xa("defaultLineWidth");this.sa.sloppiness=.5;this.sa.fontName=this.ga.Xa("defaultFont");this.sa.fontSize=this.ga.Xa("defaultFontSize");this.sa.bold=this.ga.Xa("defaultBold");this.sa.italic=this.ga.Xa("defaultItalic");this.sa.smoothness=.3;this.sa.textFillStyle=this.ga.Xa("defaultTextFillStyle");this.sa.textStrokeStyle=this.ga.Xa("defaultTextStrokeStyle");this.sa.textLineWidth=this.ga.Xa("defaultTextLineWidth");this.sa.textDecoration=
this.ga.Xa("defaultTextDecoration");this.sa.textAlign=this.ga.Xa("defaultTextAlign");this.ug=this.ga.get("defaultBrushWidth");var d=this.Df();this.pb=-d.x;this.eb=-d.y;this.Hc();this.aa.Yn=this.ga.get("spotHighlightColour");this.aa.al=this.ga.get("spotHighlightZIndex");this.aa.format(this.za,this.request);this.jn=new I(0,0,0,0);this.hn=new I(0,0,0,0);"none"!==this.Vd?this.zd(this.Vd):(this.zd(this.ga.get("defaultZoom")),this.ia());return a};c.prototype.qe=function(a,b){var d=!1;switch(a){case "allowResize":this.uh();
this.ia();break;case "defaultBrushColour":this.Kb=b;break;case "defaultFillStyle":this.Eb=this.sa.fillStyle=b;break;case "defaultStrokeStyle":this.Rb=b;this.sa.strokeStyle=b;break;case "defaultLineWidth":this.sa.lineWidth=b;break;case "defaultFont":this.sa.fontName=b;break;case "defaultBold":this.sa.bold=b;break;case "defaultTextAlign":this.sa.textAlign=b;break;case "defaultTextDecoration":this.sa.textDecoration=b;break;case "defaultItalic":this.sa.italic=b;break;case "defaultFontSize":this.sa.fontSize=
b;break;case "defaultTextFillStyle":this.sa.textFillStyle=b;break;case "defaultTextStokeStyle":this.sa.textStrokeStyle=b;break;case "defaultTextLineWidth":this.sa.textLineWidth=b;break;case "defaultBrushWidth":this.ug=b;break;case "defaultZoom":this.zd(b);break;case "pageView":this.ze=b;d=!0;break;case "pagePlacement":case "pageInflation":this.zd(this.Vd);break;case "snap":case "background":case "gridSpacing":case "gridBlocks":case "gridColour":this.Bh();d=!0;break;case "pageShadow":case "outsidePageColour":d=
!0;break;case "readOnly":!0===b&&(this.kb(),this.fb(),this.Tb(),d=!0);this.aa.$g(b);break;case "spotHighlightColour":this.aa.Yn=b;d=!0;break;case "spotHighlightZIndex":this.aa.al=b;d=!0;break;case "showRuler":case "pixelsPerUnit":case "units":d=!0}this.pa.qe&&this.pa.qe(a,b);d&&this.ia()};c.prototype.ye=function(a,b){this.log("Set default %s=%s",a,b);this.sa[a]=xc(this.sa[a],b);switch(a){case "fillStyle":this.Kb=this.Eb=b;break;case "strokeStyle":this.Kb=this.Rb=b}};c.prototype.zd=function(a){a!==
this.Vd&&this.log("Zooming to: %s (scale %s)",a,this.scale);var b=this.Te().width-20;var d=this.aa.Yv()||this.ze;var c=!0;this.Vd=a;d||"number"===typeof a||(this.log("WARNING: Cannot zoom to page/width because the document size has not been set."),c="page"===a||"width"===a);if("number"===typeof a)this.scale=a;else if("none"===a||this.aa.empty()||!d)this.scale=1;else{if("page"===a)return d=this.Df(),this.bh(d,"centre"===this.ga.get("pagePlacement"),!0),this.Vd=a,this.pa.re&&this.pa.re(),c;"width"===
a&&(d=this.Df(),this.scale=b/d.width,this.pb=-d.x*this.scale,this.eb=-d.y*this.scale,this.log("RECT=%s scale=%s tx=%s ty=%s",d,this.scale,this.pb,this.eb),this.Vd=a)}this.Hc();this.ia();this.pa.re&&this.pa.re();return c};c.prototype.xd=function(a,b,d){void 0===d&&(d=!1);a=this.gk().apply(a,b);d||(a=this.Ta(a));return a};c.prototype.cm=function(a,b){return this.gk().inverse().apply(a,b)};c.prototype.Gw=function(a,b,d){return a.fe().multiply(this.gk()).apply(b,d)};c.prototype.Be=function(a){return this.xd(a.pageX,
a.pageY,!0)};c.prototype.td=function(a,b){if("TEXTAREA"!==b.target.tagName&&"INPUT"!==b.target.tagName&&"BUTTON"!==b.target.tagName&&!b.target.isContentEditable&&(this.pa.td&&this.pa.td(a,b),!this.Wv(a,b))){switch(a){case "next-page":this.yc(this.aa.cb+1);break;case "previous-page":this.yc(this.aa.cb-1);break;case "zoom-to-page":this.ga.get("allowZoom")&&this.zd("page");break;case "zoom-to-width":this.ga.get("allowZoom")&&this.zd("width")}b.preventDefault();b.stopPropagation()}};c.prototype.wi=function(a){var b=
a instanceof Ce?a.nc.target:a.target;var d=this.ga.get("readOnly");b=b&&b.matches&&(!b.matches(".zwibbler-canvas-holder,.zwibbler-canvas-holder *, [z-drag-tool], [z-drag-tool] *, [z-fixture] *")||b.matches(".zwibbler-passthrough, .zwibbler-passthrough *")||d&&b.matches(".zwibbler-dom-node,.zwibbler-dom-node *"));a instanceof Ce&&((b=b&&!a.getData("not-passthrough"))||"down"!==a.type?"gesturestart"===a.type&&(b=b&&this.ke(a.pageX,a.pageY)):a.setData("not-passthrough",!0));return b};c.prototype.ke=
function(a,b){var d=this.xd(a,b);return this.Ve().bd(d.x,d.y)};c.prototype.ew=function(a){return a.target.matches("[z-fixture], [z-fixture] *")};c.prototype.qx=function(){function a(a){d.log(a.type)}function b(a){a.stopPropagation();a.preventDefault()}var d=this,c=this,f=new Ke(this.Oc,{op:this.ga.get("allowPointerEvents"),vo:!0});this.Dy=f;this.xa.add(function(){f.Ua()});f.oa("gesturestart",function(a){c.log("GestureStart");d.wi(a)||(c.pa.hb&&!1!==c.pa.hb(a)?(a.stopPropagation(),a.preventDefault()):
c.log("Pass to browser"))});f.oa("gesturechange",function(a){c.pa.hb&&!1!==c.pa.hb(a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass to browser")});f.oa("gestureend",function(a){c.log("GestureEnd");c.pa.hb&&!1!==c.pa.hb(a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass to browser")});var h="onpointerdown"in window,k="ongesturestart"in window,l="onmousedown"in window;this.log("Have TouchEvents: %s","ontouchstart"in window);this.log("Have PointerEvents: %s",h);this.log("Have GestureEvents: %s",
k);this.log("Have MouseEvents: %s",l);h&&!this.ga.get("allowPointerEvents")&&this.log("Configuration does not allow PointerEvents");var n=!1,q;f.oa("down",function(a){c.log(a.toString());d.wi(a)||(n=!0,c.pa.yb&&(q=c.Be(a),!1!==c.pa.yb(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault())),d.im||d.ic.na("goto-canvas"),d.im=!1)});f.oa("move",function(a){d.wi(a)||(n&&0===a.buttons&&(c.log("MISSED POINTERUP! Fixing."),u(a)),c.pa.tb&&(q=c.Be(a),!1!==c.pa.tb(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault())))});
var u=function(a){d.wi(a)||(n=!1,c.log(a.toString()),q=c.Be(a),c.pa.Gb&&!1!==c.pa.Gb(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))};f.oa("up",u);f.oa("tap",function(a){c.log(a.toString());c.pa.Ik&&(q=c.Be(a),!1!==c.pa.Ik(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});f.oa("drag",function(a){c.log(a.toString());c.pa.mr&&(q=c.Be(a),!1!==c.pa.mr(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});f.oa("doubletap",function(a){c.log("doubletap: "+a.toString());c.pa.ln&&(q=c.Be(a),
!1!==c.pa.ln(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});this.xa.addEventListener(this.Oc,"pointerleave",function(a){c.pa.nr&&(q=c.Be(a),!1!==c.pa.nr(q.x,q.y,a)&&(a.stopPropagation(),a.preventDefault()))});this.xa.addEventListener(this.Oc,"contextmenu",function(a){var b=c.Be(a);c.pa.ir&&!1!==c.pa.ir(b.x,b.y,a)?(a.stopPropagation(),a.preventDefault()):c.log("Pass contextmenu to browser")});this.xa.addEventListener(this.Oc,"mouseenter",b);this.xa.addEventListener(this.Oc,"mouseleave",b);
this.xa.addEventListener(this.Oc,"mouseover",b);this.xa.addEventListener(this.Oc,"mouseout",b);!window.parent&&this.ga.get("setFocus")&&this.Oc.focus();f.oa("wheel",function(a){if(!d.wi(a)){var b=-40*a.kv().y,e=b/120*32;q=c.Be(a);if((!c.pa.mn||!1===c.pa.mn(q.x,q.y,e,a.nc))&&c.pc.hw()){var f=c.Df();c.eb=-120>=b?Math.max(c.eb+e,-(f.bottom()*c.scale-c.canvas.height)):Math.min(c.eb+e,-f.y*c.scale);c.Hc();c.ia();a.stopPropagation();a.preventDefault()}}});this.xa.addEventListener(this.Oc,"drop",a);this.xa.addEventListener(this.Oc,
"dragenter",a);this.xa.addEventListener(this.Oc,"dragleave",a)};c.prototype.Kf=function(a){this.log("Received clipboard event: %s",a.type);if(this.ga.get("allowSystemClipboard"))if(null===a.clipboardData)this.log("Ignored; clipboardData is null.");else{var b=this;switch(a.type){case "copy":case "cut":if(!this.Gq())break;this.log("Cut to system clipboard.");var c=this.sf(!0,this.Qc(!1));a.clipboardData.setData("application/zwibbler",c);a.preventDefault();"cut"===a.type&&this.Dh();break;case "paste":for(this.log("There are %s items on the clipboard",
a.clipboardData.items.length),c=0;c<a.clipboardData.items.length;c++){var e=a.clipboardData.items[c];this.log("Item [%s] type is %s",c,e.type);if(b.wn(e)){a.preventDefault();break}else if("application/zwibbler"===e.type){this.log("Pasting from system clipboard");e.getAsString(function(a){b.xi(a)});a.preventDefault();break}}}}else this.log("   ignored due to allowSystemClipboard setting.")};c.prototype.he=function(){return this.Oc};c.prototype.wn=function(a){var b=this;if(0!==a.type.indexOf("image/"))return!1;
a instanceof File||(a=a.getAsFile());if(!1===this.Aa.Kc("paste",a))this.log("paste of file is cancelled by external app.");else{var c=new FileReader;c.readAsDataURL(a);c.onloadend=function(){b.Ew(c.result)};return!0}};c.prototype.Wv=function(a,b){if(!this.Ga.ub)return!1;var c=0,e=0,f=this.ga.get("nudge");switch(a){case "right":c=f;break;case "left":c=-f;break;case "down":e=f;break;case "up":e=-f;break;case "enter":if(this.pa.Ik){this.Ga.Fb=!1;var h="tap"}else this.Ga.Fb=!this.Ga.Fb,h=this.Ga.Fb?"down":
"up"}if(c||e)h=this.Te(),this.Ga.x+=c,this.Ga.x=Math.max(this.Ga.x,0),this.Ga.x=Math.min(h.width,this.Ga.x),this.Ga.y+=e,this.Ga.y=Math.max(this.Ga.y,0),this.Ga.y=Math.min(h.height,this.Ga.y),this.ia(),h="move";return h?(b.preventDefault(),b.stopPropagation(),this.ia(),e=A(this.canvas.first).Wb(),c=this.Ga.x+e.left-window.pageXOffset,f=this.Ga.y+e.top-window.pageYOffset,e=this.xd(c,f),this.log("Simulate a %s at (%s,%s)",h,c,f),c=new Ce(h,c,f,c,f,(new Date).getTime(),(new Date).getTime(),b.target,
b,0,{},0,0,0,!1,!1),"down"!==h&&"tap"!==h||!this.pa.yb||this.pa.yb(e.x,e.y,c),"move"===h&&this.pa.tb&&this.pa.tb(e.x,e.y,c),"up"!==h&&"tap"!==h||!this.pa.Gb||this.pa.Gb(e.x,e.y,c),!0):!1};c.prototype.Tn=function(a){void 0===a&&(a=!1);this.Ga.ub=!0;this.Ga.Fb=!1;this.Ga.Ql=a;this.log("Showing keyboard cursor, caret=%s",a);this.ia()};c.prototype.my=function(){this.Ga.ub=!0;this.Ga.Ql=!1;if(0<this.selection.length){this.log("showKeyboardCursorAndStartMoving()");this.Ga.Fb=!0;var a=this.gd.Ed();this.Ga.x=
a.x;this.Ga.y=a.y;this.kb();this.Ra(new Ye(this,new Rd(Ld,this.selection[0].La()),!1,a.x-4,a.y-4))}this.ia()};c.prototype.Zv=function(){this.Ga.ub&&(this.log("Hiding keyboard cursor"),this.Ga.ub=!1,this.ia())};c.prototype.gw=function(a){var b=A(this.canvas.first).Wb(),c=this.pc.Cg();var e=a.pageX-b.left;a=a.pageY-b.top;b=this.Te();return this.gf&&e>b.width-this.gf.width-c&&a<this.gf.height};c.prototype.Ta=function(a,b){void 0===b&&(b=0);b=b||this.ga.get("snap")||0;this.ga.get("autoSnap");if(0<b){var c=
Math.round(a.x/b)*b;var e=Math.round(a.y/b)*b}else c=a.x,e=a.y;return new F(c,e)};c.prototype.ad=function(a,b){void 0===b&&(b=this.Qc(!1));this.aa.Wa();this.aa.ad(b,a);this.aa.ua()};c.prototype.setProperty=function(a,b){var c=this.Qc(!0);this.sa[a]=b;if(c.length){this.aa.Wa();this.aa.xc(c,a,b);if("fillStyle"===a)for(var e=0;e<c.length;e++){var f=this.aa.Ma(c[e],!1);f&&(this.log("nodeType=%s closed=%s",f.type(),f.ka("closed")),"PathNode"===f.type()&&!1===f.ka("closed")&&this.aa.xc([c[e]],"strokeStyle",
b))}this.aa.ua()}0<this.selection.length&&"lineWidth"===a&&"BrushNode"===this.selection[0].type()?this.ug=b:"textFillStyle"===a&&(this.sa.textFillStyle=b)};c.prototype.Rd=function(a,b){this.pa.Rd&&this.pa.Rd(a,b);this.pa.sd&&("strokeStyle"===a?this.pa.sd(b,!1):"fillStyle"===a&&this.pa.sd(b,!0))};c.prototype.Vj=function(){return this.sa.fillStyle};c.prototype.ck=function(){return this.sa.strokeStyle};c.prototype.Rn=function(a,b){this.log("setSelectionOpacity(%s, fill=%s)",a,b);var c=this.Qc(!0);this.aa.Wa();
for(var e=b?"fillStyle":"strokeStyle",f=0;f<c.length;f++){var h=c[f],k=this.aa.Ma(h);k&&(k=k.ka(e))&&(k=rc(k,a),this.aa.xc([h],e,k),this.log("   set %s of %s to %s",e,h,k))}this.aa.ua()};c.prototype.group=function(){var a=this;this.aa.transaction(function(){a.aa.group(a.Qc(!1))})};c.prototype.fh=function(){var a=this;this.aa.transaction(function(){a.aa.fh(a.Qc(!1))})};c.prototype.Dh=function(){var a=this;this.aa.transaction(function(){a.aa.Sb(a.Qc(!1))})};c.prototype.fb=function(a){void 0===a&&(a=
!1);var b=!1;if(0<this.selection.length){b=0;for(var c=this.selection;b<c.length;b++){var e=c[b];Zc(e)&&e.ba.classList.remove("zwibbler-selected")}this.bc+=1;this.selection.length=0;this.log("Clear selection. selectGeneration=%s",this.bc);b=!0}null!==this.Gd&&(this.Aa.na("selected-edit-handle",null,null),b=!0);this.Ba&&(this.log("Clear selection."),this.Gd=this.Ba=null,b=!0);b&&a&&(this.Tb(),this.ia())};c.prototype.Xd=function(a,b){void 0===b&&(b=!0);this.Yg(null);if(a.bc!==this.bc&&a.Vb()===this.Va){this.selection.push(a);
a.bc=this.bc;if(5===(a.Db&5))Zc(a)&&a.ba.classList.add("zwibbler-selected");else{if(a.Tm()){for(var c=a.parent,e=0;e<c.Na();e++){var f=c.rb(e);Xc(f)&&this.Xd(f)}Xc(c)&&this.Xd(c)}for(c=0;c<a.Na();c++)f=a.rb(c),Xc(f)&&this.Xd(f)}if(this.ga.get("autoGroup")&&b)for(f=0,c=this.aa.Zu(a);f<c.length;f++)this.Xd(c[f],!1)}};c.prototype.selectNodes=function(a){this.fb();for(var b=0;b<a.length;b++)a[b].ka("locked")||"PageNode"===a[b].type()||this.Xd(a[b]);this.Tb()};c.prototype.Fx=function(a,b){var c=this.aa.jb(a,
!1);c?c.We()&&(c.Pq()?(c!==this.Ba&&this.Yg(c),this.log("Select edit handle %s",b),this.Gd=b,this.Aa.na("selected-edit-handle",a,b)):this.log("selectEditHandle: That handle is not selectable.")):this.log("selectEditHandle: nodeid %s does not exist.",a)};c.prototype.Ex=function(a){a=this.aa.Lv(a);for(var b=0;b<a.length;b++)this.Xd(a[b])};c.prototype.Tb=function(){this.uh();this.Aa.xg("selected-nodes");this.ia()};c.prototype.zn=function(){for(var a=0,b=this.ik;a<b.length;a++){var c=b[a];""!==c.Gf&&
this.qk.release(c.Gf)}this.ik.length=0};c.prototype.Zc=function(a,b,c,e,f,h,k){this.ik.push({type:h,position:new F(a,b),offset:new F(c,e),Gf:f,Bp:k});""!==f&&this.qk.add(f,f)};c.prototype.uh=function(){var a;this.Fi=this.Gi=this.Vk=!0;var b=!1;this.Zf.length=0;if(0!==this.selection.length){for(a=0;a<this.selection.length;a++){var c=this.selection[a];"GroupNode"!==c.type()&&(0===a?this.gd=c.rect.clone():this.gd.Ri(c.rect),this.gd.Ri(c.rect),c.ka("lockSize")&&(this.Vk=!1),c.ka("lockRotation")&&(this.Gi=
!1),c.ka("lockAspectRatio")&&(b=!0),c.ka("lockPosition")&&(this.Fi=!1))}this.Jn=1===this.selection.length?this.selection[0].Qj():new Mc(this.gd);var e=0<this.ga.get("snap");if(1<this.selection.length){c=new J;a=null;var f=this.gd}else a=this.selection[0],f=a.Ja,c=a.La();for(var h=0,k=this.ik;h<k.length;h++){var l=k[h];if("scale"===l.type){if(!this.ga.get("allowResize")||!this.Vk)continue;if("scale"===l.type&&(0!==l.position.x&&1!==l.position.x||0!==l.position.y&&1!==l.position.y)&&b)continue}else if("rotate"===
l.type&&!this.Gi)continue;this.Zf.push(Ud(l,f,c,e))}if(this.Gi&&a&&a.ka("rotationHandles"))for(b=a.ka("rotationHandles"),a=0;a<b.length;a+=4)new F(b[a],b[a+1]),h=new F(b[a+2],b[a+3]),this.Zf.push(new Qd(Md,c,f,h,e))}};c.prototype.Ot=function(){for(var a=0,b=0;b<this.selection.length;b++)b!==a&&(this.selection[a]=this.selection[b]),this.aa.Se(this.selection[a].id)&&(a+=1);this.selection.length!==a&&(this.selection.length=a);this.Ba&&!this.aa.Se(this.Ba.id)&&(this.Ba=null,null!==this.Gd&&this.Aa.na("selected-edit-handle",
null,null),this.Gd=null)};c.prototype.Ar=function(a,b){return this.selection.length&&this.Jn.bd(a,b)};c.prototype.Gq=function(){return 0!==this.selection.length||null!==this.Ba};c.prototype.cd=function(){var a=this.selection.concat();this.Ba&&a.push(this.Ba);return a};c.prototype.Kv=function(a){if(0===a.length)return new F(0,0);for(var b=a[0].rect.clone(),c=1;c<a.length;c++)b.Ri(a[c].rect);return b.Ed()};c.prototype.xq=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);return b};c.prototype.gk=
function(){var a=A(this.canvas.first).Wb();this.ga.get("showRuler")&&(a.left+=20,a.top+=20);return(new J).multiply(new Ec(1/this.scale,1/this.scale)).multiply(new Cc(-this.pb,-this.eb)).multiply(new Cc(-a.left,-a.top))};c.prototype.Qc=function(a){var b=this.cd();a||(b=this.aa.tj(b));return this.xq(b)};c.prototype.tm=function(a){for(var b=null,c=0;c<a.length;c++){var e=this.aa.jb(a[c]);e&&0==(e.Db&2)&&(null===b?b=e.rect.clone():b.Ri(e.rect))}null===b&&(b=new I(0,0,0,0));return b};c.prototype.update=
function(a,b){void 0===a&&(a=!1);if(this.aa.format(this.za,this.request)||a)this.uh(),this.ia(b)};c.prototype.Bh=function(){var a=this,b=this.ga.get("snap"),c=null,e;var f=this.ga.get("background");var h=r.Mh(f);this.background=this.Ge=null;this.backgroundRepeat="no-repeat";this.wp=this.aa.Ef();this.log("createBackground() background=%s",f);if("grid"===f){this.backgroundRepeat="repeat";b=this.ga.get("gridBlocks");var k=this.ga.get("gridSpacing"),l=(b||1)*k;c=qc(document.body);c.width=l;c.height=l;
f=c.getContext("2d");f.fillStyle="#ffffff";f.fillRect(0,0,l,l);f.beginPath();for(e=0;e<l;e+=k)if(e%l||1>b)f.moveTo(e+.5,0),f.lineTo(e+.5,l);for(e=0;e<l;e+=k)if(e%l||1>b)f.moveTo(0,e+.5),f.lineTo(l,e+.5);f.strokeStyle=this.ga.get("gridColour");f.lineWidth=.5;f.stroke();if(0<b){f.beginPath();for(e=0;e<=l;e+=l)f.moveTo(e,0),f.lineTo(e,l);for(e=0;e<=l;e+=l)f.moveTo(0,e+.5),f.lineTo(l,e+.5);f.lineWidth=2;f.stroke()}}else h?(this.log("Using background colour %s",h.toString()),this.Ge=function(a,b,c,d,e){1>
h.values[3]&&(a.globalCompositeOperation="destination-out",a.fillRect(b,c,d,e),a.globalCompositeOperation="source-over");a.fillStyle=h.toString();a.fillRect(b,c,d,e)}):0<b&&"clear"!==f&&(this.backgroundRepeat="repeat",c=qc(document.body),c.width=b,c.height=b,f=c.getContext("2d"),f.beginPath(),f.moveTo(0,0),f.arc(0,0,3,0,2*Math.PI,!1),f.moveTo(b,0),f.arc(b,0,3,0,2*Math.PI,!1),f.moveTo(b,b),f.arc(b,b,3,0,2*Math.PI,!1),f.moveTo(0,b),f.arc(0,b,3,0,2*Math.PI,!1),f.fillStyle="#c0c0c0",f.fill());this.mj=
{};var n=[];this.aa.Ub(function(b){"background"===b.Vb()&&(n.push(b),a.mj[b.id]=!0)});c&&document.body.removeChild(c);this.background=c;if(n.length){f=document.createElement("canvas");k=this.aa.Zj();f.width=k.width;f.height=k.height;b=f.getContext("2d");b.fillStyle=c?b.createPattern(c,this.backgroundRepeat):h?h.toString():"white";b.fillRect(0,0,k.width,k.height);for(c=0;c<n.length;c++)k=n[c],k.ia(b),k.bf(!0);this.background=f;this.backgroundRepeat="no-repeat";this.Ge=null}};c.prototype.ce=function(a,
b,c,e,f){this.wp!==this.aa.Ef()&&this.Bh();a.hd=null;this.background?(a.hd=a.createPattern(this.background,this.backgroundRepeat),a.fillStyle=a.hd||"magenta",a.fillRect(b,c,e,f)):this.Ge?this.Ge(a,b,c,e,f):"G_vmlCanvasManager"in window&&(a.fillStyle="rgba(0, 0, 0, 0.0)",a.fillRect(b,c,e,f));null===a.hd&&(b=this.ga.get("background"),b=r.Mh(b))&&(a.hd=b.toString())};c.prototype.su=function(a){var b=this.aa.Zj();a.beginPath();a.fillStyle="#FFFFFF";this.ga.get("pageShadow")&&(a.shadowOffsetX=3,a.shadowOffsetY=
3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,1.0)");a.rect(0,0,b.width,b.height);a.fill();a.shadowColor="rgba(0,0,0,0.0)";a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.strokeStyle=this.ga.get("pageBorderColour");a.stroke();this.ce(a,0,0,b.width,b.height);this.Ge&&this.Ge(a,0,0,b.width,b.height)};c.prototype.Nn=function(a){a?(this.log("Setting a custom background function."),this.Ge=a):this.log("Clearing custom background function.")};c.prototype.ru=function(a){if(this.Ga.ub){var b=this.Ga.x,
c=this.Ga.y,e=this.Ph();a.save();a.setTransform(e,0,0,e,0,0);a.beginPath();this.Ga.Ql?(a.moveTo(b-3,c-10),a.lineTo(b+3,c-10),a.moveTo(b-3,c+10),a.lineTo(b+3,c+10),a.moveTo(b,c-10),a.lineTo(b,c+10)):(a.moveTo(b,c-3),a.lineTo(b,c-15),a.moveTo(b,c+3),a.lineTo(b,c+15),a.moveTo(b-3,c),a.lineTo(b-15,c),a.moveTo(b+3,c),a.lineTo(b+15,c));this.Ga.Fb&&this.za.arc(b,c,8,0,2*Math.PI,!1);a.lineWidth=2;a.strokeStyle="#000000";a.stroke();a.restore()}};c.prototype.re=function(){var a=this.ga.get("showRuler")?20:
0,b=A(this.canvas.first).Wb(),c=A(this.canvas.first.parentElement).Wb(),e=this.canvas.width,f=this.canvas.height,h=b.left-c.left;b=b.top-c.top;this.pc.moveTo(h+e-20,b+a);this.pc.cf(20,f-20);this.pd.moveTo(h+a,b+f-20);this.pd.cf(e-20,20);a=this.canvas.pq();a!==this.ld&&(this.ld=a,this.log("Detected DPR change to %s",this.ld),this.pa.re&&this.pa.re());this.Ug();this.ia()};c.prototype.Ug=function(){if(!this.Vm()){var a=this.Df(),b=this.Te();b=new I(0,0,b.width,b.height);a.Nc(this.jn)&&b.Nc(this.hn)||
!this.zd(this.Vd)||(this.jn=a,this.hn=b)}};c.prototype.Cp=function(a){if(this.ze){var b=this.aa.Zj();a.save();a.beginPath();a.rect(0,0,b.width,b.height);a.clip()}return this.ze};c.prototype.ia=function(a){var b=this;this.Vm()||this.canvas.Vc(0,"main",function(c,e){if(!b.Aa.vg){var d=b.Ve(),h=d.x,k=d.y,l=d.width,n=d.height;b.ze&&(c.fillStyle=b.ga.get("outsidePageColour"),c.fillRect(0,0,b.canvas.width,b.canvas.height));c.translate(b.pb,b.eb);c.scale(b.scale,b.scale);b.ga.get("showRuler")&&c.translate(20/
b.scale,20/b.scale);var q=new Cc(b.pb,b.eb);q=q.multiply(new Ec(b.scale,b.scale));c.Vi=q;b.ze?b.su(c):b.ce(c,h,k,Math.max(l,l-h),Math.max(n,n-h));b.aa.ly();h=b.Cp(c);b.aa.ia(c,d);b.Aa.wg&&(c.save(),b.Aa.wg(c),c.restore());0<b.selection.length&&(c.save(),b.tu(c),c.restore());h&&c.restore();b.Ba&&b.Ba.Jj(c,1/b.scale,b.Gd);""!==b.Gg&&b.ga.get("showHints")&&(c.save(),c.font=15/b.scale+"px Arial",c.fillStyle="#000000",c.textBaseline="top",c.fillText(b.Gg,0,0),c.restore());b.ru(c);b.pa.qr&&b.pa.qr(c);a&&
a(c);b.Aa.Kc("draw",c);b.ga.get("showRuler")&&(c.setTransform(e,0,0,e,0,0),d=b.ga.get("pixelsPerUnit")*b.scale,h=b.ga.get("units"),c.fillStyle="#ccc",c.fillRect(0,0,20,20),Jd(c,new I(20,0,b.canvas.width-20,20),0,h,d,-b.pb),Jd(c,new I(0,20,20,b.canvas.height-20),2,h,d,-b.eb));c.setTransform(1,0,0,1,0,0);0<b.selection.length&&b.gf&&b.gf.naturalWidth&&(d=b.gf.width,c.drawImage(b.gf,b.canvas.width-d-b.pc.Cg(),0));b.Hh&&b.Hh.complete&&b.Hh.naturalWidth&&(d=b.Hh.naturalWidth,c.drawImage(b.Hh,b.canvas.width-
d-b.pc.Cg(),0));c.setTransform(e,0,0,e,0,0);c.beginPath();c.font="20px Arial";l=c.measureText(pf).width;d=b.canvas.width/e/l;c.scale(d,d);c.textBaseline="top";c.lineWidth=4/d;c.strokeStyle="rgba(128, 128, 128, 0.1)";c[sf](pf,0,0)}})};c.prototype.Jr=function(a,b){var c=this;this.canvas.Vc(1,a,function(a){a.translate(c.pb,c.eb);a.scale(c.scale,c.scale);c.ga.get("showRuler")&&a.translate(20/c.scale,20/c.scale);b(a)})};c.prototype.Sl=function(a){this.canvas.Vc(1,a,function(){})};c.prototype.tu=function(a){a.lineWidth=
1/this.scale;a.strokeStyle="#888888";a.beginPath();for(var b=0,c=0;c<this.selection.length;c++){var e=this.selection[c];var f=e.La();Yc(e)||e.hidden()||(e=new L(e.Ja),e.transform(f),e.Ij(a,[3/this.scale,3/this.scale]),b++)}if(0!==b)for(a.stroke(),c=0;c<this.Zf.length;c++)this.Zf[c].ia(a,this.qk,this.scale,this.In)};c.prototype.Yg=function(a){this.Ba=a};c.prototype.ym=function(){return this.Ba};c.prototype.so=function(a){this.In=a};c.prototype.ai=function(a){return a.bc===this.bc};c.prototype.vv=function(a,
b){if(this.Ba)return null;for(var c=this.Lo,e=null,f=0;f<this.Zf.length;f++){var h=this.Zf[f];if(h.xb(this.qk,a,b,c,this.scale)){e=h;break}}return e};c.prototype.Ac=function(){this.ws(!1)};c.prototype.Qd=function(){this.ws(!0)};c.prototype.ws=function(a){if(a?this.aa.Yd():this.aa.Zd())a?this.aa.Qd():this.aa.Ac(),a=this.aa.Ig,this.log("Most recent change page=%s",a),a!==this.aa.cb?(this.log("Undo/redo switched page %s->%s",this.aa.cb,a),this.yc(a)):this.ia(),this.Kg(!1)};c.prototype.Hk=function(a,
b,c,e){var d=this;if(b.length&&!a){for(var h=[],k=0;k<b.length;k++){var l=this.aa.jb(b[k],!1);l&&h.push(l)}this.ga.get("autoPickTool")&&this.selectNodes(h)}else if(this.selection.length||this.Ba){h=0;this.bc+=1;l=this.aa.cb;for(k=0;k<this.selection.length;k++)k!==h&&(this.selection[h]=this.selection[k]),this.aa.Se(this.selection[h].id)&&this.aa.ge(this.selection[h].id)===l&&(this.selection[h].bc=this.bc,h++);this.selection.length!==h&&(this.selection.length=h);this.Ba&&!this.aa.Se(this.Ba.id)&&(this.log("EditNode %s no longer exists",
this.Ba.id),this.Ba=null,null!==this.Gd&&this.Aa.na("selected-edit-handle",null,null),this.Gd=null);0!==this.selection.length||this.Ba||this.fb();this.Tb()}this.aa.format(this.za,this.request);this.Ot();this.uh();this.Ug();this.Hc();this.ia();this.df.clear();this.aa.Ub(function(a){5===(a.Db&5)&&d.df.lp(a.rect,a.id)});this.Vv({ij:b,Sk:c,il:e});this.Kg(a)};c.prototype.$l=function(){this.sf(!1,this.Qc(!0));this.Dh()};c.prototype.sf=function(a,b){var c=this.aa.Jv(b),e=this.aa.Cx(c);0<c.length&&(!0!==
a&&Pe.setItem("clipboard",e),this.log("Reset paste offset to 0"),this.Pi=this.Oi=0);return e};c.prototype.duplicate=function(){var a=this,b=this.Qc(!1),c=this.ga.get("pasteOffset"),e=c||this.ga.get("pasteOffsetX"),f=c||this.ga.get("pasteOffsetY");this.aa.transaction(function(){a.aa.duplicate(b,e,f)})};c.prototype.xi=function(a){var b=this;if(!a){var c=Pe.getItem("clipboard");if(c)a=c;else return}var e=this.ga.get("pasteOffset");c=e||this.ga.get("pasteOffsetX");e=e||this.ga.get("pasteOffsetY");this.Oi+=
c;this.Pi+=e;this.log("Using paste offset %s,%s",this.Oi,this.Pi);var f=new Cc(this.Oi,this.Pi);this.aa.transaction(function(){b.aa.Xq(a,f)})};c.prototype.Yk=function(a){""!==a?(this.Gg=this.language.get(a),this.Aa.na("hint",this.Gg)):(this.Gg="",this.Aa.na("hint",""))};c.prototype.kb=function(){return this.Ra(new Te(this))};c.prototype.Ra=function(a){this.pa&&this.pa.lc&&this.pa.lc();this.pa=a;a.Mc&&a.Mc();a.nd&&this.Aa.na("tool-changed",a.nd());return a};c.prototype.Oh=function(){var a=null;this.pa.nd&&
(a=this.pa.nd());return a};c.prototype.ho=function(a){a=new Ze(this,a);this.Ra(a);return a};c.prototype.Wq=function(a,b,c){this.Ra(new lf(this,"line",a,b,c))};c.prototype.em=function(a){a.lineWidth=a.lineWidth||this.ug;a.strokeStyle=a.strokeStyle||this.Kb;this.Ra(new kf(this,a,"brush"))};c.prototype.uu=function(a){a.lineWidth=a.lineWidth||this.ug;a.strokeStyle=a.strokeStyle||this.Kb;this.Ra(new kf(this,a,"shapebrush"))};c.prototype.Pp=function(a,b){a.lineWidth=a.lineWidth||this.ug;a.strokeStyle=a.strokeStyle||
this.Kb;this.Ra(new kf(this,a,b))};c.prototype.Ip=function(a){this.Ra(new lf(this,"curve",a))};c.prototype.vt=function(a,b){this.Ra(new lf(this,"arrow",a,b))};c.prototype.Df=function(){if(this.ze){var a=this.aa.Zj();var b=this.ga.get("pageInflation");a.Nd(b,b)}else a=this.aa.kc();return a};c.prototype.qo=function(){var a=A(this.canvas.first).Wb(),b=A(this.Oc).Wb(),c=a.left-b.left;a=a.top-b.top;this.aa.Rc.style.transform="translate("+this.pb+"px, "+this.eb+"px) scale("+this.scale+")";this.Li.style.transform=
"translate("+(this.pb+c)+"px, "+(this.eb+a)+"px) scale("+this.scale+")"};c.prototype.Hc=function(){if(!this.Vm())if(this.qo(),this.Aa.na("scroll"),this.ga.get("scrollbars")){var a=this.Te(),b=this.Df(),c=this.Ve(),e=!1,f=!1;c.y<=b.y&&c.bottom()>=b.bottom()?this.pc.ie():(this.pc.show(),this.pc.gs(Math.min(c.y,b.y),Math.max(c.bottom(),b.bottom()),c.height,-this.eb/this.scale),e=!0);c.x<=b.x&&c.right()>=b.right()?this.pd.ie():(this.pd.show(),this.pd.gs(Math.min(c.x,b.x),Math.max(c.right(),b.right()),
c.width,-this.pb/this.scale),f=!0);f&&e?(this.pc.cf(20,a.height-20),this.pd.cf(a.width-20,20)):e?this.pc.cf(20,a.height):f&&this.pd.cf(a.width,20)}else this.pc.ie(),this.pd.ie()};c.prototype.Xg=function(a,b,c){this.log("Set document size %s,%s",a,b);this.aa.Wa();this.aa.setProperty("width",a);this.aa.setProperty("height",b);this.aa.ua(c);this.Hc();this.Ug();this.Kg(!1)};c.prototype.Dk=function(a,b,c){var d=this;if(this.Fi)if(this.Ga.ub)this.log("Not nudging; keyboard cursor shown.");else{a*=c/this.scale;
b*=c/this.scale;this.log("Nudge selection by %s, %s",a,b);var f=this.Qc(!0),h=new Cc(a,b);this.aa.transaction(function(){d.aa.Td(f,h)});return 0<f.length}else this.log("Can't nudge; selection motion is locked.")};c.prototype.Si=function(a){var b=new N;var c=new F(-50,-50);var e=new F(50,-50);var f=new F(50,50);var h=new F(-50,50);b.moveTo(c.x,c.y);b.lineTo(e.x,e.y);b.lineTo(f.x,f.y);b.lineTo(h.x,h.y);b.lineTo(c.x,c.y);b.close();a=vc({},{commands:b.Ob(),fillStyle:this.Eb,strokeStyle:this.Rb,seed:Math.round(65535*
Math.random()),lineWidth:this.rh(this.sa.lineWidth),sloppiness:this.sa.sloppiness,layer:this.Va,wrap:this.ga.get("multilineText"),fontSize:this.ga.get("defaultFontSize")},a);this.log("Create an item on layer %s",this.Va);this.Ra(new mf(this,"PathNode",a,100,100,"rectangle","rectangle",null))};c.prototype.xo=function(a,b,c,e){var d=new N;for(var h=0;h<=a;h++){var k=50*Math.sin(b),l=50*-Math.cos(b);h&1&&(k*=c,l*=c);"matrix"in e&&(l=e.matrix.apply(k,l),k=l.x,l=l.y);0===h?d.moveTo(k,l):d.lineTo(k,l);
b+=2*Math.PI/a}d.close();"matrix"in e&&delete e.matrix;e=vc({},{commands:d.Ob(),fillStyle:this.Eb,strokeStyle:this.Rb,seed:Math.round(65535*Math.random()),lineWidth:this.rh(this.sa.lineWidth),sloppiness:this.sa.sloppiness,layer:this.Va,wrap:this.ga.get("multilineText"),fontSize:this.ga.get("defaultFontSize")},e);this.log("Create an item on layer %s",this.Va);this.Ra(new mf(this,"PathNode",e,100,100,this.ga.qq(),"polygon",null))};c.prototype.Yw=function(){this.Ra(new of(this))};c.prototype.jl=function(a){var b=
new F(0,0);var c=new N;c.moveTo(b.x,b.y-50);c.tf(b.x+50,b.y-50,b.x+50,b.y);c.tf(b.x+50,b.y+50,b.x,b.y+50);c.tf(b.x-50,b.y+50,b.x-50,b.y);c.tf(b.x-50,b.y-50,b.x,b.y-50);c.closePath();b=c.Ob();a=vc({},{commands:b,fillStyle:this.Eb,strokeStyle:this.Rb,seed:Math.round(65535*Math.random()),lineWidth:this.rh(this.sa.lineWidth),sloppiness:this.sa.sloppiness,layer:this.Va,wrap:this.ga.get("multilineText"),fontSize:this.ga.get("defaultFontSize")},a||{});this.Ra(new mf(this,"PathNode",a,100,100,this.ga.qq(),
"circle",null))};c.prototype.yo=function(a,b,c,e,f,h){this.Ra(new mf(this,a,b,c,e,f,"shape",h))};c.prototype.Ry=function(a,b){this.Ra(new nf(this,a,b))};c.prototype.wo=function(a){var b=this.aa.jb(a,!1);if(!b)return this.log("useEditHandleTool: node %s doesn't exist.",a),!1;if(!b.We())return this.log("useEditHandleTool: nodetype %s has no edit mode",b.type()),!1;this.kb();this.fb();this.Tb();this.Yg(b);this.ia()};c.prototype.Ew=function(a){var b=this,c=this.Ta(new F(100,100)),e=new Cc(c.x,c.y);this.aa.transaction(function(){var c=
b.aa.createNode("ImageNode",{url:a,layer:b.Va});b.aa.Td([c],e)});this.kb()};c.prototype.Md=function(){return A.tq()};c.prototype.Nw=function(a,b){this.pa.sd?(this.log("Simulating click of colour %s",a),this.pa.sd(a,b)):this.log("A colour is not needed for this tool.")};c.prototype.Sw=function(a,b){this.pa.Ye?(this.log("Simulating opacity change %s",a),this.pa.Ye(a,b)):this.log("An opacity is not needed for this tool.")};c.prototype.yc=function(a){this.aa.yc(a)&&(this.fb(),this.Tb(),this.Ug(),this.ia(),
this.Aa.na("set-page",a))};c.prototype.Pn=function(a){this.ze=a;a=this.Df();this.pb=-a.x;this.eb=-a.y;this.Hc();this.ia()};c.prototype.Tr=function(a){var b=this.Ve(),c=b.width/a;a=b.height/a;b.x-=(c-b.width)/2;b.y-=(a-b.height)/2;b.width=c;b.height=a;this.bh(b)};c.prototype.nl=function(){this.Tr(this.ga.Di(1.1*this.scale)/this.scale)};c.prototype.ol=function(){this.Tr(this.ga.Di(this.scale/1.1)/this.scale)};c.prototype.Kh=function(a,b,c){var d=this;c=c||this.Kv(a);var f=new Fc(b,c.x,c.y);this.aa.transaction(function(){d.aa.Td(d.xq(a),
f)})};c.prototype.eq=function(a,b){this.Gq()||this.log("flipSelection: selection is empty");this.Kh(this.cd(),a,b)};c.prototype.Ph=function(){var a=this.za;return(window.devicePixelRatio||1)/(a.az||a.zw||a.Cw||a.Hw||a.Ct||1)};c.prototype.um=function(){return new yc(this.canvas.width,this.canvas.height)};c.prototype.Te=function(){var a=this.um(),b=this.ga.get("showRuler")?20:0;return new I(b,b,a.width-b,a.height-b)};c.prototype.Ix=function(a,b){this.canvas.cf(a,b)};c.prototype.Ve=function(){var a=
this.Te();return new I((0-this.pb)/this.scale,(0-this.eb)/this.scale,a.width/this.scale,a.height/this.scale)};c.prototype.bh=function(a,b,c){void 0===b&&(b=!1);void 0===c&&(c=!1);this.log("setViewRect(%s)",a);var d=this.Te(),f=Math.min(d.width/a.width,d.height/a.height),h=a.x*f,k=a.y*f;this.pb=b?(d.width-a.width*f)/2-h:-h;this.eb=c?(d.height-a.height*f)/2-k:-k;this.Vd=this.scale=f;this.Hc();this.ia()};c.prototype.Tu=function(a){this.request.pg?(this.log("Formatting in progress; will call function soon"),
this.request.once("done",a)):(this.log("Format already done; call function in 1 tick"),setTimeout(a,0))};c.prototype.Ak=function(a){!this.jg&&a?(this.log("Locking updates."),this.jg=!0):this.jg&&!a&&(this.log("Resuming updates"),this.jg=!1,this.Ug(),this.Hc(),this.ia())};c.prototype.Vm=function(){this.jg&&this.log("Updates are locked. Ignoring draw/format request");return this.jg};c.prototype.Kg=function(a){this.Aa.xg("document-changed",{remote:a})};c.prototype.Di=function(a){return this.ga.Di(a)};
c.prototype.cc=function(a){this.Ie.style.cursor=a};return c}();var Bf=function(){function c(a,b,c){var d=this;this.Aa=a;this.qa=b;this.log=y.create("APP");this.xa=new xb;this.fr=this.hr=-1;this.Hj=[];this.Km=!1;this.Gn=this.to=null;for(this.Lf=[];null!==b.firstChild;)b.removeChild(b.firstChild);b=A(this.qa).Ld("position");"absolute"!==b&&"fixed"!==b&&(this.qa.style.position="relative");this.qa.style.overflow="none";this.qa.style.textAlign="left";this.qa.classList.add("zwibbler-main");P.Xe(".zwibbler-main { font-size: 16px; }\n        .zwibbler-passthrough { cursor: pointer; }\n        .zwibbler-selected {outline: 4px solid rgba(0, 80, 183, 0.2);}\n        ");
this.Dj=new yb(A("div").$a({width:"300px"}).ba,this.xa);this.log("Zwibbler built on "+new Date(1592943182049)+" for 'web'");this.ga=new mc(this.xa,c);this.language=new vb("\nen:arrowhead-size:Arrowhead size\nes:arrowhead-size:Flecha tama\u00f1o\n\nen:arrowhead-size-large:Large\nes:arrowhead-size-large:Grande\n\nen:arrowhead-size-medium:Medium\nes:arrowhead-size-medium:Medio\n\nen:arrowhead-size-none:None\nes:arrowhead-size-none:Nada\n\nen:arrowhead-size-small:Small\nes:arrowhead-size-small:Peque\u00f1o\n\nen:arrowhead-size-tiny:Tiny\nes:arrowhead-size-tiny:Diminuto\n\nen:arrowhead-style:Arrowhead style\nes:arrowhead-style:Flecha estilo\n\nen:arrowhead-style-simple:Simple\nes:arrowhead-style-simple:Llanura\n\nen:arrowhead-style-solid:Solid\nes:arrowhead-style-solid:Denso\n\nen:arrow-keys:Arrow Keys\nes:arrow-keys:Teclas de flecha\n\nen:arrow-tool:Arrow tool\nes:arrow-tool:Flecha\nfr:arrow-tool:Fl\u00e8che\nnl:arrow-tool:Pijl\n\nen:break-apart-group:Break apart group\nes:break-apart-group:Dividir el grupo\n\nen:bring-to-front:Bring to front\nes:bring-to-front:Traer al frente\n\nen:brush-tool:Brush tool\nes:brush-tool:Brocha\nfr:brush-tool:Brosse\nnl:brush-tool:Penseel\n\nen:circle-tool:Circle tool\nes:circle-tool:C\u00edrculo\nfr:circle-tool:Cercle\nnl:circle-tool:Cirkel\n\nen:click-to-place-another-point-or-double-click-to-end-the-line:Click to place another point, or double-click to end the line.\nes:click-to-place-another-point-or-double-click-to-end-the-line:Haga clic para colocar otro punto, o doble clic para finalizar la l\u00ednea\nfr:click-to-place-another-point-or-double-click-to-end-the-line:Cliquez pour placer un autre point, ou double-cliquez pour terminer la ligne.\nnl:click-to-place-another-point-or-double-click-to-end-the-line:Klik op een ander punt te plaatsen, of dubbelklik om de lijn te be\u00ebindigen.\n\nen:click-to-place-first-point-of-line:Click to place first point of line\nes:click-to-place-first-point-of-line:Haga clic para colocar el primer punto de la l\u00ednea\nfr:click-to-place-the-first-point-of-line:Cliquez pour placer le premier point de la ligne\nnl:click-to-place-the-first-point-of-line:Klik om het eerste punt van de lijn te plaatsen.\n\nen:click-to-set-the-end-of-the-line:Click to set the end of the line\nes:click-to-set-the-end-of-the-line:Haga clic para colocar el extremo de la l\u00ednea\nfr:click-to-set-the-end-of-the-line:Cliquez pour d\u00e9finir la fin de la ligne\nnl:click-to-set-the-end-of-the-line:Klik hier voor het einde van de lijn in te stellen.\n\nen:copy:Copy\nes:copy:Copiar\nfr:copy:Copie\nnl:copy:Kopi\u00ebren\n\nen:curve-tool:Curve tool\nes:curve-tool:Curva\nfr:curve-tool:Courbes\nnl:curve-tool:Kromme\n\nen:delete-selection:Delete selection\nes:delete-selection:Eliminar la selecci\u00f3n\n\nen:del-key:Del\nes:del-key:Del\n\nen:double-arrows:Double arrows\nes:double-arrows:flechas dobles\n\nen:draw-curves:Draw curves\nes:draw-curves:Dibuje las curvas\n\nen:draw-lines:Draw lines\nes:draw-lines:Dibujar l\u00edneas\n\nen:duplicate-selection:Duplicate selection\nes:duplicate-selection:Duplica la selecci\u00f3n\n\nen:fill-colour:Fill colour\nes:fill-colour:Color de relleno\n\nen:font:Font\nes:font:Font\n\nen:font-size:Font size\nes:font-size:Tama\u00f1o de letra\n\nen:group-selection:Group selection\nes:group-selection:Grupo la selecci\u00f3n\n\nen:image-tool:Image tool\nes:image-tool:Imagen\nfr:image-tool:Image\nnl:image-tool:Afbeelding\n\nen:image-url:Image URL\nes:image-url:URL de la imagen\n\nen:keyboard:Keyboard\nes:keyboard:Teclado\n\nen:line-style:Line style\nes:line-style:Estilo de l\u00ednea\n\nen:line-style-long-dashes:Long dashes\nes:line-style-long-dashes:Gui\u00f3n largo\n\nen:line-style-short-dashes:Short dashes\nes:line-style-short-dashes:Gui\u00f3n corto\n\nen:line-style-solid:Solid\nes:line-style-solid:Denso\n\nen:line-tool:Line tool\nes:line-tool:Raya\nfr:line-tool:Lignes\nnl:line-tool:Lijn\n\nen:move-selection-away:Move selection away\nes:move-selection-away:Mover la selecci\u00f3n de distancia\n\nen:move-selection-closer:Move selection closer\nes:move-selection-closer:Mover la selecci\u00f3n de distancia\n\nen:move-while-zoomed:Move while zoomed\nes:move-while-zoomed:Desplazarse por la pantalla\n\nen:none:None\nes:none:Nada\n\nen:no:No\nes:no:No\n\nen:outline-colour:Outline colour\nes:outline-colour:Color del contorno\n\nen:outline-thickness:Outline thickness\nes:outline-thickness:Grosor del contorno\n\nen:page-down-key:Page Down\nes:page-down-key:Page Down\n\nen:page-up-key:Page Up\nes:page-up-key:Page Up\n\nen:paste:Paste\nes:paste:Pegar\nfr:paste:Coller\nnl:paste:Plak\n\nen:pick-tool:Pick tool\nes:pick-tool:Seleccionar\nfr:pick-tool:S\u00e9lectionner\nnl:pick-tool:Uitkiezen\n\nen:rectangle-tool:Rectangle tool\nes:rectangle-tool:rect\u00e1ngulo\nfr:rectangle-tool:Rectangle\nnl:rectangle-tool:Rechthoek\n\nen:redo:Redo\nes:redo:Rehacer\nfr:redo:Refaire\nnl:redo:Opnieuw maken\n\nen:rounded-rectangle-tool:Rounded rectangle tool\nes:rounded-rectangle-tool:Rect\u00e1ngulo redondeado\n\nen:save:Save\nes:save:Guardar\n\nen:send-to-back:Send to back\nes:send-to-back:Enviar a la parte posterior\n\nen:shadow:Shadow\nes:shadow:Sombra\n\nen:shape-brush-tool:Shape brush tool\nes:shape-brush-tool:Brush que dibuja formas\n\nen:sloppiness-artist:Artist\nes:sloppiness-artist:Artista\n\nen:sloppiness-cartoonist:Cartoonist\nes:sloppiness-cartoonist:Caricaturista\n\nen:sloppiness-child:Child\nes:sloppiness-child:Ni\u00f1o\n\nen:sloppiness-draftsman:Draftsman\nes:sloppiness-draftsman:Dibujante\n\nen:sloppiness-drunk:Drunk\nes:sloppiness-drunk:Borracho\n\nen:sloppiness:Sloppiness\nes:sloppiness:La dejadez\n\nen:smoothness-sharper:Sharper\nes:smoothness-sharper:Muy afilado\n\nen:smoothness-sharpest:Sharpest\nes:smoothness-sharpest:M\u00e1s afilado\n\nen:smoothness-sharp:Sharp\nes:smoothness-sharp:Afilado\n\nen:smoothness-smoothest:Smoothest\nes:smoothness-smoothest:Muy liso\n\nen:smoothness:Smoothness\nes:smoothness:Lisura\n\nen:smoothness-smooth:Smooth\nes:smoothness-smooth:Liso\n\nen:text-colour:Text colour\nes:text-colour:Color del texto\n\nen:text:Text\nes:text:Texto\n\nen:text-tool:Text tool\nes:text-tool:Texto\nfr:text-tool:Texte\nnl:text-tool:Tekst\n\nen:thickness-brush:Brush\nes:thickness-brush:Brocha\n\nen:thickness-marker:Marker\nes:thickness-marker:Rotulador\n\nen:thickness-pencil:Pencil\nes:thickness-pencil:L\u00e1piz\n\nen:thickness-pen:Pen\nes:thickness-pen:Pluma\n\nen:undo:Undo\nes:undo:Deshacer\nfr:undo:D\u00e9faire\nnl:undo:Ongedaan maken\n\nen:yes:Yes\nes:yes:S\u00ed\n\nen:zoom-in:Zoom in\nes:zoom-in:Zoom\n\nen:zoom-out:Zoom out\nes:zoom-out:Disminuir el zoom\n");
this.language.ds(this.ga.get("language"));this.Ie=A("div").jd("zwibbler-canvas-holder").$a({position:"absolute",overflow:"hidden",touchAction:"none"}).ba;this.qa.appendChild(this.Ie);this.canvas=new Ta(this.Ie,100,100);A(this.canvas.first).jd("zwibbler-main-canvas").$a({outline:"0",position:"absolute",left:"0",top:"0",pointerEvents:"none"});this.canvas.first.setAttribute("tabindex","0");c=this.he();this.ic=new Ab;this.Li=A("DIV").$a({position:"absolute",userSelect:"none",webkitUserSelect:"none",Bz:"none",
transformOrigin:"left top",left:0,top:0}).jd("zwibbler-staging").$c(c).ba;this.Ei={ctx:a};this.view=new xf(c,this.canvas,new yf(!1,c,this.Ei),this.ic,this.ga,this.language,this.Aa,this.xa,this.Li,this.Ie);this.Rc=A(this.view.aa.Rc).jd("zwibbler-html-root").$a({position:"absolute",left:"0",top:"0",userSelect:"none",msUserSelect:"none",webkitUserSelect:"none"}).insertBefore(this.canvas.first).ba;this.Xr();this.tc=this.jy();this.xa.addEventListener(window,"resize",function(){d.Aa.resize()});window.$&&
(this.log("jQuery detected; register for bootstrap events"),window.$(document).bind("shown.bs.modal",function(){d.log("Bootstrap modal shown; resize now");d.Aa.resize()}));null!==this.ga.Xa("backgroundImage")&&(this.Mn(this.ga.Xa("backgroundImage")),this.view.aa.Tk());this.ga.oa("update",function(a,b){d.qe(a,b)});P.Xe(".zwibbler-progress-notification {\n            position: absolute;\n            top: 0;\n            right: 0;\n            box-shadow: 3px 3px 3px #444;\n            background: #ccc;\n            color: black;\n            border-bottom-left-radius: 4px;\n            font-family: arial,sans;\n        }");
this.Er=A("div").jd("zwibbler-progress-notification").$c(this.qa).ba;a.resize();this.ga.get("setFocus")&&this.focus();this.qe("showDebug",this.ga.get("showDebug"));this.view.Kg(!1);this.Aa.na("set-page",this.view.aa.cb);if(Pe.lj()){if(this.ga.get("persistent")&&(a=Pe.getItem("zwibbler-document")))try{var f=zf.mh(a,c,this.Ei);if(f)this.ag(f);else throw Error("Failed to open document.");}catch(h){this.log("Failed to load persistent document: %s",h.message)}this.to=Se(function(){d.ga.get("persistent")&&
(d.log("Saving document"),Pe.setItem("zwibbler-document",d.Aa.save()))});this.Aa.oa("document-changed",function(){d.to()});this.xa.add(function(){d.to.cancel()})}this.xa.add(function(){for(;d.qa.firstChild;)d.qa.removeChild(d.qa.firstChild);d.tc.xh();d.ic.xh();A(d.Li).remove()});this.xa.addEventListener(this.he(),"dragstart",function(a){if(a.target instanceof HTMLImageElement){var b=a.target.getAttribute("draggable");if(!b||"false"===b.toLowerCase())return a.preventDefault(),!1}})}c.prototype.Ua=
function(){this.xa.Ua()};c.prototype.qe=function(a,b){var c=!1;this.log("onConfigChange %s=%s",a,b);switch(a){case "showDebug":b?(this.Dj.show(),this.ph(0,"right",this.Dj.qa)):(this.Dj.ie(),this.Ci(this.Dj.qa));c=!0;break;case "backgroundImage":this.Mn(b);break;case "language":this.language.ds(b)}c&&this.cj()};c.prototype.Xr=function(){this.ga.Xa("sloppy")||this.view.ye("sloppiness",0);this.view.ye("smoothness",this.ga.jv());this.view.ye("fillStyle",this.ga.Xa("defaultFillStyle"));this.view.ye("strokeStyle",
this.ga.Xa("defaultStrokeStyle"));this.view.ye("fontName",this.ga.Xa("defaultFont"));this.view.ye("fontSize",this.ga.Xa("defaultFontSize"));this.view.ye("lineWidth",this.ga.Xa("defaultLineWidth"));this.view.ye("textFillStyle",this.ga.Xa("defaultTextFillStyle"))};c.prototype.ag=function(a){this.Ie.insertBefore(a.Rc,this.Rc);A(this.Rc).remove();this.Rc=a.Rc;A(this.Rc).$a({position:"absolute",left:0,top:0,userSelect:"none",webkitUserSelect:"none"});this.view.ag(a);this.Xr();this.Aa&&(this.view.Kg(!1),
this.Aa.na("set-page",a.cb));for(a=0;a<this.Hj.length;a++){var b=this.Hj[a];this.log("Removing old DomElement of type %s",b.tagName);A(b).remove()}this.Hj=[]};c.prototype.Tl=function(){this.view.aa.Tk()};c.prototype.jy=function(){var a=this,b=this;this.Km=!1;var c=new Bb;this.ga.wt(c);c.oa("*",function(b,c){a.Km?a.view.td(b,c):a.log("Ignore key action -- don't have focus.")});this.qa.setAttribute("tabindex","0");c.up(this.qa);this.xa.add(function(){a.tc.detach(a.qa)});this.ic.oa("goto-toolbar",function(){a.Gn&&
a.Gn.focus()});this.ic.oa("goto-canvas",function(){b.focus()});this.xa.addEventListener(this.qa,"blur",function(){"text"!==b.view.Oh()&&(b.log("Blur event received -- hide keyboard cursor"),b.view.Zv())});this.ga.oa("allowSystemClipboard",function(b){a.log("allowSystemClipboard=>%s",b);a.ga.Sm()&&(a.xa.addEventListener(document,"cut",function(b){return a.view.Kf(b)}),a.xa.addEventListener(document,"copy",function(b){return a.view.Kf(b)}),a.xa.addEventListener(document,"paste",function(b){return a.view.Kf(b)}))});
return c};c.prototype.ay=function(a){this.Gn=a};c.prototype.focus=function(){this.Km=!0;document.activeElement&&(document.activeElement===this.qa||document.activeElement.matches("zwibbler *, [zwibbler] *, .zwibbler-main *")&&wc(document.activeElement))?this.log("focus(): Already have focus."):this.ga.get("setFocus")&&(this.log("focus(): set focus to div"),this.qa.focus())};c.prototype.Tn=function(a){void 0===a&&(a=!1);this.focus();this.view.Tn(a)};c.prototype.createNode=function(a,b,c){"layer"in b||
(b.layer=this.view.Va);c||(c=this.view.aa.Rj());this.view.aa.Wa();a=this.view.aa.createNode(a,b,c);this.view.aa.ua();return a};c.prototype.transformNode=function(a,b){var c=this;this.view.aa.transaction(function(){c.view.aa.Td(a,b)});return!0};c.prototype.On=function(a,b,c,e,f,h,k){var d=this,n=new J(b,e,c,f,h,k);this.view.aa.transaction(function(){d.view.aa.xc(a,"matrix",n)});return!0};c.prototype.Qi=function(a,b,c){var d=this,f=new Cc(b,c);this.view.aa.transaction(function(){d.view.aa.Td(a,f)})};
c.prototype.Uk=function(a,b,c,e,f){var d=this,k=new Ec(b,c,e,f);this.view.aa.transaction(function(){d.view.aa.Td(a,k)});return!0};c.prototype.be=function(a){this.view.aa.Wa();this.view.aa.Sb(a);this.view.aa.ua();return!0};c.prototype.Mn=function(a){var b=this;this.view.aa.Wa();this.view.aa.Ub(function(a){"background"===a.Vb()&&b.view.aa.Sb([a.id])});a&&(a=this.view.aa.createNode("ImageNode",{url:a,locked:!0,tag:"background",layer:"background"}),this.view.aa.ad([a],1));this.view.aa.ua(!0);this.view.fb();
this.view.Tb()};c.prototype.av=function(){var a=null;this.view.aa.Ub(function(b){if("background"===b.Vb()&&"ImageNode"===b.type())return a=b.ka("url"),!1});return a};c.prototype.dn=function(){this.ag(new yf(!1,this.he(),this.Ei));null!==this.ga.Xa("backgroundImage")&&(this.Mn(this.ga.Xa("backgroundImage")),this.view.aa.Tk())};c.prototype.cj=function(){var a=!0;void 0===a&&(a=!1);var b=this.qa.clientWidth,c=this.qa.clientHeight;if(a||b!==this.hr||c!==this.fr){this.log("onResize()");this.hr=b;this.fr=
c;for(var e=a=0,f=0,h=0,k=0,l=this.Lf;k<l.length;k++){var n=l[k];switch(n.position){case "left":case "right":n.qa.style.top=f+"px";n.qa.style.bottom=h+"px";break;case "top":case "bottom":n.qa.style.left=a+"px",n.qa.style.right=e+"px"}switch(n.position){case "left":n.qa.style.left=a+"px";a+=n.qa.offsetWidth;break;case "right":n.qa.style.right=e+"px";e+=n.qa.offsetWidth;break;case "top":n.qa.style.top=f+"px";f+=n.qa.offsetHeight;break;case "bottom":n.qa.style.bottom=h+"px",h+=n.qa.offsetHeight}}A(this.Ie).$a({left:a+
"px",right:e+"px",top:f+"px",bottom:h+"px"});this.view.Ix(b-e-a,c-h-f);A(this.Er).$a({top:"0",right:e+"px"});this.view.re();this.Aa.na("resize")}else this.log("Ignoring resize; div size did not change.")};c.prototype.yl=function(a,b,c){void 0===c&&(c=this.view.aa.cb);var d=this.view.aa.cb;this.view.aa.yc(c);a.translate(-b.x,-b.y);this.view.ce(a,b.x,b.y,b.width,b.height);this.view.aa.ia(a);this.Aa.wg&&this.Aa.wg(a);this.view.aa.yc(d)};c.prototype.Pr=function(a,b,c){0==c&&(c=b.width);var d=c/b.width;
if("image/svg+xml"===a||"application/pdf"===a){var f=!1;"image/svg+xml"===a?c=new Id(new I(0,0,b.width,b.height)):(b=this.Aa.Ag(0),b=new I(b.x,b.y,b.width,b.height),c=new Re(new I(0,0,b.width,b.height),P.fonts),f=!0);if(f)for(f=0;f<this.view.aa.Xb();f++)0<f&&(b=this.view.aa.kc(f,Af),c.dh(b)),this.yl(c,b,f);else this.yl(c,b);return"data:"+a+";base64,"+Ba(c.rs())}f=document.createElement("canvas");f.setAttribute("width",Math.ceil(b.width*d).toString());f.setAttribute("height",Math.ceil(b.height*d).toString());
c=f.getContext("2d");c.scale(d,d);if("image/jpeg"===a||"image/bmp"===a)c.fillStyle="#ffffff",c.fillRect(0,0,b.width,b.height);this.yl(c,b);return"image/bmp"===a?tc(f):f.toDataURL(a)};c.prototype.xc=function(a,b,c){var d=this;this.log("External app setItemProperty %s: %s=%s",a,b,c);this.view.aa.transaction(function(){d.view.aa.xc(a,b,c)});return!0};c.prototype.wc=function(a,b){var c=this;this.log("External app setNodeProperty %s: %s",a,JSON.stringify(b));this.view.aa.transaction(function(){c.view.aa.wc(a,
b)});return!0};c.prototype.Xj=function(a,b){var c,e;(c=this.view.aa.Ma(a))&&(e=c.ka(b));this.log("GetItemProperty %s: %s=%s",a,b,e);return e};c.prototype.Xl=function(a){var b,c;if(6>a.length)this.log("newShape: Cannot create shape with fewer than three points.");else{var e=new N;var f=b=0;for(c=a.length-1;b<=c;f=b+=2){var h=this.view.Ta(new F(a[f],a[f+1]));if(0===f){e.moveTo(h.x,h.y);var k=h}else e.lineTo(h.x,h.y)}k&&(e.lineTo(k.x,k.y),e.close());return this.Aj(e.Ob())}};c.prototype.Aj=function(a){return this.createNode("PathNode",
{commands:a,fillStyle:this.view.Eb,strokeStyle:this.view.Rb,seed:Math.round(65535*Math.random()),lineWidth:this.view.sa.lineWidth,sloppiness:this.view.sa.sloppiness,angleArcs:this.ga.get("angleArcs")})};c.prototype.lu=function(a){return new Ra(this.Er,a)};c.prototype.ph=function(a,b,c){for(var d=0,f=this.Lf;d<f.length;d++)if(f[d].qa===c)return;this.qa.appendChild(c);this.Lf.push({order:a,qa:c,position:b});c.style.position="absolute";this.Lf.sort(function(a,b){return a.order<b.order?-1:1});this.cj()};
c.prototype.Ci=function(a){for(var b=0;b<this.Lf.length;b++)if(this.Lf[b].qa===a){this.Lf.splice(b,1);this.qa.removeChild(a);break}this.cj()};c.prototype.he=function(){for(var a=this.qa,b=a;b;){if(b instanceof HTMLElement&&(null!==b.getAttribute("zwibbler")||"ZWIBBLER"===b.tagName)){a=b;break}b=b.parentElement}return a};c.prototype.Gl=function(a,b){this.tc.map(a,b)};return c}();var Cf=function(){function c(a,b){this.view=a;this.methods=b;this.log=y.create("CustomToolBehaviour");this.$b=new $e(a)}c.prototype.Mc=function(){this.log("Entering CustomToolBehaviour");this.methods.enter&&this.methods.enter()};c.prototype.lc=function(){this.log("Leaving CustomToolBehaviour");this.methods.leave&&this.methods.leave()};c.prototype.Ik=function(a,b,c){return this.methods.onMouseClick?this.methods.onMouseClick(a,b,c.nc):!1};c.prototype.yb=function(a,b,c){return this.methods.onMouseDown?
this.methods.onMouseDown(a,b,c.nc):!1};c.prototype.tb=function(a,b,c){return this.methods.onMouseMove?this.methods.onMouseMove(a,b,c.nc):!1};c.prototype.Gb=function(a,b,c){return this.methods.onMouseUp?this.methods.onMouseUp(a,b,c.nc):!1};c.prototype.nr=function(a,b,c){return this.methods.onMouseLeave?this.methods.onMouseLeave(a,b,c):!1};c.prototype.ln=function(a,b,c){return this.methods.onDoubleClick?this.methods.onDoubleClick(a,b,c.nc):!1};c.prototype.ir=function(a,b,c){return this.methods.onContextMenu?
this.methods.onContextMenu(a,b,c):!1};c.prototype.sd=function(a,b){return this.methods.onColour?this.methods.onColour(a,b):!1};c.prototype.Ye=function(a,b){return this.methods.onOpacity?this.methods.onOpacity(a,b):!1};c.prototype.td=function(a,b){this.log("keyboard: %s",a);this.methods.onKeyCommand&&!1===this.methods.onKeyCommand(a,b)||"cancel"!==a||(this.log("ESC pressed. Abort and go back to toolbar."),this.view.kb(),this.view.ic.na("goto-toolbar"))};c.prototype.qr=function(a){if(this.methods.onRedraw)this.methods.onRedraw(a)};
c.prototype.hb=function(a){return this.methods.onGesture?this.methods.onGesture(a):this.$b.hb(a)};c.prototype.mn=function(a,b,c,e){return this.methods.onMouseWheel?this.methods.onMouseWheel(a,b,c,e):!1};c.prototype.nd=function(){return this.methods.getToolName?this.methods.getToolName():"custom"};return c}();var Df={style:".zwibbler-builtin-toolbar {\n    background: white;\n    width: 130px;\n    overflow-y: auto;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none; \n}\n\n.zwibbler-builtin-toolbar button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    background-color: white;\n    border: none;\n}\n\n.zwibbler-builtin-toolbar button img {\n    margin: 0;\n}\n\n.zwibbler-builtin-toolbar button:hover,\n.zwibbler-builtin-toolbar button.selected {\n    background-color: #9fb3e7;\n}\n",
pk:'<div class="zwibbler-builtin-toolbar">\n<button \n    z-if="getConfig(\'showPickTool\')"\n    z-click="usePickTool()"\n    z-selected="getCurrentTool()===\'pick\'"\n    title="Pick">\n    <img z-bind:src="getImageUrl(\'wd-pick.png\')">\n</button>\n<button \n    z-if="getConfig(\'showSquareTool\')"\n    z-click="useRectangleTool()"\n    z-selected="getCurrentTool()===\'rectangle\'"\n    title="Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-box.png\')">\n</button>\n<button \n    z-if="getConfig(\'showRoundRectTool\')"\n    z-click="useRoundRectTool()"\n    title="Rounded Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-roundrect.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCircleTool\')"\n    z-click="useCircleTool()"\n    z-selected="getCurrentTool()===\'circle\'"\n    title="Circle">\n    <img z-bind:src="getImageUrl(\'wd-circle.png\')">\n</button>\n<button \n    z-if="getConfig(\'showShapeBrushTool\')"\n    z-click="useShapeBrushTool()"\n    title="Shape brush">\n    <img z-bind:src="getImageUrl(\'wd-shapebrush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showBrushTool\')"\n    z-click="useBrushTool()"\n    z-selected="getCurrentTool()===\'brush\'"\n    title="Brush">\n    <img z-bind:src="getImageUrl(\'wd-brush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showLineTool\')"\n    z-click="useLineTool()"\n    z-selected="getCurrentTool()===\'line\'"\n    title="Lines">\n    <img z-bind:src="getImageUrl(\'wd-line.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCurveTool\')"\n    z-click="useCurveTool()"\n    z-selected="getCurrentTool()===\'curve\'"\n    title="Curves">\n    <img z-bind:src="getImageUrl(\'wd-curve.png\')">\n</button>\n<button \n    z-if="getConfig(\'showArrowTool\')"\n    z-click="useArrowTool()"\n    z-selected="getCurrentTool()===\'arrow\'"\n    title="Arrows">\n    <img z-bind:src="getImageUrl(\'wd-arrow.png\')">\n</button>\n<button \n    z-if="getConfig(\'showTextTool\')"\n    z-selected="getCurrentTool()===\'text\'"\n    z-click="useTextTool()"\n    title="Text">\n    <img z-bind:src="getImageUrl(\'wd-text.png\')">\n</button>\n<button \n    z-if="getConfig(\'showImageTool\')"\n    z-click="insertImage()"\n    title="Insert image...">\n    <img z-bind:src="getImageUrl(\'wd-image.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="bringToFront()"\n    title="Bring to front">\n    <img z-bind:src="getImageUrl(\'wd-moveup.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="sendToBack()"\n    title="Send to back">\n    <img z-bind:src="getImageUrl(\'wd-movedown.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canUndo()"\n    z-click="undo()"\n    title="Undo">\n    <img z-bind:src="getImageUrl(\'wd-undo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canRedo()"\n    z-click="redo()"\n    title="Redo">\n    <img z-bind:src="getImageUrl(\'wd-redo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="copy()"\n    title="Copy">\n    <img z-bind:src="getImageUrl(\'wd-copy.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="paste()"\n    title="Paste">\n    <img z-bind:src="getImageUrl(\'wd-paste.png\')">\n</button>\n<button\n    z-for="button in _zwibblerButtons"\n    z-bind:title="button.name"\n    z-click="_zwibblerButtonClicked(this, button)">\n    <img z-bind:src="getImageUrl(button.image)">\n</button>\n</div>\n',
controller:function(c){c._zwibblerButtons=P.buttons;c._zwibblerButtonClicked=function(a,b){b.onclick.call(a,c)}}};var Ef={style:".zwibbler-page-selector {\n    overflow-y: scroll;\n    background: #888;\n    width: 160px;\n    text-align: center;\n}\n\n.zwibbler-page-selector [z-page] {\n    border: 3px solid transparent;\n    margin: 5px;\n    display: inline-block;\n    box-shadow: 2px 2px 2px rgba(0,0,0,0.2);\n}\n\n.zwibbler-page-selector [z-page].selected {\n    border: 3px solid #9fb3e7;\n}\n",pk:'<div class="zwibbler-page-selector">\n    <button z-if="getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.setCurrentPage(ctx.insertPage(ctx.getCurrentPage()+1))">\n        Add Page\n    </button>\n    <button z-if="ctx.getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.deletePage(ctx.getCurrentPage())">\n        Delete Page\n    </button>\n    <br>\n    <div z-sort="ctx.movePage($from,$to)">\n        <div z-for="page in ctx.getPageCount()"\n            draggable="TRUE"\n            z-sortable\n            z-page="page"\n            z-width="130"\n            z-height="130"\n            z-click="ctx.setCurrentPage(page)"\n            z-selected="page==ctx.getCurrentPage()">\n        </div>\n    </div>\n</div>\n'};var Ff={style:".zwibbler-property-panel {\n    width: 200px;\n    background: #f5f5f5;\n    display:flex;\n    flex-flow: column nowrap;\n    overflow-y: scroll;\n    padding: 10px;\n    font-family: sans-serif;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none;     \n}\n\n.zwibbler-property-panel h3 {\n    margin-bottom: 0.5em;\n}\n\n.zwibbler-property-panel button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    display: block;\n    background-color: white;\n    color: black;\n    border: none;\n    border-radius: 2px;\n    border-bottom: 2px solid #ddd;\n    width: 100%;\n}\n\n.zwibbler-property-panel button[tool] {\n    display: inline-block;\n    width: 60px;\n    height: 60px;\n    font-size: 30px;\n}\n\n.zwibbler-property-panel button.zwibbler-option {\n    border: 0;\n    padding: 10px;\n    border-radius: 3px;\n    background: transparent;\n    text-align: left;\n}\n\n.zwibbler-property-panel button.selected {\n    background: #9fb3e7;\n}\n\n.zwibbler-property-panel button.hover {\n    background: #ddd;\n}\n\n.zwibbler-property-panel hr {\n    border: none;\n    border-top: 1px solid #ccc;\n}\n\n.zwibbler-property-panel select {\n    width: 100%;\n}\n\n.zwibbler-property-panel .colour-picker {\n    padding: 10px 0;\n}\n\n.zwibbler-property-panel [swatch] {\n    border: 1px solid black;\n    display: inline-block;\n    height: 2em;\n    width: 4em;\n    vertical-align:middle;\n    margin-right: 10px;\n}\n",
pk:'<div class="zwibbler-property-panel">\n<h3>Shape options</h3>\n<div z-if="summary.empty">\n    There are no selected shapes.\n</div>\n<div z-has="AnyNode">\n    <button z-click="deleteNodes()">Delete</button>                    \n    <button z-click="bringToFront()">\n        Move to front\n    </button>\n    <button z-click="sendToBack()">\n        Send to back\n    </button>\n</div>\n<div z-has="fontName">\n    <h3>Font</h3>\n    <select z-property="fontName">\n        <option z-for="font in getConfig(\'fonts\')" z-text="font" z-bind:value="font"></option>\n    </select>\n</div>\n<div z-has="fontSize">\n    <h3>Font size</h3>\n    <select z-property="fontSize">\n        <option value="8">8</option>\n        <option value="10">10</option>\n        <option value="12">12</option>\n        <option value="16">16</option>\n        <option value="20">20</option>\n        <option value="24">24</option>\n        <option value="50">50</option>\n    </select>\n</div>\n<div z-has="fillStyle|strokeStyle|background">\n    <h3>Colours</h3>\n    <div class="colour-picker" z-has="fillStyle">\n        <div swatch z-property="fillStyle" z-colour></div>\n        Fill style\n    </div>\n    <div class="colour-picker" z-has="strokeStyle">\n        <div swatch z-property="strokeStyle" z-colour></div>\n        Outline\n    </div>\n    <div class="colour-picker" z-has="background">\n        <div swatch z-property="background" z-colour></div>\n        Background\n    </div>\n</div>\n<div z-has="arrowSize">\n    <h3>Arrows</h3>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="0">None</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="10">Small</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="15">Large</button>\n    <hr>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="solid">Solid</button>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="open">Open</button>\n</div>\n<div z-has="lineWidth">\n        <h3>Line width</h3> \n        <select z-property="lineWidth">\n            <option value="0">None</option>\n            <option value="1">1</option>\n            <option value="2">2</option>\n            <option value="4">4</option>\n            <option value="8">8</option>\n        </select>\n    </div>\n<div z-has="dashes">\n    <h3>Line style</h3>\n    <button class="zwibbler-option" z-property="dashes" z-value="">Solid</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="3,3">Dots</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="8,2">Dashes</button>\n</div>\n<div z-has="opacity">\n    <h3>Opacity</h3>\n    <input z-property="opacity" type="range" min="0.1" max="1.0" step="0.05">\n</div>              \n'};var Q=y.create("CONTEXT");function R(c){return"number"===typeof c?c.toString(36):c}function df(c){return parseInt(c,36)}function wf(c){for(var a=[],b=0;b<c.length;b++)a.push(df(c[b]));return a}function Gf(c){if(c instanceof Array){for(var a=[],b=0;b<c.length;b++)a.push(R(c[b]));return a}return[R(c)]}
var S=function(){function c(a,b){var c=this;this.ab={};this.nm={};this.Lq=0;this.an=null;this.lg={};this.zc=this.wg=null;this.vg=!1;this.Mj=new Ka;this.Zp=new La;this.globals={};this.vw=new ec(this);this.oc=oc(5);this.Ng=null;this.ctx=this;this.mp=!1;this.En=0;this.Pg=null;this.Dp="";this.ea=new Bf(this,a,b);this.pr();var e=this;P.Rm.push(this);this.ea.xa.add(function(){Q("Running ZwibblerContext destructor");c.cl();delete a.zwibbler;delete e.ab;delete e.ea;delete e.wg;for(var b=P.Rm,d=0;d<b.length;d++)if(b[d]===
e){b.splice(d,1);break}c.zc&&c.zc.stop()});this.oa("document-changed",function(a){c.summary=c.Sh();a.remote||c.na("local-changes")});this.ea.ga.oa("latency",function(a){c.zc&&c.zc.Wx(a)});this.ea.ga.oa("broadcastMouse",function(a){c.vw.bs(a,c.oc)});this.$s();this.oa("selected-nodes",function(){c.summary=c.Sh()});this.oa("tool-changed",function(){c.summary=c.Sh()});this.summary=this.Sh();this.Zi(Df,"left","showToolbar");this.Zi(Ef,"right","showPageSelector");this.Zi(Ff,"right","showPropertyPanel");
this.Zi(wb,"bottom","showColourPanel")}c.prototype.Gl=function(a,b){this.ea.Gl(a,b)};c.prototype.qh=function(a,b){void 0===b&&(b=!1);Q("Add remote changes: %s reset=%s",a,b);b&&this.ea.ag(new yf(!0,this.ea.he(),this.ea.Ei));try{this.ea.view.aa.mb.qh(a)}catch(d){throw console.log(this.ea.view.aa.toString()),console.log(a),console.log(this.ea.view.aa.mb),d;}};c.prototype.qc=function(a,b){O.qc(a,b);O.digest();this.ea.xa.add(function(){Q("DESTROYING A PANEL");O.detach(b)});if(!this.mp&&a instanceof c||
a.ctx instanceof c)this.mp=!0,this.oa("tool-changed",function(){return O.digest()}),this.ea.ga.oa("update",function(){return O.digest()}),this.oa("document-changed",function(){return O.digest()}),this.oa("selected-nodes",function(){return O.digest()});this.resize()};c.prototype.digest=function(a){O.digest(a)};c.prototype.ct=function(){this.Ca("abortTransaction is not implemented. Please contact support.")};c.prototype.Zc=function(a,b,c,e,f,h){switch(h){case "scale":case "rotate":case "translate":var d=
h;break;default:if("function"===typeof h){d="click";var l=h}else{this.Ca('addSelectionHandle: action must be "scale", "rotate", "translate", or a function');return}}this.ea.view.Zc(a,b,c,e,f,d,l)};c.prototype.hj=function(a,b){var c=this.ea.view.aa.Ma(R(a));if(c)if(c instanceof fd){var e=Gf(b);this.Wd(function(a){a.hj(c.id,e)})}else Q("parent is not a group");else Q("addToGroup: Bad node id")};c.prototype.Il=function(a){this.ea.language.Il(a)};c.prototype.lt=function(a,b){return this.va()?0:this.vk(this.Xb(),
a,b)||0};c.prototype.ph=function(a,b,c){this.ea.ph(a,b,c)};c.prototype.Wa=function(){this.ea.view.aa.Wa()};c.prototype.nj=function(){this.Wa()};c.prototype.Jt=function(a){void 0===a&&(a=this.cd());this.va()||this.ea.view.ad(0,Gf(a))};c.prototype.Kn=function(a){this.zc&&this.zc.Kn(a)};c.prototype.Sn=function(a,b,c){this.zc&&this.zc.Vx(a,b,c)};c.prototype.Yd=function(){return this.va()?!1:this.ea.view.aa.Yd()};c.prototype.Zd=function(){return this.va()?!1:this.ea.view.aa.Zd()};c.prototype.fb=function(){this.ea.view.fb();
this.ea.view.Tb();this.ea.view.ia()};c.prototype.St=function(){this.ea.Tl()};c.prototype.Tt=function(a,b){if(this.va())return!1;this.Wg(a,!b)};c.prototype.ua=function(a){void 0===a&&(a=!1);this.ea.view.aa.ua(a)};c.prototype.Xt=function(){this.ua(!0)};c.prototype.uj=function(){this.ua(!1)};c.prototype.sf=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=this.cd());"boolean"!==typeof a&&this.Ca("First parameter of copy() must be true/false");return this.ea.view.sf(a,Gf(b))};c.prototype.Hp=function(){function a(a){for(var c=
30;100>c;c+=20)a.values[2]=c/100,b.push(a.toString())}var b="rgba(0,0,0,0.0) rgba(0,0,0,0.5) #000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");a(new r(r.kf,[0,0,0,1]));for(var c=0;720>c;c+=35){var e=new r(r.kf,[c,.5,0,1]);a(e)}return b};c.prototype.gu=function(a,b){return this.createNode("DataNode",a,b)};c.prototype.hu=function(a){if(this.va())return!1;var b=0;this.Wd(function(c){b=df(c.group(Gf(a)))});return b};
c.prototype.Qb=function(a){void 0===a&&(a={});var b={};if(a instanceof Array)return a.concat();if(!(a instanceof Object))return a;for(var c in a)if(a.hasOwnProperty(c)){var e=a[c];e=Hf(c,e);b[c]=e}return b};c.prototype.ju=function(a){return y.create(a)};c.prototype.createNode=function(a,b,c){Q("createNode(%s)",a);fc(a)||this.Ca("createNode: node type must be string");b=this.Qb(b);return c?df(this.ea.createNode(a,b,R(c))):df(this.ea.createNode(a,b))};c.prototype.iu=function(a,b,c){if(!P.Le[a])throw Error("Component "+
a+" not registered");var d=P.Le[a].sa;if(d)for(var f in d)f in b||(b[f]=d[f]);b.$component=a;return this.createNode("HTMLNode",b,c)};c.prototype.Aj=function(a){return this.ea.Aj(a)};c.prototype.Zi=function(a,b,c){var d=this,f;this.ea.ga.oa(c,function(c){c?(f||(a.style&&P.Xe(a.style),c=document.createElement("div"),c.innerHTML=a.pk,f=c.firstChild,d.qc(d,f),a.controller&&a.controller(d)),d.ea.ph(1,b,f)):f&&d.ea.Ci(f)})};c.prototype.nu=function(a,b){var c=A.jc(a);if(c){"object"===typeof b&&"[object Array]"===
Object.prototype.toString.apply(b)||this.Ca("createToolbar: second parameter must be array");P.Xe("a.zwibbler-button {\n            background-repeat: no-repeat;\n            background-position: center;\n            display: inline-block;\n            overflow: hidden;\n        }");for(var e=this,f=function(a,b){b.addEventListener("click",function(b){a.onclick.call(this,e,b)})},h=0;h<b.length;h++){var k=b[h],l=A("a").jd("zwibbler-button").ba;l.setAttribute("href","javascript:void(0)");k.toolName&&
A(l).jd(k.toolName);k.onclick&&f(k,l);k.title&&l.setAttribute("title",k.title);k.background?l.style.background=k.background:k.image&&(l.style.backgroundImage="url("+k.image+")");k.html&&(l.innerHTML=k.html);c.appendChild(l)}var n;this.oa("tool-changed",function(a){n&&n.classList.remove("zwibbler-selected");(n=c.querySelector("."+a))&&n.classList.add("zwibbler-selected")})}else this.Ca("createToolbar: Could not convert first parameter to an HTML element")};c.prototype.Xl=function(a){if(!this.ea.Xl(a))return this.Ca("createShape needs an array of at least 6 numbers"),
null};c.prototype.$l=function(){if(this.va())return!1;var a=this.ea.view.sf(!1,this.ea.view.Qc(!0));this.Np();return a};c.prototype.Ua=function(){if(!this.vg){this.Kc("destroy");this.ea.Ua();this.Mj.Ua();this.Zp.Ua();for(var a in this)this.hasOwnProperty(a)&&delete this[a];this.vg=!0}};c.prototype.Wd=function(a){this.ea.view.aa.transaction(a)};c.prototype.be=function(a){this.Sb(a)};c.prototype.Ws=function(a){for(var b=0;b<a.length;b++)this.ea.view.aa.Ma(a[b],!1)||(a.splice(b,1),--b);return 0<a.length};
c.prototype.Sb=function(a){void 0===a&&(a=this.cd());if(this.va())return!1;Q("deleteNodes()");var b=Gf(a);this.Ws(b)&&this.Wd(function(a){return a.Sb(b)})};c.prototype.ou=function(){var a=this;if(this.va())return!1;1<this.Lq&&this.Ca("deletePage is not implemented inside transactions. Please contact support.");if(1===this.Xb())this.Wd(function(b){return b.Sb(Gf(a.sm()))});else{var b=this.ea.view.aa.Ef().id;this.Wd(function(a){return a.Sb([b])})}};c.prototype.Np=function(){if(this.va())return!1;this.ea.view.Dh()};
c.prototype.Ne=function(){1===arguments.length&&!1===arguments[0]&&this.ea.view.aa.Yq();return this.ea.view.aa.Ne()};c.prototype.dispatchEvent=function(a){Q("dispatchEvent(%s)",a.type);return this.ea.Ie.dispatchEvent(a)};c.prototype.uw=function(a,b){var c={clientX:(b.pageX||0)-(document.documentElement.scrollLeft+document.body.scrollLeft),clientY:(b.pageY||0)-(document.documentElement.scrollTop+document.body.scrollTop),bubbles:!0,cancelable:!0,buttons:b.buttons};c="onpointerdown"in window&&!("ontouchstart"in
window)?new PointerEvent("pointer"+a,c):new MouseEvent("mouse"+a,c);return this.dispatchEvent(c)};c.prototype.download=function(a,b,c,e){void 0===e&&(e=0);"jpeg"===a&&(a="jpg");"pdf"===a||"svg"===a||"png"===a||"jpg"===a||"bmp"===a||"zwibbler3"===a?(a="zwibbler3"===a?zf.Xi(this.ea.view.aa,a,"data-uri"):this.save(a,c,e),this.Zp.Bx(a,b)):Q("unsupported format for download: %s",a)};c.prototype.ia=function(a,b){void 0===b&&(b={});var c=b.page||0,e=this.ea.view.aa.cb,f=this.Ag();this.ea.view.aa.yc(c);this.ea.view.ce(a,
0,0,f.width,f.height);this.ea.view.aa.ia(a);this.ea.view.aa.yc(e)};c.prototype.yu=function(a){if(this.va())return!1;var b=this.ea.view.aa.jb(R(a),!1);b?b.Xh()?(a=this.ea.view.ho({}))&&a.ao(b,b.rect.x,b.rect.y):Q("editNodeText: node %s (%s) cannot contain text.",a,b.type()):Q("editNodeText: ExtNodeID %s does not exist.",a)};c.prototype.duplicate=function(){if(this.va())return!1;this.ea.view.duplicate()};c.prototype.zl=function(a,b,c){var d=this;if(!(this.vg||this.nm[a]||this.Ys(a))){var f=function(){if(!d.vg){d.nm[a]=
!1;if(a in d.ab)for(var c=0,e=d.ab[a];c<e.length;c++){var f=e[c];try{var n=f.apply(null,b)}catch(q){console.log("Error in handler for '"+a+"':",q)}}return n}};"once"===c&&(this.nm[a]=!0);if("now"===c)return f();setTimeout(f,0);return this}};c.prototype.na=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.zl(a,b,"normal")};c.prototype.Kc=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.zl(a,b,"now")};c.prototype.xg=function(a){for(var b=
[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.zl(a,b,"once")};c.prototype.oy=function(a){this.lg[a]=a in this.lg?this.lg[a]+1:1};c.prototype.Ys=function(a){return a in this.lg&&0<this.lg[a]?(Q("Skipped %s event",a),--this.lg[a],!0):!1};c.prototype.focus=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=null);this.ea.ay(b);a?this.ea.Tn("text"===this.Oh()):this.ea.focus()};c.prototype.Ru=function(a){function b(b){return a(df(b.id))}this.ea.view.aa.hm(b,this.ea.view.aa.Ma(this.ea.view.aa.root.id));
for(var c=0,e=this.ea.view.aa.cq;c<e.length;c++)this.ea.view.aa.hm(b,e[c])};c.prototype.Lu=function(a){a=this.$p(a);return a.length?a[0]:null};c.prototype.$p=function(a){a=this.ea.view.aa.Mu(a);for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);return b};c.prototype.Pu=function(a,b,c){if(this.va())return!1;if(3===arguments.length)if("number"!==typeof b||"number"!==typeof c)this.Ca("flip: 2nd and 3rd args must be numbers.");else{var d=new F(b,c);this.ea.view.eq(a/180*Math.PI,d)}else this.ea.view.eq(a/
180*Math.PI)};c.prototype.Kh=function(a,b,c,e){if(this.va())return!1;a=this.hp(Gf(a));"number"===typeof c&&"number"===typeof e?(c=new F(c,e),this.ea.view.Kh(a,b/180*Math.PI,c)):this.ea.view.Kh(a,b/180*Math.PI)};c.prototype.jq=function(a,b,c){var d=this;void 0===c&&(c={});c.onColour=c.onColour||c.onColor||function(a,b){d.Wg(a,b)};c.onOpacity=c.onOpacity||function(a,b){d.es(a,b)};return Oe(a,b,c)};c.prototype.yg=function(){return this.ea.view.yg()};c.prototype.sm=function(){var a=[];this.ea.view.aa.Ub(function(b){a.push(df(b.id))},
this.Cf());return a};c.prototype.$u=function(){return this.ea.av()};c.prototype.tm=function(a){return this.mf(this.ea.view.tm(Gf(a)))};c.prototype.ee=function(a){fc(a)||this.Ca("getConfig: Expected string");return this.ea.ga.get(a)};c.prototype.Cf=function(){return this.ea.view.aa.cb};c.prototype.fv=function(){return this.ea.view.Vj()};c.prototype.gv=function(){return this.ea.view.ck()};c.prototype.Oh=function(){return this.ea.view.Oh()};c.prototype.hv=function(a){a=this.ea.view.aa.Ma(R(a));var b=
null;a&&"CustomNode"===a.type()&&(b=a.Ya);return b};c.prototype.wm=function(a,b){var c=this.ea.view.xd(a,b);return{x:c.x,y:c.y}};c.prototype.lv=function(a){return this.ea.view.aa.ka(a)};c.prototype.Ag=function(){var a;this.ee("pageView")&&(a=Af);return this.mf(this.ea.view.aa.kc(this.Cf(),a))};c.prototype.jc=function(){return this.ea.he()};c.prototype.Vj=function(){return this.ea.view.Vj()};c.prototype.wv=function(){for(var a=[],b=0,c=this.ea.view.aa.Jm();b<c.length;b++){var e=c[b];a.push({cid:e.Sa,
ts:e.dc})}return a};c.prototype.Am=function(a){return this.ea.ga.Am(a)};c.prototype.Av=function(a){return this.ea.language.get(a)};c.prototype.Cm=function(){var a=this.ea.view.aa.mb.bv();if(!a.empty())return this.Ng=a,a.toString();this.Ng=null;return""};c.prototype.mf=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.bj=function(a){"object"!==typeof a&&this.Ca("Error: Rectangle object expected.");a=new I(a.x||0,a.y||0,a.width||0,a.height||0);a.Lr();return a};c.prototype.nv=
function(){return this.mf(this.ea.view.aa.lq())};c.prototype.uv=function(a){var b=this.ea.view.aa.jb(R(a));return null===b?(Q("getGroupParent: No such node %s",a),null):b.Tm()&&b.parent?df(b.parent.id):null};c.prototype.tv=function(a){var b=[],c=this.ea.view.aa.Ma(R(a));if(!(c&&c instanceof fd))return Q("getGroupMembers: Error node %s is not a group.",a),b;if(c.children)for(a=0,c=c.children;a<c.length;a++)b.push(df(c[a].id));return b};c.prototype.yv=function(a,b){return this.Xj(a,b)};c.prototype.Cv=
function(){var a=[],b={};this.ea.view.aa.Jc(!1,function(d){!(c=d.Vb())||c in b||(b[c]=1,a.push(c))});var c=this.yg();c in b||a.push(c);return a};c.prototype.Bv=function(a){var b=[];this.ea.view.aa.Jc(!1,function(c){c.Vb()===a&&b.push(df(c.id))});return b};c.prototype.Dv=function(a,b,c){var d=this.ea.view.aa.jb(R(a));if(null===d)return this.Ca("Error: node %s does not exist",a),null;a=this.ea.view.Gw(d,b,c);return{x:a.x,y:a.y}};c.prototype.ge=function(a){return this.ea.view.aa.ge(R(a))};c.prototype.Xj=
function(a,b){"string"!==typeof b&&this.Ca("getNodeProperty: second parameter must be a string");return this.ea.Xj(R(a),b)};c.prototype.Ev=function(a){a=Gf(a);for(var b=null,c=0;c<a.length;c++){var e=a[c],f=this.ea.view.aa.jb(e);null===f?this.Ca("Error: node %s does not exist",e):b?b.Ri(f.rect):b=f.rect.clone()}b||(b=new I(0,0,0,0));return this.mf(b)};c.prototype.Fv=function(a){var b=this.ea.view.aa.jb(R(a));if(null===b)return this.Ca("Error: node %s does not exist",a),null;a=b.La().Yb();return{x:a.x,
y:a.y}};c.prototype.Gv=function(a){var b=this.ea.view.aa.jb(R(a));if(null===b)this.Ca("Error: node %s does not exist",a);else return a=b.La(),[a.m11,a.m21,a.m12,a.m22,a.Da,a.Ea]};c.prototype.Hv=function(a){a=this.ea.view.aa.Ma(R(a));var b="";a&&(b=a.type(),"CustomNode"===b&&(b=a.ka("nodeType")));return b};c.prototype.Iv=function(a,b){var c=this.ea.view.aa.xb(a,b,this.ea.view.Va);return c?df(c.id):this.ea.view.Ar(a,b)&&(c=this.cd(),c.length)?c[0]:null};c.prototype.Mv=function(a,b){for(var c=[],e=0,
f=this.ea.view.aa.$v(a,b);e<f.length;e++)c.push(df(f[e].id));return c};c.prototype.Xb=function(){return this.ea.view.aa.Xb()};c.prototype.Yj=function(a){return(a=this.ea.view.aa.Ef(a))?df(a.id):null};c.prototype.yq=function(a){return this.mf(this.ea.view.aa.kc(a,Af))};c.prototype.$j=function(a){var b=this.ea.view.aa.jb(R(a),!1);if(!b||"PathNode"!==b.type())return null;a=b.$j().clone().ff();var c=[];b.La();for(b=0;b<a.length;b++){var e=a[b];c.push(e.x);c.push(e.y)}return c};c.prototype.Pv=function(a){a=
this.ea.view.aa.Ma(R(a),!1);if(!a||"PathNode"!==a.type())return null;a=a.$j();for(var b=[],c=[],e=0;e<a.fa.length;){switch(a.fa[e]){case L.Fc:c=[{x:a.fa[e+1],y:a.fa[e+2]}];b.push(c);break;case L.Ec:c.push({x:a.fa[e+1],y:a.fa[e+2]})}e+=L.Gc[a.fa[e]]}return b};c.prototype.mq=function(){return this.ea.view.scale};c.prototype.ym=function(){var a=this.ea.view.ym();return a?df(a.id):0};c.prototype.Aq=function(a,b,c,e){var d=this.ea.view.cm(a,b);if(void 0===c||void 0===e)return{x:d.x,y:d.y};a=this.ea.view.cm(a+
c,b+e);return this.mf(new I(d.x,d.y,a.x-d.x,a.y-d.y))};c.prototype.Rv=function(){return this.ea.view.Gd};c.prototype.ck=function(){return this.ea.view.ck()};c.prototype.Uj=function(a,b){var c=this.ea.view.aa.jb(R(a),!1);return c&&c.We()?c.Uj(b):null};c.prototype.Px=function(a,b,c){var d=this.ea.view.aa.Ma(R(a),!1);if(!d)return Q("setEditHandle: node %s doesn't exist.",a),!1;if("PathNode"!==d.type())return Q("setEditHandle: node %s is not a PathNode.",a),!1;d=d.ka("commands");d=M.Ss(d,b,c);if(!d)return Q("setEditHandle: failed"),
!1;this.xc(a,"commands",d);return!0};c.prototype.cd=function(a){void 0===a&&(a=!1);return wf(this.ea.view.Qc(a))};c.prototype.Sh=function(a){function b(a,b){var d=c.properties[a];void 0!==b&&(c.properties[a]=d!==b&&void 0!==d?null:b);c.empty=!1}void 0===a&&(a=this.cd());for(var c={properties:{},types:{},nodes:[],empty:!0},e=this.ea.ga.get("allowTextInShape"),f=0;f<a.length;f++){var h=this.ea.view.aa.Ma(R(a[f]),!1);if(h){var k=h.type();c.types[k]=!0;c.types.AnyNode=!0;c.empty=!1;c.nodes.push(df(h.id));
"PathNode"===k&&(k=h.ka("closed")?"PathNode-closed":"PathNode-open",c.types[k]=!0);h=h.Pc();for(var l in h)h.hasOwnProperty(l)&&"matrix"!==l&&("BrushNode"!==k||"fillStyle"!==l)&&("PathNode-open"!==k||"fontSize"!==l&&"fontName"!==l&&"fillStyle"!==l)&&("PathNode-closed"!==k||(e||"fontSize"!==l&&"fontName"!==l)&&"arrowSize"!==l&&"arrowStyle"!==l)&&b(l,h[l])}}!c.nodes.length||"opacity"in c.properties||(c.properties.opacity=1);if(this.ea.view.pa.ek){a=this.ea.view.pa.ek();for(var n in a)b(n,a[n])}return c};
c.prototype.Tv=function(){return this.mf(this.ea.view.Ve())};c.prototype.Uv=function(a){this.ea.view.aa.Lm(a);this.Wr("readOnly",this.ea.view.aa.locked())};c.prototype.Ca=function(a){for(var b=1;b<arguments.length;b++);b=arguments[0].split("%s");for(var c=[],e=0;e<b.length;e++)c.push(b[e]),e<b.length-1&&c.push(JSON.stringify(arguments[e+1]));b=c.join("");Q(b);console.log(b);throw Error(b);};c.prototype.Uw=function(a){a||(a={});return this.Mj.open({accept:a.accept,format:a.format||"data-uri"}).then(function(a){return{data:a.data,
contentType:a.contentType}})};c.prototype.cw=function(){var a=this;if(this.va())return!1;this.Mj.open({accept:"image/*",format:"data-uri"}).then(function(b){a.createNode("ImageNode",{url:b.data,vz:!0})})};c.prototype.vk=function(a,b,c){if(this.va())return!1;var d={};E(b)&&E(c)&&(d.width=b,d.height=c);this.Wd(function(b){return b.createNode("PageNode",d,b.root.id,a)});return a};c.prototype.Um=function(a){return this.ea.view.aa.Um(a)};c.prototype.ai=function(a){a=this.ea.view.aa.jb(R(a));return null!==
a&&this.ea.view.ai(a)};c.prototype.ke=function(a,b){return this.ea.view.ke(a,b)};c.prototype.load=function(a,b){void 0===b&&(b=a);var c=zf.mh(b,this.ea.he(),this.ea.Ei);if(c)return this.cl(),this.ea.ag(c),!0;Q("load(): Could not open file.");return!1};c.prototype.Ak=function(a){var b=this;E(a)?(this.an&&clearTimeout(this.an),this.an=setTimeout(function(){b.ea.view.Ak(!1)},a),b.ea.view.Ak(!0)):this.Ca("lockUpdates: Expected a number")};c.prototype.ii=function(a){if(!this.Ng||a!==this.Ng.toString())throw Error("markChangesSent: does not match last getLocalChanges()");
Q("Mark changes sent!");this.ea.view.aa.mb.ii(this.Ng.Bg());this.Ng=null};c.prototype.ww=function(){if(this.va())return!1;this.ea.view.ad(3)};c.prototype.xw=function(a,b){if(this.va())return!1;if(E(a)&&E(b)){var c=this.Xb();if(0>a||a>=c)this.Ca("From page must be > 0 and less than getPageCount()");else if(0>b||b>=c)this.Ca("From page must be > 0 and less than getPageCount()");else{var e=this.Yj(a);null!==e&&this.Wd(function(a){return a.ad([R(e)],4,b)})}}else this.Ca("movePage: needs two valid page numbers.")};
c.prototype.yw=function(){if(this.va())return!1;this.ea.view.ad(2)};c.prototype.dn=function(){this.cl();this.ea.dn();this.pr()};c.prototype.nextPage=function(){this.$f(Math.min(this.Cf()+1,this.Xb()-1))};c.prototype.oa=function(a,b){"draw"===a?this.wg=b:a in this.ab?this.ab[a].push(b):this.ab[a]=[b];return this};c.prototype.Ow=function(a){"function"===typeof a||this.Ca("Error: onComplete needs a function argument.");this.ea.view.Tu(a)};c.prototype.pr=function(){var a=this.ea.ga.get("defaultPaperSize");
Q("onNewDocument()");"none"!==a&&this.Qn(a)};c.prototype.Vw=function(a){var b=this;return this.Mj.open({accept:"."+a,format:"text"}).then(function(a){if("string"===typeof a.data&&b.load(a.data))return b;throw Error("Could not open the file.");})};c.prototype.xi=function(a){if(this.va())return!1;this.ea.view.xi(a)};c.prototype.jx=function(){this.$f(Math.max(this.Cf()-1,0))};c.prototype.print=function(a,b){var c=[],e;if("number"===typeof a)c.push(a);else if(a instanceof Array)for(e=0;e<a.length;e++)if(E(a[e]))c.push(a[e]);
else{this.Ca("print(): pageSpec must be array of numbers");return}else if(!a)for(e=0;e<this.Xb();e++)c.push(e);var f=b?this.bj(b):this.bj(this.Ag());var h=this.Cf(),k=document.createElement("canvas");k.width=f.width;k.height=f.height;var l=k.getContext("2d");l.translate(-f.x,-f.y);e=window.location.hostname;var n=window.open("about:blank","_blank");n.document.write("<!DOCTYPE html><html><head><title>"+e+"</title></head><body>");for(e=0;e<c.length;e++)this.$f(c[e]),this.ea.view.ce(l,f.x,f.y,f.width,
f.height),this.ea.view.aa.ia(l),0<e?n.document.write("<div style='page-break-before:always'>"):n.document.write("<div>"),n.document.write("<img style='width:100%' src='"),n.document.write(k.toDataURL()),n.document.write("'></div>"),l.clearRect(f.x,f.y,f.width,f.height);n.document.write("</body></html>");n.document.close();setTimeout(function(){n.focus();n.print();setTimeout(function(){n.close()},1E3)},1E3);this.$f(h)};c.prototype.va=function(){return this.ea.ga.get("readOnly")?(Q("readOnly; ignore tool click."),
!0):!1};c.prototype.Qd=function(){this.ea.view.Qd()};c.prototype.Vc=function(a){this.ea.view.ia(a)};c.prototype.removeEventListener=function(a,b){if(a in this.ab){for(var c=this.ab[a],e=0;e<c.length;e++)if(c[e]===b){c.splice(e,1);break}0===c.length&&delete this.ab[a]}};c.prototype.removeListener=function(a,b){this.removeEventListener(a,b)};c.prototype.resize=function(){if(!this.En){var a=this;a.En=setTimeout(function(){a.vg||(a.En=0,a.ea.cj())},0)}};c.prototype.save=function(a,b,c){void 0===a&&(a=
"zwibbler3");void 0===c&&(c=0);var d={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",bmp:"image/bmp",svg:"image/svg+xml",pdf:"application/pdf"};b=this.bj(b||this.Ag());switch(a){case "list":return zf.Xi(this.ea.view.aa,"list","object");case "png":case "jpeg":case "jpg":case "bmp":case "svg":case "pdf":return this.ea.Pr(d[a],b,c);case "zwibbler3":return zf.Xi(this.ea.view.aa,"zwibbler3","string");case "image/png":case "image/jpeg":case "image/bmp":b=this.ea.Pr(a,b,c);b=b.substr(b.indexOf(",")+
1);a="";c=0;d={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63,"=":64};for(b=b.replace(/[^A-Za-z0-9\-_=\+\/]/g,"");c<b.length;){var f=d[b.charAt(c++)];var h=d[b.charAt(c++)];var k=d[b.charAt(c++)];var l=d[b.charAt(c++)];f=f<<2|h>>4;h=(h&
15)<<4|k>>2;var n=(k&3)<<6|l;a+=String.fromCharCode(f);64!==k&&(a+=String.fromCharCode(h));64!==l&&(a+=String.fromCharCode(n))}return a;default:return"Unsupported format: "+a}};c.prototype.cc=function(a){this.ea.view.cc(a)};c.prototype.Rd=function(a,b){if(this.va())return!1;this.ea.view.Rd(a,Hf(a,b))};c.prototype.hp=function(a){for(var b=[],c=0;c<a.length;c++){var e=this.ea.view.aa.jb(a[c],!1);e&&b.push(e)}return b};c.prototype.selectNodes=function(a){a=this.hp(Gf(a));this.ea.view.selectNodes(a);
this.ea.view.Tb();this.ea.view.ia()};c.prototype.Gx=function(a){if(this.va())return!1;var b=Gf(a||this.cd());this.Wd(function(a){return a.ad(b,1)})};c.prototype.Xk=function(a){this.ea.view.Xk(a)};c.prototype.Wr=function(a,b){"defaultPaperSize"===a&&this.Qn(b);return this.ea.ga.set(a,b)};c.prototype.Wg=function(a,b){if(this.va())return!1;this.ea.view.Nw(a,b);return!1};c.prototype.$f=function(a){this.ea.view.yc(a)};c.prototype.Nn=function(a){this.ea.view.Nn(a)};c.prototype.Nx=function(a,b){this.ea.view.aa.setProperty(a,
b)};c.prototype.Xg=function(a,b){!E(a)&&null!==a||!E(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.ea.view.Xg(a,b,!0)};c.prototype.Yr=function(a,b){!E(a)&&null!==a||!E(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.ea.view.Xg(a,b,!1)};c.prototype.Zr=function(a,b){var c=this.ea.view.aa.Ma(R(a));c?("DomNode"!==c.type()&&this.Ca("setDomElement: Node %s is not a DomNode. It is %s",a,c.type()),c.Qx(b),this.ea.Hj.push(b)):this.Ca("setDomElement: Node %s does not exist",
a)};c.prototype.Ox=function(a,b){return this.Zr(a,b)};c.prototype.$s=function(){var a=this;Q("Setting up dragdrop");this.ea.xa.addEventListener(document,"dragover",function(b){a.ea.view.ke(b.pageX,b.pageY)?b.preventDefault():Q("Ignore drag event -- not over canvas")});this.ea.xa.addEventListener(document,"drop",function(b){b.preventDefault();if(!a.ea.view.ke(b.pageX,b.pageY))Q("Ignore drop event -- not over canvas");else if(b.dataTransfer){if(b.dataTransfer.items)for(var c=0;c<b.dataTransfer.items.length;c++){if("file"===
b.dataTransfer.items[c].kind){a.ea.view.wn(b.dataTransfer.items[c]);break}}else for(c=0;c<b.dataTransfer.files.length;){a.ea.view.wn(b.dataTransfer.files[c]);break}try{var e=JSON.parse(b.dataTransfer.getData("text"))}catch(l){return}if("object"===typeof e&&e["zwibbler-src"]){var f=parseFloat(e["zwibbler-width"]),h=e["zwibbler-src"],k=e["zwibbler-props"];Q("DragDrop received with src=%s size=%s",h,f);h&&P.uq(h,function(c,d){var e=1;f&&(e=f/c);var l=a.wm(b.pageX,b.pageY);l.x-=c*e/2;l.y-=d*e/2;a.nj();
k.url=h;var n=a.createNode("ImageNode",k);a.Uk(n,e,e);a.Qi(n,l.x,l.y);a.uj();a.ys()})}}})};c.prototype.mv=function(a){var b=this.ea.view.aa.Ma(R(a));return b?Yc(b)?b.ba:(this.Ca("getDomElement: Node %s is not a DomNode. It is %s",a,b.type()),null):(this.Ca("getDomElement: Node %s does not exist",a),null)};c.prototype.wq=function(a){for(;a;){var b=a.getAttribute("nid");if(b)return parseInt(b,36)||0;a=a.parentElement}return 0};c.prototype.Gm=function(a){return(a=this.ea.view.aa.Ma(R(a)))?a.bk({ctx:this}):
null};c.prototype.Xx=function(a,b){fc(a)&&fc(b)?(this.yg()===a&&this.Xk(b),this.ea.view.aa.Jc(!1,function(c){c.Vb()===a&&c.setProperty("layer",b)})):this.Ca("setLayerName() needs string arguments.")};c.prototype.Qn=function(a,b){var c=null,e=null,f=!0,h=!1;if(2===arguments.length)if(E(arguments[0])&&E(arguments[1])){var k=arguments[0];c=arguments[1]}else fc(arguments[0])&&"boolean"===typeof arguments[1]?(e=arguments[0],h=arguments[1]):f=!1;else if(1===arguments.length&&fc(arguments[0]))for(var l=
arguments[0].split(" "),n=0;n<l.length;n++)"landscape"===l[n]?h=!0:"portrait"===l[n]?h=!1:e=l[n];if(!1===f)return Q("Bad arguments to setPaperSize()."),!1;if(null===e)return this.Xg(k,c),!0;switch(e.toLowerCase()){case "letter":k=816;c=1056;break;case "legal":k=816;c=1344;break;case "11x17":k=1056;c=1632;break;case "tabloid":k=1056;c=1632;break;case "a0":k=841/25.4*96;c=1189/25.4*96;break;case "a1":k=594/25.4*96;c=841/25.4*96;break;case "a2":k=420/25.4*96;c=594/25.4*96;break;case "a3":k=297/25.4*
96;c=420/25.4*96;break;case "a4":k=210/25.4*96;c=297/25.4*96;break;case "none":c=k=null;break;default:return Q("Invalid paper size: %s",e),!1}h&&(e=k,k=c,c=e);this.Xg(k,c);return!0};c.prototype.Ux=function(a,b,c){this.xc(a,b,c)};c.prototype.wc=function(a,b){if(this.va())return!1;if(2!==arguments.length)throw"Error: setNodeProperties takes 2 arguments.";this.ea.wc(Gf(a),this.Qb(b))};c.prototype.xc=function(a,b,c){if(this.va())return!1;3!==arguments.length&&this.Ca("Error: setNodeProperty takes 3 arguments.");
c=Hf(b,c);var d={};d[b]=c;this.wc(a,d)};c.prototype.Yx=function(a,b){for(var c=Gf(a),e=0;e<c.length;e++){var f=this.ea.view.aa.jb(c[e],!0);f&&f.bf(!b)}this.ea.view.ia()};c.prototype.es=function(a,b){if(this.va())return!1;this.ea.view.Sw(a,b)};c.prototype.Zx=function(a,b,c){E(a)&&E(b)&&E(c)||this.Ca("setPageSize(): requires pageNo, width, height");var d=this.Yj(a);d?this.wc(d,{width:b,height:c}):this.Ca("setPageSize: no such page %s",a)};c.prototype.Pn=function(a){this.ea.view.Pn(a)};c.prototype.yd=
function(a){if(!this.va()){this.wc(this.cd(),a);for(var b in a){var c=a[b];this.Rd(b,c);this.ea.view.ye(b,Hf(b,c))}}};c.prototype.setProperty=function(a,b){var c={};c[a]=b;this.yd(c)};c.prototype.ey=function(a){gc(a)&&E(a.x)&&E(a.y)&&E(a.width)&&E(a.height)||this.Ca("setViewRect: arg must be an object with numeric x, y, width, height properties");0!==a.width&&0!==a.height||this.Ca("setViewRect: width and height must be non-zero.");this.ea.view.bh(this.bj(a))};c.prototype.zd=function(a,b,c){if(E(a)||
"page"===a||"width"===a)if(1===arguments.length)this.ea.view.zd(a);else if(3===arguments.length&&"number"===typeof a&&E(b)&&E(c)){var d=this.mq()/a,f=this.ea.view.Ve();f.transform(new Ec(d,d,b,c));this.ea.view.bh(f)}else this.Ca("setZoom: invalid arguments.");else Q("setZoom: invalid parameter.")};c.prototype.Ji=function(a,b){void 0===b&&(b=!0);this.ea.view.Ji(a,b)};c.prototype.Ta=function(a,b,c){a=this.ea.view.Ta(new F(a,b),c);return{x:a.x,y:a.y}};c.prototype.xk=function(){return P.xk()};c.prototype.Ni=
function(a){a?(a=A.jc(a))||this.Ca("toggleFullScreen: can't find element from "+a):a=this.jc();a.style.backgroundColor="#ffffff";P.Ni(a)};c.prototype.Qi=function(a,b,c){if(this.va())return!1;Q("Translate node %s by %s,%s",a,b,c);return this.ea.Qi(Gf(a),b,c)};c.prototype.Ci=function(a){this.ea.Ci(a)};c.prototype.zn=function(){this.ea.view.zn()};c.prototype.yx=function(a){if(this.va())return!1;var b=0===Math.round(a/(Math.PI/2))%2;this.nj();for(var c=0;c<this.Xb();c++)this.Or(c,a);b||(a=this.ea.view.aa.ka("width"),
b=this.ea.view.aa.ka("height"),a&&b||!this.ee("pageView")||(a=Af.width,b=Af.height),a&&b&&this.Yr(b,a));this.uj()};c.prototype.Nr=function(a,b,c,e){if(this.va())return!1;Q("Rotate nodes by %s around (%s,%s)",b/Math.PI*180,c,e);for(var d=4===arguments.length,h=Gf(a),k=new F(0,0),l=0;l<h.length;l++){var n=h[l],q=this.ea.view.aa.jb(n);q&&(q||d)?!d&&q&&(n=q.rect.Ed(),k.x+=n.x,k.y+=n.y):Q("rotateNode: Node %s does not exist",n)}d?(k.x=c,k.y=e):(k.x/=h.length,k.y/=h.length);d=new Dc(b,k.x,k.y);return this.ea.transformNode(h,
d)};c.prototype.Or=function(a,b){a>=this.Xb()&&this.Ca("rotatePage: page "+a+" does not exist.");if(!this.va()){var c=Math.round(b/(Math.PI/2));b=c*Math.PI/2;var e=0===c%2;this.nj();c=this.Cf();this.$f(a);var f=this.sm(),h=this.Ag(),k=h.width/2,l=h.height/2;this.Nr(f,b,k,l);e||this.Qi(f,l-k,k-l);e=this.Yj(a);this.wc(e,{width:h.height,height:h.width});this.$f(c);this.uj()}};c.prototype.Uk=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);if(this.va())return!1;Q("Scale node %s by %s,%s",a,b,c);
return this.ea.Uk(Gf(a),b,c,e,f)};c.prototype.On=function(a,b,c,e,f,h,k){if(this.va())return!1;7!==arguments.length&&this.Ca("setNodeTransform: requires 7 arguments");Q("setNodeTransform(id=%s %s %s %s %s %s %s %s)",a,b,c,e,f,h,k);return this.ea.On(Gf(a),b,c,e,f,h,k)};c.prototype.js=function(a,b,c){var d=this;if(!this.Pg){var f=document.createElement("div");f.style.width="320px";f.style.lineHeight="0";f.style.position="absolute";f.style.webkitUserSelect="none";f.style.userSelect="none";this.jc().appendChild(f);
var h=this;this.jq(f,20,{onColour:function(a,b){var c=h.Dp;if(""===c||"fillStyle"===c&&!b)c="strokeStyle";h.setProperty(c,a)}});this.Pg=P.vl(f);this.ea.xa.add(function(){d.Pg&&(d.Pg.destroy(),A(f).remove(),d.Pg=null)})}this.Dp=a;this.Pg.show(b,c,!0)};c.prototype.mu=function(a){void 0===a&&(a=oc(32));Q("Creating shared session "+a);this.$o(a,2);return a};c.prototype.$o=function(a,b){var c=this;Q("Attach to shared session %s, creating=%s",a,b);this.zc&&this.zc.stop();this.ea.view.aa.mb.ux();return new Promise(function(d,
f){var e=c.ea.ga.get("collaborationServer");"custom"!==e?(e=new Nb(c,e.replace("{name}",a),c.ee("latency")),c.zc=e,e.oa("connected",function(){c.na("connected");c.digest()}),e.oa("connect-error",function(){c.na("connect-error");c.digest()}),e.oa("broadcast",function(a){c.na("broadcast",a);c.digest()}),e.oa("set-keys",function(a){c.na("set-keys",a)}),e.start(a,b).then(function(){Q("Session resolved");d(a)},function(a){Q("Error joining session: %s",a.message);f(a)})):d(a);return a})};c.prototype.jw=
function(a,b){void 0===a&&(a="");void 0===b&&(b=!1);return this.$o(a,b?0:1).then(function(){Q("Successfully connected to session.")},function(a){console.log("Error connecting to session:",a);throw a;})};c.prototype.cl=function(){this.zc&&(this.zc.stop(),this.zc=null,this.na("disconnected"))};c.prototype.Ac=function(){if(this.va())return!1;this.ea.view.Ac()};c.prototype.fh=function(a){if(this.va())return!1;this.Wd(function(b){b.fh(Gf(a))})};c.prototype.upload=function(a,b){function c(){}function e(){}
var f=this.ea.lu(b||"Working"),h=new XMLHttpRequest,k=new FormData(a);h.upload.addEventListener("progress",function(a){f.update(a.loaded/a.total)},!1);h.addEventListener("load",function(){200===h.status?(f.done(),e(h.response,h)):(f.error("Error"),c(h))},!1);h.addEventListener("error",function(){f.error("Error");c(h)},!1);h.addEventListener("abort",function(){f.error("Aborted");c(h)},!1);h.open(a.method,a.action);h.send(k);var l={success:function(a){e=a;return l},error:function(a){c=a;return l}};
return l};c.prototype.Jy=function(a,b){void 0===b&&(b=!1);if(this.va())return!1;this.ea.view.vt(this.Qb(a),b)};c.prototype.Ky=function(a,b){if(this.va())return!1;2===arguments.length?this.ea.view.em({lineWidth:b,strokeStyle:a}):1===arguments.length?this.ea.view.em(this.Qb(arguments[0])):this.ea.view.em({})};c.prototype.Ly=function(a){if(this.va())return!1;this.ea.view.jl(this.Qb(a))};c.prototype.My=function(a){if(this.va())return!1;this.ea.view.Ip(this.Qb(a))};c.prototype.Ny=function(a){if(this.va())return!1;
gc(a)?(a=new Cf(this.ea.view,a),this.ea.view.Ra(a)):this.Ca("useCustomTool(): requires an object as argument.")};c.prototype.wo=function(a){if(this.va())return!1;this.ea.view.wo(R(a))};c.prototype.jl=function(a){void 0===a&&(a={});if(this.va())return!1;this.ea.view.jl(this.Qb(a))};c.prototype.Qy=function(a,b,c){void 0===c&&(c="freehand");if(this.va())return!1;gc(a)?(a=this.Qb(a),c=b):a={strokeStyle:a,lineWidth:b};this.ea.view.Pp(a,c)};c.prototype.Yy=function(a,b){void 0===b&&(b=!0);if(this.va())return!1;
var c=a;fc(a)?c={url:a}:"url"in c||this.Ca("useStampTool: missing url in properties");this.ea.view.Ry(c,1===arguments.length||!0===b)};c.prototype.Sy=function(a,b){if(this.va())return!1;if(gc(b)){var c=b.singleLine;var e=b.orthogonal}else c=b;this.ea.view.Wq(this.Qb(a),c,e)};c.prototype.Ty=function(){this.ea.view.Yw()};c.prototype.ys=function(){this.ea.view.kb()};c.prototype.xo=function(a,b,c,e){if(this.va())return!1;E(a)||this.Ca("usePolygonTool: parameter 1 must be a number.");E(b)||this.Ca("usePolygonTool: parameter 2 must be a number.");
c&&!E(c)&&this.Ca("usePolygonTool: parameter 3 must be a number.");e&&!gc(e)&&this.Ca("usePolygonTool: parameter 4 must be a object properties.");this.ea.view.xo(a,b,c||1,this.Qb(e||{}))};c.prototype.Uy=function(a){void 0===a&&(a={});if(this.va())return!1;this.ea.view.Pp(this.Qb(a),"quadratic")};c.prototype.Si=function(a){void 0===a&&(a={});if(this.va())return!1;this.ea.view.Si(this.Qb(a))};c.prototype.Vy=function(a){void 0===a&&(a={});if(this.va())return!1;this.ea.view.Si(vc({roundRadius:this.ea.ga.get("defaultRoundRectRadius")},
a))};c.prototype.Wy=function(a,b){if(this.va())return!1;var c={};gc(a)?c=this.Qb(a):fc(a)&&(c.stokeStyle=a);E(b)&&(c.lineWidth=b);this.ea.view.uu(c)};c.prototype.yo=function(a,b,c,e,f,h){void 0===f&&(f="rectangle-tl");void 0===h&&(h=null);if(this.va())return!1;this.ea.view.yo(a,this.Qb(b),c,e,f,h)};c.prototype.Xy=function(a){if(this.va())return!1;this.ea.view.Si(this.Qb(a))};c.prototype.Zy=function(a){if(this.va())return!1;this.ea.view.ho(this.Qb(a))};c.prototype.nl=function(){this.ea.view.nl()};
c.prototype.ol=function(){this.ea.view.ol()};return c}();function Hf(c,a){switch(c){case "lineWidth":case "fontSize":case "arrowSize":case "arrowXOffset":case "brightness":case "contrast":case "cloudRadius":case "gamma":case "opacity":case "snap":case "zIndex":"string"===typeof a&&(a=parseFloat(a));break;case "matrix":"[object Array]"===Object.prototype.toString.apply(a)&&"Matrix"===a[0]?(a.splice(0,1),a=new J(a)):a instanceof J||(a=new J(a))}return a}S.prototype.addKeyboardShortcut=S.prototype.Gl;
S.prototype.addRemoteChanges=S.prototype.qh;S.prototype.attach=S.prototype.qc;S.prototype.abortTransaction=S.prototype.ct;S.prototype.addSelectionHandle=S.prototype.Zc;S.prototype.addToGroup=S.prototype.hj;S.prototype.addToLanguage=S.prototype.Il;S.prototype.addPage=S.prototype.lt;S.prototype.addPanel=S.prototype.ph;S.prototype.begin=S.prototype.Wa;S.prototype.beginTransaction=S.prototype.nj;S.prototype.bringToFront=S.prototype.Jt;S.prototype.sendBroadcast=S.prototype.Kn;
S.prototype.setSessionKey=S.prototype.Sn;S.prototype.canRedo=S.prototype.Yd;S.prototype.canUndo=S.prototype.Zd;S.prototype.clearSelection=S.prototype.fb;S.prototype.clearUndo=S.prototype.St;S.prototype.clickColour=S.prototype.Tt;S.prototype.commit=S.prototype.ua;S.prototype.commitIrreversibleTransaction=S.prototype.Xt;S.prototype.commitTransaction=S.prototype.uj;S.prototype.copy=S.prototype.sf;S.prototype.createColours=S.prototype.Hp;S.prototype.createDataNode=S.prototype.gu;
S.prototype.createGroup=S.prototype.hu;S.prototype.createLogger=S.prototype.ju;S.prototype.createNode=S.prototype.createNode;S.prototype.createHTMLNode=S.prototype.iu;S.prototype.createPath=S.prototype.Aj;S.prototype.createToolbar=S.prototype.nu;S.prototype.createShape=S.prototype.Xl;S.prototype.cut=S.prototype.$l;S.prototype.destroy=S.prototype.Ua;S.prototype.deleteNode=S.prototype.be;S.prototype.deleteNodes=S.prototype.Sb;S.prototype.deletePage=S.prototype.ou;S.prototype.deleteSelection=S.prototype.Np;
S.prototype.dirty=S.prototype.Ne;S.prototype.dispatchEvent=S.prototype.dispatchEvent;S.prototype.mouseEvent=S.prototype.uw;S.prototype.download=S.prototype.download;S.prototype.draw=S.prototype.ia;S.prototype.editNodeText=S.prototype.yu;S.prototype.duplicate=S.prototype.duplicate;S.prototype.emit=S.prototype.na;S.prototype.emitNow=S.prototype.Kc;S.prototype.emitOnce=S.prototype.xg;S.prototype.skipEvent=S.prototype.oy;S.prototype.focus=S.prototype.focus;S.prototype.forEachNode=S.prototype.Ru;
S.prototype.findNode=S.prototype.Lu;S.prototype.findNodes=S.prototype.$p;S.prototype.flip=S.prototype.Pu;S.prototype.flipNodes=S.prototype.Kh;S.prototype.generatePalette=S.prototype.jq;S.prototype.getActiveLayer=S.prototype.yg;S.prototype.getAllNodes=S.prototype.sm;S.prototype.getBackgroundImage=S.prototype.$u;S.prototype.getBoundingRectangle=S.prototype.tm;S.prototype.getConfig=S.prototype.ee;S.prototype.getCurrentPage=S.prototype.Cf;S.prototype.getCurrentFillColour=S.prototype.fv;
S.prototype.getCurrentOutlineColour=S.prototype.gv;S.prototype.getCurrentTool=S.prototype.Oh;S.prototype.getCustomNode=S.prototype.hv;S.prototype.getDocumentCoordinates=S.prototype.wm;S.prototype.getDocumentProperty=S.prototype.lv;S.prototype.getDocumentSize=S.prototype.Ag;S.prototype.getElement=S.prototype.jc;S.prototype.getFillColour=S.prototype.Vj;S.prototype.getHistory=S.prototype.wv;S.prototype.getImageUrl=S.prototype.Am;S.prototype.getLanguageString=S.prototype.Av;
S.prototype.getLocalChanges=S.prototype.Cm;S.prototype.getDrawingRectangle=S.prototype.nv;S.prototype.getGroupParent=S.prototype.uv;S.prototype.getGroupMembers=S.prototype.tv;S.prototype.getItemProperty=S.prototype.yv;S.prototype.getLayers=S.prototype.Cv;S.prototype.getLayerNodes=S.prototype.Bv;S.prototype.getNodeCoordinates=S.prototype.Dv;S.prototype.getNodePageNumber=S.prototype.ge;S.prototype.getNodeProperty=S.prototype.Xj;S.prototype.getNodeRectangle=S.prototype.Ev;S.prototype.getNodeScale=S.prototype.Fv;
S.prototype.getNodeTransform=S.prototype.Gv;S.prototype.getNodeType=S.prototype.Hv;S.prototype.getNodeUnderPoint=S.prototype.Iv;S.prototype.getNodesUnderPoint=S.prototype.Mv;S.prototype.getPageCount=S.prototype.Xb;S.prototype.getPageNode=S.prototype.Yj;S.prototype.getPageRect=S.prototype.yq;S.prototype.getPathData=S.prototype.$j;S.prototype.getPathAsPoints=S.prototype.Pv;S.prototype.getCanvasScale=S.prototype.mq;S.prototype.getEditNode=S.prototype.ym;S.prototype.getScreenCoordinates=S.prototype.Aq;
S.prototype.getSelectedEditHandle=S.prototype.Rv;S.prototype.getStrokeColour=S.prototype.ck;S.prototype.getEditHandleType=S.prototype.Uj;S.prototype.setEditHandle=S.prototype.Px;S.prototype.getSelectedNodes=S.prototype.cd;S.prototype.getPropertySummary=S.prototype.Sh;S.prototype.getViewRectangle=S.prototype.Tv;S.prototype.goToRevision=S.prototype.Uv;S.prototype.openFile=S.prototype.Uw;S.prototype.insertImage=S.prototype.cw;S.prototype.insertPage=S.prototype.vk;S.prototype.isLayerVisible=S.prototype.Um;
S.prototype.isNodeSelected=S.prototype.ai;S.prototype.isPointOverCanvas=S.prototype.ke;S.prototype.load=S.prototype.load;S.prototype.lockUpdates=S.prototype.Ak;S.prototype.markChangesSent=S.prototype.ii;S.prototype.moveDown=S.prototype.ww;S.prototype.movePage=S.prototype.xw;S.prototype.moveUp=S.prototype.yw;S.prototype.newDocument=S.prototype.dn;S.prototype.nextPage=S.prototype.nextPage;S.prototype.on=S.prototype.oa;S.prototype.onComplete=S.prototype.Ow;S.prototype.openFromComputer=S.prototype.Vw;
S.prototype.paste=S.prototype.xi;S.prototype.previousPage=S.prototype.jx;S.prototype.print=S.prototype.print;S.prototype.redo=S.prototype.Qd;S.prototype.redraw=S.prototype.Vc;S.prototype.removeEventListener=S.prototype.removeEventListener;S.prototype.resize=S.prototype.resize;S.prototype.save=S.prototype.save;S.prototype.setCursor=S.prototype.cc;S.prototype.setToolProperty=S.prototype.Rd;S.prototype.selectNodes=S.prototype.selectNodes;S.prototype.sendToBack=S.prototype.Gx;
S.prototype.setActiveLayer=S.prototype.Xk;S.prototype.setConfig=S.prototype.Wr;S.prototype.setColour=S.prototype.Wg;S.prototype.setCurrentPage=S.prototype.$f;S.prototype.setCustomBackgroundFn=S.prototype.Nn;S.prototype.setDocumentProperty=S.prototype.Nx;S.prototype.setDocumentSize=S.prototype.Xg;S.prototype.setDocumentSizeInTransaction=S.prototype.Yr;S.prototype.setDomElement=S.prototype.Zr;S.prototype.setDomNode=S.prototype.Ox;S.prototype.getDomElement=S.prototype.mv;
S.prototype.getNodeFromElement=S.prototype.wq;S.prototype.getNodeObject=S.prototype.Gm;S.prototype.setLayerName=S.prototype.Xx;S.prototype.setPaperSize=S.prototype.Qn;S.prototype.setItemProperty=S.prototype.Ux;S.prototype.setNodeProperties=S.prototype.wc;S.prototype.setNodeProperty=S.prototype.xc;S.prototype.setNodeVisibility=S.prototype.Yx;S.prototype.setOpacity=S.prototype.es;S.prototype.setPageSize=S.prototype.Zx;S.prototype.setPageView=S.prototype.Pn;S.prototype.setProperties=S.prototype.yd;
S.prototype.setProperty=S.prototype.setProperty;S.prototype.setViewRectangle=S.prototype.ey;S.prototype.setZoom=S.prototype.zd;S.prototype.showLayer=S.prototype.Ji;S.prototype.snap=S.prototype.Ta;S.prototype.isFullscreenSupported=S.prototype.xk;S.prototype.toggleFullscreen=S.prototype.Ni;S.prototype.translateNode=S.prototype.Qi;S.prototype.removePanel=S.prototype.Ci;S.prototype.removeSelectionHandles=S.prototype.zn;S.prototype.rotateDocument=S.prototype.yx;S.prototype.rotateNode=S.prototype.Nr;
S.prototype.rotatePage=S.prototype.Or;S.prototype.scaleNode=S.prototype.Uk;S.prototype.setNodeTransform=S.prototype.On;S.prototype.showColourPicker=S.prototype.js;S.prototype.createSharedSession=S.prototype.mu;S.prototype.joinSharedSession=S.prototype.jw;S.prototype.stopSharing=S.prototype.cl;S.prototype.undo=S.prototype.Ac;S.prototype.ungroup=S.prototype.fh;S.prototype.upload=S.prototype.upload;S.prototype.useArrowTool=S.prototype.Jy;S.prototype.useBrushTool=S.prototype.Ky;
S.prototype.useCircleTool=S.prototype.Ly;S.prototype.useCurveTool=S.prototype.My;S.prototype.useCustomTool=S.prototype.Ny;S.prototype.useEditHandleTool=S.prototype.wo;S.prototype.useEllipseTool=S.prototype.jl;S.prototype.useFreehandTool=S.prototype.Qy;S.prototype.useStampTool=S.prototype.Yy;S.prototype.useLineTool=S.prototype.Sy;S.prototype.usePanTool=S.prototype.Ty;S.prototype.usePickTool=S.prototype.ys;S.prototype.usePolygonTool=S.prototype.xo;S.prototype.useQuadraticBezierTool=S.prototype.Uy;
S.prototype.useRectangleTool=S.prototype.Si;S.prototype.useRoundRectTool=S.prototype.Vy;S.prototype.useShapeBrushTool=S.prototype.Wy;S.prototype.useShapeTool=S.prototype.yo;S.prototype.useSquareTool=S.prototype.Xy;S.prototype.useTextTool=S.prototype.Zy;S.prototype.zoomIn=S.prototype.nl;S.prototype.zoomOut=S.prototype.ol;var If=y.create("zeact");function Jf(c){"BUTTON"===c.tagName&&(c.getAttribute("type")||c.setAttribute("type","button"))}var O=ib.hf();
O.Ab("click",function(c,a,b,d){function e(b){db("z-click=["+d+"] received "+b.type);ib.mm(c,d,a,b,f);O.digest();b.preventDefault()}function f(a,b){a instanceof S&&0<=b.indexOf("Tool")&&(db("Called %s",b),h=!0);return a[b]}Jf(a);b="onpointerdown"in window;"ontouchstart"in window?O.Za(a,"touchend",e):b?O.Za(a,"pointerup",e):O.Za(a,"mouseup",e);var h;O.Za(a,"keydown",function(b){b.target===a&&13===b.keyCode&&(h=!1,e(b),h&&c.ctx.focus(!0,a))})});
O.Ab("has",function(c,a,b,d){b=[];var e=0;for(d=d.split("|");e<d.length;e++){var f=d[e];f=f.trim();b.push('("'+f+'" in ctx.summary.types || "'+f+'" in ctx.summary.properties)')}(b=b.join("||"))&&O.Cc(c,a,b,function(b){a.style.display=b?"block":"none"})});
O.Ab("property",function(c,a,b,d){b='ctx.summary.properties["'+d+'"]';var e=a.getAttribute("z-value"),f=null!==a.getAttribute("z-colour");O.Cc(c,a,b,function(b){"value"in a&&(a.value=b);null!==e&&A(a).lo("selected",""+b===e);f&&(a.style.backgroundColor=b)});"BUTTON"===a.tagName?(Jf(a),O.Za(a,"click",function(){var b=a.getAttribute("z-value")||"";c.ctx.setProperty(d,b)})):O.Za(a,"change",function(){var b=ib.ov(c,a);void 0!==b&&c.ctx.setProperty(d,b)})});
O.Ab("popup",function(c,a,b,d){if(!a.hasAttribute("z-ignore-popup-hack")){var e=a.parentNode;if(!e)throw Error("z-popup: no parent node?!");var f=document.createComment("z-popup="+d);e.replaceChild(f,a);a.setAttribute("z-ignore-popup-hack","");O.xa(e,function(){a.removeAttribute("z-ignore-popup-hack");e&&e.replaceChild(a,f)});c.ctx.$popups||(c.ctx.$popups={});c.ctx.$popups[d]={ba:a,Fh:null}}});
O.Ab("show-popup",function(c,a,b,d){Jf(a);var e=null;O.xa(a,function(){e&&e.destroy()});O.Za(a,"click",function(b){if(e)If("Dialog %s already shown",d);else{var f=c.ctx.$popups?c.ctx.$popups[d]:null;if(!f)throw Error("Popup "+d+" not found");var k=f.ba;if(f.Fh)If("Dialog %s already shown by another button",d);else{k=k.cloneNode(!0);var l="none"!==k.getAttribute("z-click-dismiss"),n=k.hasAttribute("z-click-dismiss")&&l;O.qc(c,k);e=Oa(k);f.Fh=e;e.onhide=function(){If("Dialog is hidden.");e&&(e.destroy(),
e=null,f.Fh=null,O.detach(k))};var q=a.getAttribute("z-show-position")||k.getAttribute("z-show-position");"centre"===q||"center"===q?e.show(void 0,void 0,n,l):null!==q?e.show(a,q,n,l):e.show(b.pageX,b.pageY,n,l)}}})});O.Ab("colour",function(c,a){O.Za(a,"click",function(b){c.ctx.js(a.getAttribute("z-property")||"",b.pageX,b.pageY)})});
O.Ab("page",function(c,a,b,d){function e(){var a=f.yq(k),b=Math.min(l/a.width,n/a.height);1<b&&(b=1);h.width=a.width*b|0;h.height=a.height*b|0;q.setTransform(b,0,0,b,0,0);q.fillStyle="white";q.fillRect(0,0,a.width,a.height);f.ia(q,{page:k})}if(!a.lz){var f=c.ctx,h=document.createElement("canvas"),k=ab(c,d)||0,l=parseInt(a.getAttribute("z-width")||"1000000"),n=parseInt(a.getAttribute("z-height")||"1000000");h.style.backgroundColor="white";var q=h.getContext("2d");for(b=0;b<a.attributes.length;b++)d=
a.attributes[b],"z-page"!==d.name&&h.setAttribute(d.name,d.value);a.parentNode&&a.parentNode.replaceChild(h,a);e();f.oa("document-changed",e);f.oa("resource-loaded",e);O.xa(h,function(){f.removeEventListener("document-changed",e);f.removeEventListener("resource-loaded",e)});for(b=0;b<a.attributes.length;b++)h.setAttribute(a.attributes[b].name,a.attributes[b].value);h.lz=!0;return O.qc(c,h).node}},1);
O.Ab("sort",function(c,a,b,d){P.Xe(".zwibbler-sort-highlight { outline: 3px solid orange }");var e=Qa({parent:a,kj:"z-sortable",pn:"zwibbler-sort-highlight",Rw:function(a,b){c.$from=a;c.$to=b;ab(c,d);O.digest()}});O.xa(a,function(){e()})});function Kf(){db("Document loaded.");Array.prototype.forEach.call(document.querySelectorAll("zwibbler,[zwibbler]"),function(c){Lf(c,null,!1)})}function Nf(c,a,b){A(c).matches(a)&&b(c);Array.prototype.forEach.call(c.querySelectorAll(a),b)}
function Lf(c,a,b){if(!c.nh&&("ZWIBBLER"===c.tagName&&P.Xe("zwibbler {display: block}"),b||null===c.getAttribute("z-no-auto-init"))){Nf(c,"[z-component]",function(a){var b=a.getAttribute("z-component"),c=a.getAttribute("z-controller"),d=(a.getAttribute("z-properties")||"").split(/[ ,]+/);if(b){var e=null;if(c)if(c in P.controllers)e=P.controllers[c];else if("function"===typeof window.zcontroller)e=window.zcontroller;else throw Error("While processing component: "+b+" could not find controller function "+
c);P.vj(b,{template:a,properties:d,controller:e});a.parentNode.removeChild(a)}});var d,e={};for(b=0;b<c.attributes.length;b++){var f=c.attributes[b];P.Fq(f.name)&&(e[f.name]=f.value)}Nf(c,"z-canvas,[z-canvas]",function(a){d=P.create(a,e)});a||(a=d||{});d?(a.ctx=d,d.qc(a,c)):O.qc(a,c);a.$digest=function(a){if(a)O.digest(a);else return new Promise(function(a){O.digest(a)})};a.$watch=function(b,d){O.Cc(a,c,b,d)};a.$apply=function(b){if(b)return ab(a,b);O.digest()};a.hidePopup=function(b){a.$popups&&
b in a.$popups&&a.$popups[b].Fh&&a.$popups[b].Fh.hide()};b=c.getAttribute("z-controller")||"";b in P.controllers?(db("Running controller: %s",b),P.controllers[b](a)):"function"===typeof window[b]?(db("Running controller: %s",b),window[b](a)):b&&console.log("Controller not found: %s",b);O.digest();return a}}document.addEventListener("DOMContentLoaded",function(){Kf()});
O.Ab("editable",function(c,a,b,d){function e(){var b=a.innerHTML;f=b;ab(c,d+"="+JSON.stringify(b));If("Text editor no longer selected. Blurring");k.exec("select-none");k.setActive(!1)}if(c.ctx){var f="";O.Cc(c,a,d,function(a){f!==a&&(f=a,k.Sx(a))});var h=new xb,k=new ve(h,a,{Un:!0,placeholder:a.getAttribute("placeholder")||""});O.xa(a,function(){h.Ua()});O.Za(a,"focus",function(){If("Got text focus event");k.setActive(!0)});O.Za(a,"click",function(){If("Clicked on text");k.setActive(!0)});O.Za(a,
"blur",function(){If("Got text blur event")});k.oa("selchange",function(){});k.oa("enter",e);c.ctx.oa("selected-nodes",function(){!c.ctx.ai(c.id)&&k.active&&e()})}});O.Ud("clear-glyph",function(c,a,b){If("Drawing colour panel, width=%s tag=%s",JSON.stringify(a),c.tagName);"CANVAS"===c.tagName&&(c.width=a.width,c.height=a.width,"clear"===a.style?Me(c.getContext("2d"),0,0,a.width):Ne(c.getContext("2d"),0,0,a.width),b.resize())});var Of=y.create("HTMLNode");
function Pf(c){return function(a){function b(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.ba=null;b.children=[];b.Db|=6;return b}__extends(b,a);b.prototype.Na=function(){return this.children.length};b.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,1);Yc(b)&&b.ba&&b.ba.parentNode&&b.ba.parentNode.removeChild(b.ba);return b};b.prototype.ni=function(a){for(a+=1;a<this.children.length;a++){var b=this.children[a];if(Yc(b))return b.ba}return null};
b.prototype.uk=function(a,b){this.children.splice(b,0,a);this.ba&&Yc(a)&&a.ba&&this.Bl(a.ba,this.ni(b))};b.prototype.Bl=function(a,b){if(b)b.parentNode.insertBefore(a,b);else if(this.ba){var c=a.getAttribute("z-type")||"";Qf(this.ba,c).appendChild(a)}};b.prototype.rb=function(a){return this.children[a]};b.prototype.co=function(a,b){var c=this.ni(a),d=this.ni(b),e=this.children[a],l=this.children[b],n=this.children[a];this.children[a]=this.children[b];this.children[b]=n;this.ba&&(Yc(e)&&e.ba&&this.Bl(e.ba,
d),Yc(l)&&l.ba&&this.Bl(l.ba,c))};return b}(c)}
var jf=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.bq=!1;b.rn={};b.scope=null;return b}__extends(a,c);a.prototype.type=function(){return"HTMLNode"};a.prototype.Ua=function(){this.ba&&!this.bq&&(O.detach(this.ba),A(this.ba).remove())};a.prototype.fs=function(a){this.rn=a};a.prototype.setProperty=function(a,d){"matrix"===a||"object"!==typeof d||d instanceof Array?(d=c.prototype.setProperty.call(this,a,d),this.$a(a,d)):this.yd(Rf(d,{},a+"."))};a.prototype.ka=function(a){switch(a){case "lockRotation":case "lockSize":return!0}return c.prototype.ka.call(this,
a)};a.prototype.$a=function(a,c){this.ba&&"style."===a.substr(0,6)&&(this.ba.style[a.substr(6)]=c||"")};a.prototype.format=function(a,c){var b=this;if(null===this.ba){var d=this.da.$component;Of("Create component element of type %s",d);var h=ad(this.rn,this);h=P.zj(this.rn,d,{nid:this.id,"z-type":d},h);if(!h)throw Error("Error: No component registered for "+d);this.scope=h.scope;this.ba=h.node;this.ba.style.boxSizing="border-box";this.ba.Fz=function(){return!1};this.parent&&Yc(this.parent)&&this.Pw();
for(var k in this.da)this.$a(k,this.da[k]);this.ba.addEventListener("load",function(){Of("Something loaded; request reformat.");c.na("reformat",b.id)})}d=this.La();"style.left"in this.da&&(this.ba.style.left=parseFloat(this.da["style.left"])+d.Da+"px");"style.top"in this.da&&(this.ba.style.top=parseFloat(this.da["style.top"])+d.Ea+"px");d=0;for(k=this.children;d<k.length;d++)h=k[d],Xc(h)&&h.format(a,c)};a.prototype.$x=function(a){this.rect=a;this.Ja=a.clone()};a.prototype.ia=function(a){var b=a.globalCompositeOperation;
a.globalCompositeOperation="destination-out";a.fillRect(this.Ja.x,this.Ja.y,this.Ja.width,this.Ja.height);a.globalCompositeOperation=b;a.strokeStyle="rgba(255,0,0,0.2)";a.lineWidth=3};a.prototype.ng=function(){return!0};a.prototype.Pw=function(){if(this.parent&&Yc(this.parent)&&this.parent.ba){var a=this.parent.Ue(this);if(-1===a)throw Error("Child node not found");var c=Qf(this.parent.ba,this.da.$component);a=this.parent.ni(a);c&&this.ba&&c.insertBefore(this.ba,a)}};a.prototype.Dm=function(){if(!this.ba)return this.rect;
var a=A(this.ba).Em();return new I(this.rect.x-a.left,this.rect.y-a.top,this.rect.width+a.left+a.right,this.rect.height+a.top+a.bottom)};return a}(Pf(ed));bd.kd("HTMLNode",jf);function Qf(c,a){for(var b=c.querySelectorAll("[container-for]"),d=null,e=0;e<b.length;e++)if(cf(b[e],a)){d=b[e];break}if(d){b=d.parentElement;for(e=!0;b;){if(b.getAttribute("nid")){e=b==c;break}b=b.parentElement}if(e)return d}return c}function cf(c,a){var b=c.getAttribute("container-for");return b&&0<=b.indexOf(a)}
function Rf(c,a,b){void 0===a&&(a={});void 0===b&&(b="");for(var d in c){var e=c[d];e instanceof Object&&!(e instanceof Array)?Rf(e,a,d+"."):a[b+d]=e}return a};var Sf=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.log=y.create("PAGE",!0);b.ba=document.createElement("div");b.ba.classList.add("zwibbler-page");b.ba.setAttribute("nid",a);return b}__extends(a,c);a.prototype.type=function(){return"PageNode"};a.prototype.setProperty=function(a,d){if(void 0===d)delete this.da[a];else switch(a){case "width":case "height":this.da[a]=d;break;default:c.prototype.setProperty.call(this,a,d)}};a.prototype.kc=function(){return"width"in this.da&&"height"in this.da?
new yc(this.da.width,this.da.height):null};a.prototype.format=function(){};a.prototype.xb=function(){return null};a.prototype.ia=function(){};return a}(Pf(bd));ed.kd("PageNode",Sf);var Tf=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.ba=null;b.Cj=void 0;b.vc=new Mc;b.Pm=new Mc;b.Qe=new J;b.readOnly=!1;b.ub=!1;b.Jd=null;b.width=0;b.height=0;b.Uc=null;b.Dr="";b.log=y.create("DomNode",!0);b.ih=-1;b.canvas=null;b.da.data="";b.da.locked=!1;b.Db|=4;return b}__extends(a,c);a.prototype.type=function(){return"DomNode"};a.prototype.ni=function(){return null};a.prototype.setProperty=function(a,d){if("data"===a)this.ba&&(A(this.ba).remove(),this.Cj=this.ba=null);else if("border"===
a||"lockSize"===a||"lockRotate"===a||"preview"===a){this.da[a]=d;return}c.prototype.setProperty.call(this,a,d)};a.prototype.Qx=function(a){null!==this.Jd&&(this.log("Node %s receives DOM element and requests reformat",this.id),this.ba&&(this.log("   Remove existing DOM element"),A(this.ba).remove()),this.ba=a,this.ba.style.position="absolute",A(this.ba).Qm(this.Jd.canvas),this.width=this.ba.offsetWidth||parseFloat(this.ba.getAttribute("width")||"0"),this.height=this.ba.offsetHeight||parseFloat(this.ba.getAttribute("height")||
"0"),A(this.ba).remove(),this.$g(this.readOnly,!0),this.ba.style.top="0px",this.ba.style.left="0px",this.ba.style.boxSizing="border-box",this.ba.classList.add("zwibbler-dom-node"),this.ba.setAttribute("zwibbler-node-id",""+this.id),this.Fl("transformOrigin","top left"),this.log("element height: %s, %s",this.ba.offsetWidth,this.ba.offsetHeight),this.Jd.Tg(this.id))};a.prototype.jc=function(){return this.ba};a.prototype.Fl=function(a,c){if(null!==this.ba){for(var b=a.charAt(0).toUpperCase()+a.substr(1),
d=["ms","Webkit","O","Moz"],h=0;h<d.length;h++)this.ba.style[d[h]+b]=c;this.ba.style[a]=c}};a.prototype.bf=function(a){ed.prototype.bf.call(this,a);this.ba&&(this.ba.style.visibility=this.aj?"hidden":"visible")};a.prototype.$g=function(a,c){void 0===c&&(c=!1);if(c||this.readOnly!==a)this.readOnly=a,this.ba&&this.Jd&&this.ub&&(this.sn(this.ih),A(this.ba).Qm(this.Jd.canvas))};a.prototype.format=function(a,c){var b=this;this.canvas=c.canvas;null===this.ba&&this.Cj!==this.ka("data")&&c&&(this.Cj=this.ka("data"),
this.Jd=c,this.log("DomNode %s requests conversion to DOM element",this.id),this.Jd.bu(this.Cj,this.id));if(this.ba){this.ba.uz=this.id;var d=this.La(),h=d.Yb();this.ba.style.width=this.width*h.x+"px";this.ba.style.height=this.height*h.y+"px";d=d.multiply(new Ec(1/h.x,1/h.y));h=this.Qe;h=h.multiply(d);h.iw()?(this.Fl("transform",""),this.ba.style.left=""+h.Da+"px",this.ba.style.top=""+h.Ea+"px"):(this.ba.style.left="0px",this.ba.style.top="0px",this.Fl("transform","matrix("+h.m11+","+h.m21+","+h.m12+
","+h.m22+","+h.Da+","+h.Ea+")"));this.rect.x=0;this.rect.y=0;this.rect.width=this.width;this.rect.height=this.height;this.ba.style.visibility=this.aj?"hidden":"visible"}else this.rect.x=0,this.rect.y=0,this.rect.width=100,this.rect.height=22;this.vc=new Mc(this.rect);this.Ja=this.rect.clone();this.rect.transform(this.La());this.vc.transform(this.La());if(d=this.da.border)this.rect.Nd(d),this.Pm=this.vc.clone(),this.Pm.Nd(d/2),this.vc.Nd(d);!this.da.preview||null!==this.Uc&&this.Dr===this.da.preview?
this.da.preview||(this.Uc=null):(this.log("Requesting new preview image for %s",this.da.preview),this.Uc=document.createElement("img"),this.Dr=this.Uc.src=this.da.preview,this.Uc.onload=function(){b.log("Preview image loaded.");c.Tg(b.id)},this.Uc.onerror=function(){b.log("Failed to load preview image")})};a.prototype.lf=function(a){var b=a.Vi;b&&this.Jd&&(b.m11!==this.Qe.m11||b.m21!==this.Qe.m21||b.m12!==this.Qe.m12||b.m22!==this.Qe.m22||b.Da!==this.Qe.Da||b.Ea!==this.Qe.Ea)&&(this.log("Moving DOM element as result of draw zooming"),
this.Qe=b,this.format(a,this.Jd));if(this.ba){var c=this.da.border;if(c){var f=this.Pm;a.setTransform(1,0,0,1,0,0);a.beginPath();a.lineWidth=c;a.strokeStyle="#cccccc";a.moveTo(f.la[0].x,f.la[0].y);a.lineTo(f.la[1].x,f.la[1].y);a.lineTo(f.la[2].x,f.la[2].y);a.lineTo(f.la[3].x,f.la[3].y);a.lineTo(f.la[0].x,f.la[0].y);a.closePath();a.stroke()}}else a.beginPath(),a.lineWidth=1,a.fillStyle="#888888",a.strokeStyle="#CCCCCC",a.rect(0,0,100,22),a.stroke(),a.font="20px Arial",a.textBaseline="top",a.fillText("DomNode",
0,0);if(this.Uc&&this.Uc.naturalHeight&&!b&&this.ub){this.log("Drawing preview image %s,%s ->%s,s",this.Uc.naturalWidth,this.Uc.naturalHeight,this.width,this.height);try{a.drawImage(this.Uc,0,0,this.Uc.naturalWidth,this.Uc.naturalHeight,0,0,this.width,this.height)}catch(h){this.log("Tried to draw image, got error: %s",h.toString())}}else b&&(b=a.globalCompositeOperation,a.globalCompositeOperation="destination-out",a.fillRect(this.Ja.x,this.Ja.y,this.Ja.width,this.Ja.height),a.globalCompositeOperation=
b)};a.prototype.clip=function(a){this.vc.ia(a)};a.prototype.xb=function(a,c){return!this.da.locked&&this.rect.bd(a,c)&&this.vc.bd(a,c,3)?this:null};a.prototype.Gk=function(){this.ba&&this.Jd&&(this.log("Added DOM NODE %s",this.id),this.sn(this.ih));this.ub=!0};a.prototype.Jk=function(){this.log("Removed DOM NODE %s",this.id);this.ba&&A(this.ba).remove();this.ub=!1};a.prototype.sn=function(a){if(this.ba&&this.canvas&&!(0>a)){a!==this.ih?(this.ba.classList.remove("zwibbler-zorder-"+this.ih),this.ba.classList.add("zwibbler-zorder-"+
a),this.ih=a,this.log("Add class zwibbler-zorder-%s",a)):this.log("order=zorder=%s",this.ih);var b=null;for(--a;0<=a;a--){var c=this.canvas.parentElement.querySelector(".zwibbler-zorder-"+a);if(c){b=c;this.log("Found element zorder-%s",a);break}this.log("Did not find element zorder-%s",a)}if(this.ba.previousSibling!==b||null===b)b?(this.log("Insert after previous."),A(this.ba).Qm(b)):(this.log("Insert before canvas %s",this.canvas),A(this.ba).insertBefore(this.canvas))}};a.prototype.Ua=function(){this.ba&&
(this.log("DomNode %s destroyed",this.id),O.detach(this.ba))};a.prototype.$r=function(a){this.sn(a)};return a}(ed);ed.kd("DomNode",Tf);var Uf=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.gj="UnknownNode";b.width=100;b.height=20;b.ib=new ld;b.log=y.create("UNKNOWN",!0);b.ib.Ln("center","middle");return b}__extends(a,c);a.prototype.cy=function(a){this.gj=a;this.ib.ah(a);this.log("Creating placeholder for node type %s",a)};a.prototype.type=function(){return this.gj};a.prototype.setProperty=function(a,c){this.da[a]=c};a.prototype.format=function(a){this.log("Formatting placeholder for %s",this.gj);this.rect=new I(0,0,this.width,
this.height);this.rect.transform(this.da.matrix);this.ib.format(a,this.width,this.height)};a.prototype.lf=function(a){this.log("Drawing placeholder for for %s",this.gj);a.save();a.lineWidth=1;a.fillStyle="#888888";a.fillRect(0,0,this.width,this.height);a.fillStyle="#000000";this.ib.ia(a,0,0);a.restore()};a.Ho=!1;return a}(ed);ed.kd("UnknownNode",Uf);var Vf=y.create("RootNode"),Wf=function(c){function a(a,d,e){a=c.call(this,a,d)||this;Vf("Root node is constructed: Traits=%s",a.Db);a.ba=e;return a}__extends(a,c);a.prototype.ng=function(){return!0};return a}(Pf(bd));var Af=new yc(816,1056),Xf=y.create("DOC"),yf=function(){function c(a,b,c){this.aw=c;this.Rc=document.createElement("DIV");this.Vc=new nc;this.gq=!0;this.Nb="0";this.li=new nc;this.removedNodes=new nc;this.rg=new nc;this.al=0;this.Yn="magenta";this.readOnly=!1;this.dm=new nc;this.Yh=new nc;this.Eo=new nc;this.Sd=[];this.Qr=this.Ig=this.Gh=this.cb=0;this.ur=function(){};this.cq=[];this.If=0;this.Rc.setAttribute("nid","0");this.root=new Wf(this.Wj(),this,this.Rc);this.zb=new Zb(this,this.root);this.mb=
new Xb(this.zb,oc(3),!0);a||(this.Wa(),this.yc(this.vk(0)),this.ua(!0));b&&this.ht(b,c);this.Yq()}c.prototype.ht=function(a,b){var c=this;A(a).query("[z-fixture]",function(a){var d=a.getAttribute("z-fixture")||"",e=new jf(d,c);e.ba=a;e.bq=!0;e.fs(b);Xf("Register fixture %s",d);e.ba.setAttribute("nid",d);c.zb.nt(d,e);c.cq.push(e)})};c.prototype.empty=function(){return 0===this.root.Na()};c.prototype.Yq=function(){this.Qr=this.mb.next};c.prototype.Ne=function(){return this.Qr!==this.mb.next};c.prototype.Ua=
function(){this.zb.Jc(function(a){a.Ua()})};c.prototype.Wj=function(){var a=this.Nb;this.Nb=((2147483647*Math.random()|0)+1).toString(36);return a};c.prototype.Se=function(a){return this.zb.Se(a)};c.prototype.jr=function(a){Xf("onCreateNode: %s",a);"PageNode"!==a.type()&&(this.li.add(a.id),this.removedNodes.remove(a.id));a.ka("spotHighlight")&&"PathNode"===a.type()&&this.Sd.push(a);this.Ig=this.ge(a.id)||0;"DomNode"===a.type()?this.dm.add(a.id):"PageNode"===a.type()&&(this.Gh=-1);Xc(a)&&(a.Gk(),a.$g(this.readOnly),
this.Vc.add(a.id),this.Eo.add(a.Md()))};c.prototype.ki=function(a){this.rg.add(a);this.Ig=this.ge(a)||0;this.Vc.add(a)};c.prototype.Ma=function(a,b){void 0===b&&(b=!1);if(this.zb.Se(a)){var c=this.zb.Ma(a);b&&(this.Vc.add(a),this.rg.add(a),this.Ig=this.ge(a)||0);return c}return null};c.prototype.jb=function(a,b){void 0===b&&(b=!1);var c=this.Ma(a,b);return c&&Xc(c)?c:null};c.prototype.ge=function(a){for(a=this.Ma(a,!1);;)if(a)if("PageNode"===a.type())break;else{if(null===a.parent)return null;a=a.parent}else return null;
a=this.root.Ue(a);return 0<=a?a:null};c.prototype.Jv=function(a){for(var b=[],c=0;c<a.length;c++){var e=this.Ma(a[c],!1);e&&b.push(e)}return b=this.tj(b)};c.prototype.Mu=function(a){var b=[];this.zb.Jc(function(c){c.ka("tag")===a&&b.push(c)});return b};c.prototype.Wa=function(){this.If++;Xf("begin(); nested transactions=%s",this.If)};c.prototype.ua=function(a){void 0===a&&(a=!1);this.If=Math.max(this.If-1,0);Xf("commit(skip=%s); nested transactions=%s",a,this.If);0===this.If?(this.mb.ua(!1,a),this.zb.ua(!1)):
Xf("In a nested transaction; not committing.")};c.prototype.transaction=function(a){this.Wa();a(this);this.ua()};c.prototype.Lq=function(){return 0<this.If};c.prototype.Hk=function(a){Xf("onCommit occured");this.ur(a,this.li.Ob(),this.removedNodes.Ob(),this.rg.Fj(this.li).Fj(this.removedNodes).Ob());this.li=new nc;this.removedNodes=new nc;this.rg=new nc};c.prototype.Ac=function(){this.mb.Ac()};c.prototype.Qd=function(){this.mb.Qd()};c.prototype.Zd=function(){return this.mb.Zd()};c.prototype.Yd=function(){return this.mb.Yd()};
c.prototype.Tk=function(){this.mb.Tl()};c.prototype.format=function(a,b){var c=this,e=[],f;this.gq?this.zb.Jc(function(a){Xc(a)&&e.push(a)}):this.Vc.Jc(function(a){a=c.zb.Ma(a);Xc(a)&&e.push(a);return!1});var h=this.tj(e);var k=0;for(f=h.length;k<f;k++){var l=h[k];l.format(a,b)}this.Vc.clear();this.gq=!1;this.Zt();return e.length};c.prototype.vu=function(a,b,c){if(0!==this.Sd.length&&b===this.al){a.save();a.beginPath();b=c||this.kc();a.moveTo(b.x,b.y);a.lineTo(b.x,b.bottom());a.lineTo(b.right(),b.bottom());
a.lineTo(b.right(),b.y);a.closePath();c=!1;for(var d=0;d<this.Sd.length;d++)this.ge(this.Sd[d].id)===this.cb&&(this.Sd[d].clip(a),c=!0);c&&(a.clip(),a.fillStyle=this.Yn,a.fillRect(b.x,b.y,b.width,b.height));a.restore()}};c.prototype.ce=function(a,b){var c=b||this.kc(),e=this.ka("background");e&&(e=r.Mh(e))&&(a.fillStyle=e.toString(),a.fillRect(c.x,c.y,c.width,c.height))};c.prototype.ia=function(a,b){function c(c){f.Ub(function(b){f.Yh.contains(b.Vb())||b.Md()!==c||b.hidden()||(b.$r(k++),b.ia(a))});
f.vu(a,c,b)}var e,f=this;this.Eo.add(this.al);var h=this.Eo.yy();h.sort(function(a,b){return a-b});var k=0;var l=0;for(e=h.length;l<e;l++)c(h[l])};c.prototype.xb=function(a,b,c,e){var d=null;this.Ub(function(f){f.Vb()===c&&f.xb(a,b)&&(!(null===d||d.Md()<=f.Md())||e&&e!==f.type()||(d=f))});return d};c.prototype.$v=function(a,b){var c=[],e=0,f={};this.Ub(function(d){d.xb(a,b)&&(c.push(d),f[d.id]=e,e+=1)});c.sort(function(a,b){return a.Md()!=b.Md()?a.Md()-b.Md():f[a.id]-f[b.id]});c.reverse();return c};
c.prototype.Lv=function(a){var b=[];this.Ub(function(c){a.contains(c.rect)&&b.push(c)});return b};c.prototype.tj=function(a){var b,c=[],e={};var f=0;for(b=a.length;f<b;f++){var h=a[f];if("PageNode"!==h.type()){if(!Xc(h))continue;for(;h.Tm()&&h.parent;)Xf("Node type %s:%s is a group member",h.id,h.type()),Xc(h.parent)&&(h=h.parent)}h.id in e||(e[h.id]=h,c.push(h))}this.ry(c);return c};c.prototype.Jc=function(a,b){function c(d){if(d.Na()){a&&Xc(d)&&b(d);for(var e=0;e<d.Na();e++)c(d.rb(e))}else Xc(d)&&
b(d)}c(this.root)};c.prototype.hm=function(a,b){function c(b){if(Xc(b)&&!1===a(b))return!1;if(0!=(b.Db&2)){for(var d=[],e=0;e<b.Na();e++)d.push(b.rb(e));for(b=0;b<d.length;b++)if(!1===c(d[b]))return!1}}for(var e=0;e<b.Na();e++)c(b.rb(e))};c.prototype.Ub=function(a,b){void 0===b&&(b=this.cb);b<this.root.Na()&&this.hm(a,this.root.rb(b||0))};c.prototype.Zu=function(a){var b=!1,c=a.Qj(),e=[];this.Ub(function(d){b?d.Qj().dw(c)&&e.push(d):d===a&&(b=!0)});return e};c.prototype.ry=function(a){var b=0,c={};
this.Jc(!0,function(a){c[a.id]=b++});a.sort(function(a,b){return c[a.id]-c[b.id]})};c.prototype.Cx=function(a){var b,c=[];var e=0;var f=this.tj(a);var h=0;for(b=f.length;h<b;h++)a=f[h],e=this.bp(a,c,e,null);return"zwibblerclip."+JSON.stringify(c)};c.prototype.bp=function(a,b,c,e){var d=a.Pc(),h={},k;for(k in d){var l=d[k];l instanceof J&&(l=["Matrix",l.m11,l.m12,l.m21,l.m22,l.Da,l.Ea]);h[k]=l}b.push({type:"CreateAction",node:a.type(),parent:e,properties:h});e=c+1;for(d=0;d<a.Na();d++)e=this.bp(a.rb(d),
b,e,c);return e};c.prototype.Xq=function(a,b){var c,e;0===a.indexOf("zwibblerclip.")&&(a=a.substr(13));var f=[];var h=JSON.parse(a);var k={},l=0,n=0;var q=0;for(e=h.length;q<e;q++){var u=h[q];if("GroupAction"===u.type){var v=this.Wj();k[l++]=v;v=[];var w=0;for(u=u.members;w<u.length;w++)v.push(k[u[w]]);u=this.group(v);k[l++]=u;f.push(u)}else if("CreateAction"===u.type){var x=u.properties;v={};for(c in x)x.hasOwnProperty(c)&&(w=x[c],"[object Array]"===Object.prototype.toString.apply(w)&&"Matrix"===
w[0]&&(w.splice(0,1),w=new J(w)),v[c]=w);x=this.Rj();var z=-1;w=!0;"parent"in u&&u.parent in k?(x=k[u.parent],w=!1):"PageNode"===u.node&&(x=this.root.id,z=this.cb+1+n,n+=1);v=this.createNode(u.node,v,x,z);k[l++]=v;("HTMLNode"!==u.node||w)&&f.push(v)}}0!==n||b.Rq()||this.Td(f,b)};c.prototype.rx=function(a,b){var c="function"!==typeof b?function(a){return a===b}:b;for(var e=0,f=0;f<a.length;f++)c(a[f])?e+=1:e&&(a[f-e]=a[f]);a.length-=e};c.prototype.kr=function(a){var b=this.ge(a.id)||0;this.li.remove(a.id);
this.rg.remove(a.id);this.removedNodes.add(a.id);Xc(a)&&a.Jk();a.Ua();this.Vc.remove(a.id);a.ka("spotHighlight")&&this.rx(this.Sd,a);this.dm.remove(a.id);"PageNode"===a.type()?(b===this.cb&&(Xf("Removed current page."),this.yc(Math.min(b,this.Xb()-1)),this.Ig=this.cb),this.Gh=-1):this.Ig=b};c.prototype.lq=function(a){function b(a){if(!k||a.rect.x<c)c=a.rect.x;if(!k||a.rect.right()>e)e=a.rect.right();if(!k||a.rect.y<f)f=a.rect.y;if(!k||a.rect.bottom()>h)h=a.rect.bottom();k=!0}var c=0,e=0,f=0,h=0,k=
!1;"number"===typeof a?this.Ub(b,a):this.Jc(!1,b);return k?new I(c,f,e-c,h-f):new I(0,0,10,10)};c.prototype.Yv=function(){var a=this.Ef(void 0),b=null;a instanceof Sf&&(b=a.kc());return b||this.root.Wh("width")};c.prototype.kc=function(a,b){var c=this.Ef(a),e=null;c instanceof Sf&&(e=c.kc());return e?e.ss():this.ka("width")?new I(0,0,this.ka("width"),this.ka("height")):b?b.ss():this.lq(a)};c.prototype.ka=function(a){return this.root.ka(a)};c.prototype.Wh=function(){return this.root};c.prototype.setProperty=
function(a,b){this.xc([this.root.id],a,b)};c.prototype.xc=function(a,b,c){var d={};d[b]=c;this.Wa();this.wc(a,d);this.ua()};c.prototype.wc=function(a,b){var c=this;this.vf(a,function(a){var d={},e;for(e in b)d[e]=a.ka(e);c.mb.yd(a.id,b,d)})};c.prototype.sr=function(a,b){this.Vc.add(a.id);this.rg.add(a.id);if("spotHighlight"in b&&"PathNode"===a.type()){for(var c=0;c<this.Sd.length;c++)if(this.Sd[c]===a){this.Sd.splice(c,1);break}b.spotHighlight&&"PathNode"===a.type()?(Xf("Added node %s to spotHighlightNodes",
a.id),this.Sd.push(a)):Xf("Removed node %s from spotHighlightNodes",a.id)}};c.prototype.Ji=function(a,b){Xf("showLayer(%s, %s)",a,b);b?(this.Yh.remove(a),this.Ub(function(b){b.Vb()===a&&b.Gk()})):(this.Yh.add(a),this.Ub(function(b){b.Vb()===a&&b.Jk()}))};c.prototype.Um=function(a){return!this.Yh.contains(a)};c.prototype.vk=function(a){Xf("Adding page to document with index %s",a);if(a>this.root.Na())return Xf("Error: Can insert page with index %s",a),-1;this.createNode("PageNode",{},this.root.id,
a);return a};c.prototype.Xb=function(){return this.root.Na()};c.prototype.yc=function(a){if(a!==this.cb){if(0<=a&&a<this.Xb())return Xf("Set current page to %s/%s",a,this.Xb()),this.cb=a,!0;Xf("Tried to set page to non-existing %s",a);return!1}};c.prototype.ly=function(){this.Gh!==this.cb&&(this.mo(this.Gh,!1),this.mo(this.cb,!0),this.Gh=this.cb)};c.prototype.mo=function(a,b){var c=this;b?this.Ub(function(a){"DomNode"!==a.type()||c.Yh.contains(a.Vb())||a.Gk()},a):this.dm.Jc(function(a){(a=c.jb(a,
!1))&&a.Jk()})};c.prototype.Ef=function(a){return 0===this.root.Na()?this.root:void 0===a?this.root.rb(this.cb):this.root.rb(a)};c.prototype.Zj=function(){return this.kc(this.cb,Af)};c.prototype.$g=function(a){this.Jc(!1,function(b){b.$g(a)})};c.prototype.getRootNode=function(){return this.root};c.prototype.sw=function(a,b){var c=b.$type||b.type||"",e=bd.create(c,a,this);e||(c in P.Zl?(e=new Yf(a,this),e.setProperty("nodeType",c)):(Xf("Bad node type: %s",c),e=bd.create("UnknownNode",a,this),e.cy(c)));
5===(e.Db&5)&&e.fs(this.aw);e.yd(b);return e};c.prototype.createNode=function(a,b,c,e,f){f||(f=this.Wj());c||(c=this.Rj());var d=this.Ma(c);if(!d)throw Error("createNode type="+a+": parent "+c+" does not exist");if(void 0===e||-1==e)e=d.Na();b.$type=a;this.mb.createNode(f,c,e,b);return f};c.prototype.vf=function(a,b){for(var c=0;c<a.length;c++){var e=a[c],f=this.Ma(e);f?b(f):Xf("Node %s does not exist",e)}};c.prototype.Sb=function(a){function b(a){for(var d=a.Na()-1;0<=d;d--)b(a.rb(d));c.mb.be(a.id,
a.parent.id,a.parent.Ue(a))}var c=this;this.vf(a,function(a){a.parent?b(a):Xf("deleteNode(%s): node has no parent",a.id)})};c.prototype.Td=function(a,b){var c=this;this.vf(a,function(a){if(Xc(a)){var d=b.multiply(a.La());c.xc([a.id],"matrix",d)}})};c.prototype.ne=function(a,b,c,e){var d=this.jb(a,!0);if(d&&d.We()){var h=d.rq(),k=d.ka(h);d.ne(b,c,e);b=d.ka(h);d.setProperty(h,k);this.xc([a],h,b)}};c.prototype.Rj=function(){return this.root.rb(this.cb).id};c.prototype.group=function(a){var b=this.createNode("GroupNode",
{});this.hj(b,a);return b};c.prototype.hj=function(a,b){var c=this,e=0;this.vf(b,function(b){if(!b.parent)throw Error("Expected node to have a parent");c.mb.Sc(b.id,a,e++,b.parent.id,b.parent.Ue(b))})};c.prototype.fh=function(a){var b=this,c={};this.vf(a,function(a){if(a instanceof fd&&!(a.id in c)&&a.parent){c[a.id]=!0;for(var d=a.parent.Na(),e=a.Na()-1;0<=e;e--)b.mb.Sc(a.children[e].id,a.parent.id,d,a.id,e);b.Sb([a.id])}})};c.prototype.duplicate=function(a,b,c){function d(a,b){var c=a.Pc();"matrix"in
c&&(c.matrix=h.multiply(c.matrix));c=f.createNode(a.type(),c,b);if(0!=(a.Db&2))for(var e=0;e<a.Na();e++)d(a.rb(e),c)}var f=this,h=new Cc(b,c);this.vf(a,function(a){null!==a.parent&&d(a,a.parent.id)})};c.prototype.Sc=function(a,b,c){var d=this.Ma(a);if(null===d)throw Error("moveNode: "+a+" does not exist");var f=this.Ma(b);if(null===f)throw Error("moveNode: New parent "+b+" does not exist");-1===c&&(c=d.parent!==f?f.Na():f.Na()-1);if(null===d.parent)throw Error("Expected a parent");f===d.parent&&c===
d.parent.Ue(d)?Xf("moveNode: Skip moving to the same place"):this.mb.Sc(a,b,c,d.parent.id,d.parent.Ue(d))};c.prototype.ad=function(a,b,c){var d=this;void 0===c&&(c=-1);this.vf(a,function(a){if(a.parent){var e=a.parent.id,f=a.parent.Ue(a);switch(b){case 0:d.Sc(a.id,e,-1);break;case 1:d.Sc(a.id,e,0);break;case 3:0<f&&d.Sc(a.id,e,f-1);break;case 2:f<a.parent.Na()-1&&d.Sc(a.id,e,f+1);break;case 4:d.Sc(a.id,e,c)}}})};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a,
b){void 0===b&&(b="");if(!(a instanceof bd))return b+"NOT A NODE: "+a+"\n";var c=a.type();c=b+a.id+": "+c+"\n";for(var e=0;e<a.Na();e++)c+=this.encode(a.rb(e),b+"  ");return c};c.prototype.zm=function(a){if(a instanceof Element)for(;a;){var b=a.getAttribute("nid");if(b&&(b=this.Ma(b))&&5===(b.Db&5))return b;a=a.parentElement}return null};c.prototype.Zt=function(){this.Uo(this.Rc,new J,null,0,0)};c.prototype.Uo=function(a,b,c,e,f){if(a instanceof HTMLElement){var d=a.offsetLeft-a.scrollLeft,k=a.offsetTop-
a.scrollTop;c===a.offsetParent&&(d-=e,k-=f);b=b.multiply(new Cc(d,k));c=a.getAttribute("nid")||"0";(c=this.Ma(c))&&Zc(c)&&(e=new I(0,0,c.ba.offsetWidth,c.ba.offsetHeight),e.transform(b),c.$x(e));for(c=a.firstElementChild;c;)this.Uo(c,b,a.offsetParent,a.offsetLeft,a.offsetTop),c=c.nextElementSibling}};c.prototype.Jm=function(){return this.mb.Jm()};c.prototype.locked=function(){return this.mb.locked()};c.prototype.Lm=function(a){return this.mb.Lm(a)};return c}();var zf=new (function(){function c(){this.log=y.create("serializer");this.Fo={pdf:"application/pdf",svg:"image/svg+xml",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp"}}c.prototype.mh=function(a,b,c){if(a instanceof Array)b=this.Kq(a,b,c);else{if("string"!==typeof a)return this.log("Can only open an array or string as a document."),null;if("{"===a.charAt(0))b=this.ow(a,b,c);else if(0===a.indexOf("zwibbler3."))a=JSON.parse(a.substr(10)),b=this.Kq(a,b,c);else if(0===a.indexOf("zwibblerclip."))b=
new yf(!1,b,c),b.Xq(a,new J),b.Tk();else throw Error("Format detection failed.");}for(a=1;a<b.Xb();a++)b.mo(a,!1);return b};c.prototype.ow=function(a,b,c){function d(a){var b=new J;b.m11=a.m11;b.m12=a.m12;b.m21=a.m21;b.m22=a.m22;b.Da=a.dx;b.Ea=a.dy;return b}function f(a,b){switch(a.type){case "Node":for(var c=[],e=a.children,h=e.length-1;0<=h;h--)try{c.push(f(e[h],b+1))}catch(C){}return 0<b?k.group(c):"";case "PathNode":case "ArrowNode":var l=a;e=0;"arrowSize"in l&&(e=l.arrowSize,l=l.path);c=d(l.matrix);
e={strokeStyle:l.strokeStyle,fillStyle:l.fillStyle,lineWidth:l.lineWidth,smoothness:l.smoothness,sloppiness:l.sloppiness,shadow:l.shadow,arrowSize:e,seed:Math.round(65535*Math.random())};"textNode"in l&&(h=l.textNode,e.fontSize=h.fontSize,e.fontName=h.fontName,e.text=h.text,e.textFillStyle="textFillStyle"in h?h.textFillStyle:h.fillStyle);"path"in l&&(l=l.path);var n=l.startX,q=l.startY;h=l.closed;var G=new N;l=l.segments;n=c.apply(n,q);G.moveTo(n.x,n.y);for(n=0;n<l.length;n++){var H=l[n];switch(H.type){case 1:q=
c.apply(H.x,H.y);G.lineTo(q.x,q.y);break;case 2:q=c.apply(H.x,H.y);G.Ch(q.x,q.y);break;case 3:q=c.apply(H.x1,H.y1);H=c.apply(H.x,H.y);G.tf(q.x,q.y,H.x,H.y);break;default:throw"Unknown path segment type: "+H.type;}}h&&G.close();e.commands=G.Ob();return k.createNode("PathNode",e);case "TextNode":return c=d(a.matrix),c=c.multiply(new Cc(0,1.3*a.fontSize)),k.createNode("TextNode",{fillStyle:a.fillStyle,lineWidth:0,text:a.text,fontName:a.fontName,fontSize:a.fontSize,matrix:c});default:throw Error("Unknown node type: "+
a.type);}}var h=y.create("IMPORT"),k=new yf(!1,b,c);try{var l=JSON.parse(a)}catch(n){a=a.replace(/\\\\/g,"\\").replace(/\\"/g,'"');try{l=JSON.parse(a)}catch(q){throw h("Couldn't parse file."),"Couldn't parse file.";}}h("Successfully parsed!");f(l,0);k.ua(!0);return k};c.prototype.Kq=function(a,b,c){function d(a,b){if(void 0!==a){var c={};for(var e in a)a.hasOwnProperty(e)&&"children"!==e&&"parent"!==e&&"id"!==e&&"type"!==e&&(c[e]="matrix"===e?new J(a[e]):a[e]);e=a.id;"0"!==b||h||(b=n.Rj());0!==a.id&&
n.createNode(a.type,c,b,-1,e.toString(36));if(void 0!==a.children)for(c=0;c<a.children.length;c++)d(a.children[c],e.toString(36))}}a=JSON.parse(JSON.stringify(a));var f={},h=!1;var k=0;for(var l=a;k<l.length;k++)if("PageNode"===l[k].type){h=!0;break}var n=new yf(h,b,c);n.Wa();for(b=0;b<a.length;b++){k=a[b];if("document"===k.type||0===k.id){delete k.type;for(var q in k)n.setProperty(q,k[q])}if("parent"in k){if(!(k.parent in f))throw Error("Error: child "+k.id+" references parent "+k.parent+" before it was defined.");
c=f[k.parent];void 0!==c.children?c.children.push(k):c.children=[k]}"GroupNode"!==k.type&&"PageNode"!==k.type||void 0!==k.children||(k.children=[]);f[k.id]=k}d(f[0],"0");n.ua(!0);return n};c.prototype.Xp=function(a){function b(a,d){var e={id:parseInt(d.id,36),type:d.type()};c.push(e);a&&(e.parent=parseInt(a.id,36));var f=d.Pc(),l;for(l in f)f.hasOwnProperty(l)&&("matrix"===l?e[l]=f[l].Ob():"inverse"!==l&&(e[l]=f[l]));for(e=0;e<d.Na();e++)b(d,d.rb(e))}var c=[];b(null,a.getRootNode());return c};c.prototype.Xi=
function(a,b,c){b in this.Fo&&(b=this.Fo[b]);if("list"===b)a=this.Xp(a),b="application/json";else if("zwibbler3"===b)a=this.Xp(a),a="zwibbler3."+JSON.stringify(a),b="application/octet-stream";else if("image/svg+xml"===b){var d=a.kc();var f=new Id(d);a.ce(f);a.ia(f);a=f;b="image/svg+xml"}else if("application/pdf"===b){d=a.kc(0);f=new Re(new I(0,0,d.width,d.height),P.fonts);var h=a.cb;for(b=0;b<a.Xb();b++)0<b&&(d=a.kc(b),f.dh(d)),f.translate(-d.x,-d.y),a.yc(b),a.ce(f),a.ia(f);a.yc(h);a=f;b="application/pdf"}else if(!(d=
"image/png"===b||"image/bmp"===b)&&(d="image/jpeg"==b)&&(d=document.createElement("canvas"),f=!1,d.width=10,d.height=10,"toDataURL"in d&&(f=0<d.toDataURL("image/jpeg").indexOf("jpeg")),pc("JPEG supported: %s",f),d=f),d)f=document.createElement("canvas"),d=a.kc(),f.width=d.width,f.height=d.height,h=f.getContext("2d"),h.translate(-d.x,-d.y),a.ce(h),a.ia(h),a="image/bmp"===b?tc(f):f.toDataURL(b),a=a.split(",")[1],a=atob(a);else throw"Unknown save format: "+b;if("string"===typeof a)if("string"===c)var k=
a;else if("data-uri"===c)k="data:"+b+";base64,"+Ba(Ca(a));else{if("blob"===c)for(c=new Uint8Array(a.length),b=0;b<a.length;b++)c[b]=a.charCodeAt(b)}else if(a.toBlob&&a.toString)"string"===c?k=a.toString():"data-uri"===c?k="data:"+b+";base64,"+Ba(Ca(a.toString())):"blob"===c&&(k=a.toBlob());else if("object"===c)k=a;else throw"Error in ZwibblerDocument.save()";return k};return c}());var Zf=y.create("OPENTYPE");function $f(c){var a;void 0===a&&(a="Assertion failed.");if(!c)throw console.log(Error(a)),Error(a);}
var ag=function(){function c(a,b){this.code=a;this.ud=b}c.prototype.toString=function(){return(255<this.code?"code=12 "+(this.code&255):""+this.code)+" "+JSON.stringify(this.ud)};return c}(),bg=function(){function c(a,b,c){void 0===b&&(b=0);void 0===c&&(c=a.length-b);this.qp=a;this.start=b;this.length=c;this.wd=0}c.prototype.ma=function(a){for(var b=0;a--;)b=256*b+this.qp[this.wd++ +this.start];return b};c.prototype.getInt16=function(){var a=this.ma(2);a&32768&&(a-=65536);return a};c.prototype.Dg=
function(a,b){void 0===b&&(b=1);for(var c="",e=0;e<a;e+=b)c+=String.fromCharCode(this.ma(b));return c};c.prototype.Bf=function(){return this.getInt16()/16384};c.prototype.seek=function(a){if(a>this.length)throw Error("Seek to invalid location");var b=this.wd;this.wd=a;return b};c.prototype.slice=function(a,b){void 0===b&&(b=this.length-a);return new c(this.qp,a+this.start,b)};c.prototype.Nm=function(){var a;void 0===a&&(a=this.wd);this.seek(a);var b=this.ma(2);if(0<b){var c=this.ma(1);this.seek(a+
3+c*b);var e=this.ma(c);this.seek(a+3+(b+1)*c-1+e)}return a};c.prototype.Bm=function(a){this.seek(a);a=this.ma(2);var b=this.ma(1);if(4<b)throw Error("Error: This is not an index; offsetSize="+b);return a};c.prototype.$h=function(a,b){this.seek(a);var c=this.ma(2);if(b>=c)throw Error("Tried to read past end of index");var e=this.ma(1);this.seek(a+3+e*b);var f=this.ma(e),h=this.ma(e);return this.slice(a+3+(c+1)*e-1+f,h-f)};c.prototype.lm=function(){return this.wd>=this.length};c.prototype.vq=function(a,
b){void 0===a&&(a=!1);void 0===b&&(b=[]);for(var c=new ag(0,b);;){if(this.lm())throw Error("Unexpected end of charstring");var e=this.ma(1);if(12===e)return c.code=3072|this.ma(1),c;if(28>e||a&&29<=e&&31>=e)return c.code=e,c;if(30===e){var f="";a:for(;;){e=this.ma(1);for(var h=4;0<=h;h-=4){var k=e>>h&15;switch(k){case 10:f+=".";break;case 11:f+="E";break;case 12:f+="E-";break;case 14:f+="-";break;case 15:break a;case 14:break;default:f+=k.toString()}}}c.ud.push(parseFloat(f))}else 29===e?(f=this.ma(1),
e=this.ma(1),h=this.ma(1),k=this.ma(1),c.ud.push(f<<24|e<<16|h<<8|k)):28===e?(f=this.ma(1),e=this.ma(1),c.ud.push(f<<8|e)):a&&255===e?c.ud.push(this.ma(4)/65536):251<=e?(f=this.ma(1),c.ud.push(256*-(e-251)-f-108)):247<=e?(f=this.ma(1),c.ud.push(256*(e-247)+f+108)):c.ud.push(e-139)}};return c}(),cg=function(){function c(a){this.no=[];var b=this.n=0;for(a=a.split(/([:\[\]\(\)\-\.{}]|\d+)|\s+/);b<a.length;b++){var c=a[b];c&&c.length&&this.no.push(c)}}c.prototype.next=function(){return this.no[this.n++]};
c.prototype.match=function(a){return this.no[this.n]===a?(this.n+=1,!0):!1};c.prototype.value=function(a){var b=this.next(),c=parseFloat(b);return isNaN(c)?a[b]:c};c.prototype.Ih=function(a){this.n=a;return!1};return c}();function dg(c,a,b,d){if(c.match("{")){for(b={};eg(c,a,b,d););c.match("}");return b}return fg(c,a,b,d)}
function eg(c,a,b,d){var e=c.n;if(c.match("push")){var f=gg(c,b);for(a=a.slice(f);eg(c,a,b,d););return c.match("pop")?!0:!1}f=c.next();return c.match(":")?(c=fg(c,a,b,d),"_"!==f&&(b[f]=c),!0):c.Ih(e)}
function fg(c,a,b,d){var e=c.n;if(c.match("[")){var f=gg(c,b),h="",k=[];c.match(".")&&(h=c.next(),k={});if(!c.match("]"))return c.Ih(e);e=c.n;for(var l=0;l<f;l++){c.n=e;var n=dg(c,a,b,d);""===h?k.push(n):k[n[h]]=n}0===f&&dg(c,a,b,!0);return k}if(c.match("("))return b=gg(c,b),c.match(")"),b;if(c.match("uint"))return b=c.value(b)/8,d?0:a.ma(b);if(c.match("int"))return c.next(),d?0:a.getInt16();if(c.match("offset"))return a.wd;if(c.match("date"))return c=1E3*(4294967296*a.ma(4)+a.ma(4))+Date.UTC(1904,
1,1),new Date(c);if(c.match("fixed"))return d?0:a.ma(4)/65536;if(c.match("string")){if(!c.match("("))return c.Ih(e);b=gg(c,b);return c.match(")")?d?0:a.Dg(b):c.Ih(e)}return c.Ih(e)}function gg(c,a){var b=c.value(a);if(c.match("-"))b-=c.value(a);else if(c.match(":")){var d=c.value(a);b=b>>d&1}return b}function hg(c,a){return dg(new cg(a),c,null,!1)}
var jg=function(){function c(){this.fonts=[]}c.prototype.add=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:return[4,fetch(a)];case 1:return b=d.sent(),[4,b.arrayBuffer()];case 2:return c=d.sent(),[2,this.Ww(new Uint8Array(c))]}})})};c.prototype.get=function(a){for(var b=0,c=this.fonts;b<c.length;b++){var e=c[b];if(e.Af===a)return e}return null};c.prototype.Ww=function(a){a=new bg(a);var b=a.ma(4);a.seek(0);a=1953784678===
b?this.jt(a):[new ig(a)];b=0;a:for(;b<a.length;b++){for(var c=a[b],e=0,f=this.fonts;e<f.length;e++)if(f[e].Af===c.Af){Zf("Not adding %s; already have it.");continue a}Zf("Opened font: %s weight=%s italic=%s",c.Af,c.weight,c.bi);this.fonts.push(c)}return a};c.prototype.jt=function(a){var b=hg(a,"{\n    ttcTag:string(4)\n    majorVersion:uint16\n    minorVersion:uint16\n    numFonts:uint32\n    offsetTable:[numFonts] uint32\n}");Zf(JSON.stringify(b,null,2));Zf("Collection contains %s fonts",b.numFonts);
var c=[],e=0;for(b=b.offsetTable;e<b.length;e++)c.push(new ig(a,b[e]));return c};return c}(),ig=function(){function c(a,b){void 0===b&&(b=0);this.ya=a;this.Xc={};this.Af=this.fontFamily="";this.weight=0;this.bold=this.bi=!1;this.sj=[];this.Rl=null;this.Wm=[];a.seek(b);this.rd=hg(a,"{  \n    scalarType:uint32\n    numTables:uint16\n    searchRange:uint16\n    entrySelector:uint16\n    rangeShift:uint16\n    tables:[numTables.tag] {\n        tag:string(4)\n        checksum:uint32\n        offset:uint32\n        length:uint32\n    }\n}");
Zf(JSON.stringify(this.rd,null,2));for(var c in this.rd.tables)Zf("Table: %s",c);this.Me("head","{\n    version:fixed\n    fontRevision:fixed\n    checksumAdjustment:uint32\n    magicNumber:uint32\n    flags:uint16\n    unitsPerEm:uint16\n    created:date\n    modified:date\n    xMin:int16\n    yMmin:int16\n    xMax:int16\n    yMax:int16\n    macStyle:uint16\n    lowestRectPPEM:uint16\n    fontDirectionHint:uint16\n    indexToLocFormat:uint16\n    glyphDataFormat:uint16\n\n    bold:(macStyle:0)\n    italic:(macStyle:1)\n}");
this.Me("name","{\n    offset:offset\n    format:uint16\n    count:uint16\n    stringOffset:uint16\n    names:[count] {\n        platformID:uint16\n        platformSpecificID:uint16\n        languageID:uint16\n        nameID:uint16\n        length:uint16\n        offset:uint16\n    }\n}");this.Me("cmap","{\n    offset:offset\n    version:uint16\n    numberSubtables:uint16\n    subTables:[numberSubtables] {\n        platformID:uint16\n        platformSpecificID:uint16\n        offset:uint32\n    }\n}");
this.Me("hhea","{\n    version:fixed\n    ascent:int16\n    descent:int16\n    lineGap:int16\n    advanceWidthMax:uint16\n    minLeftSideBearing:int16\n    minRightSideBearing:int16\n    xMaxExtent:int16\n    caretSlopeRise:int16\n    caretSlopeRun:uint16\n    caretOffset:int16\n    reserved:uint64\n    metricDataFormat:int16\n    numOfLongHorMetrics:uint16\n}");this.Me("kern","{\n    version:uint16\n    nTables:uint16\n    tables:[nTables] {\n        version:uint16\n        length:uint16\n        coverage:uint16\n        offset:offset\n        _:[length-6] uint8\n    }\n}");
this.Me("maxp","{\n    version:fixed\n    numGlyphs:uint16\n}");this.Me("OS/2","{\n    version:uint16\n    xAvgCharWidth:int16\n    usWeightClass:uint16\n    usWidthClass:uint16\n}");this.Me("CFF ","{\n    offset:offset\n    major:uint8\n    minor:uint8\n}");this.fx(a,this.Xc.name);this.$w(a,this.Xc.cmap);this.cx(a);this.ex(a,this.Xc.kern);this.bi=!!this.Xc.head.italic;this.bold=!!this.Xc.head.bold;this.weight=this.Xc["OS/2"].usWeightClass;"CFF "in this.Xc&&(this.Rl=new kg(a.slice(this.Xc["CFF "].offset)))}
c.prototype.Me=function(a,b){a in this.rd.tables&&(Zf("Decoding %s",a),this.ya.seek(this.rd.tables[a].offset),this.Xc[a]=hg(this.ya,b),Zf(a+" table:",JSON.stringify(this.Xc[a],null,2)))};c.prototype.fx=function(a,b){for(var c=0,e=b.names;c<e.length;c++){var f=e[c];a.seek(b.offset+b.stringOffset+f.offset);var h=0===f.platformID||3===f.platformID?a.Dg(f.length,2):a.Dg(f.length);switch(f.nameID){case 1:this.fontFamily=h;break;case 4:this.Af=h}}};c.prototype.$w=function(a,b){for(var c=0,e=b.subTables;c<
e.length;c++){var f=e[c],h=f.platformID,k=f.platformSpecificID;f=b.offset+f.offset;a.seek(f);var l=a.ma(2),n=a.ma(2);Zf("CMAP platform "+h+" "+k+" format "+l+" length "+n+" at "+f);switch(l){case 0:this.sj.push(new lg(a.slice(f,n)));break;case 4:this.sj.push(new mg(a.slice(f,n)))}}};c.prototype.cx=function(a){var b=this.rd.tables.GPOS;b&&this.Wm.push(new ng(a.slice(b.offset,b.length)))};c.prototype.ex=function(a,b){if(b)for(var c=0,e=b.tables;c<e.length;c++){var f=e[c];0===f.coverage>>8&&(Zf("Format 0 kern table detected"),
this.Wm.push(new og(a.slice(f.offset,f.length))))}};c.prototype.transform=function(a,b){var c=this.Yb(b);a.scale(c,-c)};c.prototype.gm=function(a,b,c,e){if(this.Rl)this.Rl.gm(a,b,c,e);else if(b=this.Gr(b),null!==b)for(var d=0,h=0,k=0,l=0,n;h<b.la.length;h++){var q=b.la[h];0===d?(a.moveTo(q.x+c,q.y+e),d=1):1===d?q.Lg?a.lineTo(q.x+c,q.y+e):d=2:(n=b.la[h-1],q.Lg?(a.quadraticCurveTo(n.x+c,n.y+e,q.x+c,q.y+e),d=1):a.quadraticCurveTo(n.x+c,n.y+e,(n.x+q.x)/2+c,(n.y+q.y)/2+e));h===b.ae[k]&&(2===d&&(n=q,q=
b.la[l],q.Lg?a.quadraticCurveTo(n.x+c,n.y+e,q.x+c,q.y+e):a.quadraticCurveTo(n.x+c,n.y+e,(n.x+q.x)/2+c,(n.y+q.y)/2+e)),l=h+1,k+=1,d=0)}};c.prototype.Gr=function(a){var b=this.sv(a);a=this.ya;var c=this.rd.tables.glyf;if(0===b||b>=c.offset+c.length)return null;$f(b>=c.offset);$f(b<c.offset+c.length);a.seek(b);b={ae:[],si:a.getInt16(),la:[],gz:a.getInt16(),kz:a.getInt16(),fz:a.getInt16(),jz:a.getInt16()};$f(-1<=b.si);-1===b.si?this.lx(a,b):this.nx(a,b);return b};c.prototype.sv=function(a){$f("loca"in
this.rd.tables);var b=this.rd.tables.loca,c=this.ya;if(1===this.Xc.head.indexToLocFormat){b=c.seek(b.offset+4*a);a=c.ma(4);var e=c.ma(4)}else b=c.seek(b.offset+2*a),a=2*c.ma(2),e=2*c.ma(2);c.seek(b);return a===e?0:a+this.rd.tables.glyf.offset};c.prototype.lx=function(a,b){var c,e,f=32;b.ae=[];for(b.la=[];f&32;){f=a.ma(2);var h=a.ma(2);var k=1;var l=c=0;var n=1;var q=e=0;if(f&1){var u=a.getInt16();var v=a.getInt16()}else u=a.ma(1),v=a.ma(1);f&2&&(e=u,q=v);f&8?n=k=a.Bf():f&64?(k=a.Bf(),n=a.Bf()):f&
128&&(k=a.Bf(),c=a.Bf(),l=a.Bf(),n=a.Bf());u=a.wd;if(h=this.Gr(h)){var w=b.la.length;for(v=0;v<h.ae.length;v++)b.ae.push(h.ae[v]+w);for(v=0;v<h.la.length;v++){w=h.la[v].x;var x=h.la[v].y;w=k*w+c*x+e;x=l*w+n*x+q;b.la.push({x:w,y:x,Lg:h.la[v].Lg})}}a.seek(u)}b.si=b.ae.length;f&256&&a.seek(a.ma(2)+a.wd)};c.prototype.nx=function(a,b){function c(b,c,d){for(var f=0,l=0;l<h;l++){var n=k[l];n&c?f=n&d?f+a.ma(1):f-a.ma(1):~n&d&&(f+=a.getInt16());e[l][b]=f}}b.ae=[];for(var e=b.la=[],f=0;f<b.si;f++)b.ae.push(a.ma(2));
a.seek(a.ma(2)+a.wd);if(0!==b.si){var h=Math.max.apply(null,b.ae)+1,k=[];for(f=0;f<h;f++){var l=a.ma(1);k.push(l);e.push({x:0,y:0,Lg:0<(l&1)});if(l&8){var n=a.ma(1);$f(0<n);for(f+=n;n--;)k.push(l),e.push({x:0,y:0,Lg:0<(l&1)})}}c("x",2,16,b.gz,b.fz);c("y",4,32,b.kz,b.jz)}};c.prototype.Yb=function(a){return a/this.Xc.head.unitsPerEm};c.prototype.xv=function(a){$f("hmtx"in this.rd.tables);var b=this.ya,c=this.rd.tables.hmtx.offset;b.seek(c+4);var e=this.Xc.hhea.numOfLongHorMetrics;if(a<e){var f=this.ya.seek(c+
4*a);var h=b.ma(2)}else f=b.seek(c+4*(e-1)),h=b.ma(2),b.seek(c+4*e+2*(a-e));a=b.getInt16();b.seek(f);return{np:h,lw:a}};c.prototype.rv=function(a){for(var b=0,c=0;c<this.sj.length&&!(b=this.sj[c].map(a));c++);return b};c.prototype.wu=function(a,b,c,e,f){a.save();a.translate(c,e);this.transform(a,f);f=[];for(c=0;c<b.length;c++)f.push(new pg(this.rv(b.charCodeAt(c))));c=0;for(e=this.Wm;c<e.length;c++)e[c].ci(f);for(var d=e=c=0;d<f.length;d++){var k=f[d],l=this.xv(k.od);Zf("Metrics for %s code %s index %s: %s %s",
b.charAt(d),b.charCodeAt(d),k.od,l.np,l.lw);this.gm(a,k.od,c+k.Qg.x,e+k.Qg.y);c+=l.np+k.advance.x;e+=k.advance.y}a.restore()};return c}(),lg=function(){function c(a){this.ya=a}c.prototype.map=function(a){return 0<=a&&255>=a?(this.ya.seek(a+6),Zf("charCode %s maps to %s",a,this.ya.ma(1)),this.ya.seek(a+6),this.ya.ma(1)):0};return c}(),mg=function(){function c(a){this.ya=a;a.seek(6);this.Vg=a.ma(2)/2}c.prototype.map=function(a){var b=this;Zf("Try to map charcode %s using %s ranges",a,this.Vg);var c=
this.ya,e=0,f=0,h=qg(this.Vg-1,function(d){c.seek(14+2*d);var f=c.ma(2);c.seek(2*b.Vg+16+2*d);e=c.ma(2);return a<e?-1:a>f?1:0});if(0<=h){c.seek(6*this.Vg+16+2*h);f=c.ma(2);c.seek(4*this.Vg+16+2*h);var k=c.getInt16();0===f?f=k+a&65535:(c.seek(6*this.Vg+16+2*h+(2*(a-e)+f)),f=c.ma(2),0!==f&&(f=f+k&65535))}return f};return c}();function qg(c,a){for(var b=c,d=-1,e;1<b-d;){e=b+d>>1;var f=a(e);if(0==f)return e;0<f?d=e:b=e}return-1}
var kg=function(){function c(a){this.ya=a;this.qm=null;this.pm=[];var b=a.ma(1),c=a.ma(1),e=a.ma(1);Zf("CFF Version "+b+"."+c);a.seek(e);a.Nm();this.qu=a.Nm();this.uy=a.Nm();this.wy=a.wd;b=this.oo=this.Fr(a.$h(this.qu,0));this.er=a.Bm(b.CharStrings);Zf("CFF Font contains "+this.er+" glyphs");this.oo.FDSelect?(this.qm=new rg(a.slice(b.FDSelect),this.er),this.mx(a,b)):this.pm.push(b)}c.prototype.Fr=function(a){a=sg(a,{},this);if(a.Private){var b=a.Private[1];sg(this.ya.slice(b,a.Private[0]),a,this);
a.Subrs&&(a.Subrs+=b)}return a};c.prototype.Dg=function(a){if(a<tg.length)return tg[a];a=this.ya.$h(this.uy,a-tg.length);return a.Dg(a.length)};c.prototype.mx=function(a,b){var c=b.FDArray,e=a.Bm(c);Zf("There are %s items in FDArray",e);for(var f=0;f<e;f++)this.pm.push(this.Fr(a.$h(c,f)))};c.prototype.Cq=function(a,b){void 0===b&&(b=-1);if(-1===b){var c=this.wy;var e=this.oo.CharstringType}else e=this.pm[b],c=e.Subrs,e=e.CharstringType;var f=this.ya.Bm(c);return this.ya.$h(c,a+(0===e?0:1240>f?107:
33900>f?1131:32768))};c.prototype.qv=function(a){return this.qm?this.qm.fi(a):0};c.prototype.gm=function(a,b,c,e){a.translate(c,e);var d=this.oo.CharStrings,h=this.qv(b);ug(this.ya.$h(d,b),a,h,this);a.translate(-c,-e)};return c}(),vg=0,wg=1,U=2,xg=3,yg={};function W(c,a,b,d){var e=b instanceof Array;yg[a]={name:c,Jp:d,type:e?b:[b],fn:function(a,d){a[c]=e||b===xg?d:d[0]}}}W("version",0,vg);W("Notice",1,vg);W("Copyright",12,vg);W("FullName",2,vg);W("FamilyName",3,vg);W("Weight",4,vg);
W("isFixedPitch",3073,wg,!1);W("ItalicAngle",3074,U,0);W("UnderlinePosition",3075,U,-100);W("UnderlineThickness",3076,U,50);W("PaintType",3077,U,0);W("CharstringType",3078,U,2);W("FontMatrix",3079,xg,[.001,0,0,.001,0,0]);W("UniqueID",13,U);W("FontBBox",5,xg,[0,0,0,0]);W("StrokeWidth",3080,U,0);W("XUID",14,xg);W("charset",15,U,0);W("Encoding",16,U,0);W("CharStrings",17,U,0);W("Private",18,[U,U]);W("SyntheticBase",3092,U);W("PostSCript",3093,vg);W("BaseFontName",3094,vg);W("BaseFontBlend",3095,vg);
W("ROS",3102,[vg,vg]);W("CIDFontVersion",3103,U,0);W("CIDFontRevision",3104,U,0);W("CIDFontType",3105,U,0);W("CIDCount",3106,U);W("FDArray",3108,U);W("FDSelect",3109,U);W("FontName",3110,vg);W("BlueValues",6,U);W("OtherBlues",7,U);W("FamilyBlues",8,U);W("FamilyOtherBlues",9,U);W("BlueScale",3081,U,.039625);W("BlueShift",3082,8);W("BlueFuzz",3073,1);W("StdHW",10,U);W("StdVW",11,U);W("StemSnapH",3084,U);W("StemSnapV",3085,U);W("ForceBold",3086,wg,!1);W("LanguageGroup",3089,U,0);
W("ExpansionFactor",3090,U,.6);W("initialRandomSeed",3091,U,0);W("Subrs",19,U);W("defaultWidthX",20,U);W("NominalWidthX",21,U);
function sg(c,a,b){for(;!c.lm();){var d=c.vq();if(d.code in yg){var e=yg[d.code],f=[],h=0;a:for(;h<e.type.length;h++){var k=e.type[h];if(h>=d.ud.length)throw Error("Not enough operands for instruction:"+d);var l=d.ud[h];switch(k){case vg:f.push(b.Dg(l));break;case wg:f.push(!!l);break;case xg:f=d.ud;break a;case U:f.push(l)}}e.fn(a,f)}else Zf("Uknown dict opcode: %s",d.code)}for(var n in yg)e=yg[n],!e.Jp||e.name in a||(a[e.name]=e.Jp);return a}
function ug(c,a,b,d,e){for(e=e||{first:!0,width:0,ri:0,stack:[],x:0,y:0,bg:!1,nb:0,ob:0};!c.lm();){switch(c.vq(!0,e.stack).code){case 1:case 3:e.stack.length&1&&zg(e);break;case 4:1<e.stack.length&&zg(e);e.y+=e.stack[0];Ag(e,a);break;case 5:for(var f=0;f+1<e.stack.length;f+=2)e.x+=e.stack[f],e.y+=e.stack[f+1],a.lineTo(e.x,e.y);break;case 6:for(f=0;f<e.stack.length;f+=2)e.x+=e.stack[f],a.lineTo(e.x,e.y),f+1<e.stack.length&&(e.y+=e.stack[f+1],a.lineTo(e.x,e.y));break;case 7:for(f=0;f<e.stack.length;f+=
2)e.y+=e.stack[f],a.lineTo(e.x,e.y),f+1<e.stack.length&&(e.x+=e.stack[f+1],a.lineTo(e.x,e.y));break;case 8:Bg(e,a);break;case 10:ug(d.Cq(e.stack.pop(),b),a,b,d,e);continue;case 11:return;case 14:e.stack.length&&zg(e);e.bg&&a.lineTo(e.nb,e.ob);break;case 18:case 23:e.stack.length&1&&zg(e);e.ri+=e.stack.length>>1;break;case 19:case 20:e.stack.length&1&&zg(e);e.ri+=e.stack.length>>1;f=e.ri+7>>3;for(var h=0;h<f;h++)c.ma(1);break;case 21:e.stack.length&1&&zg(e);e.x+=e.stack[0];e.y+=e.stack[1];Ag(e,a);
break;case 22:2===e.stack.length&&zg(e);e.x+=e.stack[0];Ag(e,a);break;case 24:Bg(e,a);e.y+=e.stack.pop();e.x+=e.stack.pop();a.lineTo(e.x,e.y);break;case 25:for(f=0;f<e.stack.length-6;f+=2)e.x+=e.stack[f],e.y+=e.stack[f+1],a.lineTo(e.x,e.y);Bg(e,a,f);break;case 26:var k=e.stack.length&1;k&&(e.x+=e.stack[0]);for(;k<e.stack.length;k+=4){f=e.x;h=e.y+=e.stack[k+0];var l=e.x+=e.stack[k+1],n=e.y+=e.stack[k+2],q=e.x,u=e.y+=e.stack[k+3];a.bezierCurveTo(f,h,l,n,q,u)}break;case 27:if(k=e.stack.length&1)e.y+=
e.stack[0];for(;k<e.stack.length;k+=4)f=e.x+=e.stack[k+0],h=e.y,l=e.x+=e.stack[k+1],n=e.y+=e.stack[k+2],q=e.x+=e.stack[k+3],u=e.y,a.bezierCurveTo(f,h,l,n,q,u);break;case 29:ug(d.Cq(e.stack.pop(),-1),a,b,d,e);continue;case 30:Cg(e,!1,a);break;case 31:Cg(e,!0,a);break;case 3075:case 3076:case 3077:case 3081:case 3082:case 3083:case 3084:case 3086:case 3087:case 3090:case 3092:case 3093:case 3094:case 3095:case 3096:case 3098:case 3099:case 3100:case 3101:case 3102:case 3106:case 3107:case 3108:case 3109:throw Error("Not implemented.");
}e.stack.length=0}}function Ag(c,a){c.bg&&a.lineTo(c.nb,c.ob);c.nb=c.x;c.ob=c.y;c.bg=!0;a.moveTo(c.x,c.y)}function Bg(c,a,b){for(void 0===b&&(b=0);b+5<c.stack.length;b+=6){var d=c.x+=c.stack[b+0],e=c.y+=c.stack[b+1],f=c.x+=c.stack[b+2],h=c.y+=c.stack[b+3],k=c.x+=c.stack[b+4],l=c.y+=c.stack[b+5];a.bezierCurveTo(d,e,f,h,k,l)}}
function Cg(c,a,b){for(var d=0;d+1<c.stack.length;d+=4){var e=d==c.stack.length-5;if(a){var f=c.x+=c.stack[d+0],h=c.y,k=c.x+=c.stack[d+1],l=c.y+=c.stack[d+2],n=e?c.x+=c.stack[d+4]:c.x;e=c.y+=c.stack[d+3]}else f=c.x,h=c.y+=c.stack[d+0],k=c.x+=c.stack[d+1],l=c.y+=c.stack[d+2],n=c.x+=c.stack[d+3],e=e?c.y+=c.stack[d+4]:c.y;b.bezierCurveTo(f,h,k,l,n,e);a=!a}}function zg(c){c.first?(c.width=c.stack.shift(),c.first=!1):(Zf("Warning; already have width"),c.stack.shift())}
var rg=function(){function c(a){this.ya=a;this.ar=0;this.format=a.ma(1);Zf("Reading FDSelect format %s",this.format);if(3!==this.format&&0!==this.format)throw Error("Can't read format "+this.format+" FDSelect");3===this.format&&(this.ar=a.ma(2))}c.prototype.fi=function(a){var b=this;if(0===this.format)return this.ya.seek(1+a),this.ya.ma(1);var c=-1;qg(this.ar,function(d){b.ya.seek(3+3*d);d=b.ya.ma(2);c=b.ya.ma(1);var e=b.ya.ma(2);return a<d?-1:a>=e?1:0});return c};return c}(),tg=".notdef space exclam quotedbl numbersign dollar percent ampersand quoteright \nparenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven \neight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U\nV W X Y Z bracketleft backslash bracketright asciicircum underscore quoteleft a b c d e f g h i j k \nl m n o p q r s t u v w x y z braceleft bar braceright asciitilde exclamdown cent sterling fraction\nyen florin section currency quotesingle quotedblleft guillemotleft guilsinglleft guilsinglright fi\nfl endash dagger daggerdbl periodcentered paragraph bullet quotesinglbase quotedblbase quotedblright\nguillemotright ellipsis perthousand questiondown grave acute circumflex tilde macron breve dotaccent \ndieresis ring cedilla hungarumlaut ogonek caron emdash AE ordfeminine Lslash Oslash OE ordmasculine \nae dotlessi lslash oslash oe germandbls onesuperior logicalnot mu trademark Eth onehalf plusminus \nThorn onequarter divide brokenbar degree thorn threequarters twosuperior registered minus eth \nmultiply threesuperior copyright Aacute Acircumflex Adieresis Agrave Aring Atilde Ccedilla Eacute \nEcircumflex Edieresis Egrave Iacute Icircumflex Idieresis Igrave Ntilde Oacute Ocircumflex \nOdieresis Ograve Otilde Scaron Uacute Ucircumflex Udieresis Ugrave Yacute Ydieresis Zcaron aacute \nacircumflex adieresis agrave aring atilde ccedilla eacute ecircumflex edieresis egrave iacute \nicircumflex idieresis igrave ntilde oacute ocircumflex odieresis ograve otilde scaron uacute \nucircumflex udieresis ugrave yacute ydieresis zcaron exclamsmall Hungarumlautsmall dollaroldstyle \ndollarsuperior ampersandsmall Acutesmall parenleftsuperior parenrightsuperior twodotenleader \nonedotenleader zerooldstyle oneoldstyle twooldstyle threeoldstyle fouroldstyle fiveoldstyle \nsixoldstyle sevenoldstyle eightoldstyle nineoldstyle commasuperior threequartersemdash \nperiodsuperior questionsmall asuperior bsuperior centsuperior dsuperior esuperior isuperior \nlsuperior msuperior nsuperior osuperior rsuperior ssuperior tsuperior ff ffi ffl parenleftinferior \nparenrightinferior Circumflexsmall hyphensuperior Gravesmall Asmall Bsmall Csmall Dsmall Esmall \nFsmall Gsmall Hsmall Ismall Jsmall Ksmall Lsmall Msmall Nsmall Osmall Psmall Qsmall Rsmall Ssmall \nTsmall Usmall Vsmall Wsmall Xsmall Ysmall Zsmall colonmonetary onefitted rupiah Tildesmall \nexclamdownsmall centoldstyle Lslashsmall Scaronsmall Zcaronsmall Dieresissmall Brevesmall Caronsmall \nDotaccentsmall Macronsmall figuredash hypheninferior Ogoneksmall Ringsmall Cedillasmall \nquestiondownsmall oneeighth threeeighths fiveeighths seveneighths onethird twothirds zerosuperior \nfoursuperior fivesuperior sixsuperior sevensuperior eightsuperior ninesuperior zeroinferior \noneinferior twoinferior threeinferior fourinferior fiveinferior sixinferior seveninferior \neightinferior nineinferior centinferior dollarinferior periodinferior commainferior Agravesmall \nAacutesmall Acircumflexsmall Atildesmall Adieresissmall Aringsmall AEsmall Ccedillasmall Egravesmall \nEacutesmall Ecircumflexsmall Edieresissmall Igravesmall Iacutesmall Icircumflexsmall Idieresissmall \nEthsmall Ntildesmall Ogravesmall Oacutesmall Ocircumflexsmall Otildesmall Odieresissmall OEsmall \nOslashsmall Ugravesmall Uacutesmall Ucircumflexsmall Udieresissmall Yacutesmall Thornsmall \nYdieresissmall 001.000 001.001 001.002 001.003 Black Bold Book Light Medium Regular Roman Semibold".split(/\s+/);
function pg(c){this.od=c;this.Qg={x:0,y:0};this.advance={x:0,y:0}}
var ng=function(){function c(a){this.Jl=[];this.Iq=hg(a,"{\n    majorVersion:uint16\n    minorVersion:uint16\n    scriptListOffset:uint16\n    featureListOffset:uint16\n    lookupListOffset:uint16\n    featureVariationsOffset:uint16\n\n    push scriptListOffset\n    scriptCount:uint16\n    scriptRecords:[scriptCount] {\n        tag:string(4)\n        scriptOffset:uint16\n        push scriptOffset\n        defaultLangSys:uint16\n        langSysCount:uint16\n        langSysRecords:[langSysCount] {\n            langSysTag:string(4)\n            langSysOffset:uint16\n            push langSysOffset\n            lookupOrder:uint16\n            requiredFeatureIndex:uint16\n            featureIndexCount:uint16\n            featureIndices:[featureIndexCount] uint16\n            pop\n        }\n        pop\n    }\n    pop\n\n    push lookupListOffset\n    lookupCount:uint16\n    lookups:[lookupCount] {\n        offset:uint16\n        push offset\n        lookupType:uint16\n        lookupFlag:uint16\n        subTableCount:uint16\n        subTables:[subTableCount] {\n            offset:uint16\n            push offset\n            posFormat:uint16\n            coverageOffset:uint16\n        }\n        pop\n    }\n    pop\n\n    push featureListOffset\n    featureCount:uint16\n    featureRecords[featureCount] {\n        featureTag:string(4)\n        featureOffset:uint16\n        push featureOffset\n        featureParams:uint16\n        lookupIndexCount:uint16\n        lookupListIndicies:[lookupIndexCount] uint16\n        pop\n    }\n    pop\n}");for(var b=
this.Iq.lookupListOffset,c=0,e=this.Iq.lookups;c<e.length;c++){var f=e[c],h=b+f.offset,k=f.lookupType;Zf("Lookup type %s has %s subtables",k,f.subTables.length);var l=0;for(f=f.subTables;l<f.length;l++){var n=f[l],q=h+n.offset;2===k&&1===n.posFormat?this.Jl.push(new Dg(a.slice(q))):2===k&&2===n.posFormat&&this.Jl.push(new Eg(a.slice(q)))}}}c.prototype.ci=function(a){for(var b=0,c=this.Jl;b<c.length;b++)c[b].ci(a)};return c}(),Fg=function(){function c(a){this.ya=a;this.mk=4;this.format=a.ma(2);this.count=
a.ma(2);Zf("CoverageTable format %s count %s",this.format,this.count)}c.prototype.vm=function(a){var b=this,c=-1;1===this.format?qg(this.count,function(d){b.ya.seek(b.mk+2*d);d=b.ya.ma(2);if(a<d)return-1;if(a>d)return 1;c=d;return 0}):qg(this.count,function(d){b.ya.seek(b.mk+6*d);d=b.ya.ma(2);b.ya.ma(2);var e=b.ya.ma(2);if(a<d)return-1;if(a>d)return 1;c=e+a-d;return 0});return c};return c}(),Gg=function(c){function a(a){var b=c.call(this,a)||this;b.ns=0;1===b.format&&(b.ns=b.count,b.count=a.ma(2),
b.mk+=2);return b}__extends(a,c);a.prototype.nq=function(a){return Math.max(0,this.vm(a-this.ns))};return a}(Fg);function Hg(c,a,b){b&1&&(a.Qg.x=c.getInt16());b&2&&(a.Qg.y=c.getInt16());b&4&&(a.advance.x=c.getInt16());b&8&&(a.advance.y=c.getInt16());b&16&&c.getInt16();b&32&&c.getInt16();b&64&&c.getInt16();b&128&&c.getInt16()}
var Ig=function(){function c(){}c.prototype.ci=function(a){for(var b=0;b<a.length-1;b++)b+=this.fi(a[b],a[b+1])};return c}(),Dg=function(c){function a(a){var b=c.call(this)||this;b.ya=a;a.ma(2);var e=a.ma(2);b.Vl=new Fg(a.slice(e));b.Ti=a.ma(2);b.Ui=a.ma(2);b.count=a.ma(2);b.px=2*Jg(b.Ti)+2*Jg(b.Ui)+2;return b}__extends(a,c);a.prototype.fi=function(a,c){var b=this,d=this.Vl.vm(a.od);if(-1===d)return 0;this.ya.seek(10+2*d);this.ya.seek(this.ya.ma(2));var h=this.ya.wd;d=this.ya.ma(2);return 0<=qg(d,
function(d){b.ya.seek(h+d*b.px);d=b.ya.ma(2);if(d<c.od)return-1;if(d>c.od)return 1;Hg(b.ya,a,b.Ti);Hg(b.ya,c,b.Ui);return 0})?1:0};return a}(Ig),Eg=function(c){function a(a){var b=c.call(this)||this;b.ya=a;a.ma(2);b.Vl=new Fg(a.slice(a.ma(2)));b.Ti=a.ma(2);b.Ui=a.ma(2);b.Qt=new Gg(a.slice(a.ma(2)));b.Rt=new Gg(a.slice(a.ma(2)));b.xz=a.ma(2);b.Pt=a.ma(2);b.Ir=2*Jg(b.Ti)+2*Jg(b.Ui);return b}__extends(a,c);a.prototype.fi=function(a,c){if(-1===this.Vl.vm(a.od))return 0;var b=this.Qt.nq(a.od),d=this.Rt.nq(c.od);
this.ya.seek(16+b*this.Ir*this.Pt+d*this.Ir);Hg(this.ya,a,this.Ti);Hg(this.ya,c,this.Ui);return 1};return a}(Ig),og=function(c){function a(a,d){void 0===d&&(d=a.ma(2));var b=c.call(this)||this;b.ya=a;b.count=d;Zf("Kern table has %s entries",b.count);return b}__extends(a,c);a.prototype.fi=function(a,c){var b=this,d=a.od<<16|c.od,h=0;qg(this.count,function(a){b.ya.seek(8+6*a);a=b.ya.ma(4);if(d<a)return-1;if(d>a)return 1;a=b.ya.getInt16();c.Qg.x+=a;c.advance.x+=a;h=1;return 0});return h};return a}(Ig);
function Jg(c){c-=c>>1&1431655765;c=(c&858993459)+(c>>2&858993459);return 16843009*(c+(c>>4)&252645135)>>24};"undefined"!==typeof jQuery&&(jQuery.fn.zwibbler=function(c){void 0===c&&(c={});var a=null;this.each(function(b,d){d.zwibbler&&jQuery(d).empty();a=new S(d,c);d.zwibbler=a});return a},jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});
var Z=function(){function c(){this.Rm=[];this.buttons=[];this.Zl={};this.fonts=new jg;this.Le={};this.log=y.create("ZWIBBLER");this.WebSocket=WebSocket;this.Ad=new Ja;this.controllers={};this.Js=S}c.prototype.create=function(a,b){"string"===typeof a&&0<a.length&&"."!==a.charAt(0)&&"#"!==a.charAt(0)&&(a="#"+a);var c=A.jc(a);if(!c)throw alert("Zwibbler.create: Cannot find an element with id "+a),Error("Error in Zwibbler.creawte");return new S(c,b)};c.prototype.et=function(a){for(var b=["name","image",
"onclick"],c=0;c<b.length;c++)if(!(b[c]in a))return alert("Zwibbler.addButton: missing "+b[c]),!1;this.buttons.push(a);return!0};c.prototype.gt=function(a,b){this.Zl[a]=b};c.prototype.Qs=function(a,b){void 0===b&&(b={});return this.vl(a,b)};c.prototype.vl=function(a,b){void 0===b&&(b={});return Oa(a,b)};c.prototype.ku=function(a,b){return this.Vf(a,b)};c.prototype.Ab=function(a,b){O.Ab(a,function(a,c,f,h){b(new fb(O,a,c,f,h))})};c.prototype.Vf=function(a,b,c){function d(){var a=x.kc(),b=1,d=0,e=0;
l&&(a.y=l);u&&(a.height=u-a.y);n&&(a.x=n);q&&(a.width=q-a.x);h&&k?b=Math.min(h/a.width,k/a.height):h?(b=h/a.width,k=a.height*b):k?(b=k/a.height,h=a.width*b):(h=a.width,k=a.height);a.width*b<h&&(d=h/2-a.width*b/2);a.height*b<k&&(e=k/2-a.height*b/2);d-=a.x*b;e-=a.y*b;v.width=Math.ceil(h);v.height=Math.ceil(k);w.translate(d,e);w.scale(b,b);x.ia(w);f.log("Drawn.");c(v)}var f=this;void 0===b&&(b={});void 0===c&&(c=function(){});var h=b.width||0,k=b.height||0,l=b.top||0,n=b.left||0,q=b.right||0,u=b.bottom||
0,v=qc(null),w=v.getContext("2d"),x=zf.mh(a,null,{});if(!x)throw Error("Zwibbler.render: Could not open document");var z=new Wc;x.format(w,z);z.oa("reformat",function(a){x.ki(a)});z.pg?z.oa("done",function(){x.format(w,z);d()}):d();return v};c.prototype.save=function(a,b){return new Promise(function(c,e){var d=zf.mh(a,null,{});if(d){d.Wh("background")||d.setProperty("background","white");var h=qc(null).getContext("2d"),k=new Wc;k.oa("reformat",function(a){d.ki(a)});k.oa("done",function(){try{d.format(h,
k);var a=zf.Xi(d,b,"string");c(a)}catch(n){e(n)}});d.format(h,k)}else e(Error("Failed to open document"))})};c.prototype.ax=function(a){a=r.de(a);return{r:a.values[0],g:a.values[1],b:a.values[2],a:a.values[3]}};c.prototype.qw=function(a){return(new r(r.RGBA,[a.r,a.g,a.b,a.a])).toString()};c.prototype.Wu=function(a){var b=document.createElement("a");b.href=a;return b.href};c.prototype.Dt=function(a){return Ba(Ca(a))};c.prototype.it=function(a){var b=this;return this.fonts.add(a).then(function(c){b.Xe('\n@font-face {\n    font-family: "'+
c[0].Af+'";\n    src: url("'+a+'");\n}');return c[0].Af})};c.prototype.Ps=function(a){return new N(a)};c.prototype.Is=function(a){var b=new N;Pc(b,a);return b.Ob()};c.prototype.uq=function(a,b){var c=document.createElement("img");c.src=a;c.onload=function(){b(c.naturalWidth,c.naturalHeight,c)}};c.prototype.Lx=function(a,b){return rc(a,b)};c.prototype.By=function(a){return this.Ni(a)};c.prototype.xk=function(){var a=document.createElement("DIV");return!!(a.requestFullscreen||a.msRequestFullscreen||
a.Bw||a.webkitRequestFullscreen)};c.prototype.Ni=function(a){var b=A.jc(a);if(!b)throw Error("Zwibbler.toggleFullScreen: "+a+" not found");a=document;this.Qq()?document.exitFullscreen?document.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.Aw?a.Aw():a.webkitExitFullscreen&&a.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.Bw?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):
console.log("Element does not contain any requestFullscreen methods")};c.prototype.Qq=function(){var a=document;return a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?!0:!1};c.prototype.Au=function(){y.zu()};c.prototype.Fq=function(a){return mc.Ls(a)};c.prototype.Xe=function(a){this.Ad.Om(a)};c.prototype.controller=function(a,b){this.controllers[a]=b};c.prototype.vj=function(a,b){O.vj(a,b);this.Le[a]=b};c.prototype.iv=function(a){return a in this.Le?JSON.parse(JSON.stringify(this.Le[a].sa||
{})):{}};c.prototype.zj=function(a,b,c,e){void 0===c&&(c={});void 0===e&&(e=null);if("object"!==typeof a||"string"!==typeof b)throw Error("Bad arguments passed to createComponent");return O.zj(a,b,c,e)};c.prototype.pu=function(a){O.detach(a);A(a).remove()};c.prototype.qc=function(a,b){var c=A.jc(a);if(!c)throw Error("Zwibbler.attach: Cannot find element from "+a);return Lf(c,b,!0)};c.prototype.detach=function(a){O.detach(a)};c.prototype.qt=function(a){return"string"!==typeof a.url?Promise.reject(Error("Zwibbler.ajax: settings.url missing")):
Ia({url:a.url,method:a.method,wr:a.params,mimeType:a.mimeType,contentType:a.contentType,withCredentials:a.withCredentials,data:a.data,Lp:a.delay}).then(function(a){O.digest();return a},function(a){O.digest();throw a;})};c.prototype.Tx=function(a,b){var c=bc();c[a]=b;var e;var f=[];var h=!0;for(e in c)c.hasOwnProperty(e)&&("/"===e.charAt(0)?(h||f.unshift("&"),""!==c[e]&&(f.unshift(encodeURIComponent(c[e])),f.unshift("=")),f.unshift("/"+encodeURIComponent(e.substr(1))),h=!1):(h||f.push("&"),h=!1,f.push(encodeURIComponent(e)),
""!==c[e]&&(f.push("="),f.push(encodeURIComponent(c[e])))));window.location.hash=f.join("")};return c}();
document.addEventListener("dragstart",function(c){var a=c.target;if("IMG"===a.tagName){var b={},d=a.getAttribute("zwibbler-props");if(d)try{b=JSON.parse(d)}catch(e){console.log(Error("Could not parse z-property value as JSON:"+d))}a={"zwibbler-src":a.getAttribute("zwibbler-src"),"zwibbler-width":a.getAttribute("zwibbler-width"),"zwibbler-props":b};a["zwibbler-src"]&&c.dataTransfer.setData("text",JSON.stringify(a))}});var P=new Z,Kg=ic;void 0===Kg&&(Kg=window.location.href);
var Lg=ac(Kg,"?").module||"Zwibbler";"function"===typeof define&&define.amd&&define(Lg,["exports"],function(c){c.Zwibbler=P});window[Lg]=P;P.instances=P.Rm;Z.prototype.addButton=Z.prototype.et;Z.prototype.addCustomNode=Z.prototype.gt;Z.prototype.Popup=Z.prototype.Qs;Z.prototype.Dialog=Z.prototype.vl;Z.prototype.createPreview=Z.prototype.ku;Z.prototype.directive=Z.prototype.Ab;Z.prototype.render=Z.prototype.Vf;Z.prototype.save=Z.prototype.save;Z.prototype.parseColour=Z.prototype.ax;
Z.prototype.makeColour=Z.prototype.qw;Z.prototype.getAbsoluteUrl=Z.prototype.Wu;Z.prototype.base64Encode=Z.prototype.Dt;Z.prototype.addFont=Z.prototype.it;Z.prototype.PathCommands=Z.prototype.Ps;Z.prototype.CommandsFromSvgPath=Z.prototype.Is;Z.prototype.getImageSize=Z.prototype.uq;Z.prototype.setColourOpacity=Z.prototype.Lx;Z.prototype.toggleFullScreen=Z.prototype.By;Z.prototype.isFullscreenSupported=Z.prototype.xk;Z.prototype.toggleFullscreen=Z.prototype.Ni;Z.prototype.isFullScreen=Z.prototype.Qq;
Z.prototype.enableConsoleLogging=Z.prototype.Au;Z.prototype.hasConfig=Z.prototype.Fq;Z.prototype.injectStyle=Z.prototype.Xe;Z.prototype.controller=Z.prototype.controller;Z.prototype.component=Z.prototype.vj;Z.prototype.createComponent=Z.prototype.zj;Z.prototype.destroyComponent=Z.prototype.pu;Z.prototype.attach=Z.prototype.qc;Z.prototype.detach=Z.prototype.detach;Z.prototype.ajax=Z.prototype.qt;Z.prototype.setHashValue=Z.prototype.Tx;Z.prototype.Context=Z.prototype.Js;window.Zwibbler=P;function Mg(c){return{m11:c.m11,m12:c.m21,m21:c.m12,m22:c.m22,dx:c.Da,dy:c.Ea}}
var Ng=function(){function c(a,b){this.node=a;this.request=b}c.prototype.Uu=function(a,b,c){this.node.hq(b,a,this.request,c)};c.prototype.pv=function(a){return this.node.sq(a)};c.prototype.af=function(){this.request.Tg(this.node.id)};c.prototype.nw=function(a,b){this.request.add(this.node.id,"image",a,null,b)};c.prototype.Hu=function(a){this.node.Up(a,!0)};c.prototype.vy=function(a){this.node.Up(a,!1)};c.prototype.Vu=function(a,b){var c=new ld;b.text&&c.ah(b.text);if(b.font){var e=Ed(b.font);c.cs(e.fontFamily||
"arial",parseFloat(e.fontSize),"bold"===e.fontWeight,"italic"===e.fontStyle,b.textDecoration||"")}c.Ln(b.halign||null,b.valign||null);c.format(a,b.width||0,b.height||0);return{draw:function(a,b,d){c.ia(a,b,d)},width:c.rect.width,height:c.rect.height}};c.prototype.Yb=function(){return 1};c.prototype.bx=function(a){return new Gd(a)};c.prototype.ee=function(a){return this.request.ee(a)};c.prototype.Fy=function(a,b){var c=this.node.La().apply(a,b);return{x:c.x,y:c.y}};return c}(),Yf=function(c){function a(a,
d){var b=c.call(this,a,d)||this;b.Ya=null;b.log=y.create("CUSTOM");b.setProperty("matrix",new J);return b}__extends(a,c);a.prototype.type=function(){return"CustomNode"};a.prototype.ng=function(){return!0};a.prototype.setProperty=function(a,d){if(null===this.Ya&&"nodeType"===a){var b=P.Zl[d];this.Ya=new b(this.id);for(var f in this.da)this.setProperty(f,this.da[f]);this.da.nodeType=d}else d=c.prototype.setProperty.call(this,a,d),"matrix"===a&&(d=Mg(d)),this.Ya&&this.Ya.setProperty&&this.Ya.setProperty(a,
d)};a.prototype.We=function(){return this.Ya&&this.Ya.hasEditMode?this.Ya.hasEditMode():!1};a.prototype.xm=function(){var a=[];this.Ya&&this.Ya.getEditHandles&&(a=this.Ya.getEditHandles());for(var c=this.La(),e=[],f=0;f<a.length;f++){var h=a[f];e.push(c.apply(h.x||0,h.y||0))}return e};a.prototype.xb=function(a,c){var b=this.fe().apply(a,c);return this.hidden()||this.ka("locked")||!this.Ja.bd(b.x,b.y)||this.Ya&&this.Ya.hittest&&!this.Ya.hittest(b.x,b.y)?null:this};a.prototype.Jj=function(a,c){a.beginPath();
for(var b=10/c,d=2/c,h=0,k=this.xm();h<k.length;h++){var l=k[h];a.moveTo(l.x+b/c,l.y);a.arc(l.x,l.y,b,0,2*Math.PI,!1)}a.strokeStyle="#0050B7";a.lineWidth=d;a.stroke()};a.prototype.Tj=function(){this.xm()};a.prototype.nk=function(a,c,e){for(var b=this.xm(),d=0;d<b.length;d++)if(20>b[d].Lb(new F(a,c))/e)return d;return null};a.prototype.ne=function(a,c,e){this.Ya&&this.Ya.moveEditHandle&&(c=this.fe().apply(c,e),this.Ya.moveEditHandle(a,c.x,c.y))};a.prototype.ka=function(a){var b;this.Ya&&this.Ya.getProperty&&
(b=this.Ya.getProperty(a));void 0===b&&(b=c.prototype.ka.call(this,a));"matrix"===a&&(b=b?b instanceof J?b:new J(b.m11||1,b.m21||0,b.m12||0,b.m22||1,b.dx||0,b.dy||0):new J);return b};a.prototype.bf=function(a){c.prototype.bf.call(this,a);this.Ya.setHidden&&this.Ya.setHidden(a)};a.prototype.format=function(a,c){if(this.Ya)if(this.Mb||(this.Mb=new Ng(this,c)),"format"in this.Ya&&this.Ya.format(a,this.Mb),this.Ya.getUntransformedRect){var b=this.Ya.getUntransformedRect();this.Ja=new I(b.x||0,b.y||0,
b.width||0,b.height||0);this.rect=this.Ja.clone();this.rect.transform(this.La())}else this.log("Error: NodeType %s missing getUntransformedRect()",this.da.nodeType)};a.prototype.lf=function(a){this.hidden()||(a.save(),a.getTransform=function(){return a.Vi?Mg(a.Vi):Mg(new J)},this.Mb.getScale=function(){return a.Vi?a.Vi.Yb().x:1},this.Ya.draw(a,this.Mb),a.restore())};return a}(ed);ed.kd("CustomNode",Yf);Ng.prototype.formatFill=Ng.prototype.Uu;Ng.prototype.getFill=Ng.prototype.pv;
Ng.prototype.reformat=Ng.prototype.af;Ng.prototype.loadImage=Ng.prototype.nw;Ng.prototype.fillEraser=Ng.prototype.Hu;Ng.prototype.strokeEraser=Ng.prototype.vy;Ng.prototype.formatText=Ng.prototype.Vu;Ng.prototype.getScale=Ng.prototype.Yb;Ng.prototype.parseFont=Ng.prototype.bx;Ng.prototype.getConfig=Ng.prototype.ee;Ng.prototype.transformPoint=Ng.prototype.Fy;}).call(window);
//# sourceMappingURL=zwibbler-demo.js.map